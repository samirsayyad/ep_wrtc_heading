{"version":3,"sources":["copyPasteEvents.js","getStats.min.js","getUserMediaPolyfill.js","adapter.js","jquery.tmpl.min.js","clientShare.js","textChat.js","videoChat.js","webrtc.js","webrtcRoom.js"],"names":["_","require","randomString","events","padInner","getFirstColumnOfSelection","line","rep","firstLineOfSelection","selStart","getLastColumnOfSelection","lastLineOfSelection","nextLine","startLineOffset","lines","offsetOfIndex","getLength","selEnd","hasCommentOnLine","lineNumber","firstColumn","lastColumn","attributeManager","foundHeadOnLine","headId","column","object","getAttributesOnPosition","headingTagId","getSelectionHtml","html","window","getSelection","sel","contents","rangeCount","container","document","createElement","i","len","appendChild","getRangeAt","cloneContents","innerHTML","selection","type","createRange","htmlText","Object","freeze","addTextOnClipboard","e","aces","inner","removeSelection","headerId","hTag","content","callWithAce","ace","ace_hasHeaderOnSelection","hasVideoHeader","hasMultipleLine","rawHtml","$","append","find","removeClass","index","css","match","join","addClass","selectionMultipleLine","closest","eq","prop","toLowerCase","originalEvent","clipboardData","setData","preventDefault","execCommand","hasHeaderOnSelection","this","documentAttributeManager","selectionOfMultipleLine","hasMultipleLineSelected","foundLineWithComment","hasCommentOnMultipleLineSelection","getStats","mediaStreamTrack","callback","interval","getStatsLooper","getStatsWrapper","results","forEach","result","keys","getStatsParser","key","console","error","message","stack","peer","iceConnectionState","search","nomore","getStatsResult","datachannel","state","ended","audio","video","bandwidth","speed","bytesSent","helper","audioBytesSent","videoBytesSent","setTimeout","cb","InstallTrigger","isSafari","then","res","items","r","push","item","names","name","stat","id","timestamp","that","browserFakeUserAgent","global","navigator","userAgent","getUserMedia","log","arguments","documentElement","captureStream","mozCaptureStream","obj","getContext","play","pause","drawImage","toDataURL","HTMLVideoElement","location","protocol","href","hash","screen","width","height","URL","createObjectURL","revokeObjectURL","MediaStreamTrack","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","systemNetworkType","connection","toString","encryption","send","tracks","codecs","availableBandwidth","streams","framerateMean","bitrateMean","recv","bytesReceived","latency","packetsLost","systemBandwidth","sentPerSecond","encodedPerSecond","videoBytestSent","connectionType","systemIpAddress","local","candidateType","transport","ipAddress","networkType","remote","resolutions","internal","candidates","checkIfOfferer","isOfferer","googInitiator","test","googCertificate","googFingerprintAlgorithm","fingerprintAlgorithm","checkAudioTracks","mediaType","sendrecvType","split","pop","isRemote","indexOf","googCodecName","kilobytes","prevBytesSent","bytes","toFixed","prevBytesReceived","googTrackId","googCurrentDelayMs","prevGoogCurrentDelayMs","prevPacketsLost","checkVideoTracks","googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","prevFramerateMean","prevBitrateMean","bweforvideo","availableSendBandwidth","googAvailableSendBandwidth","googActualEncBitrate","googAvailableReceiveBandwidth","googRetransmitBitrate","googTargetEncBitrate","googBucketDelay","googTransmitBitrate","candidatePair","googActiveConnection","cid","candidate","googLocalAddress","googRemoteAddress","googTransportType","localCandidate","localCandidateId","remoteCandidate","remoteCandidateId","selected","nominated","mozLocalTransport","mozRemoteTransport","availableOutgoingBitrate","prevAvailableOutgoingBitrate","availableIncomingBitrate","prevAvailableIncomingBitrate","LOCAL_candidateType","LOCAL_transport","LOCAL_ipAddress","LOCAL_networkType","localcandidate","portNumber","priority","REMOTE_candidateType","REMOTE_transport","REMOTE_ipAddress","REMOTE_networkType","remotecandidate","dataSentReceived","parseInt","inboundrtp","outboundrtp","track","remoteSource","frameWidth","frameHeight","SSRC","ssrc","length","module","exports","define","amd","mediaDevices","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","constraints","Promise","resolve","reject","stream","RTCIceGatherer","Error","f","self","adapter","n","t","o","c","u","a","code","p","call","1","adapterFactory","./adapter_factory.js","2","defineProperty","value","_ref","undefined","options","shimChrome","shimFirefox","shimEdge","shimSafari","logging","utils","browserDetails","detectBrowser","commonShim","extractVersion","disableLog","disableWarnings","browser","chromeShim","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimGetStats","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimConnectionState","shimMaxMessageSize","shimSendThrowTypeError","removeAllowExtmapMixed","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","edgeShim","shimGetDisplayMedia","shimReplaceTrack","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","_interopRequireWildcard","__esModule","newObj","prototype","hasOwnProperty","default","./chrome/chrome_shim","./common_shim","./edge/edge_shim","./firefox/firefox_shim","./safari/safari_shim","./utils","3","_typeof","Symbol","iterator","constructor","_getusermedia","enumerable","get","_getdisplaymedia","MediaStream","webkitMediaStream","_ontrack","set","removeEventListener","addEventListener","configurable","origSetRemoteDescription","setRemoteDescription","_this","_ontrackpoly","te","receiver","getReceivers","event","Event","transceiver","dispatchEvent","getTracks","apply","wrapPeerConnectionEvent","shimSenderWithDtmf","pc","dtmf","_dtmf","kind","createDTMFSender","_pc","getSenders","_senders","slice","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","idx","splice","origAddStream","addStream","_this2","origRemoveStream","removeStream","_this3","s","RTCRtpSender","origGetSenders","_this4","senders","origGetStats","_this5","_arguments","Array","selector","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","makeMapStats","stats","Map","map","successCallbackWrapper_","RTCRtpReceiver","_this6","filterStats","origGetReceivers","_this7","receivers","srcElement","err","DOMException","shimAddTrackRemoveTrackWithNative","version","origGetLocalStreams","getLocalStreams","_this11","nativeStreams","_reverseStreams","_this12","_streams","newStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","_this13","signalingState","alreadyExists","oldStream","method","nativeMethod","methodObj","_defineProperty","_this14","args","isLegacyCall","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","_this15","streamid","RTCIceCandidate","nativeAddIceCandidate","addIceCandidate","target","writable","_this8","_shimmedLocalStreams","streamId","_this9","existingSenders","newSenders","filter","newSender","concat","_this10","../utils.js","./getdisplaymedia","./getusermedia","4","getSourceId","getDisplayMedia","sourceId","widthSpecified","heightSpecified","frameRateSpecified","frameRate","mandatory","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","5","constraintsToChrome_","optional","cc","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","oc","mix","advanced","shimConstraints_","func","JSON","parse","stringify","remap","b","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","devices","dev","d","some","label","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","constraint","constraintName","onSuccess","onError","bind","origGetUserMedia","cs","getAudioTracks","getVideoTracks","stop","6","NativeRTCIceCandidate","substr","nativeCandidate","parsedCandidate","_sdp2","parseCandidate","augmentedCandidate","assign","toJSON","sdpMid","sdpMLineIndex","usernameFragment","_sctp","sctpInDescription","sections","splitSections","shift","mediaSection","mLine","parseMLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","matchPrefix","_getConfiguration","getConfiguration","sdpSemantics","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","Math","sctp","wrapDcSend","dc","origDataChannelSend","data","size","byteLength","readyState","TypeError","origCreateDataChannel","createDataChannel","dataChannel","channel","proto","completed","checking","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","nativeSRD","trim","_sdp","7","origMSTEnabled","ev","enabled","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","_rtcpeerconnectionShim2","config","iceServers","_filtericeservers","filterIceServers","replaceTrack","setTrack","_rtcpeerconnectionShim","../utils","./filtericeservers","rtcpeerconnection-shim","8","edgeVersion","hasTurn","server","urls","url","deprecated","isString","validTurn","startsWith","9","10","catch","11","RTCTrackEvent","modernStatsTypes","candidatepair","nativeGetStats","DataChannel","RTCDataChannel","12","preferredMediaSource","mediaSource","13","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","14","_localStreams","_addTrack","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","origCreateOffer","createOffer","origCreateAnswer","createAnswer","successCallback","failureCallback","promise","withCallback","_getUserMedia","shimConstraints","errcb","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","addTransceiver","offerToReceiveVideo","videoTransceiver","compactObject","15","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","bool","logDisabled_","deprecationWarnings_","oldMethod","newMethod","warn","isSecureContext","supportsUnifiedPlan","RTCRtpTransceiver","isObject","reduce","accumulator","isObj","isEmptyObject","walkStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","trackId","uastring","expr","pos","val","base","resultSet","has","endsWith","16","SDPUtils","writeMediaSection","caps","dtlsRole","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","foundation","ip","port","addRemoteCandidate","makeError","NotSupportedError","InvalidAccessError","OperationError","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","trackEvent","_dispatchEvent","_eventTarget","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","_createIceGatherer","bufferedCandidateEvents","bufferCandidates","end","_gather","onlocalcandidate","evt","cand","component","ufrag","serializedCandidate","writeCandidate","getMediaSections","getDescription","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","params","encodings","rtcp","cname","compound","rtcpParameters","receive","sessionpart","parseRtpParameters","isIceLite","isRejected","rejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","receiverList","iceOptions","splitLines","getKind","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","getCapabilities","codec","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","close","newState","states","new","closed","connected","disconnected","failed","connecting","numAudioTracks","numVideoTracks","writeSessionBoilerplate","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","mediaSectionsInOffer","localTrack","reducedSize","candidateString","senderOrReceiver","promises","all","allStats","ortcObjectName","nativeGetstats","nativeStats","mapStats","methods","17","random","blob","part","parts","substring","address","relatedAddress","relatedPort","tcpType","parseIceOptions","parseRtpMap","parsed","channels","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseSsrcGroup","semantics","ssrcs","parseFingerprint","algorithm","fingerprints","setupType","fp","password","mline","rtpmapline","fmtps","maxptime","extension","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","encParam","codecPayloadType","fec","mechanism","maxBitrate","remoteSsrc","rsize","mux","spec","planB","msidParts","sessId","sessVer","sessUser","fmt","parseOLine","username","sessionId","sessionVersion","netType","addressType","isValidSDP","fn","domManip","q","h","l","g","_wrap","tmpl","parent","nodes","calls","nest","w","wrap","x","v","update","extend","_ctnt","m","makeArray","childNodes","Function","tag","_default","k","$1","$2","isArray","nodeType","getElementsByTagName","getAttribute","parentNode","removeAttribute","template","wrapped","innerText","textContent","outerHTML","cloneNode","insertBefore","remove","each","appendTo","prependTo","insertAfter","replaceAll","pushStack","tmplItem","afterManip","encode","open","if","else","=","!","jQuery","avatarUrl","share","scrollDownToLastChatText","$element","animate","scrollTop","scrollHeight","duration","queue","getUserFromId","userId","pad","collabClient","getConnectedUsers","user","slugify","text","$body_ace_outer","wrtcStore","wrtcPubsub","on","eventName","off","emit","_len","_key","inlineAvatar","ROOM","room","inlineAvatarLimit","clientVars","webrtc","left","WRTC_Room","getHeaderRoomX","userInList","colorId","ep_profile_list","imageUrl","img","hide","show","TEXT","list","VIDEO","el","requestUser","roomInfo","USERS","users","actions","$headingRoom","$btnVideo","$btnText","$btnPlus","newAction","attr","data-action","appendUserList","empty","roomBoxIconActive","textActive","videoActive","notifyNewUserJoined","msg","btnJoin","headerTitle","roomCounter","userCount","VIDEOCHATLIMIT","authorClass","charCodeAt","minutes","Date","time","getMinutes","hours","getHours","timeStr","userName","addTextChatMessage","createShareLink","headerText","origin","pathname","padutils","textChat","socket","padId","currentRoom","$joinBtn","createAndAppendMessage","tim","class","escapeHtmlWithClickableLinks","data-authorid","author","eventTextChatInput","keyCode","which","textMessage","getTime","incomMsg","deactivateModal","$TextChatWrapper","removeAttr","$btn","toggle","activateModal","headTitle","existTextChat","data-id","textChatBox","headingId","addUserToRoom","present","data-text","removeUserFromRoom","$textChatUserList","socketBulkUpdateRooms","rooms","info","roomsInfo","postAceInit","hook","context","webSocket","docId","getPadId","chatBox","innerHeight","transform","userJoin","userData","$joinButton","userLeave","bulkUpdateRooms","hTagList","videoChat","localStream","stopStreaming","data-video","WRTC","activate","prepend","opacity","data-active","active","hasClass","createSession","userInfo","gateway_userJoin","_userData","gateway_userLeave","showUserMediaError","reachedVideoRoomSize","showAlert","isBulkUpdate","gritter","add","title","sticky","class_name","bulkUpdate","$videoChatUserList","deactivate","removeListener","videoChatLimit","videoSettings","localStorage","getItem","microphone","speaker","camera","audioInputSelect","querySelector","audioOutputSelect","videoSelect","deviceInfo","option","reloadSession","videoSizes","large","small","DtlsSrtpKeyAgreement","sdpConstraints","OfferToReceiveAudio","OfferToReceiveVideo","remoteStream","callQueue","enlargedVideos","Set","localVideoElement","_pad","sizes","payload","receiveMessage","audioVideoInputChange","changeAudioDestination","hangupAll","appendInterfaceLayout","werc_toolbar","$wrtc_modal","$parent","videoBox","aceSetAuthorStyle","border-color","siblings","hangup","reason","sendErrorStat","hostname","toggleMuted","audioTrack","toggleVideo","videoTrack","setStream","isLocal","getUserId","videoId","videoContainer","max-height","loadedmetadata","addInterface","autoplay","muted","attachMediaStream","$video","$mute","click","toggleClass","videoEnabled","$disableVideo","videoEnlarged","$largeVideo","videoSize","bitrate","floor","parseFloat","pow","formatBytes","transportId","packetsSent","audioInputLevel","statName","sendMessage","to","client","from","createPeerConnection","cleanupSdp","logError","_headerId","notify","webrtcDetectedBrowser","cons1","cons2","merged","mergeConstraints","attachSinkId","element","sinkId","setSinkId","errorMessage","selectedIndex","audioDestination","videoElement","audioSource","videoSource","audioOutput","mediaConstraints","setItem","srcObject","mozSrcObject","src","preferOpus","sdpLines","mLineIndex","opusPayload","extractSdp","setDefaultCodec","mLineElements","cnPos","removeCN","sdpLine","pattern","elements","newLine","rate","sdpRate","scroll2Header","scrollIntoView","behavior","closeTextChat","trigger","roomBtnHandler","joinChatRoom","leaveChatRoom","pathName","link","$temp","select","shareRoomsLink","getHeaderRoomY","outerHeight","paddingTop","aceOuterPadding","ceil","offset","top","outerWidth","paddingLeft","$wbrtc_roomBox","headerURI","position","$box","urlParams","URLSearchParams","joinByQueryString","adoptHeaderYRoom","$padOuter","$el","hClassId","$headingEl","findTags","hTags","children","aceInnerOffset","newHTagAdded","newY","newX","exec","positionTop","positionLeft","box","avatarBox"],"mappings":"AAGA,aACA,IAAIA,EAAIC,QAAQ,yCACZC,aAAeD,QAAQ,wCAAwCC,aAE/DC,OAAS,WAEZ,IAAIC,EAAW,KAEXC,EAA4B,SAAmCC,EAAMC,EAAKC,GAC7E,OAAOF,IAASE,EAAuB,EAAID,EAAIE,SAAS,IAcrDC,EAA2B,SAAkCJ,EAAMC,EAAKI,GAO3E,OALIL,IAASK,EAbE,SAAmBL,EAAMC,GACxC,IAAIK,EAAWN,EAAO,EAClBO,EAAkBN,EAAIO,MAAMC,cAAcT,GAM9C,OALoBC,EAAIO,MAAMC,cAAcH,GAGXC,EAAkB,EAQ1BG,CAAUV,EAAMC,GAEhBA,EAAIU,OAAO,GAAK,GAMtCC,EAAmB,SAA0BC,EAAYC,EAAaC,EAAYC,GAGrF,IAFA,IAAIC,GAAkB,EAClBC,EAAS,KACJC,EAASL,EAAaK,GAAUJ,IAAeE,EAAiBE,KACxED,EAASxB,EAAE0B,OAAOJ,EAAiBK,wBAAwBR,EAAYM,IAASG,gBAE/EL,GAAkB,GAGpB,MAAO,CAAEA,gBAAiBA,EAAiBC,OAAQA,IAqCpD,SAASK,IACR,IAAIC,EAAO,GACX,QAAmC,IAAxBC,OAAOC,aAA8B,CAC/C,IAAIC,EAAM7B,EAAS8B,WAAW,GAAGF,eACjC,GAAIC,EAAIE,WAAY,CAEnB,IADA,IAAIC,EAAYC,SAASC,cAAc,OAC9BC,EAAI,EAAGC,EAAMP,EAAIE,WAAYI,EAAIC,IAAOD,EAChDH,EAAUK,YAAYR,EAAIS,WAAWH,GAAGI,iBAEzCb,EAAOM,EAAUQ,qBAEsB,IAAvBP,SAASQ,WACM,SAA5BR,SAASQ,UAAUC,OACtBhB,EAAOO,SAASQ,UAAUE,cAAcC,UAG1C,OAAOlB,EAuDR,OAAOmB,OAAOC,OAAO,CACpBC,mBAhCwB,SAA4BC,EAAGC,EAAMC,EAAOC,GAGpE,IAAIV,EAbqBW,EACrBC,EACAC,EAgBJ,GAPAtD,EAAWkD,EAGXD,EAAKM,aAAY,SAAqBC,GACrCf,EAAYe,EAAIC,8BAGbhB,EAAUiB,gBAAkBjB,EAAUkB,gBAAiB,CAC1D,IAAIC,EACJ,GAAInB,EAAUkB,gBAAiB,CACVlC,IACpBmC,EAjCH,WACC,IAAIA,EAAUnC,IAOd,OANAmC,EAAUC,EAAE,eAAeC,OAAOF,IAC1BG,KAAK,gBAAgBC,aAAY,SAAqBC,EAAOC,GACpE,OAAQA,EAAIC,MAAM,uBAAyB,IAAIC,KAAK,QAClDC,UAAS,SAAkBJ,EAAOC,GACpC,MAAO,gBAAkBpE,aAAa,IAAM,IAAMoE,KAE5CN,EAAQlC,OAyBH4C,OACJ,CACN,IAAI7B,EAAUrB,OAAQ,OAAO,EAxBNgC,EAyBIX,EAAUrB,OAxBnCiC,EAAOrD,EAAS8B,WAAWiC,KAAK,iBAAmBX,GAAUmB,QAAQ,WAAWC,GAAG,GAAGC,KAAK,WAAWC,cACtGpB,EAAUtD,EAAS8B,WAAWiC,KAAK,iBAAmBX,GAAUmB,QAAQ,gBAAgBP,aAAY,SAASC,EAAOC,GACvH,OAAQA,EAAIC,MAAM,uBAAyB,IAAIC,KAAK,QAClD1C,OAqBDkC,KApBEP,IAASC,IACCO,EAAE,eAAeC,OAAO,IAAMT,EAAO,8BAAgCvD,aAAa,IAAM,KAAOwD,EAAU,YAAcD,EAAO,KAC7H3B,OAqBd,GAAIkC,EAGH,OAFAZ,EAAE2B,cAAcC,cAAcC,QAAQ,YAAajB,GACnDZ,EAAE8B,kBACK,EAIJ3B,GACHnD,EAAS8B,WAAW,GAAGiD,YAAY,YAOrCC,qBA1F0B,WAC1B,IAAItB,EACAxC,EAAmB+D,KAAKC,yBACxB/E,EAAM8E,KAAK9E,IACXC,EAAuBD,EAAIE,SAAS,GACpCW,EAAcb,EAAIE,SAAS,GAC3BY,EAAad,EAAIU,OAAO,GACxBN,EAAsBJ,EAAIU,OAAO,GACjCsE,EAZyB,SAAiC/E,EAAsBG,GACpF,OAAOH,IAAyBG,EAWF6E,CAAwBhF,EAAsBG,GAM5E,MAAO,CAAEmD,gBAJRA,EADGyB,EA1BmC,SAA2C/E,EAAsBG,EAAqBJ,EAAKe,GAElI,IADA,IAAImE,GAAuB,EAClBnF,EAAOE,EAAsBF,GAAQK,IAAwB8E,EAAsBnF,IAAQ,CACnG,IAAIc,EAAcf,EAA0BC,EAAMC,EAAKC,GACnDa,EAAaX,EAAyBJ,EAAMC,EAAKI,GACpCO,EAAiBZ,EAAMc,EAAaC,EAAYC,KAEhEmE,GAAuB,GAGzB,OAAOA,EAiBWC,CAAkClF,EAAsBG,EAAqBJ,EAAKe,GAElFJ,EAAiBV,EAAsBY,EAAaC,EAAYC,IAE1CC,gBAAiBC,OAAQsC,EAAetC,OAAQuC,gBAAiBwB,MAzE9F;ACPb,aAca,IAAII,SAAS,SAASC,EAAiBC,EAASC,GAAU,SAASC,IAAiBC,GAAgB,SAASC,GAAS,GAAGA,GAASA,EAAQC,QAAQ,CAACD,EAAQC,SAAQ,SAASC,GAAQlD,OAAOmD,KAAKC,GAAgBH,SAAQ,SAASI,GAAK,GAAG,mBAAmBD,EAAeC,GAAK,IAAID,EAAeC,GAAKH,GAAQ,MAAM/C,GAAGmD,QAAQC,MAAMpD,EAAEqD,QAAQrD,EAAEsD,MAAMtD,UAAQ,KAAsE,IAAlEuD,EAAKC,mBAAmBC,OAAO,kCAAuCC,GAAO,GAAI,MAAM1D,GAAG0D,GAAO,GAAY,IAATA,IAAcC,EAAeC,cAAcD,EAAeC,YAAYC,MAAM,SAASF,EAAeG,OAAM,GAAIH,EAAed,QAAQA,EAAQc,EAAeI,OAAOJ,EAAeK,QAAQL,EAAeM,UAAUC,MAAMP,EAAeI,MAAMI,UAAUR,EAAeM,UAAUG,OAAOC,gBAAgBV,EAAeK,MAAMG,UAAUR,EAAeM,UAAUG,OAAOE,gBAAgBX,EAAeM,UAAUG,OAAOC,eAAeV,EAAeI,MAAMI,UAAUR,EAAeM,UAAUG,OAAOE,eAAeX,EAAeK,MAAMG,WAAW1B,EAASkB,GAAgBD,GAAQ,aAAehB,GAAUA,GAAU6B,WAAW5B,EAAeD,GAAU,SAAQ,SAASE,EAAgB4B,QAAI,IAAoB7F,OAAO8F,gBAAgBC,EAASnB,EAAKhB,SAAS5D,OAAO6D,kBAAkB,MAAMmC,MAAK,SAASC,GAAK,IAAIC,EAAM,GAAGD,EAAI9B,SAAQ,SAASgC,GAAGD,EAAME,KAAKD,MAAKN,EAAGK,MAAgB,MAAEL,GAAIjB,EAAKhB,UAAS,SAASqC,GAAK,IAAIC,EAAM,GAAGD,EAAI7B,SAASD,SAAQ,SAAS8B,GAAK,IAAII,EAAK,GAAGJ,EAAIK,QAAQnC,SAAQ,SAASoC,GAAMF,EAAKE,GAAMN,EAAIO,KAAKD,MAAQF,EAAKI,GAAGR,EAAIQ,GAAGJ,EAAKtF,KAAKkF,EAAIlF,KAAKsF,EAAKK,UAAUT,EAAIS,UAAUR,EAAME,KAAKC,MAAQR,EAAGK,MAAS,IAAyHS,EAArHC,EAAqB,uFAAgGD,EAA+nC,oBAAoBE,OAAOA,OAAO,OAArpC,oBAAoB7G,QAAQ,oBAAoB6G,SAASA,OAAOC,UAAU,CAACC,UAAUH,EAAqBI,aAAa,cAAcH,OAAOrC,UAAUqC,OAAOrC,QAAQ,SAAI,IAAoBqC,OAAOrC,QAAQyC,UAAK,IAAoBJ,OAAOrC,QAAQC,QAAQoC,OAAOrC,QAAQC,MAAMoC,OAAOrC,QAAQyC,IAAIJ,OAAOrC,QAAQyC,KAAK,WAAWzC,QAAQyC,IAAIC,aAAa,oBAAoB5G,WAAWqG,EAAKrG,SAAS,CAAC6G,gBAAgB,CAACzG,YAAY,WAAW,MAAM,MAAMJ,SAASC,cAAcD,SAAS8G,cAAc9G,SAAS+G,iBAAiB,WAAW,IAAIC,EAAI,CAACC,WAAW,WAAW,OAAOD,GAAKE,KAAK,aAAaC,MAAM,aAAaC,UAAU,aAAaC,UAAU,WAAW,MAAM,KAAK,OAAOL,GAAKX,EAAKiB,iBAAiB,cAAc,oBAAoBC,WAAWlB,EAAKkB,SAAS,CAACC,SAAS,QAAQC,KAAK,GAAGC,KAAK,KAAK,oBAAoBC,SAAStB,EAAKsB,OAAO,CAACC,MAAM,EAAEC,OAAO,IAAI,oBAAoBC,MAAMzB,EAAKyB,IAAI,CAACC,gBAAgB,WAAW,MAAM,IAAIC,gBAAgB,WAAW,MAAM,MAAM,oBAAoBC,mBAAmB5B,EAAK4B,iBAAiB,mBAAc,IAAoBC,IAAoB7B,EAAK6B,kBAAkB,cAAc7B,EAAK3G,OAAO6G,QAAiD,IAAI2B,EAAkBxI,OAAOwI,mBAAmBxI,OAAOyI,sBAAsBzI,OAAO0I,wBAAwB,oBAAoBH,mBAAmBA,iBAAiB,IAAI,IAAII,IAAoB7B,UAAU8B,YAAY,IAAI7H,MAAM,WAAW8H,WAAW9F,cAAciC,EAAe,CAAC8D,WAAW,UAAU1D,MAAM,CAAC2D,KAAK,CAACC,OAAO,GAAGC,OAAO,GAAGC,mBAAmB,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,YAAY,GAAGC,KAAK,CAACN,OAAO,GAAGC,OAAO,GAAGC,mBAAmB,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,YAAY,GAAG7D,UAAU,EAAE+D,cAAc,EAAEC,QAAQ,EAAEC,YAAY,GAAGpE,MAAM,CAAC0D,KAAK,CAACC,OAAO,GAAGC,OAAO,GAAGC,mBAAmB,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,YAAY,GAAGC,KAAK,CAACN,OAAO,GAAGC,OAAO,GAAGC,mBAAmB,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,YAAY,GAAG7D,UAAU,EAAE+D,cAAc,EAAEC,QAAQ,EAAEC,YAAY,GAAGnE,UAAU,CAACoE,gBAAgB,EAAEC,cAAc,EAAEC,iBAAiB,EAAEnE,OAAO,CAACC,eAAe,EAAEmE,gBAAgB,GAAGtE,MAAM,GAAGrB,QAAQ,GAAG4F,eAAe,CAACnB,kBAAkBA,EAAkBoB,gBAAgB,cAAcC,MAAM,CAACC,cAAc,GAAGC,UAAU,GAAGC,UAAU,GAAGC,YAAY,IAAIC,OAAO,CAACJ,cAAc,GAAGC,UAAU,GAAGC,UAAU,GAAGC,YAAY,KAAKE,YAAY,CAACvB,KAAK,CAACb,MAAM,EAAEC,OAAO,GAAGmB,KAAK,CAACpB,MAAM,EAAEC,OAAO,IAAIoC,SAAS,CAACnF,MAAM,CAAC2D,KAAK,GAAGO,KAAK,IAAIjE,MAAM,CAAC0D,KAAK,GAAGO,KAAK,IAAIkB,WAAW,IAAIzF,OAAO,WAAWA,GAAO,IAAKT,EAAe,CAACmG,eAAe,SAASrG,GAAQ,yBAAyBA,EAAOrD,OAAOiE,EAAe0F,UAAUtG,EAAOuG,iBAAiB5E,EAAS,iCAAiC6E,KAAK9D,UAAUC,WAAWnC,EAAKtB,KAAK,KAAK4D,UAAU,aAAasB,GAAmB,KAAK,qDAAqD5D,EAAKsC,UAAU,GAAGA,UAAU,aAAaqB,mBAAmB1E,EAAiBqD,UAAU,GAAGpD,EAASoD,UAAU,GAAGnD,EAASmD,UAAU,IAAI,IAAInC,GAAO,EAAGT,EAAeW,YAAY,SAASb,GAAQ,gBAAgBA,EAAOrD,OAAOiE,EAAeC,YAAY,CAACC,MAAMd,EAAOc,SAASZ,EAAeuG,gBAAgB,SAASzG,GAAQ,mBAAmBA,EAAOrD,OAAOiE,EAAe8D,WAAW1E,EAAO0G,0BAA0B,eAAe1G,EAAOrD,OAAOiE,EAAe8D,WAAW1E,EAAO2G,uBAAuBzG,EAAe0G,iBAAiB,SAAS5G,GAAQ,GAAG,UAAUA,EAAO6G,UAAU,CAAC,IAAIC,EAAa9G,EAAOqC,GAAG0E,MAAM,KAAKC,MAAM,IAAqB,IAAlBhH,EAAOiH,WAAgBH,EAAa,SAA0B,IAAlB9G,EAAOiH,WAAgBH,EAAa,QAAQA,EAAa,CAAC,IAAsF,IAAnFlG,EAAeI,MAAM8F,GAAcjC,OAAOqC,QAAQlH,EAAOmH,eAAe,SAAcvG,EAAeI,MAAM8F,GAAcjC,OAAO7C,KAAKhC,EAAOmH,eAAe,QAAQnH,EAAOoB,UAAU,CAAC,IAAIgG,EAAU,EAAExG,EAAeuF,SAASnF,MAAM8F,GAAcO,gBAAgBzG,EAAeuF,SAASnF,MAAM8F,GAAcO,cAAcrH,EAAOoB,WAAW,IAAIkG,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASnF,MAAM8F,GAAcO,cAAczG,EAAeuF,SAASnF,MAAM8F,GAAcO,cAAcrH,EAAOoB,UAAUgG,EAAUE,EAAM,KAAK1G,EAAeI,MAAM8F,GAAchC,mBAAmBsC,EAAUG,QAAQ,GAAG3G,EAAeI,MAAMI,UAAUgG,EAAUG,QAAQ,GAAG,GAAGvH,EAAOmF,cAAc,CAAKiC,EAAU,EAAExG,EAAeuF,SAASnF,MAAM8F,GAAcU,oBAAoB5G,EAAeuF,SAASnF,MAAM8F,GAAcU,kBAAkBxH,EAAOmF,eAAmBmC,EAAMtH,EAAOmF,cAAcvE,EAAeuF,SAASnF,MAAM8F,GAAcU,kBAAkB5G,EAAeuF,SAASnF,MAAM8F,GAAcU,kBAAkBxH,EAAOmF,cAAciC,EAAUE,EAAM,KAAK1G,EAAeI,MAAMmE,cAAciC,EAAUG,QAAQ,GAAG,GAAGvH,EAAOyH,cAAsF,IAAzE7G,EAAeI,MAAM8F,GAAclC,OAAOsC,QAAQlH,EAAOyH,cAAmB7G,EAAeI,MAAM8F,GAAclC,OAAO5C,KAAKhC,EAAOyH,aAAazH,EAAO0H,mBAAmB,CAAKN,EAAU,EAAExG,EAAeuF,SAASnF,MAAM2G,yBAAyB/G,EAAeuF,SAASnF,MAAM2G,uBAAuB3H,EAAO0H,oBAAwBJ,EAAMtH,EAAO0H,mBAAmB9G,EAAeuF,SAASnF,MAAM2G,uBAAuB/G,EAAeuF,SAASnF,MAAM2G,uBAAuB3H,EAAO0H,mBAAmB9G,EAAeI,MAAMoE,QAAQkC,EAAMC,QAAQ,GAAG3G,EAAeI,MAAMoE,QAAQ,IAAIxE,EAAeI,MAAMoE,QAAQ,GAAG,GAAGpF,EAAOqF,YAAY,CAAK+B,EAAU,EAAExG,EAAeuF,SAASnF,MAAM4G,kBAAkBhH,EAAeuF,SAASnF,MAAM4G,gBAAgB5H,EAAOqF,aAAiBiC,EAAMtH,EAAOqF,YAAYzE,EAAeuF,SAASnF,MAAM4G,gBAAgBhH,EAAeuF,SAASnF,MAAM4G,gBAAgB5H,EAAOqF,YAAYzE,EAAeI,MAAMqE,YAAYiC,EAAMC,QAAQ,GAAG3G,EAAeI,MAAMqE,YAAY,IAAIzE,EAAeI,MAAMqE,YAAY,OAAOnF,EAAe2H,iBAAiB,SAAS7H,GAAQ,GAAG,UAAUA,EAAO6G,UAAU,CAAC,IAAIC,EAAa9G,EAAOqC,GAAG0E,MAAM,KAAKC,MAAM,IAAqB,IAAlBhH,EAAOiH,WAAgBH,EAAa,SAA0B,IAAlB9G,EAAOiH,WAAgBH,EAAa,QAAQA,EAAa,CAAC,IAAqF,IAAlFlG,EAAeK,MAAM6F,GAAcjC,OAAOqC,QAAQlH,EAAOmH,eAAe,QAAavG,EAAeK,MAAM6F,GAAcjC,OAAO7C,KAAKhC,EAAOmH,eAAe,OAAOnH,EAAOoB,UAAU,CAAC,IAAIgG,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcO,gBAAgBzG,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAcrH,EAAOoB,WAAW,IAAIkG,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAczG,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAcrH,EAAOoB,UAAUgG,EAAUE,EAAM,KAAK1G,EAAeK,MAAM6F,GAAchC,mBAAmBsC,EAAUG,QAAQ,GAAG3G,EAAeK,MAAMG,UAAUgG,EAAUG,QAAQ,GAAG,GAAGvH,EAAOmF,cAAc,CAAKiC,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcU,oBAAoB5G,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkBxH,EAAOmF,eAAmBmC,EAAMtH,EAAOmF,cAAcvE,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkB5G,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkBxH,EAAOmF,cAAciC,EAAUE,EAAM,KAAK1G,EAAeK,MAAMkE,cAAciC,EAAUG,QAAQ,GAAG,GAAGvH,EAAO8H,yBAAyB9H,EAAO+H,yBAAyBnH,EAAesF,YAAYY,GAAchD,MAAM9D,EAAO+H,uBAAuBnH,EAAesF,YAAYY,GAAc/C,OAAO/D,EAAO8H,yBAAyB9H,EAAOgI,qBAAqBhI,EAAOiI,qBAAqBrH,EAAesF,YAAYY,GAAchD,MAAM9D,EAAOiI,mBAAmBrH,EAAesF,YAAYY,GAAc/C,OAAO/D,EAAOgI,qBAAqBhI,EAAOyH,cAAsF,IAAzE7G,EAAeK,MAAM6F,GAAclC,OAAOsC,QAAQlH,EAAOyH,cAAmB7G,EAAeK,MAAM6F,GAAclC,OAAO5C,KAAKhC,EAAOyH,aAAazH,EAAOgF,cAAc,CAACpE,EAAeM,UAAU8D,cAAchF,EAAOgF,cAAkBoC,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcoB,oBAAoBtH,EAAeuF,SAASlF,MAAM6F,GAAcoB,kBAAkBlI,EAAOiF,aAAiBqC,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASlF,MAAM6F,GAAcoB,kBAAkBtH,EAAeuF,SAASlF,MAAM6F,GAAcoB,kBAAkBlI,EAAOgF,cAAcoC,EAAUE,EAAM,KAAK1G,EAAeK,MAAM6F,GAAc9B,cAAcsC,EAAMC,QAAQ,GAAG,GAAGvH,EAAOiF,YAAY,CAACrE,EAAeM,UAAU+D,YAAYjF,EAAOiF,YAAgBmC,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcqB,kBAAkBvH,EAAeuF,SAASlF,MAAM6F,GAAcqB,gBAAgBnI,EAAOiF,aAAiBqC,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASlF,MAAM6F,GAAcqB,gBAAgBvH,EAAeuF,SAASlF,MAAM6F,GAAcqB,gBAAgBnI,EAAOiF,YAAYmC,EAAUE,EAAM,KAAK1G,EAAeK,MAAM6F,GAAc7B,YAAYqC,EAAMC,QAAQ,GAAG,GAAGvH,EAAO0H,mBAAmB,CAAKN,EAAU,EAAExG,EAAeuF,SAASlF,MAAM0G,yBAAyB/G,EAAeuF,SAASlF,MAAM0G,uBAAuB3H,EAAO0H,oBAAwBJ,EAAMtH,EAAO0H,mBAAmB9G,EAAeuF,SAASlF,MAAM0G,uBAAuB/G,EAAeuF,SAASlF,MAAM0G,uBAAuB3H,EAAO0H,mBAAmB9G,EAAeK,MAAMmE,QAAQkC,EAAMC,QAAQ,GAAG3G,EAAeK,MAAMmE,QAAQ,IAAIxE,EAAeK,MAAMmE,QAAQ,GAAG,GAAGpF,EAAOqF,YAAY,CAAK+B,EAAU,EAAExG,EAAeuF,SAASlF,MAAM2G,kBAAkBhH,EAAeuF,SAASlF,MAAM2G,gBAAgB5H,EAAOqF,aAAiBiC,EAAMtH,EAAOqF,YAAYzE,EAAeuF,SAASlF,MAAM2G,gBAAgBhH,EAAeuF,SAASlF,MAAM2G,gBAAgB5H,EAAOqF,YAAYzE,EAAeK,MAAMoE,YAAYiC,EAAMC,QAAQ,GAAG3G,EAAeK,MAAMoE,YAAY,IAAIzE,EAAeK,MAAMoE,YAAY,OAAOnF,EAAekI,YAAY,SAASpI,GAAQ,aAAaA,EAAOrD,OAAOiE,EAAeM,UAAUmH,uBAAuBrI,EAAOsI,2BAA2B1H,EAAeM,UAAUqH,qBAAqBvI,EAAOuI,qBAAqB3H,EAAeM,UAAUoH,2BAA2BtI,EAAOsI,2BAA2B1H,EAAeM,UAAUsH,8BAA8BxI,EAAOwI,8BAA8B5H,EAAeM,UAAUuH,sBAAsBzI,EAAOyI,sBAAsB7H,EAAeM,UAAUwH,qBAAqB1I,EAAO0I,qBAAqB9H,EAAeM,UAAUyH,gBAAgB3I,EAAO2I,gBAAgB/H,EAAeM,UAAU0H,oBAAoB5I,EAAO4I,sBAAsB1I,EAAe2I,cAAc,SAAS7I,GAAQ,GAAG,sBAAsBA,EAAOrD,MAAM,mBAAmBqD,EAAOrD,MAAM,oBAAoBqD,EAAOrD,MAAM,qBAAqBqD,EAAOrD,KAAK,CAAC,GAAG,QAAQqD,EAAO8I,qBAAsBhM,OAAOmD,KAAKW,EAAeuF,SAASC,YAAYrG,SAAQ,SAASgJ,GAAK,IAAIC,EAAUpI,EAAeuF,SAASC,WAAW2C,IAA6D,IAAxDC,EAAUjD,UAAUmB,QAAQlH,EAAOiJ,oBAAyBrI,EAAe8E,eAAeE,MAAMC,cAAcmD,EAAUnD,cAAcjF,EAAe8E,eAAeE,MAAMG,UAAUiD,EAAUjD,UAAUnF,EAAe8E,eAAeE,MAAMI,YAAYgD,EAAUhD,YAAYpF,EAAe8E,eAAeE,MAAME,UAAUkD,EAAUlD,YAAoE,IAAzDkD,EAAUjD,UAAUmB,QAAQlH,EAAOkJ,qBAA0BtI,EAAe8E,eAAeO,OAAOJ,cAAcmD,EAAUnD,cAAcjF,EAAe8E,eAAeO,OAAOF,UAAUiD,EAAUjD,UAAUnF,EAAe8E,eAAeO,OAAOD,YAAYgD,EAAUhD,YAAYpF,EAAe8E,eAAeO,OAAOH,UAAUkD,EAAUlD,cAAalF,EAAe8E,eAAeI,UAAU9F,EAAOmJ,mBAAsBC,EAAexI,EAAeuF,SAASC,WAAWpG,EAAOqJ,oBAAkCD,EAAerD,YAAYnF,EAAe8E,eAAeC,gBAAgByD,EAAerD,YAAeuD,EAAgB1I,EAAeuF,SAASC,WAAWpG,EAAOuJ,qBAAoCD,EAAgBvD,YAAYnF,EAAe8E,eAAeC,gBAAgB2D,EAAgBvD,WAAW,GAAG,mBAAmB/F,EAAOrD,OAAwB,IAAlBqD,EAAOwJ,WAAkC,IAAnBxJ,EAAOyJ,WAAgB,cAAczJ,EAAOc,MAAM,IAAIsI,EAAexI,EAAeuF,SAASC,WAAWpG,EAAOuJ,mBAAmBD,EAAgB1I,EAAeuF,SAASC,WAAWpG,EAAOuJ,mBAAmB,GAAG,oBAAoBvJ,EAAOrD,OAAOiE,EAAe8E,eAAeE,MAAMC,cAAc7F,EAAO6F,cAAcjF,EAAe8E,eAAeE,MAAMG,UAAU/F,EAAO+F,UAAUnF,EAAe8E,eAAeE,MAAMI,YAAYhG,EAAOgG,YAAYpF,EAAe8E,eAAeE,MAAME,UAAU9F,EAAO0J,mBAAmB1J,EAAO8F,WAAW,qBAAqB9F,EAAOrD,OAAOiE,EAAe8E,eAAeO,OAAOJ,cAAc7F,EAAO6F,cAAcjF,EAAe8E,eAAeO,OAAOF,UAAU/F,EAAO+F,UAAUnF,EAAe8E,eAAeO,OAAOD,YAAYhG,EAAOgG,YAAYpF,EAAe8E,eAAeO,OAAOH,UAAU9F,EAAO2J,oBAAoB3J,EAAO8F,WAAWnE,EAAS,CAAC,IAAImF,EAAa9G,EAAOqJ,iBAAiB,OAAO,OAAO,IAAIvC,EAAa,OAAO,GAAG9G,EAAOoB,UAAU,CAAC,IAAIgG,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcO,gBAAgBzG,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAcrH,EAAOoB,WAAW,IAAIkG,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAczG,EAAeuF,SAASlF,MAAM6F,GAAcO,cAAcrH,EAAOoB,UAAUgG,EAAUE,EAAM,KAAK1G,EAAeK,MAAM6F,GAAchC,mBAAmBsC,EAAUG,QAAQ,GAAG3G,EAAeK,MAAMG,UAAUgG,EAAUG,QAAQ,GAAG,GAAGvH,EAAOmF,cAAc,CAAKiC,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAcU,oBAAoB5G,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkBxH,EAAOmF,eAAmBmC,EAAMtH,EAAOmF,cAAcvE,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkB5G,EAAeuF,SAASlF,MAAM6F,GAAcU,kBAAkBxH,EAAOmF,cAAciC,EAAUE,EAAM,KAAK1G,EAAeK,MAAMkE,cAAciC,EAAUG,QAAQ,GAAG,GAAGvH,EAAO4J,yBAAyB,CAAKxC,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAc+C,+BAA+BjJ,EAAeuF,SAASlF,MAAM6F,GAAc+C,6BAA6B7J,EAAO4J,0BAA8BtC,EAAMtH,EAAO4J,yBAAyBhJ,EAAeuF,SAASlF,MAAM6F,GAAc+C,6BAA6BjJ,EAAeuF,SAASlF,MAAM6F,GAAc+C,6BAA6B7J,EAAO4J,yBAAyBxC,EAAUE,EAAM,KAAK1G,EAAeK,MAAM2I,yBAAyBxC,EAAUG,QAAQ,GAAG,GAAGvH,EAAO8J,yBAAyB,CAAK1C,EAAU,EAAExG,EAAeuF,SAASlF,MAAM6F,GAAciD,+BAA+BnJ,EAAeuF,SAASlF,MAAM6F,GAAciD,6BAA6B/J,EAAO8J,0BAA8BxC,EAAMtH,EAAO8J,yBAAyBlJ,EAAeuF,SAASlF,MAAM6F,GAAciD,6BAA6BnJ,EAAeuF,SAASlF,MAAM6F,GAAciD,6BAA6B/J,EAAO8J,yBAAyB1C,EAAUE,EAAM,KAAK1G,EAAeK,MAAM6I,yBAAyB1C,EAAUG,QAAQ,OAAO,IAAIyC,EAAoB,GAAGC,EAAgB,GAAGC,EAAgB,GAAGC,EAAkB,GAAGjK,EAAekK,eAAe,SAASpK,GAAQ,mBAAmBA,EAAOrD,MAAM,oBAAoBqD,EAAOrD,MAAMqD,EAAOqC,KAAK2H,EAAoBhK,EAAOqC,MAAM2H,EAAoBhK,EAAOqC,IAAI,IAAI4H,EAAgBjK,EAAOqC,MAAM4H,EAAgBjK,EAAOqC,IAAI,IAAI6H,EAAgBlK,EAAOqC,MAAM6H,EAAgBlK,EAAOqC,IAAI,IAAI8H,EAAkBnK,EAAOqC,MAAM8H,EAAkBnK,EAAOqC,IAAI,IAAIrC,EAAO6F,gBAA+E,IAAhEmE,EAAoBhK,EAAOqC,IAAI6E,QAAQlH,EAAO6F,gBAAqBmE,EAAoBhK,EAAOqC,IAAIL,KAAKhC,EAAO6F,eAAe7F,EAAO8F,YAAmE,IAAxDmE,EAAgBjK,EAAOqC,IAAI6E,QAAQlH,EAAO8F,YAAiBmE,EAAgBjK,EAAOqC,IAAIL,KAAKhC,EAAO8F,WAAW9F,EAAO+F,YAAyF,IAA9EmE,EAAgBlK,EAAOqC,IAAI6E,QAAQlH,EAAO+F,UAAU,IAAI/F,EAAOqK,aAAkBH,EAAgBlK,EAAOqC,IAAIL,KAAKhC,EAAO+F,UAAU,IAAI/F,EAAOqK,YAAYrK,EAAOgG,cAAyE,IAA5DmE,EAAkBnK,EAAOqC,IAAI6E,QAAQlH,EAAOgG,cAAmBmE,EAAkBnK,EAAOqC,IAAIL,KAAKhC,EAAOgG,aAAapF,EAAeuF,SAASC,WAAWpG,EAAOqC,IAAI,CAACwD,cAAcmE,EAAoBhK,EAAOqC,IAAI0D,UAAUmE,EAAgBlK,EAAOqC,IAAIgI,WAAWrK,EAAOqK,WAAWrE,YAAYmE,EAAkBnK,EAAOqC,IAAIiI,SAAStK,EAAOsK,SAASxE,UAAUmE,EAAgBjK,EAAOqC,IAAIC,UAAUtC,EAAOsC,UAAUD,GAAGrC,EAAOqC,GAAG1F,KAAKqD,EAAOrD,MAAMiE,EAAe8E,eAAeE,MAAMC,cAAcmE,EAAoBhK,EAAOqC,IAAIzB,EAAe8E,eAAeE,MAAMG,UAAUmE,EAAgBlK,EAAOqC,IAAIzB,EAAe8E,eAAeE,MAAMI,YAAYmE,EAAkBnK,EAAOqC,IAAIzB,EAAe8E,eAAeE,MAAME,UAAUmE,EAAgBjK,EAAOqC,MAAM,IAAIkI,EAAqB,GAAGC,EAAiB,GAAGC,EAAiB,GAAGC,EAAmB,GAAGxK,EAAeyK,gBAAgB,SAAS3K,GAAQ,oBAAoBA,EAAOrD,MAAM,qBAAqBqD,EAAOrD,MAAMqD,EAAOqC,KAAKkI,EAAqBvK,EAAOqC,MAAMkI,EAAqBvK,EAAOqC,IAAI,IAAImI,EAAiBxK,EAAOqC,MAAMmI,EAAiBxK,EAAOqC,IAAI,IAAIoI,EAAiBzK,EAAOqC,MAAMoI,EAAiBzK,EAAOqC,IAAI,IAAIqI,EAAmB1K,EAAOqC,MAAMqI,EAAmB1K,EAAOqC,IAAI,IAAIrC,EAAO6F,gBAAgF,IAAjE0E,EAAqBvK,EAAOqC,IAAI6E,QAAQlH,EAAO6F,gBAAqB0E,EAAqBvK,EAAOqC,IAAIL,KAAKhC,EAAO6F,eAAe7F,EAAO8F,YAAoE,IAAzD0E,EAAiBxK,EAAOqC,IAAI6E,QAAQlH,EAAO8F,YAAiB0E,EAAiBxK,EAAOqC,IAAIL,KAAKhC,EAAO8F,WAAW9F,EAAO+F,YAA0F,IAA/E0E,EAAiBzK,EAAOqC,IAAI6E,QAAQlH,EAAO+F,UAAU,IAAI/F,EAAOqK,aAAkBI,EAAiBzK,EAAOqC,IAAIL,KAAKhC,EAAO+F,UAAU,IAAI/F,EAAOqK,YAAYrK,EAAOgG,cAA0E,IAA7D0E,EAAmB1K,EAAOqC,IAAI6E,QAAQlH,EAAOgG,cAAmB0E,EAAmB1K,EAAOqC,IAAIL,KAAKhC,EAAOgG,aAAapF,EAAeuF,SAASC,WAAWpG,EAAOqC,IAAI,CAACwD,cAAc0E,EAAqBvK,EAAOqC,IAAI0D,UAAU0E,EAAiBzK,EAAOqC,IAAIgI,WAAWrK,EAAOqK,WAAWrE,YAAY0E,EAAmB1K,EAAOqC,IAAIiI,SAAStK,EAAOsK,SAASxE,UAAU0E,EAAiBxK,EAAOqC,IAAIC,UAAUtC,EAAOsC,UAAUD,GAAGrC,EAAOqC,GAAG1F,KAAKqD,EAAOrD,MAAMiE,EAAe8E,eAAeO,OAAOJ,cAAc0E,EAAqBvK,EAAOqC,IAAIzB,EAAe8E,eAAeO,OAAOF,UAAU0E,EAAiBzK,EAAOqC,IAAIzB,EAAe8E,eAAeO,OAAOD,YAAY0E,EAAmB1K,EAAOqC,IAAIzB,EAAe8E,eAAeO,OAAOH,UAAU0E,EAAiBxK,EAAOqC,MAAMnC,EAAe0K,iBAAiB,SAAS5K,IAASA,EAAOmH,eAAe,UAAUnH,EAAO6G,WAAW,UAAU7G,EAAO6G,YAAY7G,EAAOoB,YAAYR,EAAeZ,EAAO6G,WAAWzF,UAAUyJ,SAAS7K,EAAOoB,YAAYpB,EAAOmF,gBAAgBvE,EAAeZ,EAAO6G,WAAW1B,cAAc0F,SAAS7K,EAAOmF,kBAAkBjF,EAAe4K,WAAW,SAAS9K,GAAQ,GAAG2B,GAAU,gBAAgB3B,EAAOrD,KAAK,CAAC,IAAIkK,EAAU7G,EAAO6G,WAAW,QAAQC,EAAa9G,EAAOiH,SAAS,OAAO,OAAO,GAAGH,EAAa,CAAC,GAAG9G,EAAOoB,UAAU,CAAC,IAAIgG,EAAU,EAAExG,EAAeuF,SAASU,GAAWC,GAAcO,gBAAgBzG,EAAeuF,SAASU,GAAWC,GAAcO,cAAcrH,EAAOoB,WAAW,IAAIkG,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASU,GAAWC,GAAcO,cAAczG,EAAeuF,SAASU,GAAWC,GAAcO,cAAcrH,EAAOoB,UAAUgG,EAAUE,EAAM,KAAK1G,EAAeiG,GAAWC,GAAchC,mBAAmBsC,EAAUG,QAAQ,GAAG3G,EAAeiG,GAAWzF,UAAUgG,EAAUG,QAAQ,GAAG,GAAGvH,EAAOmF,cAAc,CAAKiC,EAAU,EAAExG,EAAeuF,SAASU,GAAWC,GAAcU,oBAAoB5G,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkBxH,EAAOmF,eAAmBmC,EAAMtH,EAAOmF,cAAcvE,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkB5G,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkBxH,EAAOmF,cAAciC,EAAUE,EAAM,KAAK1G,EAAeiG,GAAW1B,cAAciC,EAAUG,QAAQ,OAAOrH,EAAe6K,YAAY,SAAS/K,GAAQ,GAAG2B,GAAU,iBAAiB3B,EAAOrD,KAAK,CAAC,IAAIkK,EAAU7G,EAAO6G,WAAW,QAAQC,EAAa9G,EAAOiH,SAAS,OAAO,OAAO,GAAGH,EAAa,CAAC,GAAG9G,EAAOoB,UAAU,CAAC,IAAIgG,EAAU,EAAExG,EAAeuF,SAASU,GAAWC,GAAcO,gBAAgBzG,EAAeuF,SAASU,GAAWC,GAAcO,cAAcrH,EAAOoB,WAAW,IAAIkG,EAAMtH,EAAOoB,UAAUR,EAAeuF,SAASU,GAAWC,GAAcO,cAAczG,EAAeuF,SAASU,GAAWC,GAAcO,cAAcrH,EAAOoB,UAAUgG,EAAUE,EAAM,KAAK1G,EAAeiG,GAAWC,GAAchC,mBAAmBsC,EAAUG,QAAQ,GAAG3G,EAAeiG,GAAWzF,UAAUgG,EAAUG,QAAQ,GAAG,GAAGvH,EAAOmF,cAAc,CAAKiC,EAAU,EAAExG,EAAeuF,SAASU,GAAWC,GAAcU,oBAAoB5G,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkBxH,EAAOmF,eAAmBmC,EAAMtH,EAAOmF,cAAcvE,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkB5G,EAAeuF,SAASU,GAAWC,GAAcU,kBAAkBxH,EAAOmF,cAAciC,EAAUE,EAAM,KAAK1G,EAAeiG,GAAW1B,cAAciC,EAAUG,QAAQ,OAAOrH,EAAe8K,MAAM,SAAShL,GAAQ,GAAG2B,GAAU,UAAU3B,EAAOrD,KAAK,CAAC,IAAImK,GAAmC,IAAtB9G,EAAOiL,aAAkB,OAAO,OAAOjL,EAAOkL,YAAYlL,EAAOmL,cAAcvK,EAAesF,YAAYY,GAAchD,MAAM9D,EAAOkL,WAAWtK,EAAesF,YAAYY,GAAc/C,OAAO/D,EAAOmL,eAAe,IAAIC,EAAK,CAACpK,MAAM,CAAC2D,KAAK,GAAGO,KAAK,IAAIjE,MAAM,CAAC0D,KAAK,GAAGO,KAAK,KAAKhF,EAAemL,KAAK,SAASrL,GAAQ,GAAGA,EAAOmH,gBAAgB,UAAUnH,EAAO6G,WAAW,UAAU7G,EAAO6G,YAAY,SAAS7G,EAAOrD,KAAK,CAAC,IAAImK,EAAa9G,EAAOqC,GAAG0E,MAAM,KAAKC,OAAmE,IAA7DoE,EAAKpL,EAAO6G,WAAWC,GAAcI,QAAQlH,EAAOqL,OAAYD,EAAKpL,EAAO6G,WAAWC,GAAc9E,KAAKhC,EAAOqL,MAAMzK,EAAeZ,EAAO6G,WAAWC,GAAc/B,QAAQqG,EAAKpL,EAAO6G,WAAWC,GAAcwE,SAAS1L,KAAkB,oBAAoB2L,SAASA,OAAOC,QAAQhM,UAAU,mBAAmBiM,QAAQA,OAAOC,KAAKD,OAAO,WAAW,IAAG,WAAW,OAAOjM;CCd3utB,WAEE,GADKkD,UAAUiJ,eAAcjJ,UAAUiJ,aAAe,KACjDjJ,UAAUiJ,aAAa/I,aAAc,CACxC,IAAIA,EACFF,UAAUkJ,oBACVlJ,UAAUmJ,iBACVnJ,UAAUoJ,gBACVpJ,UAAUE,aAGVF,UAAUiJ,aAAa/I,aADrBA,EACoC,SAASmJ,GAC7C,OAAO,IAAIC,SAAQ,SAASC,EAASC,GACnCtJ,EACEmJ,GACA,SAASI,GACPF,EAAQE,MAEV,SAAS9L,GACP6L,EAAO7L,UAMuB,WAgBpC,OAAO,IAAI2L,SAAQ,SAASC,EAASC,GAOjC,IALIjP,EADArB,OAAOwI,mBAAqBxI,OAAO0I,yBAA2B1I,OAAOyI,sBAAwBzI,OAAOwQ,iBAMpGnP,EAAI,IAAIoP,MAAM,wBAEhBlK,KAAO,8BACT+J,EAAOjP,MARHA,EAAI,IAAIoP,MAAM,mDAEhBlK,KAAO,0BACT+J,EAAOjP,SA7CnB;CCAA,SAAUqP,GAAG,GAAoB,iBAAVd,SAAoC,oBAATD,OAAsBA,OAAOC,QAAQc,SAAS,GAAmB,mBAATb,QAAqBA,OAAOC,IAAKD,OAAO,GAAGa,OAAO,EAA0B,oBAAT1Q,OAAwBA,OAA+B,oBAAT6G,OAAwBA,OAA6B,oBAAP8J,KAAsBA,KAAYrN,MAAOsN,QAAUF,KAA5T,EAAmU,WAAqC,OAAmB,SAASvK,EAAE9E,EAAEwP,EAAEC,GAAG,SAASC,EAAEvQ,EAAEkQ,GAAG,IAAIG,EAAErQ,GAAG,CAAC,IAAIa,EAAEb,GAAG,CAAC,IAAIwQ,EAAE,mBAAmB9S,SAASA,QAAQ,IAAIwS,GAAGM,EAAE,OAAOA,EAAExQ,GAAE,GAAI,GAAGyQ,EAAE,OAAOA,EAAEzQ,GAAE,GAAI,IAAI0Q,EAAE,IAAIT,MAAM,uBAAuBjQ,EAAE,KAAK,MAAM0Q,EAAEC,KAAK,mBAAmBD,EAAE,IAAIE,EAAEP,EAAErQ,GAAG,CAACoP,QAAQ,IAAIvO,EAAEb,GAAG,GAAG6Q,KAAKD,EAAExB,SAAQ,SAASzJ,GAAoB,OAAO4K,EAAlB1P,EAAEb,GAAG,GAAG2F,IAAeA,KAAIiL,EAAEA,EAAExB,QAAQzJ,EAAE9E,EAAEwP,EAAEC,GAAG,OAAOD,EAAErQ,GAAGoP,QAAQ,IAAI,IAAIqB,EAAE,mBAAmB/S,SAASA,QAAQsC,EAAE,EAAEA,EAAEsQ,EAAEpB,OAAOlP,IAAIuQ,EAAED,EAAEtQ,IAAI,OAAOuQ,EAA7b,CAA4c,CAACO,EAAE,CAAC,SAASpT,EAAQyR,EAAOC,GAUt1B,aAEA,IAEIgB,GAAU,EAFS1S,EAAQ,wBAEIqT,gBAAgB,CAAEvR,OAAQA,SAC7D2P,EAAOC,QAAUgB,GAEf,CAACY,uBAAuB,IAAIC,EAAE,CAAC,SAASvT,EAAQyR,EAAOC,GACzD,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQ2B,eAoCR,WACC,IAAIK,EAAO1K,UAAUwI,OAAS,QAAsBmC,IAAjB3K,UAAU,GAAmBA,UAAU,GAAK,GAC7ElH,EAAS4R,EAAK5R,OAEZ8R,EAAU5K,UAAUwI,OAAS,QAAsBmC,IAAjB3K,UAAU,GAAmBA,UAAU,GAAK,CACjF6K,YAAY,EACZC,aAAa,EACbC,UAAU,EACVC,YAAY,GAITC,EAAUC,EAAMnL,IAChBoL,EAAiBD,EAAME,cAActS,GAErC4Q,EAAU,CACbyB,eAAgBA,EAChBE,WAAYA,EACZC,eAAgBJ,EAAMI,eACtBC,WAAYL,EAAMK,WAClBC,gBAAiBN,EAAMM,iBAIxB,OAAQL,EAAeM,SACtB,IAAK,SACJ,IAAKC,IAAeA,EAAWC,qBAAuBf,EAAQC,WAE7D,OADAI,EAAQ,wDACDvB,EAERuB,EAAQ,+BAERvB,EAAQkC,YAAcF,EAEtBA,EAAWG,iBAAiB/S,GAC5B4S,EAAWI,gBAAgBhT,GAC3B4S,EAAWC,mBAAmB7S,GAC9B4S,EAAWK,YAAYjT,GACvB4S,EAAWM,wBAAwBlT,GACnC4S,EAAWO,uBAAuBnT,GAClC4S,EAAWQ,aAAapT,GACxB4S,EAAWS,2BAA2BrT,GACtC4S,EAAWU,qBAAqBtT,GAEhCuS,EAAWgB,oBAAoBvT,GAC/BuS,EAAWiB,oBAAoBxT,GAC/BuS,EAAWkB,mBAAmBzT,GAC9BuS,EAAWmB,uBAAuB1T,GAClCuS,EAAWoB,uBAAuB3T,GAClC,MACD,IAAK,UACJ,IAAK4T,IAAgBA,EAAYf,qBAAuBf,EAAQE,YAE/D,OADAG,EAAQ,yDACDvB,EAERuB,EAAQ,gCAERvB,EAAQkC,YAAcc,EAEtBA,EAAYb,iBAAiB/S,GAC7B4T,EAAYf,mBAAmB7S,GAC/B4T,EAAYX,YAAYjT,GACxB4T,EAAYC,iBAAiB7T,GAC7B4T,EAAYE,mBAAmB9T,GAC/B4T,EAAYG,qBAAqB/T,GACjC4T,EAAYI,mBAAmBhU,GAE/BuS,EAAWgB,oBAAoBvT,GAC/BuS,EAAWiB,oBAAoBxT,GAC/BuS,EAAWkB,mBAAmBzT,GAC9BuS,EAAWmB,uBAAuB1T,GAClC,MACD,IAAK,OACJ,IAAKiU,IAAaA,EAASpB,qBAAuBf,EAAQG,SAEzD,OADAE,EAAQ,yDACDvB,EAERuB,EAAQ,6BAERvB,EAAQkC,YAAcmB,EAEtBA,EAASlB,iBAAiB/S,GAC1BiU,EAASC,oBAAoBlU,GAC7BiU,EAASpB,mBAAmB7S,GAC5BiU,EAASE,iBAAiBnU,GAI1BuS,EAAWkB,mBAAmBzT,GAC9BuS,EAAWmB,uBAAuB1T,GAClC,MACD,IAAK,SACJ,IAAKoU,IAAetC,EAAQI,WAE3B,OADAC,EAAQ,wDACDvB,EAERuB,EAAQ,+BAERvB,EAAQkC,YAAcsB,EAEtBA,EAAWC,qBAAqBrU,GAChCoU,EAAWE,sBAAsBtU,GACjCoU,EAAWG,iBAAiBvU,GAC5BoU,EAAWI,oBAAoBxU,GAC/BoU,EAAWK,qBAAqBzU,GAChCoU,EAAWM,0BAA0B1U,GACrCoU,EAAWrB,iBAAiB/S,GAE5BuS,EAAWgB,oBAAoBvT,GAC/BuS,EAAWkB,mBAAmBzT,GAC9BuS,EAAWmB,uBAAuB1T,GAClCuS,EAAWoB,uBAAuB3T,GAClC,MACD,QACCmS,EAAQ,wBAIV,OAAOvB,GAxJR,IAEIwB,EAAQuC,EAFCzW,EAAQ,YAMjB0U,EAAa+B,EAFEzW,EAAQ,yBAMvB+V,EAAWU,EAFEzW,EAAQ,qBAMrB0V,EAAce,EAFEzW,EAAQ,2BAMxBkW,EAAaO,EAFEzW,EAAQ,yBAMvBqU,EAAaoC,EAFEzW,EAAQ,kBAI3B,SAASyW,EAAwBrN,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,IAqIhQ,CAACI,uBAAuB,EAAEC,gBAAgB,EAAEC,mBAAmB,EAAEC,yBAAyB,GAAGC,uBAAuB,GAAGC,UAAU,KAAKC,EAAE,CAAC,SAASrX,EAAQyR,EAAOC,GAUnK,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBAAsBtE,EAAQmD,sBAAmBlB,EAEzD,IAAI2D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAElQsO,EAAgB1X,EAAQ,kBAE5BgD,OAAOwQ,eAAe9B,EAAS,mBAAoB,CAClDiG,YAAY,EACZC,IAAK,WACJ,OAAOF,EAAc7C,oBAIvB,IAAIgD,EAAmB7X,EAAQ,qBAE/BgD,OAAOwQ,eAAe9B,EAAS,sBAAuB,CACrDiG,YAAY,EACZC,IAAK,WACJ,OAAOC,EAAiB7B,uBAG1BtE,EAAQoD,gBAkBR,SAAyBhT,GACxBA,EAAOgW,YAAchW,EAAOgW,aAAehW,EAAOiW,mBAlBnDrG,EAAQqD,YAqBR,SAAqBjT,GACpB,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwI,qBAAuB,YAAaxI,EAAOwI,kBAAkBsM,WAAY,CACnK5T,OAAOwQ,eAAe1R,EAAOwI,kBAAkBsM,UAAW,UAAW,CACpEgB,IAAK,WACJ,OAAOxS,KAAK4S,UAEbC,IAAK,SAAazF,GACbpN,KAAK4S,UACR5S,KAAK8S,oBAAoB,QAAS9S,KAAK4S,UAExC5S,KAAK+S,iBAAiB,QAAS/S,KAAK4S,SAAWxF,IAGhDmF,YAAY,EACZS,cAAc,IAEf,IAAIC,EAA2BvW,EAAOwI,kBAAkBsM,UAAU0B,qBAClExW,EAAOwI,kBAAkBsM,UAAU0B,qBAAuB,WACzD,IAAIC,EAAQnT,KA0CZ,OAxCKA,KAAKoT,eACTpT,KAAKoT,aAAe,SAAUrV,GAG7BA,EAAEkP,OAAO8F,iBAAiB,YAAY,SAAUM,GAC/C,IAAIC,OAAW,EAEdA,EADG5W,EAAOwI,kBAAkBsM,UAAU+B,aAC3BJ,EAAMI,eAAezU,MAAK,SAAU+D,GAC9C,OAAOA,EAAEiJ,OAASjJ,EAAEiJ,MAAM3I,KAAOkQ,EAAGvH,MAAM3I,MAGhC,CAAE2I,MAAOuH,EAAGvH,OAGxB,IAAI0H,EAAQ,IAAIC,MAAM,SACtBD,EAAM1H,MAAQuH,EAAGvH,MACjB0H,EAAMF,SAAWA,EACjBE,EAAME,YAAc,CAAEJ,SAAUA,GAChCE,EAAM3N,QAAU,CAAC9H,EAAEkP,QACnBkG,EAAMQ,cAAcH,MAErBzV,EAAEkP,OAAO2G,YAAY/S,SAAQ,SAAUiL,GACtC,IAAIwH,OAAW,EAEdA,EADG5W,EAAOwI,kBAAkBsM,UAAU+B,aAC3BJ,EAAMI,eAAezU,MAAK,SAAU+D,GAC9C,OAAOA,EAAEiJ,OAASjJ,EAAEiJ,MAAM3I,KAAO2I,EAAM3I,MAG7B,CAAE2I,MAAOA,GAErB,IAAI0H,EAAQ,IAAIC,MAAM,SACtBD,EAAM1H,MAAQA,EACd0H,EAAMF,SAAWA,EACjBE,EAAME,YAAc,CAAEJ,SAAUA,GAChCE,EAAM3N,QAAU,CAAC9H,EAAEkP,QACnBkG,EAAMQ,cAAcH,OAGtBxT,KAAK+S,iBAAiB,YAAa/S,KAAKoT,eAElCH,EAAyBY,MAAM7T,KAAM4D,iBAM7CkL,EAAMgF,wBAAwBpX,EAAQ,SAAS,SAAUqB,GAIxD,OAHKA,EAAE2V,aACN9V,OAAOwQ,eAAerQ,EAAG,cAAe,CAAEsQ,MAAO,CAAEiF,SAAUvV,EAAEuV,YAEzDvV,MA1FVuO,EAAQuD,uBA+FR,SAAgCnT,GAE/B,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwI,qBAAuB,eAAgBxI,EAAOwI,kBAAkBsM,YAAc,qBAAsB9U,EAAOwI,kBAAkBsM,UAAW,CAClO,IAAIuC,EAAqB,SAA4BC,EAAIlI,GACxD,MAAO,CACNA,MAAOA,EACPmI,WAQC,YAPmB1F,IAAfvO,KAAKkU,QACW,UAAfpI,EAAMqI,KACTnU,KAAKkU,MAAQF,EAAGI,iBAAiBtI,GAEjC9L,KAAKkU,MAAQ,MAGRlU,KAAKkU,OAEbG,IAAKL,IAKP,IAAKtX,EAAOwI,kBAAkBsM,UAAU8C,WAAY,CACnD5X,EAAOwI,kBAAkBsM,UAAU8C,WAAa,WAE/C,OADAtU,KAAKuU,SAAWvU,KAAKuU,UAAY,GAC1BvU,KAAKuU,SAASC,SAEtB,IAAIC,EAAe/X,EAAOwI,kBAAkBsM,UAAUkD,SACtDhY,EAAOwI,kBAAkBsM,UAAUkD,SAAW,SAAkB5I,EAAOmB,GACtE,IAAI0H,EAASF,EAAaZ,MAAM7T,KAAM4D,WAKtC,OAJK+Q,IACJA,EAASZ,EAAmB/T,KAAM8L,GAClC9L,KAAKuU,SAASzR,KAAK6R,IAEbA,GAGR,IAAIC,EAAkBlY,EAAOwI,kBAAkBsM,UAAUqD,YACzDnY,EAAOwI,kBAAkBsM,UAAUqD,YAAc,SAAqBF,GACrEC,EAAgBf,MAAM7T,KAAM4D,WAC5B,IAAIkR,EAAM9U,KAAKuU,SAASvM,QAAQ2M,IACnB,IAATG,GACH9U,KAAKuU,SAASQ,OAAOD,EAAK,IAI7B,IAAIE,EAAgBtY,EAAOwI,kBAAkBsM,UAAUyD,UACvDvY,EAAOwI,kBAAkBsM,UAAUyD,UAAY,SAAmBhI,GACjE,IAAIiI,EAASlV,KAEbA,KAAKuU,SAAWvU,KAAKuU,UAAY,GACjCS,EAAcnB,MAAM7T,KAAM,CAACiN,IAC3BA,EAAO2G,YAAY/S,SAAQ,SAAUiL,GACpCoJ,EAAOX,SAASzR,KAAKiR,EAAmBmB,EAAQpJ,QAIlD,IAAIqJ,EAAmBzY,EAAOwI,kBAAkBsM,UAAU4D,aAC1D1Y,EAAOwI,kBAAkBsM,UAAU4D,aAAe,SAAsBnI,GACvE,IAAIoI,EAASrV,KAEbA,KAAKuU,SAAWvU,KAAKuU,UAAY,GACjCY,EAAiBtB,MAAM7T,KAAM,CAACiN,IAE9BA,EAAO2G,YAAY/S,SAAQ,SAAUiL,GACpC,IAAI6I,EAASU,EAAOd,SAASzV,MAAK,SAAUwW,GAC3C,OAAOA,EAAExJ,QAAUA,KAEhB6I,GAEHU,EAAOd,SAASQ,OAAOM,EAAOd,SAASvM,QAAQ2M,GAAS,YAIrD,GAAwE,iBAAjD,IAAXjY,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwI,mBAAqB,eAAgBxI,EAAOwI,kBAAkBsM,WAAa,qBAAsB9U,EAAOwI,kBAAkBsM,WAAa9U,EAAO6Y,gBAAkB,SAAU7Y,EAAO6Y,aAAa/D,WAAY,CAC3S,IAAIgE,EAAiB9Y,EAAOwI,kBAAkBsM,UAAU8C,WACxD5X,EAAOwI,kBAAkBsM,UAAU8C,WAAa,WAC/C,IAAImB,EAASzV,KAET0V,EAAUF,EAAe3B,MAAM7T,KAAM,IAIzC,OAHA0V,EAAQ7U,SAAQ,SAAU8T,GACzB,OAAOA,EAAON,IAAMoB,KAEdC,GAGR9X,OAAOwQ,eAAe1R,EAAO6Y,aAAa/D,UAAW,OAAQ,CAC5DgB,IAAK,WAQJ,YAPmBjE,IAAfvO,KAAKkU,QACgB,UAApBlU,KAAK8L,MAAMqI,KACdnU,KAAKkU,MAAQlU,KAAKqU,IAAID,iBAAiBpU,KAAK8L,OAE5C9L,KAAKkU,MAAQ,MAGRlU,KAAKkU,WA5LhB5H,EAAQwD,aAkMR,SAAsBpT,GACrB,IAAKA,EAAOwI,kBACX,OAGD,IAAIyQ,EAAejZ,EAAOwI,kBAAkBsM,UAAUlR,SACtD5D,EAAOwI,kBAAkBsM,UAAUlR,SAAW,WAC7C,IAAIsV,EAAS5V,KAET6V,EAAaC,MAAMtE,UAAUgD,MAAMzG,KAAKnK,WAC1CmS,EAAWF,EAAW,GACtBG,EAASH,EAAW,GACpBI,EAAQJ,EAAW,GAMrB,GAAIjS,UAAUwI,OAAS,GAAyB,mBAAb2J,EAClC,OAAOJ,EAAa9B,MAAM7T,KAAM4D,WAKjC,GAA4B,IAAxB+R,EAAavJ,SAAsC,IAArBxI,UAAUwI,QAAoC,mBAAb2J,GAClE,OAAOJ,EAAa9B,MAAM7T,KAAM,IAGjC,IAAIkW,EAAkB,SAAyBC,GAC9C,IAAIC,EAAiB,GAiBrB,OAhBcD,EAASrV,SACfD,SAAQ,SAAUwV,GACzB,IAAIC,EAAgB,CACnBnT,GAAIkT,EAAOlT,GACXC,UAAWiT,EAAOjT,UAClB3F,KAAM,CACLyN,eAAgB,kBAChBO,gBAAiB,oBAChB4K,EAAO5Y,OAAS4Y,EAAO5Y,MAE1B4Y,EAAOrT,QAAQnC,SAAQ,SAAUoC,GAChCqT,EAAcrT,GAAQoT,EAAOnT,KAAKD,MAEnCmT,EAAeE,EAAcnT,IAAMmT,KAG7BF,GAIJG,EAAe,SAAsBC,GACxC,OAAO,IAAIC,IAAI7Y,OAAOmD,KAAKyV,GAAOE,KAAI,SAAUzV,GAC/C,MAAO,CAACA,EAAKuV,EAAMvV,SAIrB,GAAI2C,UAAUwI,QAAU,EAAG,CAC1B,IAAIuK,EAA0B,SAAiCR,GAC9DH,EAAOO,EAAaL,EAAgBC,MAGrC,OAAOR,EAAa9B,MAAM7T,KAAM,CAAC2W,EAAyBZ,IAI3D,OAAO,IAAIjJ,SAAQ,SAAUC,EAASC,GACrC2I,EAAa9B,MAAM+B,EAAQ,CAAC,SAAUO,GACrCpJ,EAAQwJ,EAAaL,EAAgBC,MACnCnJ,OACDtK,KAAKsT,EAAQC,KAtQlB3J,EAAQyD,2BA0QR,SAAoCrT,GACnC,KAA0E,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwI,mBAAqBxI,EAAO6Y,cAAgB7Y,EAAOka,gBAC/I,OAID,KAAM,aAAcla,EAAO6Y,aAAa/D,WAAY,CACnD,IAAIgE,EAAiB9Y,EAAOwI,kBAAkBsM,UAAU8C,WACpDkB,IACH9Y,EAAOwI,kBAAkBsM,UAAU8C,WAAa,WAC/C,IAAIuC,EAAS7W,KAET0V,EAAUF,EAAe3B,MAAM7T,KAAM,IAIzC,OAHA0V,EAAQ7U,SAAQ,SAAU8T,GACzB,OAAOA,EAAON,IAAMwC,KAEdnB,IAIT,IAAIjB,EAAe/X,EAAOwI,kBAAkBsM,UAAUkD,SAClDD,IACH/X,EAAOwI,kBAAkBsM,UAAUkD,SAAW,WAC7C,IAAIC,EAASF,EAAaZ,MAAM7T,KAAM4D,WAEtC,OADA+Q,EAAON,IAAMrU,KACN2U,IAGTjY,EAAO6Y,aAAa/D,UAAUlR,SAAW,WACxC,IAAIqU,EAAS3U,KACb,OAAOA,KAAKqU,IAAI/T,WAAWoC,MAAK,SAAU5B,GACzC,OAKCgO,EAAMgI,YAAYhW,EAAQ6T,EAAO7I,OAAO,OAO5C,KAAM,aAAcpP,EAAOka,eAAepF,WAAY,CACrD,IAAIuF,EAAmBra,EAAOwI,kBAAkBsM,UAAU+B,aACtDwD,IACHra,EAAOwI,kBAAkBsM,UAAU+B,aAAe,WACjD,IAAIyD,EAAShX,KAETiX,EAAYF,EAAiBlD,MAAM7T,KAAM,IAI7C,OAHAiX,EAAUpW,SAAQ,SAAUyS,GAC3B,OAAOA,EAASe,IAAM2C,KAEhBC,IAGTnI,EAAMgF,wBAAwBpX,EAAQ,SAAS,SAAUqB,GAExD,OADAA,EAAEuV,SAASe,IAAMtW,EAAEmZ,WACZnZ,KAERrB,EAAOka,eAAepF,UAAUlR,SAAW,WAC1C,IAAIgT,EAAWtT,KACf,OAAOA,KAAKqU,IAAI/T,WAAWoC,MAAK,SAAU5B,GACzC,OAAOgO,EAAMgI,YAAYhW,EAAQwS,EAASxH,OAAO,OAKpD,KAAM,aAAcpP,EAAO6Y,aAAa/D,cAAa,aAAc9U,EAAOka,eAAepF,WACxF,OAID,IAAImE,EAAejZ,EAAOwI,kBAAkBsM,UAAUlR,SACtD5D,EAAOwI,kBAAkBsM,UAAUlR,SAAW,WAC7C,GAAIsD,UAAUwI,OAAS,GAAKxI,UAAU,aAAclH,EAAOuI,iBAAkB,CAC5E,IAAI6G,EAAQlI,UAAU,GAClB+Q,OAAS,EACTrB,OAAW,EACX6D,OAAM,EAoBV,OAnBAnX,KAAKsU,aAAazT,SAAQ,SAAUyU,GAC/BA,EAAExJ,QAAUA,IACX6I,EACHwC,GAAM,EAENxC,EAASW,MAIZtV,KAAKuT,eAAe1S,SAAQ,SAAUgC,GAQrC,OAPIA,EAAEiJ,QAAUA,IACXwH,EACH6D,GAAM,EAEN7D,EAAWzQ,GAGNA,EAAEiJ,QAAUA,KAEhBqL,GAAOxC,GAAUrB,EACbxG,QAAQE,OAAO,IAAIoK,aAAa,4DAA6D,uBAC1FzC,EACHA,EAAOrU,WACJgT,EACHA,EAAShT,WAEVwM,QAAQE,OAAO,IAAIoK,aAAa,gDAAiD,uBAEzF,OAAOzB,EAAa9B,MAAM7T,KAAM4D,aArXlC0I,EAAQ+K,kCAAoCA,EAC5C/K,EAAQsD,wBAscR,SAAiClT,GAChC,IAAKA,EAAOwI,kBACX,OAED,IAAI6J,EAAiBD,EAAME,cAActS,GAEzC,GAAIA,EAAOwI,kBAAkBsM,UAAUkD,UAAY3F,EAAeuI,SAAW,GAC5E,OAAOD,EAAkC3a,GAK1C,IAAI6a,EAAsB7a,EAAOwI,kBAAkBsM,UAAUgG,gBAC7D9a,EAAOwI,kBAAkBsM,UAAUgG,gBAAkB,WACpD,IAAIC,EAAUzX,KAEV0X,EAAgBH,EAAoB1D,MAAM7T,MAE9C,OADAA,KAAK2X,gBAAkB3X,KAAK2X,iBAAmB,GACxCD,EAAchB,KAAI,SAAUzJ,GAClC,OAAOwK,EAAQE,gBAAgB1K,EAAO9J,QAIxC,IAAI6R,EAAgBtY,EAAOwI,kBAAkBsM,UAAUyD,UACvDvY,EAAOwI,kBAAkBsM,UAAUyD,UAAY,SAAmBhI,GACjE,IAAI2K,EAAU5X,KAed,GAbAA,KAAK6X,SAAW7X,KAAK6X,UAAY,GACjC7X,KAAK2X,gBAAkB3X,KAAK2X,iBAAmB,GAE/C1K,EAAO2G,YAAY/S,SAAQ,SAAUiL,GAIpC,GAHoB8L,EAAQtD,aAAaxV,MAAK,SAAUwW,GACvD,OAAOA,EAAExJ,QAAUA,KAGnB,MAAM,IAAIsL,aAAa,wBAAyB,0BAK7CpX,KAAK2X,gBAAgB1K,EAAO9J,IAAK,CACrC,IAAI2U,EAAY,IAAIpb,EAAOgW,YAAYzF,EAAO2G,aAC9C5T,KAAK6X,SAAS5K,EAAO9J,IAAM2U,EAC3B9X,KAAK2X,gBAAgBG,EAAU3U,IAAM8J,EACrCA,EAAS6K,EAEV9C,EAAcnB,MAAM7T,KAAM,CAACiN,KAG5B,IAAIkI,EAAmBzY,EAAOwI,kBAAkBsM,UAAU4D,aA2D1D,SAAS2C,EAAwB/D,EAAIgE,GACpC,IAAIC,EAAMD,EAAYC,IAMtB,OALAra,OAAOmD,KAAKiT,EAAG2D,iBAAmB,IAAI9W,SAAQ,SAAUqX,GACvD,IAAIC,EAAiBnE,EAAG2D,gBAAgBO,GACpCE,EAAiBpE,EAAG6D,SAASM,EAAehV,IAChD8U,EAAMA,EAAII,QAAQ,IAAIC,OAAOF,EAAejV,GAAI,KAAMgV,EAAehV,OAE/D,IAAIoV,sBAAsB,CAChC9a,KAAMua,EAAYva,KAClBwa,IAAKA,IAGP,SAASO,EAAwBxE,EAAIgE,GACpC,IAAIC,EAAMD,EAAYC,IAMtB,OALAra,OAAOmD,KAAKiT,EAAG2D,iBAAmB,IAAI9W,SAAQ,SAAUqX,GACvD,IAAIC,EAAiBnE,EAAG2D,gBAAgBO,GACpCE,EAAiBpE,EAAG6D,SAASM,EAAehV,IAChD8U,EAAMA,EAAII,QAAQ,IAAIC,OAAOH,EAAehV,GAAI,KAAMiV,EAAejV,OAE/D,IAAIoV,sBAAsB,CAChC9a,KAAMua,EAAYva,KAClBwa,IAAKA,IA/EPvb,EAAOwI,kBAAkBsM,UAAU4D,aAAe,SAAsBnI,GACvEjN,KAAK6X,SAAW7X,KAAK6X,UAAY,GACjC7X,KAAK2X,gBAAkB3X,KAAK2X,iBAAmB,GAE/CxC,EAAiBtB,MAAM7T,KAAM,CAACA,KAAK6X,SAAS5K,EAAO9J,KAAO8J,WACnDjN,KAAK2X,gBAAgB3X,KAAK6X,SAAS5K,EAAO9J,IAAMnD,KAAK6X,SAAS5K,EAAO9J,IAAIA,GAAK8J,EAAO9J,WACrFnD,KAAK6X,SAAS5K,EAAO9J,KAG7BzG,EAAOwI,kBAAkBsM,UAAUkD,SAAW,SAAkB5I,EAAOmB,GACtE,IAAIwL,EAAUzY,KAEd,GAA4B,WAAxBA,KAAK0Y,eACR,MAAM,IAAItB,aAAa,sDAA0D,qBAElF,IAAIvR,EAAU,GAAG2O,MAAMzG,KAAKnK,UAAW,GACvC,GAAuB,IAAnBiC,EAAQuG,SAAiBvG,EAAQ,GAAG+N,YAAY9U,MAAK,SAAU0O,GAClE,OAAOA,IAAM1B,KAIb,MAAM,IAAIsL,aAAa,gHAAsH,qBAG9I,IAAIuB,EAAgB3Y,KAAKsU,aAAaxV,MAAK,SAAUwW,GACpD,OAAOA,EAAExJ,QAAUA,KAEpB,GAAI6M,EACH,MAAM,IAAIvB,aAAa,wBAAyB,sBAGjDpX,KAAK6X,SAAW7X,KAAK6X,UAAY,GACjC7X,KAAK2X,gBAAkB3X,KAAK2X,iBAAmB,GAC/C,IAAIiB,EAAY5Y,KAAK6X,SAAS5K,EAAO9J,IACrC,GAAIyV,EAKHA,EAAUlE,SAAS5I,GAGnBgB,QAAQC,UAAUrK,MAAK,WACtB+V,EAAQ9E,cAAc,IAAIF,MAAM,6BAE3B,CACN,IAAIqE,EAAY,IAAIpb,EAAOgW,YAAY,CAAC5G,IACxC9L,KAAK6X,SAAS5K,EAAO9J,IAAM2U,EAC3B9X,KAAK2X,gBAAgBG,EAAU3U,IAAM8J,EACrCjN,KAAKiV,UAAU6C,GAEhB,OAAO9X,KAAKsU,aAAaxV,MAAK,SAAUwW,GACvC,OAAOA,EAAExJ,QAAUA,MA8BrB,CAAC,cAAe,gBAAgBjL,SAAQ,SAAUgY,GACjD,IAAIC,EAAepc,EAAOwI,kBAAkBsM,UAAUqH,GAClDE,EAAYC,EAAgB,GAAIH,GAAQ,WAC3C,IAAII,EAAUjZ,KAEVkZ,EAAOtV,UACPuV,EAAevV,UAAUwI,QAAkC,mBAAjBxI,UAAU,GACxD,OAAIuV,EACIL,EAAajF,MAAM7T,KAAM,CAAC,SAAUgY,GAC1C,IAAIoB,EAAOrB,EAAwBkB,EAASjB,GAC5CkB,EAAK,GAAGrF,MAAM,KAAM,CAACuF,KACnB,SAAUjC,GACR+B,EAAK,IACRA,EAAK,GAAGrF,MAAM,KAAMsD,IAEnBvT,UAAU,KAEPkV,EAAajF,MAAM7T,KAAM4D,WAAWlB,MAAK,SAAUsV,GACzD,OAAOD,EAAwBkB,EAASjB,SAG1Ctb,EAAOwI,kBAAkBsM,UAAUqH,GAAUE,EAAUF,MAGxD,IAAIQ,EAA0B3c,EAAOwI,kBAAkBsM,UAAU8H,oBACjE5c,EAAOwI,kBAAkBsM,UAAU8H,oBAAsB,WACxD,OAAK1V,UAAUwI,QAAWxI,UAAU,GAAGnG,MAGvCmG,UAAU,GAAK4U,EAAwBxY,KAAM4D,UAAU,IAChDyV,EAAwBxF,MAAM7T,KAAM4D,YAHnCyV,EAAwBxF,MAAM7T,KAAM4D,YAQ7C,IAAI2V,EAAuB3b,OAAO4b,yBAAyB9c,EAAOwI,kBAAkBsM,UAAW,oBAC/F5T,OAAOwQ,eAAe1R,EAAOwI,kBAAkBsM,UAAW,mBAAoB,CAC7EgB,IAAK,WACJ,IAAIwF,EAAcuB,EAAqB/G,IAAIqB,MAAM7T,MACjD,MAAyB,KAArBgY,EAAYva,KACRua,EAEDD,EAAwB/X,KAAMgY,MAIvCtb,EAAOwI,kBAAkBsM,UAAUqD,YAAc,SAAqBF,GACrE,IAAI8E,EAAUzZ,KAEd,GAA4B,WAAxBA,KAAK0Y,eACR,MAAM,IAAItB,aAAa,sDAA0D,qBAIlF,IAAKzC,EAAON,IACX,MAAM,IAAI+C,aAAa,yFAA+F,aAGvH,KADczC,EAAON,MAAQrU,MAE5B,MAAM,IAAIoX,aAAa,6CAA8C,sBAItEpX,KAAK6X,SAAW7X,KAAK6X,UAAY,GACjC,IAAI5K,OAAS,EACbrP,OAAOmD,KAAKf,KAAK6X,UAAUhX,SAAQ,SAAU6Y,GAC7BD,EAAQ5B,SAAS6B,GAAU9F,YAAY9U,MAAK,SAAUgN,GACpE,OAAO6I,EAAO7I,QAAUA,OAGxBmB,EAASwM,EAAQ5B,SAAS6B,OAIxBzM,IAC+B,IAA9BA,EAAO2G,YAAYxH,OAGtBpM,KAAKoV,aAAapV,KAAK2X,gBAAgB1K,EAAO9J,KAG9C8J,EAAO4H,YAAYF,EAAO7I,OAE3B9L,KAAK2T,cAAc,IAAIF,MAAM,yBA5pBhCnH,EAAQiD,mBAiqBR,SAA4B7S,GAC3B,IAAIqS,EAAiBD,EAAME,cAActS,IAEpCA,EAAOwI,mBAAqBxI,EAAO0I,0BAEvC1I,EAAOwI,kBAAoBxI,EAAO0I,yBAEnC,IAAK1I,EAAOwI,kBACX,OAIG6J,EAAeuI,QAAU,IAC5B,CAAC,sBAAuB,uBAAwB,mBAAmBzW,SAAQ,SAAUgY,GACpF,IAAIC,EAAepc,EAAOwI,kBAAkBsM,UAAUqH,GAClDE,EAAYC,EAAgB,GAAIH,GAAQ,WAE3C,OADAjV,UAAU,GAAK,IAAgB,oBAAXiV,EAA+Bnc,EAAOid,gBAAkBjd,EAAO6b,uBAAuB3U,UAAU,IAC7GkV,EAAajF,MAAM7T,KAAM4D,cAEjClH,EAAOwI,kBAAkBsM,UAAUqH,GAAUE,EAAUF,MAKzD,IAAIe,EAAwBld,EAAOwI,kBAAkBsM,UAAUqI,gBAC/Dnd,EAAOwI,kBAAkBsM,UAAUqI,gBAAkB,WACpD,OAAKjW,UAAU,GAQXmL,EAAeuI,QAAU,IAAM1T,UAAU,IAAiC,KAA3BA,UAAU,GAAGkG,UACxDgD,QAAQC,UAET6M,EAAsB/F,MAAM7T,KAAM4D,YAVpCA,UAAU,IACbA,UAAU,GAAGiQ,MAAM,MAEb/G,QAAQC,aA9rBlBT,EAAQ0D,qBAysBR,SAA8BtT,GAC7BoS,EAAMgF,wBAAwBpX,EAAQ,qBAAqB,SAAUqB,GAEpE,GAA0B,WADjBA,EAAE+b,OACJpB,eAGP,OAAO3a,MA7sBT,IAEI+Q,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,gBAMrB,SAASoe,EAAgBhV,EAAK/C,EAAKoN,GAAiK,OAApJpN,KAAO+C,EAAOpG,OAAOwQ,eAAepK,EAAK/C,EAAK,CAAEoN,MAAOA,EAAOkE,YAAY,EAAMS,cAAc,EAAM+G,UAAU,IAAkB/V,EAAI/C,GAAOoN,EAAgBrK,EA8W3M,SAASqT,EAAkC3a,GAI1CA,EAAOwI,kBAAkBsM,UAAUgG,gBAAkB,WACpD,IAAIwC,EAASha,KAGb,OADAA,KAAKia,qBAAuBja,KAAKia,sBAAwB,GAClDrc,OAAOmD,KAAKf,KAAKia,sBAAsBvD,KAAI,SAAUwD,GAC3D,OAAOF,EAAOC,qBAAqBC,GAAU,OAI/C,IAAIzF,EAAe/X,EAAOwI,kBAAkBsM,UAAUkD,SACtDhY,EAAOwI,kBAAkBsM,UAAUkD,SAAW,SAAkB5I,EAAOmB,GACtE,IAAKA,EACJ,OAAOwH,EAAaZ,MAAM7T,KAAM4D,WAEjC5D,KAAKia,qBAAuBja,KAAKia,sBAAwB,GAEzD,IAAItF,EAASF,EAAaZ,MAAM7T,KAAM4D,WAMtC,OALK5D,KAAKia,qBAAqBhN,EAAO9J,KAE+B,IAA1DnD,KAAKia,qBAAqBhN,EAAO9J,IAAI6E,QAAQ2M,IACvD3U,KAAKia,qBAAqBhN,EAAO9J,IAAIL,KAAK6R,GAF1C3U,KAAKia,qBAAqBhN,EAAO9J,IAAM,CAAC8J,EAAQ0H,GAI1CA,GAGR,IAAIK,EAAgBtY,EAAOwI,kBAAkBsM,UAAUyD,UACvDvY,EAAOwI,kBAAkBsM,UAAUyD,UAAY,SAAmBhI,GACjE,IAAIkN,EAASna,KAEbA,KAAKia,qBAAuBja,KAAKia,sBAAwB,GAEzDhN,EAAO2G,YAAY/S,SAAQ,SAAUiL,GAIpC,GAHoBqO,EAAO7F,aAAaxV,MAAK,SAAUwW,GACtD,OAAOA,EAAExJ,QAAUA,KAGnB,MAAM,IAAIsL,aAAa,wBAAyB,yBAGlD,IAAIgD,EAAkBpa,KAAKsU,aAC3BU,EAAcnB,MAAM7T,KAAM4D,WAC1B,IAAIyW,EAAara,KAAKsU,aAAagG,QAAO,SAAUC,GACnD,OAA+C,IAAxCH,EAAgBpS,QAAQuS,MAEhCva,KAAKia,qBAAqBhN,EAAO9J,IAAM,CAAC8J,GAAQuN,OAAOH,IAGxD,IAAIlF,EAAmBzY,EAAOwI,kBAAkBsM,UAAU4D,aAC1D1Y,EAAOwI,kBAAkBsM,UAAU4D,aAAe,SAAsBnI,GAGvE,OAFAjN,KAAKia,qBAAuBja,KAAKia,sBAAwB,UAClDja,KAAKia,qBAAqBhN,EAAO9J,IACjCgS,EAAiBtB,MAAM7T,KAAM4D,YAGrC,IAAIgR,EAAkBlY,EAAOwI,kBAAkBsM,UAAUqD,YACzDnY,EAAOwI,kBAAkBsM,UAAUqD,YAAc,SAAqBF,GACrE,IAAI8F,EAAUza,KAcd,OAZAA,KAAKia,qBAAuBja,KAAKia,sBAAwB,GACrDtF,GACH/W,OAAOmD,KAAKf,KAAKia,sBAAsBpZ,SAAQ,SAAUqZ,GACxD,IAAIpF,EAAM2F,EAAQR,qBAAqBC,GAAUlS,QAAQ2M,IAC5C,IAATG,GACH2F,EAAQR,qBAAqBC,GAAUnF,OAAOD,EAAK,GAEE,IAAlD2F,EAAQR,qBAAqBC,GAAU9N,eACnCqO,EAAQR,qBAAqBC,MAIhCtF,EAAgBf,MAAM7T,KAAM4D,cAmRnC,CAAC8W,cAAc,GAAGC,oBAAoB,EAAEC,iBAAiB,IAAIC,EAAE,CAAC,SAASjgB,EAAQyR,EAAOC,GAS1F,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBACR,SAA6BlU,EAAQoe,GACpC,GAAIpe,EAAO8G,UAAUiJ,cAAgB,oBAAqB/P,EAAO8G,UAAUiJ,aAC1E,OAED,IAAK/P,EAAO8G,UAAUiJ,aACrB,OAID,GAA2B,mBAAhBqO,EAEV,YADA5Z,QAAQC,MAAM,+DAGfzE,EAAO8G,UAAUiJ,aAAasO,gBAAkB,SAAyBlO,GACxE,OAAOiO,EAAYjO,GAAanK,MAAK,SAAUsY,GAC9C,IAAIC,EAAiBpO,EAAY9K,OAAS8K,EAAY9K,MAAM6C,MACxDsW,EAAkBrO,EAAY9K,OAAS8K,EAAY9K,MAAM8C,OACzDsW,EAAqBtO,EAAY9K,OAAS8K,EAAY9K,MAAMqZ,UAchE,OAbAvO,EAAY9K,MAAQ,CACnBsZ,UAAW,CACVC,kBAAmB,UACnBC,oBAAqBP,EACrBQ,aAAcL,GAAsB,IAGlCF,IACHpO,EAAY9K,MAAMsZ,UAAUI,SAAWR,GAEpCC,IACHrO,EAAY9K,MAAMsZ,UAAUK,UAAYR,GAElCxe,EAAO8G,UAAUiJ,aAAa/I,aAAamJ,SAKnD,IAAI8O,EAAE,CAAC,SAAS/gB,EAAQyR,EAAOC,GASjC,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAGR,IAAI6D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAEtQsI,EAAQmD,iBAUR,SAA0B/S,GACzB,IAAI8G,EAAY9G,GAAUA,EAAO8G,UAEjC,IAAKA,EAAUiJ,aACd,OAGD,IAAIsC,EAAiBD,EAAME,cAActS,GAErCkf,EAAuB,SAA8BlO,GACxD,GAA8D,iBAA5C,IAANA,EAAoB,YAAcwE,EAAQxE,KAAoBA,EAAE2N,WAAa3N,EAAEmO,SAC1F,OAAOnO,EAER,IAAIoO,EAAK,GA4CT,OA3CAle,OAAOmD,KAAK2M,GAAG7M,SAAQ,SAAUI,GAChC,GAAY,YAARA,GAA6B,aAARA,GAA8B,gBAARA,EAA/C,CAGA,IAAI4B,EAAwB,WAApBqP,EAAQxE,EAAEzM,IAAqByM,EAAEzM,GAAO,CAAE8a,MAAOrO,EAAEzM,SAC3CsN,IAAZ1L,EAAEmZ,OAA0C,iBAAZnZ,EAAEmZ,QACrCnZ,EAAEoZ,IAAMpZ,EAAEqZ,IAAMrZ,EAAEmZ,OAEnB,IAAIG,EAAW,SAAkBC,EAAQnZ,GACxC,OAAImZ,EACIA,EAASnZ,EAAKoZ,OAAO,GAAGC,cAAgBrZ,EAAKuR,MAAM,GAE3C,aAATvR,EAAsB,WAAaA,GAE3C,QAAgBsL,IAAZ1L,EAAEkZ,MAAqB,CAC1BD,EAAGD,SAAWC,EAAGD,UAAY,GAC7B,IAAIU,EAAK,GACc,iBAAZ1Z,EAAEkZ,OACZQ,EAAGJ,EAAS,MAAOlb,IAAQ4B,EAAEkZ,MAC7BD,EAAGD,SAAS/Y,KAAKyZ,IACjBA,EAAK,IACFJ,EAAS,MAAOlb,IAAQ4B,EAAEkZ,MAC7BD,EAAGD,SAAS/Y,KAAKyZ,KAEjBA,EAAGJ,EAAS,GAAIlb,IAAQ4B,EAAEkZ,MAC1BD,EAAGD,SAAS/Y,KAAKyZ,SAGHhO,IAAZ1L,EAAEmZ,OAA0C,iBAAZnZ,EAAEmZ,OACrCF,EAAGT,UAAYS,EAAGT,WAAa,GAC/BS,EAAGT,UAAUc,EAAS,GAAIlb,IAAQ4B,EAAEmZ,OAEpC,CAAC,MAAO,OAAOnb,SAAQ,SAAU2b,QACjBjO,IAAX1L,EAAE2Z,KACLV,EAAGT,UAAYS,EAAGT,WAAa,GAC/BS,EAAGT,UAAUc,EAASK,EAAKvb,IAAQ4B,EAAE2Z,WAKrC9O,EAAE+O,WACLX,EAAGD,UAAYC,EAAGD,UAAY,IAAIrB,OAAO9M,EAAE+O,WAErCX,GAGJY,EAAmB,SAA0B7P,EAAa8P,GAC7D,GAAI5N,EAAeuI,SAAW,GAC7B,OAAOqF,EAAK9P,GAGb,IADAA,EAAc+P,KAAKC,MAAMD,KAAKE,UAAUjQ,MACU,WAA/BqF,EAAQrF,EAAY/K,OAAqB,CAC3D,IAAIib,EAAQ,SAAe/Y,EAAK4J,EAAGoP,GAC9BpP,KAAK5J,KAASgZ,KAAKhZ,KACtBA,EAAIgZ,GAAKhZ,EAAI4J,UACN5J,EAAI4J,KAIbmP,GADAlQ,EAAc+P,KAAKC,MAAMD,KAAKE,UAAUjQ,KACtB/K,MAAO,kBAAmB,uBAC5Cib,EAAMlQ,EAAY/K,MAAO,mBAAoB,wBAC7C+K,EAAY/K,MAAQ8Z,EAAqB/O,EAAY/K,OAEtD,GAAI+K,GAA8C,WAA/BqF,EAAQrF,EAAY9K,OAAqB,CAE3D,IAAIkb,EAAOpQ,EAAY9K,MAAMmb,WAC7BD,EAAOA,IAAyE,iBAA/C,IAATA,EAAuB,YAAc/K,EAAQ+K,IAAsBA,EAAO,CAAElB,MAAOkB,IAC3G,IAAIE,EAA6BpO,EAAeuI,QAAU,GAE1D,GAAI2F,IAAwB,SAAfA,EAAKjB,OAAmC,gBAAfiB,EAAKjB,OAA0C,SAAfiB,EAAKlB,OAAmC,gBAAfkB,EAAKlB,UAA8BvY,EAAUiJ,aAAa2Q,0BAA2B5Z,EAAUiJ,aAAa2Q,0BAA0BF,YAAeC,GAA6B,QACzQtQ,EAAY9K,MAAMmb,WACzB,IAAIG,OAAU,EAMd,GALmB,gBAAfJ,EAAKjB,OAA0C,gBAAfiB,EAAKlB,MACxCsB,EAAU,CAAC,OAAQ,QACM,SAAfJ,EAAKjB,OAAmC,SAAfiB,EAAKlB,QACxCsB,EAAU,CAAC,UAERA,EAEH,OAAO7Z,EAAUiJ,aAAa6Q,mBAAmB5a,MAAK,SAAU6a,GAI/D,IAAIC,GAHJD,EAAUA,EAAQjD,QAAO,SAAUmD,GAClC,MAAkB,eAAXA,EAAEtJ,SAEQrV,MAAK,SAAU2e,GAChC,OAAOJ,EAAQK,MAAK,SAAUxe,GAC7B,OAAOue,EAAEE,MAAMle,cAAcme,SAAS1e,SAWxC,OARKse,GAAOD,EAAQnR,QAAUiR,EAAQO,SAAS,UAC9CJ,EAAMD,EAAQA,EAAQnR,OAAS,IAE5BoR,IACH3Q,EAAY9K,MAAM8b,SAAWZ,EAAKjB,MAAQ,CAAEA,MAAOwB,EAAIK,UAAa,CAAE9B,MAAOyB,EAAIK,WAElFhR,EAAY9K,MAAQ6Z,EAAqB/O,EAAY9K,OACrD8M,EAAQ,WAAa+N,KAAKE,UAAUjQ,IAC7B8P,EAAK9P,MAIfA,EAAY9K,MAAQ6Z,EAAqB/O,EAAY9K,OAGtD,OADA8M,EAAQ,WAAa+N,KAAKE,UAAUjQ,IAC7B8P,EAAK9P,IAGTiR,EAAa,SAAoB/f,GACpC,OAAIgR,EAAeuI,SAAW,GACtBvZ,EAED,CACNkF,KAAM,CACL8a,sBAAuB,kBACvBC,yBAA0B,kBAC1BC,kBAAmB,kBACnBC,qBAAsB,gBACtBC,4BAA6B,uBAC7BC,gBAAiB,mBACjBC,+BAAgC,kBAChCC,wBAAyB,kBACzBC,gBAAiB,aACjBC,mBAAoB,aACpBC,mBAAoB,cACnB1gB,EAAEkF,OAASlF,EAAEkF,KACf7B,QAASrD,EAAEqD,QACXsd,WAAY3gB,EAAE2gB,YAAc3gB,EAAE4gB,eAC9BpZ,SAAU,WACT,OAAOvF,KAAKiD,MAAQjD,KAAKoB,SAAW,MAAQpB,KAAKoB,WAmBpD,GALAoC,EAAUE,aATU,SAAuBmJ,EAAa+R,EAAWC,GAClEnC,EAAiB7P,GAAa,SAAUa,GACvClK,EAAUkJ,mBAAmBgB,EAAGkR,GAAW,SAAU7gB,GAChD8gB,GACHA,EAAQf,EAAW/f,WAKgB+gB,KAAKtb,GAKxCA,EAAUiJ,aAAa/I,aAAc,CACxC,IAAIqb,EAAmBvb,EAAUiJ,aAAa/I,aAAaob,KAAKtb,EAAUiJ,cAC1EjJ,EAAUiJ,aAAa/I,aAAe,SAAUsb,GAC/C,OAAOtC,EAAiBsC,GAAI,SAAUtR,GACrC,OAAOqR,EAAiBrR,GAAGhL,MAAK,SAAUuK,GACzC,GAAIS,EAAE5L,QAAUmL,EAAOgS,iBAAiB7S,QAAUsB,EAAE3L,QAAUkL,EAAOiS,iBAAiB9S,OAIrF,MAHAa,EAAO2G,YAAY/S,SAAQ,SAAUiL,GACpCA,EAAMqT,UAED,IAAI/H,aAAa,GAAI,iBAE5B,OAAOnK,KACL,SAAUlP,GACZ,OAAO+O,QAAQE,OAAO8Q,EAAW/f,aArLtC,IAEI+Q,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,gBAMrB,IAAIiU,EAAUC,EAAMnL,KAsLlB,CAAC+W,cAAc,KAAK0E,EAAE,CAAC,SAASxkB,EAAQyR,EAAOC,GASjD,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAGR,IAAI6D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAEtQsI,EAAQ2D,oBAkBR,SAA6BvT,GAG5B,IAAKA,EAAOid,iBAAmBjd,EAAOid,iBAAmB,eAAgBjd,EAAOid,gBAAgBnI,UAC/F,OAGD,IAAI6N,EAAwB3iB,EAAOid,gBACnCjd,EAAOid,gBAAkB,SAAyBT,GAOjD,GALoE,iBAA/C,IAATA,EAAuB,YAAchH,EAAQgH,KAAuBA,EAAKpP,WAA8C,IAAjCoP,EAAKpP,UAAU9B,QAAQ,SACxHkR,EAAO0D,KAAKC,MAAMD,KAAKE,UAAU5D,KAC5BpP,UAAYoP,EAAKpP,UAAUwV,OAAO,IAGpCpG,EAAKpP,WAAaoP,EAAKpP,UAAUsC,OAAQ,CAE5C,IAAImT,EAAkB,IAAIF,EAAsBnG,GAC5CsG,EAAkBC,EAAM/N,QAAQgO,eAAexG,EAAKpP,WACpD6V,EAAqB/hB,OAAOgiB,OAAOL,EAAiBC,GAWxD,OARAG,EAAmBE,OAAS,WAC3B,MAAO,CACN/V,UAAW6V,EAAmB7V,UAC9BgW,OAAQH,EAAmBG,OAC3BC,cAAeJ,EAAmBI,cAClCC,iBAAkBL,EAAmBK,mBAGhCL,EAER,OAAO,IAAIN,EAAsBnG,IAElCxc,EAAOid,gBAAgBnI,UAAY6N,EAAsB7N,UAIzD1C,EAAMgF,wBAAwBpX,EAAQ,gBAAgB,SAAUqB,GAO/D,OANIA,EAAE+L,WACLlM,OAAOwQ,eAAerQ,EAAG,YAAa,CACrCsQ,MAAO,IAAI3R,EAAOid,gBAAgB5b,EAAE+L,WACpCiQ,SAAU,UAGLhc,MA9DTuO,EAAQ6D,mBAkER,SAA4BzT,GAC3B,IAAKA,EAAOwI,kBACX,OAED,IAAI6J,EAAiBD,EAAME,cAActS,GAEnC,SAAUA,EAAOwI,kBAAkBsM,WACxC5T,OAAOwQ,eAAe1R,EAAOwI,kBAAkBsM,UAAW,OAAQ,CACjEgB,IAAK,WACJ,YAA6B,IAAfxS,KAAKigB,MAAwB,KAAOjgB,KAAKigB,SAK1D,IAAIC,EAAoB,SAA2BlI,GAClD,IAAKA,IAAgBA,EAAYC,IAChC,OAAO,EAER,IAAIkI,EAAWV,EAAM/N,QAAQ0O,cAAcpI,EAAYC,KAEvD,OADAkI,EAASE,QACFF,EAASzC,MAAK,SAAU4C,GAC9B,IAAIC,EAAQd,EAAM/N,QAAQ8O,WAAWF,GACrC,OAAOC,GAAwB,gBAAfA,EAAMpM,OAA8D,IAApCoM,EAAM/b,SAASwD,QAAQ,YAIrEyY,EAA0B,SAAiCzI,GAE9D,IAAI9Y,EAAQ8Y,EAAYC,IAAI/Y,MAAM,mCAClC,GAAc,OAAVA,GAAkBA,EAAMkN,OAAS,EACpC,OAAQ,EAET,IAAIkL,EAAU3L,SAASzM,EAAM,GAAI,IAEjC,OAAOoY,GAAYA,GAAW,EAAIA,GAG/BoJ,EAA2B,SAAkCC,GAKhE,IAAIC,EAAwB,MAuB5B,MAtB+B,YAA3B7R,EAAeM,UAKhBuR,EAJE7R,EAAeuI,QAAU,IACH,IAArBqJ,EAGqB,MAIA,WAEf5R,EAAeuI,QAAU,GAKgB,KAA3BvI,EAAeuI,QAAiB,MAAQ,MAGxC,YAGnBsJ,GAGJC,EAAoB,SAA2B7I,EAAa2I,GAG/D,IAAIG,EAAiB,MAKU,YAA3B/R,EAAeM,SAAoD,KAA3BN,EAAeuI,UAC1DwJ,EAAiB,OAGlB,IAAI5hB,EAAQugB,EAAM/N,QAAQqP,YAAY/I,EAAYC,IAAK,uBASvD,OARI/Y,EAAMkN,OAAS,EAClB0U,EAAiBnV,SAASzM,EAAM,GAAGogB,OAAO,IAAK,IACV,YAA3BvQ,EAAeM,UAA8C,IAArBsR,IAIlDG,EAAiB,YAEXA,GAGJ7N,EAA2BvW,EAAOwI,kBAAkBsM,UAAU0B,qBAClExW,EAAOwI,kBAAkBsM,UAAU0B,qBAAuB,WAKzD,GAJAlT,KAAKigB,MAAQ,KAIkB,WAA3BlR,EAAeM,SAAwBN,EAAeuI,SAAW,GAAI,CACxE,IAAI0J,EAAoBhhB,KAAKihB,mBAC3BC,EAAeF,EAAkBE,aAEd,WAAjBA,GACHtjB,OAAOwQ,eAAepO,KAAM,OAAQ,CACnCwS,IAAK,WACJ,YAA6B,IAAfxS,KAAKigB,MAAwB,KAAOjgB,KAAKigB,OAGxD1N,YAAY,EACZS,cAAc,IAKjB,GAAIkN,EAAkBtc,UAAU,IAAK,CAEpC,IAAIud,EAAYV,EAAwB7c,UAAU,IAG9Cwd,EAAaV,EAAyBS,GAGtCE,EAAYR,EAAkBjd,UAAU,GAAIud,GAG5CL,OAAiB,EAEpBA,EADkB,IAAfM,GAAkC,IAAdC,EACNC,OAAOC,kBACC,IAAfH,GAAkC,IAAdC,EACbG,KAAKtF,IAAIkF,EAAYC,GAErBG,KAAKvF,IAAImF,EAAYC,GAKvC,IAAII,EAAO,GACX7jB,OAAOwQ,eAAeqT,EAAM,iBAAkB,CAC7CjP,IAAK,WACJ,OAAOsO,KAGT9gB,KAAKigB,MAAQwB,EAGd,OAAOxO,EAAyBY,MAAM7T,KAAM4D,aAlN9C0I,EAAQ8D,uBAsNR,SAAgC1T,GAC/B,IAAMA,EAAOwI,qBAAqB,sBAAuBxI,EAAOwI,kBAAkBsM,WACjF,OAOD,SAASkQ,EAAWC,EAAI3N,GACvB,IAAI4N,EAAsBD,EAAGlc,KAC7Bkc,EAAGlc,KAAO,WACT,IAAIoc,EAAOje,UAAU,GACjBwI,EAASyV,EAAKzV,QAAUyV,EAAKC,MAAQD,EAAKE,WAC9C,GAAsB,SAAlBJ,EAAGK,YAAyBhO,EAAGyN,MAAQrV,EAAS4H,EAAGyN,KAAKX,eAC3D,MAAM,IAAImB,UAAU,4CAA8CjO,EAAGyN,KAAKX,eAAiB,WAE5F,OAAOc,EAAoB/N,MAAM8N,EAAI/d,YAGvC,IAAIse,EAAwBxlB,EAAOwI,kBAAkBsM,UAAU2Q,kBAC/DzlB,EAAOwI,kBAAkBsM,UAAU2Q,kBAAoB,WACtD,IAAIC,EAAcF,EAAsBrO,MAAM7T,KAAM4D,WAEpD,OADA8d,EAAWU,EAAapiB,MACjBoiB,GAERtT,EAAMgF,wBAAwBpX,EAAQ,eAAe,SAAUqB,GAE9D,OADA2jB,EAAW3jB,EAAEskB,QAAStkB,EAAE+b,QACjB/b,MAjPTuO,EAAQ4D,oBA4PR,SAA6BxT,GAC5B,IAAKA,EAAOwI,mBAAqB,oBAAqBxI,EAAOwI,kBAAkBsM,UAC9E,OAED,IAAI8Q,EAAQ5lB,EAAOwI,kBAAkBsM,UACrC5T,OAAOwQ,eAAekU,EAAO,kBAAmB,CAC/C9P,IAAK,WACJ,MAAO,CACN+P,UAAW,YACXC,SAAU,cACTxiB,KAAKuB,qBAAuBvB,KAAKuB,oBAGpCgR,YAAY,EACZS,cAAc,IAEfpV,OAAOwQ,eAAekU,EAAO,0BAA2B,CACvD9P,IAAK,WACJ,OAAOxS,KAAKyiB,0BAA4B,MAEzC5P,IAAK,SAAatQ,GACbvC,KAAKyiB,2BACRziB,KAAK8S,oBAAoB,wBAAyB9S,KAAKyiB,iCAChDziB,KAAKyiB,0BAETlgB,GACHvC,KAAK+S,iBAAiB,wBAAyB/S,KAAKyiB,yBAA2BlgB,IAIjFgQ,YAAY,EACZS,cAAc,IAGf,CAAC,sBAAuB,wBAAwBnS,SAAQ,SAAUgY,GACjE,IAAI6J,EAAaJ,EAAMzJ,GACvByJ,EAAMzJ,GAAU,WAaf,OAZK7Y,KAAK2iB,6BACT3iB,KAAK2iB,2BAA6B,SAAU5kB,GAC3C,IAAIiW,EAAKjW,EAAE+b,OACX,GAAI9F,EAAG4O,uBAAyB5O,EAAG6O,gBAAiB,CACnD7O,EAAG4O,qBAAuB5O,EAAG6O,gBAC7B,IAAIC,EAAW,IAAIrP,MAAM,wBAAyB1V,GAClDiW,EAAGL,cAAcmP,GAElB,OAAO/kB,GAERiC,KAAK+S,iBAAiB,2BAA4B/S,KAAK2iB,6BAEjDD,EAAW7O,MAAM7T,KAAM4D,gBA5SjC0I,EAAQ+D,uBAiTR,SAAgC3T,GAE/B,IAAKA,EAAOwI,kBACX,OAED,IAAI6J,EAAiBD,EAAME,cAActS,GACzC,GAA+B,WAA3BqS,EAAeM,SAAwBN,EAAeuI,SAAW,GACpE,OAED,IAAIyL,EAAYrmB,EAAOwI,kBAAkBsM,UAAU0B,qBACnDxW,EAAOwI,kBAAkBsM,UAAU0B,qBAAuB,SAA8BkG,GAMvF,OALIA,GAAQA,EAAKnB,MAAuD,IAAhDmB,EAAKnB,IAAIjQ,QAAQ,4BACxCoR,EAAKnB,IAAMmB,EAAKnB,IAAIpQ,MAAM,MAAMyS,QAAO,SAAUrf,GAChD,MAAuB,yBAAhBA,EAAK+nB,UACV7jB,KAAK,OAEF4jB,EAAUlP,MAAM7T,KAAM4D,aA/T/B,IAUgCI,EAV5Bif,EAAOroB,EAAQ,OAEf6kB,GAQ4Bzb,EARGif,IAQkBjf,EAAIsN,WAAatN,EAAM,CAAE0N,QAAS1N,GAJnF8K,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,aA+TnB,CAACoX,UAAU,GAAGiG,IAAM,KAAKiL,EAAE,CAAC,SAAStoB,EAAQyR,EAAOC,GAStD,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBAAsBtE,EAAQmD,sBAAmBlB,EAEzD,IAAI+D,EAAgB1X,EAAQ,kBAE5BgD,OAAOwQ,eAAe9B,EAAS,mBAAoB,CAClDiG,YAAY,EACZC,IAAK,WACJ,OAAOF,EAAc7C,oBAIvB,IAAIgD,EAAmB7X,EAAQ,qBAE/BgD,OAAOwQ,eAAe9B,EAAS,sBAAuB,CACrDiG,YAAY,EACZC,IAAK,WACJ,OAAOC,EAAiB7B,uBAG1BtE,EAAQiD,mBAiBR,SAA4B7S,GAC3B,IAAIqS,EAAiBD,EAAME,cAActS,GAEzC,GAAIA,EAAOwQ,iBACLxQ,EAAOid,kBACXjd,EAAOid,gBAAkB,SAAyBT,GACjD,OAAOA,IAGJxc,EAAO6b,wBACX7b,EAAO6b,sBAAwB,SAA+BW,GAC7D,OAAOA,IAMLnK,EAAeuI,QAAU,OAAO,CACnC,IAAI6L,EAAiBvlB,OAAO4b,yBAAyB9c,EAAOuI,iBAAiBuM,UAAW,WACxF5T,OAAOwQ,eAAe1R,EAAOuI,iBAAiBuM,UAAW,UAAW,CACnEqB,IAAK,SAAaxE,GACjB8U,EAAetQ,IAAI9E,KAAK/N,KAAMqO,GAC9B,IAAI+U,EAAK,IAAI3P,MAAM,WACnB2P,EAAGC,QAAUhV,EACbrO,KAAK2T,cAAcyP,MAQnB1mB,EAAO6Y,gBAAkB,SAAU7Y,EAAO6Y,aAAa/D,YAC1D5T,OAAOwQ,eAAe1R,EAAO6Y,aAAa/D,UAAW,OAAQ,CAC5DgB,IAAK,WAQJ,YAPmBjE,IAAfvO,KAAKkU,QACgB,UAApBlU,KAAK8L,MAAMqI,KACdnU,KAAKkU,MAAQ,IAAIxX,EAAO4mB,cAActjB,MACR,UAApBA,KAAK8L,MAAMqI,OACrBnU,KAAKkU,MAAQ,OAGRlU,KAAKkU,SAMXxX,EAAO4mB,gBAAkB5mB,EAAO6mB,gBACnC7mB,EAAO6mB,cAAgB7mB,EAAO4mB,eAG/B,IAAIE,GAAwB,EAAIC,EAAwB/R,SAAShV,EAAQqS,EAAeuI,SACxF5a,EAAOwI,kBAAoB,SAA2Bwe,GAKrD,OAJIA,GAAUA,EAAOC,aACpBD,EAAOC,YAAa,EAAIC,EAAkBC,kBAAkBH,EAAOC,WAAY5U,EAAeuI,SAC9FxI,EAAMnL,IAAI,+BAAgC+f,EAAOC,aAE3C,IAAIH,EAAsBE,IAElChnB,EAAOwI,kBAAkBsM,UAAYgS,EAAsBhS,WA5E5DlF,EAAQuE,iBA+ER,SAA0BnU,GAErBA,EAAO6Y,gBAAkB,iBAAkB7Y,EAAO6Y,aAAa/D,aAClE9U,EAAO6Y,aAAa/D,UAAUsS,aAAepnB,EAAO6Y,aAAa/D,UAAUuS,WAhF7E,IAUgC/f,EAR5B8K,EAUJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAVtPF,CAFCzW,EAAQ,aAIjBgpB,EAAoBhpB,EAAQ,sBAE5BopB,EAAyBppB,EAAQ,0BAEjC6oB,GAE4Bzf,EAFqBggB,IAEAhgB,EAAIsN,WAAatN,EAAM,CAAE0N,QAAS1N,IA0ErF,CAACigB,WAAW,GAAGC,qBAAqB,EAAEvJ,oBAAoB,EAAEC,iBAAiB,GAAGuJ,yBAAyB,KAAKC,EAAE,CAAC,SAASxpB,EAAQyR,EAAOC,GAS3I,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQuX,iBAaR,SAA0BF,EAAYU,GACrC,IAAIC,GAAU,EAEd,OADAX,EAAa/G,KAAKC,MAAMD,KAAKE,UAAU6G,KACrBrJ,QAAO,SAAUiK,GAClC,GAAIA,IAAWA,EAAOC,MAAQD,EAAOE,KAAM,CAC1C,IAAID,EAAOD,EAAOC,MAAQD,EAAOE,IAC7BF,EAAOE,MAAQF,EAAOC,MACzB1V,EAAM4V,WAAW,mBAAoB,qBAEtC,IAAIC,EAA2B,iBAATH,EAoBtB,OAnBIG,IACHH,EAAO,CAACA,IAETA,EAAOA,EAAKlK,QAAO,SAAUmK,GAE5B,GAA6B,IAAzBA,EAAIzc,QAAQ,SACf,OAAO,EAGR,IAAI4c,EAAYH,EAAII,WAAW,UAAYJ,EAAII,WAAW,WAAaJ,EAAI7G,SAAS,iBACpF,OAAIgH,IAAcN,GACjBA,GAAU,GACH,GAEDM,IAAcN,YAGfC,EAAOE,IACdF,EAAOC,KAAOG,EAAWH,EAAK,GAAKA,IAC1BA,EAAKpY,YAxCjB,IAEI0C,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,cA6CnB,CAACqpB,WAAW,KAAKa,EAAE,CAAC,SAASlqB,EAAQyR,EAAOC,GAS9C,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBACR,SAA6BlU,GAC5B,KAAM,oBAAqBA,EAAO8G,WACjC,OAED,IAAK9G,EAAO8G,UAAUiJ,aACrB,OAED,GAAI/P,EAAO8G,UAAUiJ,cAAgB,oBAAqB/P,EAAO8G,UAAUiJ,aAC1E,OAED/P,EAAO8G,UAAUiJ,aAAasO,gBAAkBre,EAAO8G,UAAUuX,gBAAgB+D,KAAKpiB,EAAO8G,aAG5F,IAAIuhB,GAAG,CAAC,SAASnqB,EAAQyR,EAAOC,GASlC,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQmD,iBACR,SAA0B/S,GACzB,IAAI8G,EAAY9G,GAAUA,EAAO8G,UAc7Bub,EAAmBvb,EAAUiJ,aAAa/I,aAAaob,KAAKtb,EAAUiJ,cAC1EjJ,EAAUiJ,aAAa/I,aAAe,SAAUgK,GAC/C,OAAOqR,EAAiBrR,GAAGsX,OAAM,SAAUjnB,GAC1C,OAAO+O,QAAQE,OAfA,SAAoBjP,GACpC,MAAO,CACNkF,KAAM,CAAE8a,sBAAuB,mBAAoBhgB,EAAEkF,OAASlF,EAAEkF,KAChE7B,QAASrD,EAAEqD,QACXsd,WAAY3gB,EAAE2gB,WACdnZ,SAAU,WACT,OAAOvF,KAAKiD,OASS6a,CAAW/f,UAKlC,IAAIknB,GAAG,CAAC,SAASrqB,EAAQyR,EAAOC,GASlC,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBAAsBtE,EAAQmD,sBAAmBlB,EAEzD,IAAI2D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAElQsO,EAAgB1X,EAAQ,kBAE5BgD,OAAOwQ,eAAe9B,EAAS,mBAAoB,CAClDiG,YAAY,EACZC,IAAK,WACJ,OAAOF,EAAc7C,oBAIvB,IAAIgD,EAAmB7X,EAAQ,qBAE/BgD,OAAOwQ,eAAe9B,EAAS,sBAAuB,CACrDiG,YAAY,EACZC,IAAK,WACJ,OAAOC,EAAiB7B,uBAG1BtE,EAAQqD,YAeR,SAAqBjT,GACoD,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwoB,eAAiB,aAAcxoB,EAAOwoB,cAAc1T,aAAe,gBAAiB9U,EAAOwoB,cAAc1T,YACnM5T,OAAOwQ,eAAe1R,EAAOwoB,cAAc1T,UAAW,cAAe,CACpEgB,IAAK,WACJ,MAAO,CAAEc,SAAUtT,KAAKsT,cAlB5BhH,EAAQiD,mBAwBR,SAA4B7S,GAC3B,IAAIqS,EAAiBD,EAAME,cAActS,GAEzC,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAA2BA,EAAOwI,oBAAqBxI,EAAOyI,qBACxH,QAEIzI,EAAOwI,mBAAqBxI,EAAOyI,uBAEvCzI,EAAOwI,kBAAoBxI,EAAOyI,sBAG/B4J,EAAeuI,QAAU,IAE5B,CAAC,sBAAuB,uBAAwB,mBAAmBzW,SAAQ,SAAUgY,GACpF,IAAIC,EAAepc,EAAOwI,kBAAkBsM,UAAUqH,GAClDE,EA3BP,SAAyB/U,EAAK/C,EAAKoN,GAAapN,KAAO+C,EAAOpG,OAAOwQ,eAAepK,EAAK/C,EAAK,CAAEoN,MAAOA,EAAOkE,YAAY,EAAMS,cAAc,EAAM+G,UAAU,IAAkB/V,EAAI/C,GAAOoN,EAAS,OAAOrK,EA2BxLgV,CAAgB,GAAIH,GAAQ,WAE3C,OADAjV,UAAU,GAAK,IAAgB,oBAAXiV,EAA+Bnc,EAAOid,gBAAkBjd,EAAO6b,uBAAuB3U,UAAU,IAC7GkV,EAAajF,MAAM7T,KAAM4D,cAEjClH,EAAOwI,kBAAkBsM,UAAUqH,GAAUE,EAAUF,MAKzD,IAAIe,EAAwBld,EAAOwI,kBAAkBsM,UAAUqI,gBAC/Dnd,EAAOwI,kBAAkBsM,UAAUqI,gBAAkB,WACpD,OAAKjW,UAAU,GAQXmL,EAAeuI,QAAU,IAAM1T,UAAU,IAAiC,KAA3BA,UAAU,GAAGkG,UACxDgD,QAAQC,UAET6M,EAAsB/F,MAAM7T,KAAM4D,YAVpCA,UAAU,IACbA,UAAU,GAAGiQ,MAAM,MAEb/G,QAAQC,YAUjB,IAAIoY,EAAmB,CACtBvZ,WAAY,cACZC,YAAa,eACbuZ,cAAe,iBACfla,eAAgB,kBAChBO,gBAAiB,oBAGd4Z,EAAiB3oB,EAAOwI,kBAAkBsM,UAAUlR,SACxD5D,EAAOwI,kBAAkBsM,UAAUlR,SAAW,WAC7C,IAAIuV,EAAaC,MAAMtE,UAAUgD,MAAMzG,KAAKnK,WAC1CmS,EAAWF,EAAW,GACtBG,EAASH,EAAW,GACpBI,EAAQJ,EAAW,GAErB,OAAOwP,EAAexR,MAAM7T,KAAM,CAAC+V,GAAY,OAAOrT,MAAK,SAAU8T,GACpE,GAAIzH,EAAeuI,QAAU,KAAOtB,EAGnC,IACCQ,EAAM3V,SAAQ,SAAUqC,GACvBA,EAAKzF,KAAO0nB,EAAiBjiB,EAAKzF,OAASyF,EAAKzF,QAEhD,MAAOM,GACR,GAAe,cAAXA,EAAEkF,KACL,MAAMlF,EAGPyY,EAAM3V,SAAQ,SAAUqC,EAAMhG,GAC7BsZ,EAAM3D,IAAI3V,EAAGU,OAAOgiB,OAAO,GAAI1c,EAAM,CACpCzF,KAAM0nB,EAAiBjiB,EAAKzF,OAASyF,EAAKzF,WAK9C,OAAO+Y,KACL9T,KAAKsT,EAAQC,KAnGlB3J,EAAQkE,mBAuGR,SAA4B9T,GAC3B,GAA0E,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAAyBA,EAAOwI,oBAAqBxI,EAAO6Y,aACxH,OAED,GAAI7Y,EAAO6Y,cAAgB,aAAc7Y,EAAO6Y,aAAa/D,UAC5D,OAED,IAAIgE,EAAiB9Y,EAAOwI,kBAAkBsM,UAAU8C,WACpDkB,IACH9Y,EAAOwI,kBAAkBsM,UAAU8C,WAAa,WAC/C,IAAInB,EAAQnT,KAER0V,EAAUF,EAAe3B,MAAM7T,KAAM,IAIzC,OAHA0V,EAAQ7U,SAAQ,SAAU8T,GACzB,OAAOA,EAAON,IAAMlB,KAEduC,IAIT,IAAIjB,EAAe/X,EAAOwI,kBAAkBsM,UAAUkD,SAClDD,IACH/X,EAAOwI,kBAAkBsM,UAAUkD,SAAW,WAC7C,IAAIC,EAASF,EAAaZ,MAAM7T,KAAM4D,WAEtC,OADA+Q,EAAON,IAAMrU,KACN2U,IAGTjY,EAAO6Y,aAAa/D,UAAUlR,SAAW,WACxC,OAAON,KAAK8L,MAAQ9L,KAAKqU,IAAI/T,SAASN,KAAK8L,OAASgB,QAAQC,QAAQ,IAAI0J,OAnI1EnK,EAAQmE,qBAuIR,SAA8B/T,GAC7B,GAA0E,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAAyBA,EAAOwI,oBAAqBxI,EAAO6Y,aACxH,OAED,GAAI7Y,EAAO6Y,cAAgB,aAAc7Y,EAAOka,eAAepF,UAC9D,OAED,IAAIuF,EAAmBra,EAAOwI,kBAAkBsM,UAAU+B,aACtDwD,IACHra,EAAOwI,kBAAkBsM,UAAU+B,aAAe,WACjD,IAAI2B,EAASlV,KAETiX,EAAYF,EAAiBlD,MAAM7T,KAAM,IAI7C,OAHAiX,EAAUpW,SAAQ,SAAUyS,GAC3B,OAAOA,EAASe,IAAMa,KAEhB+B,IAGTnI,EAAMgF,wBAAwBpX,EAAQ,SAAS,SAAUqB,GAExD,OADAA,EAAEuV,SAASe,IAAMtW,EAAEmZ,WACZnZ,KAERrB,EAAOka,eAAepF,UAAUlR,SAAW,WAC1C,OAAON,KAAKqU,IAAI/T,SAASN,KAAK8L,SA9JhCQ,EAAQiE,iBAkKR,SAA0B7T,GACzB,IAAKA,EAAOwI,mBAAqB,iBAAkBxI,EAAOwI,kBAAkBsM,UAC3E,OAED9U,EAAOwI,kBAAkBsM,UAAU4D,aAAe,SAAsBnI,GACvE,IAAIoI,EAASrV,KAEb8O,EAAM4V,WAAW,eAAgB,eACjC1kB,KAAKsU,aAAazT,SAAQ,SAAU8T,GAC/BA,EAAO7I,OAASmB,EAAO2G,YAAYgK,SAASjJ,EAAO7I,QACtDuJ,EAAOR,YAAYF,QA3KvBrI,EAAQoE,mBAiLR,SAA4BhU,GAGvBA,EAAO4oB,cAAgB5oB,EAAO6oB,iBACjC7oB,EAAO6oB,eAAiB7oB,EAAO4oB,cAnLjC,IAEIxW,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,cAuLnB,CAACqpB,WAAW,GAAGtJ,oBAAoB,GAAGC,iBAAiB,KAAK4K,GAAG,CAAC,SAAS5qB,EAAQyR,EAAOC,GAS1F,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAER/B,EAAQsE,oBACR,SAA6BlU,EAAQ+oB,GACpC,GAAI/oB,EAAO8G,UAAUiJ,cAAgB,oBAAqB/P,EAAO8G,UAAUiJ,aAC1E,OAED,IAAK/P,EAAO8G,UAAUiJ,aACrB,OAED/P,EAAO8G,UAAUiJ,aAAasO,gBAAkB,SAAyBlO,GACxE,IAAMA,IAAeA,EAAY9K,MAAQ,CACxC,IAAIoV,EAAM,IAAIC,aAAa,0DAI3B,OAHAD,EAAIlU,KAAO,gBAEXkU,EAAItJ,KAAO,EACJf,QAAQE,OAAOmK,GAOvB,OAL0B,IAAtBtK,EAAY9K,MACf8K,EAAY9K,MAAQ,CAAE2jB,YAAaD,GAEnC5Y,EAAY9K,MAAM2jB,YAAcD,EAE1B/oB,EAAO8G,UAAUiJ,aAAa/I,aAAamJ,MAIlD,IAAI8Y,GAAG,CAAC,SAAS/qB,EAAQyR,EAAOC,GASlC,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAGR,IAAI6D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAEtQsI,EAAQmD,iBAQR,SAA0B/S,GACzB,IAAIqS,EAAiBD,EAAME,cAActS,GACrC8G,EAAY9G,GAAUA,EAAO8G,UAC7ByB,EAAmBvI,GAAUA,EAAOuI,iBAQxC,GANAzB,EAAUE,aAAe,SAAUmJ,EAAa+R,EAAWC,GAE1D/P,EAAM4V,WAAW,yBAA0B,uCAC3ClhB,EAAUiJ,aAAa/I,aAAamJ,GAAanK,KAAKkc,EAAWC,MAG5D9P,EAAeuI,QAAU,IAAM,oBAAqB9T,EAAUiJ,aAAa2Q,2BAA4B,CAC5G,IAAIL,EAAQ,SAAe/Y,EAAK4J,EAAGoP,GAC9BpP,KAAK5J,KAASgZ,KAAKhZ,KACtBA,EAAIgZ,GAAKhZ,EAAI4J,UACN5J,EAAI4J,KAITgY,EAAqBpiB,EAAUiJ,aAAa/I,aAAaob,KAAKtb,EAAUiJ,cAU5E,GATAjJ,EAAUiJ,aAAa/I,aAAe,SAAUgK,GAM/C,MAL8D,iBAA5C,IAANA,EAAoB,YAAcwE,EAAQxE,KAAyC,WAArBwE,EAAQxE,EAAE5L,SACnF4L,EAAIkP,KAAKC,MAAMD,KAAKE,UAAUpP,IAC9BqP,EAAMrP,EAAE5L,MAAO,kBAAmB,sBAClCib,EAAMrP,EAAE5L,MAAO,mBAAoB,wBAE7B8jB,EAAmBlY,IAGvBzI,GAAoBA,EAAiBuM,UAAUqU,YAAa,CAC/D,IAAIC,EAAoB7gB,EAAiBuM,UAAUqU,YACnD5gB,EAAiBuM,UAAUqU,YAAc,WACxC,IAAI7hB,EAAM8hB,EAAkBjS,MAAM7T,KAAM4D,WAGxC,OAFAmZ,EAAM/Y,EAAK,qBAAsB,mBACjC+Y,EAAM/Y,EAAK,sBAAuB,oBAC3BA,GAIT,GAAIiB,GAAoBA,EAAiBuM,UAAUuU,iBAAkB,CACpE,IAAIC,EAAyB/gB,EAAiBuM,UAAUuU,iBACxD9gB,EAAiBuM,UAAUuU,iBAAmB,SAAUrY,GAMvD,MALkB,UAAd1N,KAAKmU,MAA8E,iBAA5C,IAANzG,EAAoB,YAAcwE,EAAQxE,MAC9EA,EAAIkP,KAAKC,MAAMD,KAAKE,UAAUpP,IAC9BqP,EAAMrP,EAAG,kBAAmB,sBAC5BqP,EAAMrP,EAAG,mBAAoB,wBAEvBsY,EAAuBnS,MAAM7T,KAAM,CAAC0N,QArD/C,IAEIoB,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,cA2DnB,CAACqpB,WAAW,KAAKgC,GAAG,CAAC,SAASrrB,EAAQyR,EAAOC,GAQ/C,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAGR,IAAI6D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAEtQsI,EAAQ4E,oBAeR,SAA6BxU,GAC5B,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAA0BA,EAAOwI,kBAC3F,OAEK,oBAAqBxI,EAAOwI,kBAAkBsM,YACnD9U,EAAOwI,kBAAkBsM,UAAUgG,gBAAkB,WAIpD,OAHKxX,KAAKkmB,gBACTlmB,KAAKkmB,cAAgB,IAEflmB,KAAKkmB,gBAGd,KAAM,cAAexpB,EAAOwI,kBAAkBsM,WAAY,CACzD,IAAI2U,EAAYzpB,EAAOwI,kBAAkBsM,UAAUkD,SACnDhY,EAAOwI,kBAAkBsM,UAAUyD,UAAY,SAAmBhI,GACjE,IAAIkG,EAAQnT,KAEPA,KAAKkmB,gBACTlmB,KAAKkmB,cAAgB,IAEjBlmB,KAAKkmB,cAActI,SAAS3Q,IAChCjN,KAAKkmB,cAAcpjB,KAAKmK,GAIzBA,EAAOgS,iBAAiBpe,SAAQ,SAAUiL,GACzC,OAAOqa,EAAUpY,KAAKoF,EAAOrH,EAAOmB,MAErCA,EAAOiS,iBAAiBre,SAAQ,SAAUiL,GACzC,OAAOqa,EAAUpY,KAAKoF,EAAOrH,EAAOmB,OAItCvQ,EAAOwI,kBAAkBsM,UAAUkD,SAAW,SAAkB5I,GAC/D,IAAImB,EAASrJ,UAAU,GAQvB,OAPIqJ,IACEjN,KAAKkmB,cAEElmB,KAAKkmB,cAActI,SAAS3Q,IACvCjN,KAAKkmB,cAAcpjB,KAAKmK,GAFxBjN,KAAKkmB,cAAgB,CAACjZ,IAKjBkZ,EAAUtS,MAAM7T,KAAM4D,YAGzB,iBAAkBlH,EAAOwI,kBAAkBsM,YAChD9U,EAAOwI,kBAAkBsM,UAAU4D,aAAe,SAAsBnI,GACvE,IAAIiI,EAASlV,KAERA,KAAKkmB,gBACTlmB,KAAKkmB,cAAgB,IAEtB,IAAIlnB,EAAQgB,KAAKkmB,cAAcle,QAAQiF,GACvC,IAAe,IAAXjO,EAAJ,CAGAgB,KAAKkmB,cAAcnR,OAAO/V,EAAO,GACjC,IAAI0G,EAASuH,EAAO2G,YACpB5T,KAAKsU,aAAazT,SAAQ,SAAU8T,GAC/BjP,EAAOkY,SAASjJ,EAAO7I,QAC1BoJ,EAAOL,YAAYF,UA1ExBrI,EAAQ6E,qBAiFR,SAA8BzU,GAC7B,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAA0BA,EAAOwI,kBAC3F,OAEK,qBAAsBxI,EAAOwI,kBAAkBsM,YACpD9U,EAAOwI,kBAAkBsM,UAAU4U,iBAAmB,WACrD,OAAOpmB,KAAKqmB,eAAiBrmB,KAAKqmB,eAAiB,KAGrD,KAAM,gBAAiB3pB,EAAOwI,kBAAkBsM,WAAY,CAC3D5T,OAAOwQ,eAAe1R,EAAOwI,kBAAkBsM,UAAW,cAAe,CACxEgB,IAAK,WACJ,OAAOxS,KAAKsmB,cAEbzT,IAAK,SAAazF,GACjB,IAAIiI,EAASrV,KAETA,KAAKsmB,eACRtmB,KAAK8S,oBAAoB,YAAa9S,KAAKsmB,cAC3CtmB,KAAK8S,oBAAoB,QAAS9S,KAAKumB,mBAExCvmB,KAAK+S,iBAAiB,YAAa/S,KAAKsmB,aAAelZ,GACvDpN,KAAK+S,iBAAiB,QAAS/S,KAAKumB,iBAAmB,SAAUxoB,GAChEA,EAAE8H,QAAQhF,SAAQ,SAAUoM,GAI3B,GAHKoI,EAAOgR,iBACXhR,EAAOgR,eAAiB,KAErBhR,EAAOgR,eAAezI,SAAS3Q,GAAnC,CAGAoI,EAAOgR,eAAevjB,KAAKmK,GAC3B,IAAIuG,EAAQ,IAAIC,MAAM,aACtBD,EAAMvG,OAASA,EACfoI,EAAO1B,cAAcH,YAKzB,IAAIP,EAA2BvW,EAAOwI,kBAAkBsM,UAAU0B,qBAClExW,EAAOwI,kBAAkBsM,UAAU0B,qBAAuB,WACzD,IAAIc,EAAKhU,KAiBT,OAhBKA,KAAKumB,kBACTvmB,KAAK+S,iBAAiB,QAAS/S,KAAKumB,iBAAmB,SAAUxoB,GAChEA,EAAE8H,QAAQhF,SAAQ,SAAUoM,GAI3B,GAHK+G,EAAGqS,iBACPrS,EAAGqS,eAAiB,MAEjBrS,EAAGqS,eAAere,QAAQiF,IAAW,GAAzC,CAGA+G,EAAGqS,eAAevjB,KAAKmK,GACvB,IAAIuG,EAAQ,IAAIC,MAAM,aACtBD,EAAMvG,OAASA,EACf+G,EAAGL,cAAcH,SAIbP,EAAyBY,MAAMG,EAAIpQ,cAzI7C0I,EAAQ2E,iBA8IR,SAA0BvU,GACzB,GAAwE,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,MAA0BA,EAAOwI,kBAC3F,OAED,IAAIsM,EAAY9U,EAAOwI,kBAAkBsM,UACrCgV,EAAkBhV,EAAUiV,YAC5BC,EAAmBlV,EAAUmV,aAC7BrN,EAAsB9H,EAAU8H,oBAChCpG,EAAuB1B,EAAU0B,qBACjC2G,EAAkBrI,EAAUqI,gBAEhCrI,EAAUiV,YAAc,SAAqBG,EAAiBC,GAC7D,IAAIrY,EAAU5K,UAAUwI,QAAU,EAAIxI,UAAU,GAAKA,UAAU,GAC3DkjB,EAAUN,EAAgB3S,MAAM7T,KAAM,CAACwO,IAC3C,OAAKqY,GAGLC,EAAQpkB,KAAKkkB,EAAiBC,GACvB/Z,QAAQC,WAHP+Z,GAMTtV,EAAUmV,aAAe,SAAsBC,EAAiBC,GAC/D,IAAIrY,EAAU5K,UAAUwI,QAAU,EAAIxI,UAAU,GAAKA,UAAU,GAC3DkjB,EAAUJ,EAAiB7S,MAAM7T,KAAM,CAACwO,IAC5C,OAAKqY,GAGLC,EAAQpkB,KAAKkkB,EAAiBC,GACvB/Z,QAAQC,WAHP+Z,GAMT,IAAIC,EAAe,SAAsB/O,EAAa4O,EAAiBC,GACtE,IAAIC,EAAUxN,EAAoBzF,MAAM7T,KAAM,CAACgY,IAC/C,OAAK6O,GAGLC,EAAQpkB,KAAKkkB,EAAiBC,GACvB/Z,QAAQC,WAHP+Z,GAKTtV,EAAU8H,oBAAsByN,EAEhCA,EAAe,SAAsB/O,EAAa4O,EAAiBC,GAClE,IAAIC,EAAU5T,EAAqBW,MAAM7T,KAAM,CAACgY,IAChD,OAAK6O,GAGLC,EAAQpkB,KAAKkkB,EAAiBC,GACvB/Z,QAAQC,WAHP+Z,GAKTtV,EAAU0B,qBAAuB6T,EAEjCA,EAAe,SAAsBjd,EAAW8c,EAAiBC,GAChE,IAAIC,EAAUjN,EAAgBhG,MAAM7T,KAAM,CAAC8J,IAC3C,OAAK+c,GAGLC,EAAQpkB,KAAKkkB,EAAiBC,GACvB/Z,QAAQC,WAHP+Z,GAKTtV,EAAUqI,gBAAkBkN,GAxM7Bza,EAAQmD,iBA2MR,SAA0B/S,GACzB,IAAI8G,EAAY9G,GAAUA,EAAO8G,UAEjC,GAAIA,EAAUiJ,cAAgBjJ,EAAUiJ,aAAa/I,aAAc,CAElE,IAAI+I,EAAejJ,EAAUiJ,aACzBua,EAAgBva,EAAa/I,aAAaob,KAAKrS,GACnDjJ,EAAUiJ,aAAa/I,aAAe,SAAUmJ,GAC/C,OAAOma,EAAcC,EAAgBpa,MAIlCrJ,EAAUE,cAAgBF,EAAUiJ,cAAgBjJ,EAAUiJ,aAAa/I,eAC/EF,EAAUE,aAAe,SAAsBmJ,EAAatK,EAAI2kB,GAC/D1jB,EAAUiJ,aAAa/I,aAAamJ,GAAanK,KAAKH,EAAI2kB,IACzDpI,KAAKtb,KAzNT8I,EAAQ2a,gBAAkBA,EAC1B3a,EAAQyE,qBAoOR,SAA8BrU,GAE7B,IAAIyqB,EAAqBzqB,EAAOwI,kBAChCxI,EAAOwI,kBAAoB,SAA2BkiB,EAAUC,GAC/D,GAAID,GAAYA,EAASzD,WAAY,CAEpC,IADA,IAAI2D,EAAgB,GACXpqB,EAAI,EAAGA,EAAIkqB,EAASzD,WAAWvX,OAAQlP,IAAK,CACpD,IAAIqnB,EAAS6C,EAASzD,WAAWzmB,IAC5BqnB,EAAO9S,eAAe,SAAW8S,EAAO9S,eAAe,QAC3D3C,EAAM4V,WAAW,mBAAoB,sBACrCH,EAAS3H,KAAKC,MAAMD,KAAKE,UAAUyH,KAC5BC,KAAOD,EAAOE,WACdF,EAAOE,IACd6C,EAAcxkB,KAAKyhB,IAEnB+C,EAAcxkB,KAAKskB,EAASzD,WAAWzmB,IAGzCkqB,EAASzD,WAAa2D,EAEvB,OAAO,IAAIH,EAAmBC,EAAUC,IAEzC3qB,EAAOwI,kBAAkBsM,UAAY2V,EAAmB3V,UAEpD,wBAAyB9U,EAAOwI,mBACnCtH,OAAOwQ,eAAe1R,EAAOwI,kBAAmB,sBAAuB,CACtEsN,IAAK,WACJ,OAAO2U,EAAmBI,wBA9P9Bjb,EAAQ8E,0BAoQR,SAAmC1U,GAEsC,iBAAjD,IAAXA,EAAyB,YAAcwV,EAAQxV,KAAyBA,EAAOwoB,eAAiB,aAAcxoB,EAAOwoB,cAAc1T,aAAe,gBAAiB9U,EAAOwoB,cAAc1T,YACnM5T,OAAOwQ,eAAe1R,EAAOwoB,cAAc1T,UAAW,cAAe,CACpEgB,IAAK,WACJ,MAAO,CAAEc,SAAUtT,KAAKsT,cAxQ5BhH,EAAQ0E,sBA8QR,SAA+BtU,GAC9B,IAAI8pB,EAAkB9pB,EAAOwI,kBAAkBsM,UAAUiV,YACzD/pB,EAAOwI,kBAAkBsM,UAAUiV,YAAc,SAAqBe,GACrE,GAAIA,EAAc,MAC+B,IAArCA,EAAaC,sBAEvBD,EAAaC,sBAAwBD,EAAaC,qBAEnD,IAAIC,EAAmB1nB,KAAK2nB,kBAAkB7oB,MAAK,SAAU4U,GAC5D,MAA2C,UAApCA,EAAYJ,SAASxH,MAAMqI,SAEM,IAArCqT,EAAaC,qBAAiCC,EACd,aAA/BA,EAAiBE,UAChBF,EAAiBG,aACpBH,EAAiBG,aAAa,YAE9BH,EAAiBE,UAAY,WAEW,aAA/BF,EAAiBE,YACvBF,EAAiBG,aACpBH,EAAiBG,aAAa,YAE9BH,EAAiBE,UAAY,aAGgB,IAArCJ,EAAaC,qBAAiCC,GACxD1nB,KAAK8nB,eAAe,cAG2B,IAArCN,EAAaO,sBAEvBP,EAAaO,sBAAwBP,EAAaO,qBAEnD,IAAIC,EAAmBhoB,KAAK2nB,kBAAkB7oB,MAAK,SAAU4U,GAC5D,MAA2C,UAApCA,EAAYJ,SAASxH,MAAMqI,SAEM,IAArCqT,EAAaO,qBAAiCC,EACd,aAA/BA,EAAiBJ,UAChBI,EAAiBH,aACpBG,EAAiBH,aAAa,YAE9BG,EAAiBJ,UAAY,WAEW,aAA/BI,EAAiBJ,YACvBI,EAAiBH,aACpBG,EAAiBH,aAAa,YAE9BG,EAAiBJ,UAAY,aAGgB,IAArCJ,EAAaO,qBAAiCC,GACxDhoB,KAAK8nB,eAAe,SAGtB,OAAOtB,EAAgB3S,MAAM7T,KAAM4D,aAlUrC,IAEIkL,EAEJ,SAAiC9K,GAAO,GAAIA,GAAOA,EAAIsN,WAAc,OAAOtN,EAAc,IAAIuN,EAAS,GAAI,GAAW,MAAPvN,EAAe,IAAK,IAAI/C,KAAO+C,EAAWpG,OAAO4T,UAAUC,eAAe1D,KAAK/J,EAAK/C,KAAMsQ,EAAOtQ,GAAO+C,EAAI/C,IAAgC,OAAtBsQ,EAAOG,QAAU1N,EAAYuN,EAFtPF,CAFCzW,EAAQ,aAwNrB,SAASqsB,EAAgBpa,GACxB,OAAIA,QAAqC0B,IAAtB1B,EAAY9K,MACvBnE,OAAOgiB,OAAO,GAAI/S,EAAa,CAAE9K,MAAO+M,EAAMmZ,cAAcpb,EAAY9K,SAGzE8K,IAyGN,CAACoX,WAAW,KAAKiE,GAAG,CAAC,SAASttB,EAAQyR,EAAOC,GAS/C,aAEA1O,OAAOwQ,eAAe9B,EAAS,aAAc,CAC5C+B,OAAO,IAGR,IAAI6D,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUpO,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXmO,QAAyBnO,EAAIqO,cAAgBF,QAAUnO,IAAQmO,OAAOX,UAAY,gBAAkBxN,GAEtQsI,EAAQ4C,eAAiBA,EACzB5C,EAAQwH,wBA+BR,SAAiCpX,EAAQyrB,EAAiBC,GACzD,IAAK1rB,EAAOwI,kBACX,OAED,IAAIod,EAAQ5lB,EAAOwI,kBAAkBsM,UACjC6W,EAAyB/F,EAAMvP,iBACnCuP,EAAMvP,iBAAmB,SAAUuV,EAAiB/lB,GACnD,GAAI+lB,IAAoBH,EACvB,OAAOE,EAAuBxU,MAAM7T,KAAM4D,WAE3C,IAAI2kB,EAAkB,SAAyBxqB,GAC9C,IAAIyqB,EAAgBJ,EAAQrqB,GACxByqB,GACHjmB,EAAGimB,IAKL,OAFAxoB,KAAKyoB,UAAYzoB,KAAKyoB,WAAa,GACnCzoB,KAAKyoB,UAAUlmB,GAAMgmB,EACdF,EAAuBxU,MAAM7T,KAAM,CAACsoB,EAAiBC,KAG7D,IAAIG,EAA4BpG,EAAMxP,oBACtCwP,EAAMxP,oBAAsB,SAAUwV,EAAiB/lB,GACtD,GAAI+lB,IAAoBH,IAAoBnoB,KAAKyoB,YAAczoB,KAAKyoB,UAAUlmB,GAC7E,OAAOmmB,EAA0B7U,MAAM7T,KAAM4D,WAE9C,IAAI+kB,EAAc3oB,KAAKyoB,UAAUlmB,GAEjC,cADOvC,KAAKyoB,UAAUlmB,GACfmmB,EAA0B7U,MAAM7T,KAAM,CAACsoB,EAAiBK,KAGhE/qB,OAAOwQ,eAAekU,EAAO,KAAO6F,EAAiB,CACpD3V,IAAK,WACJ,OAAOxS,KAAK,MAAQmoB,IAErBtV,IAAK,SAAatQ,GACbvC,KAAK,MAAQmoB,KAChBnoB,KAAK8S,oBAAoBqV,EAAiBnoB,KAAK,MAAQmoB,WAChDnoB,KAAK,MAAQmoB,IAEjB5lB,GACHvC,KAAK+S,iBAAiBoV,EAAiBnoB,KAAK,MAAQmoB,GAAmB5lB,IAIzEgQ,YAAY,EACZS,cAAc,KA5EhB1G,EAAQ6C,WAgFR,SAAoByZ,GACnB,GAAoB,kBAATA,EACV,OAAO,IAAIzb,MAAM,wBAAqC,IAATyb,EAAuB,YAAc1W,EAAQ0W,IAAS,2BAGpG,OADAC,EAAeD,EACRA,EAAO,8BAAgC,8BApF/Ctc,EAAQ8C,gBA2FR,SAAyBwZ,GACxB,GAAoB,kBAATA,EACV,OAAO,IAAIzb,MAAM,wBAAqC,IAATyb,EAAuB,YAAc1W,EAAQ0W,IAAS,2BAGpG,OADAE,GAAwBF,EACjB,oCAAsCA,EAAO,WAAa,YA/FlEtc,EAAQ3I,IAkGR,WACC,GAAwE,YAAjD,oBAAXjH,OAAyB,YAAcwV,EAAQxV,SAAuB,CACjF,GAAImsB,EACH,OAEsB,oBAAZ3nB,SAAkD,mBAAhBA,QAAQyC,KACpDzC,QAAQyC,IAAIkQ,MAAM3S,QAAS0C,aAvG9B0I,EAAQoY,WA+GR,SAAoBqE,EAAWC,GAC9B,IAAKF,EACJ,OAED5nB,QAAQ+nB,KAAKF,EAAY,8BAAgCC,EAAY,cAlHtE1c,EAAQ0C,cA2HR,SAAuBtS,GACtB,IAAI8G,EAAY9G,EAAO8G,UAInB1C,EAAS,CAAEuO,QAAS,KAAMiI,QAAS,MAGvC,QAAsB,IAAX5a,IAA2BA,EAAO8G,UAE5C,OADA1C,EAAOuO,QAAU,iBACVvO,EAGR,GAAI0C,EAAUmJ,gBAEb7L,EAAOuO,QAAU,UACjBvO,EAAOwW,QAAUpI,EAAe1L,EAAUC,UAAW,mBAAoB,QACnE,GAAID,EAAUkJ,qBAAiD,IAA3BhQ,EAAOwsB,iBAA6BxsB,EAAO0I,0BAA4B1I,EAAOwQ,eAKxHpM,EAAOuO,QAAU,SACjBvO,EAAOwW,QAAUpI,EAAe1L,EAAUC,UAAW,wBAAyB,QACxE,GAAID,EAAUiJ,cAAgBjJ,EAAUC,UAAUvE,MAAM,sBAE9D4B,EAAOuO,QAAU,OACjBvO,EAAOwW,QAAUpI,EAAe1L,EAAUC,UAAW,qBAAsB,OACrE,CAAA,IAAI/G,EAAOwI,oBAAqB1B,EAAUC,UAAUvE,MAAM,wBAQhE,OADA4B,EAAOuO,QAAU,2BACVvO,EANPA,EAAOuO,QAAU,SACjBvO,EAAOwW,QAAUpI,EAAe1L,EAAUC,UAAW,uBAAwB,GAC7E3C,EAAOqoB,oBAAsBzsB,EAAO0sB,mBAAqB,qBAAsB1sB,EAAO0sB,kBAAkB5X,UAOzG,OAAO1Q,GAjKRwL,EAAQ2b,cAmLR,SAASA,EAAcpG,GACtB,IAAKwH,EAASxH,GACb,OAAOA,EAGR,OAAOjkB,OAAOmD,KAAK8gB,GAAMyH,QAAO,SAAUC,EAAatoB,GACtD,IAAIuoB,EAAQH,EAASxH,EAAK5gB,IACtBoN,EAAQmb,EAAQvB,EAAcpG,EAAK5gB,IAAQ4gB,EAAK5gB,GAChDwoB,EAAgBD,IAAU5rB,OAAOmD,KAAKsN,GAAOjC,OACjD,YAAcmC,IAAVF,GAAuBob,EACnBF,EAED3rB,OAAOgiB,OAAO2J,EA3LvB,SAAyBvlB,EAAK/C,EAAKoN,GAAapN,KAAO+C,EAAOpG,OAAOwQ,eAAepK,EAAK/C,EAAK,CAAEoN,MAAOA,EAAOkE,YAAY,EAAMS,cAAc,EAAM+G,UAAU,IAAkB/V,EAAI/C,GAAOoN,EAAS,OAAOrK,EA2LvKgV,CAAgB,GAAI/X,EAAKoN,MACzD,KA/LJ/B,EAAQod,UAAYA,EACpBpd,EAAQwK,YAmNR,SAAqBhW,EAAQgL,EAAO6d,GACnC,IAAIC,EAAkBD,EAAW,eAAiB,cAC9CE,EAAiB,IAAIpT,IACzB,GAAc,OAAV3K,EACH,OAAO+d,EAER,IAAIC,EAAa,GAajB,OAZAhpB,EAAOD,SAAQ,SAAUwN,GACL,UAAfA,EAAM5Q,MAAoB4Q,EAAM0b,kBAAoBje,EAAM3I,IAC7D2mB,EAAWhnB,KAAKuL,MAGlByb,EAAWjpB,SAAQ,SAAUmpB,GAC5BlpB,EAAOD,SAAQ,SAAU2V,GACpBA,EAAM/Y,OAASmsB,GAAmBpT,EAAMyT,UAAYD,EAAU7mB,IACjEumB,EAAU5oB,EAAQ0V,EAAOqT,SAIrBA,GAlOR,IAAIhB,GAAe,EACfC,GAAuB,EAU3B,SAAS5Z,EAAegb,EAAUC,EAAMC,GACvC,IAAIlrB,EAAQgrB,EAAShrB,MAAMirB,GAC3B,OAAOjrB,GAASA,EAAMkN,QAAUge,GAAOze,SAASzM,EAAMkrB,GAAM,IAuJ7D,SAASf,EAASgB,GACjB,MAA+C,oBAAxCzsB,OAAO4T,UAAUjM,SAASwI,KAAKsc,GAyBvC,SAASX,EAAUlT,EAAO8T,EAAMC,GAC1BD,IAAQC,EAAUC,IAAIF,EAAKnnB,MAGhConB,EAAU1X,IAAIyX,EAAKnnB,GAAImnB,GACvB1sB,OAAOmD,KAAKupB,GAAMzpB,SAAQ,SAAUoC,GAC/BA,EAAKwnB,SAAS,MACjBf,EAAUlT,EAAOA,EAAMhE,IAAI8X,EAAKrnB,IAAQsnB,GAC9BtnB,EAAKwnB,SAAS,QACxBH,EAAKrnB,GAAMpC,SAAQ,SAAUsC,GAC5BumB,EAAUlT,EAAOA,EAAMhE,IAAIrP,GAAKonB,YA6BlC,IAAIG,GAAG,CAAC,SAAS9vB,EAAQyR,EAAOC,GASlC,aAEA,IAAIqe,EAAW/vB,EAAQ,OAYvB,SAASgwB,EAAkBlX,EAAamX,EAAMptB,EAAMwP,EAAQ6d,GAC3D,IAAI7S,EAAM0S,EAASI,oBAAoBrX,EAAYS,KAAM0W,GAuBzD,GApBA5S,GAAO0S,EAASK,mBACdtX,EAAYuX,YAAYC,sBAG1BjT,GAAO0S,EAASQ,oBACdzX,EAAY0X,cAAcF,qBACjB,UAATztB,EAAmB,UAAYqtB,GAAY,UAE7C7S,GAAO,SAAWvE,EAAY2X,IAAM,OAEhC3X,EAAY4X,WAAa5X,EAAY6X,YACxCtT,GAAO,iBACGvE,EAAY4X,UACtBrT,GAAO,iBACGvE,EAAY6X,YACtBtT,GAAO,iBAEPA,GAAO,iBAGJvE,EAAY4X,UAAW,CAC1B,IAAIrB,EAAUvW,EAAY4X,UAAUE,iBAClC9X,EAAY4X,UAAUxf,MAAM3I,GAC9BuQ,EAAY4X,UAAUE,gBAAkBvB,EAExC,IAAIwB,EAAO,SAAWxe,EAASA,EAAO9J,GAAK,KAAO,IAChD8mB,EAAU,OACZhS,GAAO,KAAOwT,EAEdxT,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGvf,KACvD,IAAMsf,EAGJ/X,EAAYgY,uBAAuB,GAAGC,MACzC1T,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC3D,IAAMsf,EACRxT,GAAO,oBACLvE,EAAYgY,uBAAuB,GAAGvf,KAAO,IAC7CuH,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC1C,QAUJ,OANA8L,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGvf,KACvD,UAAYwe,EAASiB,WAAa,OAChClY,EAAY4X,WAAa5X,EAAYgY,uBAAuB,GAAGC,MAClE1T,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC3D,UAAYwe,EAASiB,WAAa,QAE9B3T,EA2CR,SAAS4T,EAAsBC,EAAmBC,GACjD,IAAIC,EAAqB,CACxBrmB,OAAQ,GACRsmB,iBAAkB,GAClBC,cAAe,IAGZC,EAAyB,SAASC,EAAIzmB,GACzCymB,EAAKzgB,SAASygB,EAAI,IAClB,IAAK,IAAIlvB,EAAI,EAAGA,EAAIyI,EAAOyG,OAAQlP,IAClC,GAAIyI,EAAOzI,GAAGmvB,cAAgBD,GAC5BzmB,EAAOzI,GAAGovB,uBAAyBF,EACpC,OAAOzmB,EAAOzI,IAKbqvB,EAAuB,SAASC,EAAMC,EAAMC,EAASC,GACxD,IAAIC,EAAST,EAAuBK,EAAKK,WAAWC,IAAKJ,GACrDK,EAASZ,EAAuBM,EAAKI,WAAWC,IAAKH,GACzD,OAAOC,GAAUG,GACfH,EAAO3pB,KAAKxD,gBAAkBstB,EAAO9pB,KAAKxD,eAqD7C,OAlDAqsB,EAAkBnmB,OAAO9E,SAAQ,SAAS+rB,GACzC,IAAK,IAAI1vB,EAAI,EAAGA,EAAI6uB,EAAmBpmB,OAAOyG,OAAQlP,IAAK,CAC1D,IAAI6vB,EAAShB,EAAmBpmB,OAAOzI,GACvC,GAAI0vB,EAAO3pB,KAAKxD,gBAAkBstB,EAAO9pB,KAAKxD,eAC5CmtB,EAAOI,YAAcD,EAAOC,UAAW,CACxC,GAAkC,QAA9BJ,EAAO3pB,KAAKxD,eACdmtB,EAAOC,YAAcE,EAAOF,WAAWC,MAGnCP,EAAqBK,EAAQG,EAChCjB,EAAkBnmB,OAAQomB,EAAmBpmB,QAC9C,UAGFonB,EAASnQ,KAAKC,MAAMD,KAAKE,UAAUiQ,KAE5BE,YAAczL,KAAKvF,IAAI2Q,EAAOK,YACnCF,EAAOE,aAETjB,EAAmBrmB,OAAO7C,KAAKiqB,GAG/BA,EAAOG,aAAeH,EAAOG,aAAa5S,QAAO,SAAS6S,GACzD,IAAK,IAAIC,EAAI,EAAGA,EAAIR,EAAOM,aAAa9gB,OAAQghB,IAC/C,GAAIR,EAAOM,aAAaE,GAAG3vB,OAAS0vB,EAAG1vB,MACrCmvB,EAAOM,aAAaE,GAAGC,YAAcF,EAAGE,UACzC,OAAO,EAGT,OAAO,KAIR,WAKHvB,EAAkBG,iBAAiBprB,SAAQ,SAASysB,GACnD,IAAK,IAAIpwB,EAAI,EAAGA,EAAI6uB,EAAmBE,iBAAiB7f,OACrDlP,IAAK,CACP,IAAIqwB,EAAmBxB,EAAmBE,iBAAiB/uB,GAC3D,GAAIowB,EAAiBE,MAAQD,EAAiBC,IAAK,CAClDxB,EAAmBC,iBAAiBnpB,KAAKyqB,GACzC,WAMIvB,EAIR,SAASyB,EAAgCC,EAAQjwB,EAAMib,GACtD,OAS6C,IATtC,CACNiV,MAAO,CACNrU,oBAAqB,CAAC,SAAU,oBAChCpG,qBAAsB,CAAC,SAAU,sBAElC0a,OAAQ,CACPtU,oBAAqB,CAAC,oBAAqB,uBAC3CpG,qBAAsB,CAAC,mBAAoB,0BAE3CzV,GAAMiwB,GAAQ1lB,QAAQ0Q,GAGzB,SAASmV,EAAkBC,EAAchkB,GAGxC,IAAIikB,EAAeD,EAAaE,sBAC7BlvB,MAAK,SAASsL,GACd,OAAON,EAAUmkB,aAAe7jB,EAAgB6jB,YAC9CnkB,EAAUokB,KAAO9jB,EAAgB8jB,IACjCpkB,EAAUqkB,OAAS/jB,EAAgB+jB,MACnCrkB,EAAUsB,WAAahB,EAAgBgB,UACvCtB,EAAUtF,WAAa4F,EAAgB5F,UACvCsF,EAAUrM,OAAS2M,EAAgB3M,QAKxC,OAHKswB,GACJD,EAAaM,mBAAmBtkB,IAEzBikB,EAIT,SAASM,EAAUprB,EAAM+U,GACxB,IAAIja,EAAI,IAAIoP,MAAM6K,GAUlB,OATAja,EAAEkF,KAAOA,EAETlF,EAAE8P,KAAO,CACRygB,kBAAmB,EACnBrQ,kBAAmB,GACnBsQ,mBAAoB,GACpBtM,eAAW1T,EACXigB,oBAAgBjgB,GACftL,GACKlF,EAGRsO,EAAOC,QAAU,SAAS5P,EAAQ2nB,GAIjC,SAASoK,EAA6B3iB,EAAOmB,GAC5CA,EAAOyH,SAAS5I,GAChBmB,EAAO0G,cAAc,IAAIjX,EAAOgyB,sBAAsB,WACpD,CAAC5iB,MAAOA,KASX,SAAS6iB,EAAa3a,EAAIlI,EAAOwH,EAAUzN,GAC1C,IAAI+oB,EAAa,IAAInb,MAAM,SAC3Bmb,EAAW9iB,MAAQA,EACnB8iB,EAAWtb,SAAWA,EACtBsb,EAAWlb,YAAc,CAACJ,SAAUA,GACpCsb,EAAW/oB,QAAUA,EACrBnJ,EAAO4F,YAAW,WACjB0R,EAAG6a,eAAe,QAASD,MAI7B,IAAI1pB,EAAoB,SAASwe,GAChC,IAAI1P,EAAKhU,KAEL8uB,EAAe9xB,SAAS+xB,yBAwB5B,GAvBA,CAAC,mBAAoB,sBAAuB,iBACzCluB,SAAQ,SAASgY,GACjB7E,EAAG6E,GAAUiW,EAAajW,GAAQiG,KAAKgQ,MAG1C9uB,KAAKgvB,wBAA0B,KAE/BhvB,KAAKivB,iBAAkB,EAEvBjvB,KAAKkvB,aAAe,GACpBlvB,KAAKmvB,cAAgB,GAErBnvB,KAAKovB,kBAAoB,KACzBpvB,KAAKqvB,mBAAqB,KAE1BrvB,KAAK0Y,eAAiB,SACtB1Y,KAAKuB,mBAAqB,MAC1BvB,KAAK6iB,gBAAkB,MACvB7iB,KAAKsvB,kBAAoB,MAEzB5L,EAAS9G,KAAKC,MAAMD,KAAKE,UAAU4G,GAAU,KAE7C1jB,KAAKuvB,YAAsC,eAAxB7L,EAAO8L,aACG,cAAzB9L,EAAO+L,cACV,MAAMpB,EAAU,oBACd,8CAKH,OAJY3K,EAAO+L,gBAClB/L,EAAO+L,cAAgB,WAGhB/L,EAAOgM,oBACd,IAAK,MACL,IAAK,QACJ,MACD,QACChM,EAAOgM,mBAAqB,MAI9B,OAAQhM,EAAO8L,cACd,IAAK,WACL,IAAK,aACL,IAAK,aACJ,MACD,QACC9L,EAAO8L,aAAe,WAOxB,GAHA9L,EAAOC,WA/OT,SAA0BA,EAAYU,GACrC,IAAIC,GAAU,EAEd,OADAX,EAAa/G,KAAKC,MAAMD,KAAKE,UAAU6G,KACrBrJ,QAAO,SAASiK,GACjC,GAAIA,IAAWA,EAAOC,MAAQD,EAAOE,KAAM,CAC1C,IAAID,EAAOD,EAAOC,MAAQD,EAAOE,IAC7BF,EAAOE,MAAQF,EAAOC,MACzBtjB,QAAQ+nB,KAAK,qDAEd,IAAItE,EAA2B,iBAATH,EAoBtB,OAnBIG,IACHH,EAAO,CAACA,IAETA,EAAOA,EAAKlK,QAAO,SAASmK,GAM3B,OALyC,IAAzBA,EAAIzc,QAAQ,WACQ,IAAlCyc,EAAIzc,QAAQ,mBACe,IAA3Byc,EAAIzc,QAAQ,YACXsc,GAGFA,GAAU,GACH,GAEwB,IAAzBG,EAAIzc,QAAQ,UAAkBqc,GAAe,QACf,IAAnCI,EAAIzc,QAAQ,4BAGRuc,EAAOE,IACdF,EAAOC,KAAOG,EAAWH,EAAK,GAAKA,IAC1BA,EAAKpY,WAkNKyX,CAAiBH,EAAOC,YAAc,GAAIU,GAE9DrkB,KAAK2vB,cAAgB,GACjBjM,EAAOkM,qBACV,IAAK,IAAI1yB,EAAIwmB,EAAOkM,qBAAsB1yB,EAAI,EAAGA,IAChD8C,KAAK2vB,cAAc7sB,KAAK,IAAIpG,EAAOwQ,eAAe,CACjDyW,WAAYD,EAAOC,WACnBkM,aAAcnM,EAAOgM,2BAIvBhM,EAAOkM,qBAAuB,EAG/B5vB,KAAK8vB,QAAUpM,EAIf1jB,KAAK+vB,aAAe,GAEpB/vB,KAAKgwB,cAAgBrF,EAASsF,oBAC9BjwB,KAAKkwB,mBAAqB,EAE1BlwB,KAAKmwB,eAAY5hB,EAEjBvO,KAAKowB,WAAY,GAGlBxyB,OAAOwQ,eAAelJ,EAAkBsM,UAAW,mBAAoB,CACtEwB,cAAc,EACdR,IAAK,WACJ,OAAOxS,KAAKovB,qBAGdxxB,OAAOwQ,eAAelJ,EAAkBsM,UAAW,oBAAqB,CACvEwB,cAAc,EACdR,IAAK,WACJ,OAAOxS,KAAKqvB,sBAKdnqB,EAAkBsM,UAAU6e,eAAiB,KAC7CnrB,EAAkBsM,UAAU8e,YAAc,KAC1CprB,EAAkBsM,UAAU+e,QAAU,KACtCrrB,EAAkBsM,UAAUgf,eAAiB,KAC7CtrB,EAAkBsM,UAAUif,uBAAyB,KACrDvrB,EAAkBsM,UAAUkf,2BAA6B,KACzDxrB,EAAkBsM,UAAUmf,wBAA0B,KACtDzrB,EAAkBsM,UAAUof,0BAA4B,KACxD1rB,EAAkBsM,UAAUqf,oBAAsB,KAClD3rB,EAAkBsM,UAAUsf,cAAgB,KAE5C5rB,EAAkBsM,UAAUqd,eAAiB,SAAS5rB,EAAMuQ,GACvDxT,KAAKowB,YAGTpwB,KAAK2T,cAAcH,GACc,mBAAtBxT,KAAK,KAAOiD,IACtBjD,KAAK,KAAOiD,GAAMuQ,KAIpBtO,EAAkBsM,UAAUuf,0BAA4B,WACvD,IAAIvd,EAAQ,IAAIC,MAAM,2BACtBzT,KAAK6uB,eAAe,0BAA2Brb,IAGhDtO,EAAkBsM,UAAUyP,iBAAmB,WAC9C,OAAOjhB,KAAK8vB,SAGb5qB,EAAkBsM,UAAUgG,gBAAkB,WAC7C,OAAOxX,KAAKkvB,cAGbhqB,EAAkBsM,UAAU4U,iBAAmB,WAC9C,OAAOpmB,KAAKmvB,eAKbjqB,EAAkBsM,UAAUwf,mBAAqB,SAAS7c,EAAM8c,GAC/D,IAAIC,EAAqBlxB,KAAK+vB,aAAa3jB,OAAS,EAChDsH,EAAc,CACjB5H,MAAO,KACPmf,YAAa,KACb6C,aAAc,KACd1C,cAAe,KACfU,kBAAmB,KACnBC,mBAAoB,KACpBT,UAAW,KACXC,YAAa,KACbpX,KAAMA,EACNkX,IAAK,KACLK,uBAAwB,KACxByF,uBAAwB,KACxBlkB,OAAQ,KACRmkB,6BAA8B,GAC9BC,aAAa,GAEd,GAAIrxB,KAAKuvB,aAAe2B,EACvBxd,EAAYoa,aAAe9tB,KAAK+vB,aAAa,GAAGjC,aAChDpa,EAAY0X,cAAgBprB,KAAK+vB,aAAa,GAAG3E,kBAC3C,CACN,IAAIkG,EAAatxB,KAAKuxB,8BACtB7d,EAAYoa,aAAewD,EAAWxD,aACtCpa,EAAY0X,cAAgBkG,EAAWlG,cAKxC,OAHK6F,GACJjxB,KAAK+vB,aAAajtB,KAAK4Q,GAEjBA,GAGRxO,EAAkBsM,UAAUkD,SAAW,SAAS5I,EAAOmB,GACtD,GAAIjN,KAAKowB,UACR,MAAM/B,EAAU,oBACd,0DAGH,IAQI3a,EAJJ,GAJoB1T,KAAK+vB,aAAajxB,MAAK,SAASwW,GACnD,OAAOA,EAAExJ,QAAUA,KAInB,MAAMuiB,EAAU,qBAAsB,yBAIvC,IAAK,IAAInxB,EAAI,EAAGA,EAAI8C,KAAK+vB,aAAa3jB,OAAQlP,IACxC8C,KAAK+vB,aAAa7yB,GAAG4O,OACxB9L,KAAK+vB,aAAa7yB,GAAGiX,OAASrI,EAAMqI,OACrCT,EAAc1T,KAAK+vB,aAAa7yB,IAiBlC,OAdKwW,IACJA,EAAc1T,KAAKgxB,mBAAmBllB,EAAMqI,OAG7CnU,KAAKwxB,+BAEsC,IAAvCxxB,KAAKkvB,aAAalnB,QAAQiF,IAC7BjN,KAAKkvB,aAAapsB,KAAKmK,GAGxByG,EAAY5H,MAAQA,EACpB4H,EAAYzG,OAASA,EACrByG,EAAY4X,UAAY,IAAI5uB,EAAO6Y,aAAazJ,EAC9C4H,EAAY0X,eACP1X,EAAY4X,WAGpBpmB,EAAkBsM,UAAUyD,UAAY,SAAShI,GAChD,IAAI+G,EAAKhU,KACT,GAAIqkB,GAAe,MAClBpX,EAAO2G,YAAY/S,SAAQ,SAASiL,GACnCkI,EAAGU,SAAS5I,EAAOmB,UAEd,CAIN,IAAIwkB,EAAexkB,EAAOykB,QAC1BzkB,EAAO2G,YAAY/S,SAAQ,SAASiL,EAAOgJ,GAC1C,IAAI6c,EAAcF,EAAa7d,YAAYkB,GAC3ChJ,EAAMiH,iBAAiB,WAAW,SAASS,GAC1Cme,EAAYtO,QAAU7P,EAAM6P,cAG9BoO,EAAa7d,YAAY/S,SAAQ,SAASiL,GACzCkI,EAAGU,SAAS5I,EAAO2lB,QAKtBvsB,EAAkBsM,UAAUqD,YAAc,SAASF,GAClD,GAAI3U,KAAKowB,UACR,MAAM/B,EAAU,oBACd,6DAGH,KAAM1Z,aAAkBjY,EAAO6Y,cAC9B,MAAM,IAAI0M,UAAU,0FAIrB,IAAIvO,EAAc1T,KAAK+vB,aAAajxB,MAAK,SAAS0O,GACjD,OAAOA,EAAE8d,YAAc3W,KAGxB,IAAKjB,EACJ,MAAM2a,EAAU,qBACd,8CAEH,IAAIphB,EAASyG,EAAYzG,OAEzByG,EAAY4X,UAAUnM,OACtBzL,EAAY4X,UAAY,KACxB5X,EAAY5H,MAAQ,KACpB4H,EAAYzG,OAAS,MAMiB,IAHnBjN,KAAK+vB,aAAarZ,KAAI,SAASlJ,GACjD,OAAOA,EAAEP,UAEOjF,QAAQiF,IACvBjN,KAAKkvB,aAAalnB,QAAQiF,IAAW,GACtCjN,KAAKkvB,aAAana,OAAO/U,KAAKkvB,aAAalnB,QAAQiF,GAAS,GAG7DjN,KAAKwxB,+BAGNtsB,EAAkBsM,UAAU4D,aAAe,SAASnI,GACnD,IAAI+G,EAAKhU,KACTiN,EAAO2G,YAAY/S,SAAQ,SAASiL,GACnC,IAAI6I,EAASX,EAAGM,aAAaxV,MAAK,SAASwW,GAC1C,OAAOA,EAAExJ,QAAUA,KAEhB6I,GACHX,EAAGa,YAAYF,OAKlBzP,EAAkBsM,UAAU8C,WAAa,WACxC,OAAOtU,KAAK+vB,aAAazV,QAAO,SAAS5G,GACxC,QAASA,EAAY4X,aAErB5U,KAAI,SAAShD,GACb,OAAOA,EAAY4X,cAIrBpmB,EAAkBsM,UAAU+B,aAAe,WAC1C,OAAOvT,KAAK+vB,aAAazV,QAAO,SAAS5G,GACxC,QAASA,EAAY6X,eAErB7U,KAAI,SAAShD,GACb,OAAOA,EAAY6X,gBAKrBrmB,EAAkBsM,UAAUogB,mBAAqB,SAAS7R,EACxDwP,GACD,IAAIvb,EAAKhU,KACT,GAAIuvB,GAAexP,EAAgB,EAClC,OAAO/f,KAAK+vB,aAAa,GAAG9E,YACtB,GAAIjrB,KAAK2vB,cAAcvjB,OAC7B,OAAOpM,KAAK2vB,cAActP,QAE3B,IAAI4K,EAAc,IAAIvuB,EAAOwQ,eAAe,CAC3CyW,WAAY3jB,KAAK8vB,QAAQnM,WACzBkM,aAAc7vB,KAAK8vB,QAAQJ,qBAkB5B,OAhBA9xB,OAAOwQ,eAAe6c,EAAa,QACjC,CAAC5c,MAAO,MAAO0L,UAAU,IAG3B/Z,KAAK+vB,aAAahQ,GAAe8R,wBAA0B,GAC3D7xB,KAAK+vB,aAAahQ,GAAe+R,iBAAmB,SAASte,GAC5D,IAAIue,GAAOve,EAAM1J,WAAqD,IAAxClM,OAAOmD,KAAKyS,EAAM1J,WAAWsC,OAG3D6e,EAAYrpB,MAAQmwB,EAAM,YAAc,YACuB,OAA3D/d,EAAG+b,aAAahQ,GAAe8R,yBAClC7d,EAAG+b,aAAahQ,GAAe8R,wBAAwB/uB,KAAK0Q,IAG9DyX,EAAYlY,iBAAiB,iBAC5B/S,KAAK+vB,aAAahQ,GAAe+R,kBAC3B7G,GAIR/lB,EAAkBsM,UAAUwgB,QAAU,SAAS3G,EAAKtL,GACnD,IAAI/L,EAAKhU,KACLirB,EAAcjrB,KAAK+vB,aAAahQ,GAAekL,YACnD,IAAIA,EAAYgH,iBAAhB,CAGA,IAAIJ,EACH7xB,KAAK+vB,aAAahQ,GAAe8R,wBAClC7xB,KAAK+vB,aAAahQ,GAAe8R,wBAA0B,KAC3D5G,EAAYnY,oBAAoB,iBAC/B9S,KAAK+vB,aAAahQ,GAAe+R,kBAClC7G,EAAYgH,iBAAmB,SAASC,GACvC,KAAIle,EAAGub,aAAexP,EAAgB,GAAtC,CAMA,IAAIvM,EAAQ,IAAIC,MAAM,gBACtBD,EAAM1J,UAAY,CAACgW,OAAQuL,EAAKtL,cAAeA,GAE/C,IAAIoS,EAAOD,EAAIpoB,UAEXioB,GAAOI,GAAqC,IAA7Bv0B,OAAOmD,KAAKoxB,GAAM/lB,OACrC,GAAI2lB,EAGuB,QAAtB9G,EAAYrpB,OAAyC,cAAtBqpB,EAAYrpB,QAC9CqpB,EAAYrpB,MAAQ,iBAEf,CACoB,QAAtBqpB,EAAYrpB,QACfqpB,EAAYrpB,MAAQ,aAGrBuwB,EAAKC,UAAY,EAEjBD,EAAKE,MAAQpH,EAAYC,qBAAqBlL,iBAE9C,IAAIsS,EAAsB3H,EAAS4H,eAAeJ,GAClD3e,EAAM1J,UAAYlM,OAAOgiB,OAAOpM,EAAM1J,UACpC6gB,EAASjL,eAAe4S,IAE1B9e,EAAM1J,UAAUA,UAAYwoB,EAC5B9e,EAAM1J,UAAU+V,OAAS,WACxB,MAAO,CACN/V,UAAW0J,EAAM1J,UAAUA,UAC3BgW,OAAQtM,EAAM1J,UAAUgW,OACxBC,cAAevM,EAAM1J,UAAUiW,cAC/BC,iBAAkBxM,EAAM1J,UAAUkW,mBAMrC,IAAIG,EAAWwK,EAAS6H,iBAAiBxe,EAAGob,kBAAkBnX,KAK7DkI,EAAS3M,EAAM1J,UAAUiW,gBAJrBgS,EAKF,0BAHA,KAAOve,EAAM1J,UAAUA,UAAY,OAKtCkK,EAAGob,kBAAkBnX,IACnB0S,EAAS8H,eAAeze,EAAGob,kBAAkBnX,KAC7CkI,EAAShhB,KAAK,IAChB,IAAIuzB,EAAW1e,EAAG+b,aAAa4C,OAAM,SAASjf,GAC7C,OAAOA,EAAYuX,aACiB,cAAlCvX,EAAYuX,YAAYrpB,SAGE,cAAzBoS,EAAGsb,oBACNtb,EAAGsb,kBAAoB,YACvBtb,EAAG+c,6BAKCgB,GACJ/d,EAAG6a,eAAe,eAAgBrb,GAE/Bkf,IACH1e,EAAG6a,eAAe,eAAgB,IAAIpb,MAAM,iBAC5CO,EAAGsb,kBAAoB,WACvBtb,EAAG+c,+BAKLr0B,EAAO4F,YAAW,WACjBuvB,EAAwBhxB,SAAQ,SAAS9C,GACxCktB,EAAYgH,iBAAiBl0B,QAE5B,KAIJmH,EAAkBsM,UAAU+f,4BAA8B,WACzD,IAAIvd,EAAKhU,KACL8tB,EAAe,IAAIpxB,EAAOk2B,gBAAgB,MAC9C9E,EAAa+E,iBAAmB,WAC/B7e,EAAG8e,4BACH9e,EAAG+e,0BAGJ,IAAI3H,EAAgB,IAAI1uB,EAAOs2B,iBAAiBlF,GAWhD,OAVA1C,EAAc6H,kBAAoB,WACjCjf,EAAG+e,0BAEJ3H,EAAc8H,QAAU,WAEvBt1B,OAAOwQ,eAAegd,EAAe,QACnC,CAAC/c,MAAO,SAAU0L,UAAU,IAC9B/F,EAAG+e,0BAGG,CACNjF,aAAcA,EACd1C,cAAeA,IAMjBlmB,EAAkBsM,UAAU2hB,6BAA+B,SACzDpT,GACD,IAAIkL,EAAcjrB,KAAK+vB,aAAahQ,GAAekL,YAC/CA,WACIA,EAAYgH,wBACZjyB,KAAK+vB,aAAahQ,GAAekL,aAEzC,IAAI6C,EAAe9tB,KAAK+vB,aAAahQ,GAAe+N,aAChDA,WACIA,EAAa+E,wBACb7yB,KAAK+vB,aAAahQ,GAAe+N,cAEzC,IAAI1C,EAAgBprB,KAAK+vB,aAAahQ,GAAeqL,cACjDA,WACIA,EAAc6H,yBACd7H,EAAc8H,eACdlzB,KAAK+vB,aAAahQ,GAAeqL,gBAK1ClmB,EAAkBsM,UAAU4hB,YAAc,SAAS1f,EACjDjO,EAAMO,GACP,IAAIqtB,EAASxH,EAAsBnY,EAAYoY,kBAC7CpY,EAAYqY,oBACVtmB,GAAQiO,EAAY4X,YACvB+H,EAAOC,UAAY5f,EAAYgY,uBAC/B2H,EAAOE,KAAO,CACbC,MAAO7I,EAASiB,WAChB6H,SAAU/f,EAAYggB,eAAeD,UAElC/f,EAAYyd,uBAAuB/kB,SACtCinB,EAAOE,KAAKpnB,KAAOuH,EAAYyd,uBAAuB,GAAGhlB,MAE1DuH,EAAY4X,UAAU7lB,KAAK4tB,IAExBrtB,GAAQ0N,EAAY6X,aAAe8H,EAAO1tB,OAAOyG,OAAS,IAEpC,UAArBsH,EAAYS,MACXT,EAAYyd,wBACZ9M,EAAc,OAClB3Q,EAAYyd,uBAAuBtwB,SAAQ,SAASiN,UAC5CA,EAAE6d,OAGPjY,EAAYyd,uBAAuB/kB,OACtCinB,EAAOC,UAAY5f,EAAYyd,uBAE/BkC,EAAOC,UAAY,CAAC,IAErBD,EAAOE,KAAO,CACbE,SAAU/f,EAAYggB,eAAeD,UAElC/f,EAAYggB,eAAeF,QAC9BH,EAAOE,KAAKC,MAAQ9f,EAAYggB,eAAeF,OAE5C9f,EAAYgY,uBAAuBtf,SACtCinB,EAAOE,KAAKpnB,KAAOuH,EAAYgY,uBAAuB,GAAGvf,MAE1DuH,EAAY6X,YAAYoI,QAAQN,KAIlCnuB,EAAkBsM,UAAU8H,oBAAsB,SAAStB,GAC1D,IAeImI,EACAyT,EAhBA5f,EAAKhU,KAGT,IAAuD,IAAnD,CAAC,QAAS,UAAUgI,QAAQgQ,EAAYva,MAC3C,OAAOqP,QAAQE,OAAOqhB,EAAU,YAC9B,qBAAuBrW,EAAYva,KAAO,MAG7C,IAAKgwB,EAAgC,sBACnCzV,EAAYva,KAAMuW,EAAG0E,iBAAmB1E,EAAGoc,UAC5C,OAAOtjB,QAAQE,OAAOqhB,EAAU,oBAC9B,qBAAuBrW,EAAYva,KACnC,aAAeuW,EAAG0E,iBAKrB,GAAyB,UAArBV,EAAYva,KAGf0iB,EAAWwK,EAASvK,cAAcpI,EAAYC,KAC9C2b,EAAczT,EAASE,QACvBF,EAAStf,SAAQ,SAASyf,EAAcP,GACvC,IAAI8K,EAAOF,EAASkJ,mBAAmBvT,GACvCtM,EAAG+b,aAAahQ,GAAe+L,kBAAoBjB,KAGpD7W,EAAG+b,aAAalvB,SAAQ,SAAS6S,EAAaqM,GAC7C/L,EAAGge,QAAQte,EAAY2X,IAAKtL,WAEvB,GAAyB,WAArB/H,EAAYva,KAAmB,CACzC0iB,EAAWwK,EAASvK,cAAcpM,EAAGqb,mBAAmBpX,KACxD2b,EAAczT,EAASE,QACvB,IAAIyT,EAAYnJ,EAAS5J,YAAY6S,EACnC,cAAcxnB,OAAS,EACzB+T,EAAStf,SAAQ,SAASyf,EAAcP,GACvC,IAAIrM,EAAcM,EAAG+b,aAAahQ,GAC9BkL,EAAcvX,EAAYuX,YAC1B6C,EAAepa,EAAYoa,aAC3B1C,EAAgB1X,EAAY0X,cAC5BU,EAAoBpY,EAAYoY,kBAChCC,EAAqBrY,EAAYqY,mBAMrC,KAHepB,EAASoJ,WAAWzT,IAC8B,IAA/DqK,EAAS5J,YAAYT,EAAc,iBAAiBlU,UAEpCsH,EAAYsgB,SAAU,CACvC,IAAIC,EAAsBtJ,EAASuJ,iBACjC5T,EAAcsT,GACZO,EAAuBxJ,EAASyJ,kBAClC9T,EAAcsT,GACZE,IACHK,EAAqBE,KAAO,UAGxBrgB,EAAGub,aAAiC,IAAlBxP,IACtB/L,EAAGge,QAAQte,EAAY2X,IAAKtL,GACD,QAAvB+N,EAAalsB,OAChBksB,EAAawG,MAAMrJ,EAAagJ,EAC9BH,EAAY,cAAgB,cAEH,QAAxB1I,EAAcxpB,OACjBwpB,EAAckJ,MAAMH,IAKtB,IAAId,EAASxH,EAAsBC,EACjCC,GAIF/X,EAAGof,YAAY1f,EACb2f,EAAO1tB,OAAOyG,OAAS,GACvB,OAeL,OAVA4H,EAAGob,kBAAoB,CACtB3xB,KAAMua,EAAYva,KAClBwa,IAAKD,EAAYC,KAEO,UAArBD,EAAYva,KACfuW,EAAGugB,sBAAsB,oBAEzBvgB,EAAGugB,sBAAsB,UAGnBznB,QAAQC,WAGhB7H,EAAkBsM,UAAU0B,qBAAuB,SAAS8E,GAC3D,IAAIhE,EAAKhU,KAGT,IAAuD,IAAnD,CAAC,QAAS,UAAUgI,QAAQgQ,EAAYva,MAC3C,OAAOqP,QAAQE,OAAOqhB,EAAU,YAC9B,qBAAuBrW,EAAYva,KAAO,MAG7C,IAAKgwB,EAAgC,uBACnCzV,EAAYva,KAAMuW,EAAG0E,iBAAmB1E,EAAGoc,UAC5C,OAAOtjB,QAAQE,OAAOqhB,EAAU,oBAC9B,sBAAwBrW,EAAYva,KACpC,aAAeuW,EAAG0E,iBAGrB,IAAI7S,EAAU,GACdmO,EAAGmb,cAActuB,SAAQ,SAASoM,GACjCpH,EAAQoH,EAAO9J,IAAM8J,KAEtB,IAAIunB,EAAe,GACfrU,EAAWwK,EAASvK,cAAcpI,EAAYC,KAC9C2b,EAAczT,EAASE,QACvByT,EAAYnJ,EAAS5J,YAAY6S,EACnC,cAAcxnB,OAAS,EACrBmjB,EAAc5E,EAAS5J,YAAY6S,EACrC,mBAAmBxnB,OAAS,EAC9B4H,EAAGub,YAAcA,EACjB,IAAIkF,EAAa9J,EAAS5J,YAAY6S,EACpC,kBAAkB,GA4UpB,OA1UC5f,EAAGgb,0BADAyF,GAC0BA,EAAWnV,OAAO,IAAIzX,MAAM,KACtDG,QAAQ,YAAc,EAK1BmY,EAAStf,SAAQ,SAASyf,EAAcP,GACvC,IAAItkB,EAAQkvB,EAAS+J,WAAWpU,GAC5BnM,EAAOwW,EAASgK,QAAQrU,GAExB0T,EAAWrJ,EAASoJ,WAAWzT,IAC8B,IAA/DqK,EAAS5J,YAAYT,EAAc,iBAAiBlU,OAClD5H,EAAW/I,EAAM,GAAG6jB,OAAO,GAAGzX,MAAM,KAAK,GAEzC+f,EAAY+C,EAASiK,aAAatU,EAAcsT,GAChDiB,EAAalK,EAASmK,UAAUxU,GAEhC+K,EAAMV,EAASoK,OAAOzU,IAAiBqK,EAASqK,qBAGpD,GAAIhB,GAAsB,gBAAT7f,IAAwC,cAAb3P,GAC7B,kBAAbA,GAGDwP,EAAG+b,aAAahQ,GAAiB,CAChCsL,IAAKA,EACLlX,KAAMA,EACN3P,SAAUA,EACVwvB,UAAU,OARZ,CAmBA,IAAItgB,EACAuX,EACA6C,EACA1C,EACAG,EACAG,EACAyF,EACArF,EAEAhgB,GAfCkoB,GAAYhgB,EAAG+b,aAAahQ,IAC/B/L,EAAG+b,aAAahQ,GAAeiU,WAEhChgB,EAAG+b,aAAahQ,GAAiB/L,EAAGgd,mBAAmB7c,GAAM,IAc9D,IACI8f,EACAE,EAFApI,EAAqBpB,EAASkJ,mBAAmBvT,GAGhD0T,IACJC,EAAsBtJ,EAASuJ,iBAAiB5T,EAC9CsT,IACFO,EAAuBxJ,EAASyJ,kBAAkB9T,EAChDsT,IACmBS,KAAO,UAE7BlD,EACExG,EAASsK,2BAA2B3U,GAEtC,IAAIoT,EAAiB/I,EAASuK,oBAAoB5U,GAE9C6U,EAAaxK,EAAS5J,YAAYT,EACpC,sBAAuBsT,GAAaxnB,OAAS,EAC3CgpB,EAAQzK,EAAS5J,YAAYT,EAAc,gBAC5C5J,KAAI,SAASyb,GACb,OAAOxH,EAASjL,eAAeyS,MAE/B7X,QAAO,SAAS6X,GAChB,OAA0B,IAAnBA,EAAKC,aAuBf,IAnB0B,UAArBpa,EAAYva,MAAyC,WAArBua,EAAYva,QAC9Cu2B,GAAYzE,GAAexP,EAAgB,GAC5C/L,EAAG+b,aAAahQ,KACjB/L,EAAGmf,6BAA6BpT,GAChC/L,EAAG+b,aAAahQ,GAAekL,YAC7BjX,EAAG+b,aAAa,GAAG9E,YACrBjX,EAAG+b,aAAahQ,GAAe+N,aAC7B9Z,EAAG+b,aAAa,GAAGjC,aACrB9Z,EAAG+b,aAAahQ,GAAeqL,cAC7BpX,EAAG+b,aAAa,GAAG3E,cACjBpX,EAAG+b,aAAahQ,GAAeuL,WAClCtX,EAAG+b,aAAahQ,GAAeuL,UAAU+J,aACvCrhB,EAAG+b,aAAa,GAAG3E,eAElBpX,EAAG+b,aAAahQ,GAAewL,aAClCvX,EAAG+b,aAAahQ,GAAewL,YAAY8J,aACzCrhB,EAAG+b,aAAa,GAAG3E,gBAGE,UAArBpT,EAAYva,MAAqBu2B,GAmG9B,GAAyB,WAArBhc,EAAYva,OAAsBu2B,EAAU,CAEtD/I,GADAvX,EAAcM,EAAG+b,aAAahQ,IACJkL,YAC1B6C,EAAepa,EAAYoa,aAC3B1C,EAAgB1X,EAAY0X,cAC5BG,EAAc7X,EAAY6X,YAC1BG,EAAyBhY,EAAYgY,uBACrCI,EAAoBpY,EAAYoY,kBAEhC9X,EAAG+b,aAAahQ,GAAeoR,uBAC7BA,EACFnd,EAAG+b,aAAahQ,GAAegM,mBAC7BA,EACF/X,EAAG+b,aAAahQ,GAAe2T,eAAiBA,EAE5C0B,EAAMhpB,QAAiC,QAAvB0hB,EAAalsB,SAC3BkyB,IAAaqB,GACd5F,GAAiC,IAAlBxP,EAGlBqV,EAAMv0B,SAAQ,SAASiJ,GACtB+jB,EAAkBna,EAAYoa,aAAchkB,MAH7CgkB,EAAawH,oBAAoBF,IAQ9B7F,GAAiC,IAAlBxP,IACQ,QAAvB+N,EAAalsB,OAChBksB,EAAawG,MAAMrJ,EAAagJ,EAC9B,eAEyB,QAAxB7I,EAAcxpB,OACjBwpB,EAAckJ,MAAMH,KAMGtI,EACxBnY,EAAYoY,kBACZpY,EAAYqY,oBAEmBpmB,OAAO2U,QAAO,SAAS5M,GACtD,MAAgC,QAAzBA,EAAEzK,KAAKxD,iBACZ2M,QACYsH,EAAYgY,uBAAuB,GAAGC,YAC7CjY,EAAYgY,uBAAuB,GAAGC,IAG9C3X,EAAGof,YAAY1f,EACC,aAAdkU,GAA0C,aAAdA,EACd,aAAdA,GAA0C,aAAdA,IAG1B2D,GACa,aAAd3D,GAA0C,aAAdA,SAiBvBlU,EAAY6X,aAhBnBzf,EAAQyf,EAAYzf,MAChB+oB,GACEhvB,EAAQgvB,EAAW5nB,UACvBpH,EAAQgvB,EAAW5nB,QAAU,IAAIvQ,EAAOgW,aAEzC+b,EAA6B3iB,EAAOjG,EAAQgvB,EAAW5nB,SACvDunB,EAAa1xB,KAAK,CAACgJ,EAAOyf,EAAa1lB,EAAQgvB,EAAW5nB,YAErDpH,EAAQ6L,UACZ7L,EAAQ6L,QAAU,IAAIhV,EAAOgW,aAE9B+b,EAA6B3iB,EAAOjG,EAAQ6L,SAC5C8iB,EAAa1xB,KAAK,CAACgJ,EAAOyf,EAAa1lB,EAAQ6L,iBAvKH,EAC9CgC,EAAcM,EAAG+b,aAAahQ,IAC5B/L,EAAGgd,mBAAmB7c,IACZkX,IAAMA,EAEb3X,EAAYuX,cAChBvX,EAAYuX,YAAcjX,EAAG4d,mBAAmB7R,EAC9CwP,IAGC6F,EAAMhpB,QAA6C,QAAnCsH,EAAYoa,aAAalsB,SACxCuzB,GAAgB5F,GAAiC,IAAlBxP,EAGlCqV,EAAMv0B,SAAQ,SAASiJ,GACtB+jB,EAAkBna,EAAYoa,aAAchkB,MAH7C4J,EAAYoa,aAAawH,oBAAoBF,IAQ/CtJ,EAAoBpvB,EAAOka,eAAe2e,gBAAgBphB,GAItDkQ,EAAc,QACjByH,EAAkBnmB,OAASmmB,EAAkBnmB,OAAO2U,QAClD,SAASkb,GACR,MAAsB,QAAfA,EAAMvyB,SAIjByoB,EAAyBhY,EAAYgY,wBAA0B,CAAC,CAC/Dvf,KAAgC,MAAzB,EAAI4T,EAAgB,KAI5B,IAOM9S,EAPFwoB,GAAa,EACjB,GAAkB,aAAd7N,GAA0C,aAAdA,GAK/B,GAJA6N,GAAc/hB,EAAY6X,YAC1BA,EAAc7X,EAAY6X,aACxB,IAAI7uB,EAAOka,eAAelD,EAAY0X,cAAejX,GAEnDshB,EAEH3pB,EAAQyf,EAAYzf,MAEhB+oB,GAAoC,MAAtBA,EAAW5nB,SAElB4nB,GACLhvB,EAAQgvB,EAAW5nB,UACvBpH,EAAQgvB,EAAW5nB,QAAU,IAAIvQ,EAAOgW,YACxC9U,OAAOwQ,eAAevI,EAAQgvB,EAAW5nB,QAAS,KAAM,CACvDuF,IAAK,WACJ,OAAOqiB,EAAW5nB,WAIrBrP,OAAOwQ,eAAetC,EAAO,KAAM,CAClC0G,IAAK,WACJ,OAAOqiB,EAAW/oB,SAGpBmB,EAASpH,EAAQgvB,EAAW5nB,UAEvBpH,EAAQ6L,UACZ7L,EAAQ6L,QAAU,IAAIhV,EAAOgW,aAE9BzF,EAASpH,EAAQ6L,UAEdzE,IACHwhB,EAA6B3iB,EAAOmB,GACpCyG,EAAY0d,6BAA6BtuB,KAAKmK,IAE/CunB,EAAa1xB,KAAK,CAACgJ,EAAOyf,EAAate,SAE9ByG,EAAY6X,aAAe7X,EAAY6X,YAAYzf,QAC7D4H,EAAY0d,6BAA6BvwB,SAAQ,SAASyU,GACzD,IAAIogB,EAAcpgB,EAAE1B,YAAY9U,MAAK,SAAS0O,GAC7C,OAAOA,EAAErK,KAAOuQ,EAAY6X,YAAYzf,MAAM3I,MAE3CuyB,GAl0BT,SAA2C5pB,EAAOmB,GACjDA,EAAO4H,YAAY/I,GACnBmB,EAAO0G,cAAc,IAAIjX,EAAOgyB,sBAAsB,cACpD,CAAC5iB,MAAOA,KAg0BL6pB,CAAkCD,EAAapgB,MAGjD5B,EAAY0d,6BAA+B,IAG5C1d,EAAYoY,kBAAoBA,EAChCpY,EAAYqY,mBAAqBA,EACjCrY,EAAY6X,YAAcA,EAC1B7X,EAAYggB,eAAiBA,EAC7BhgB,EAAYgY,uBAAyBA,EACrChY,EAAYyd,uBAAyBA,EAIrCnd,EAAGof,YAAYpf,EAAG+b,aAAahQ,IAC7B,EACA0V,aA8EiBlnB,IAAjByF,EAAGmc,YACNnc,EAAGmc,UAAiC,UAArBnY,EAAYva,KAAmB,SAAW,WAG1DuW,EAAGqb,mBAAqB,CACvB5xB,KAAMua,EAAYva,KAClBwa,IAAKD,EAAYC,KAEO,UAArBD,EAAYva,KACfuW,EAAGugB,sBAAsB,qBAEzBvgB,EAAGugB,sBAAsB,UAE1B32B,OAAOmD,KAAK8E,GAAShF,SAAQ,SAAS+0B,GACrC,IAAI3oB,EAASpH,EAAQ+vB,GACrB,GAAI3oB,EAAO2G,YAAYxH,OAAQ,CAC9B,IAA0C,IAAtC4H,EAAGmb,cAAcnnB,QAAQiF,GAAgB,CAC5C+G,EAAGmb,cAAcrsB,KAAKmK,GACtB,IAAIuG,EAAQ,IAAIC,MAAM,aACtBD,EAAMvG,OAASA,EACfvQ,EAAO4F,YAAW,WACjB0R,EAAG6a,eAAe,YAAarb,MAIjCghB,EAAa3zB,SAAQ,SAASkC,GAC7B,IAAI+I,EAAQ/I,EAAK,GACbuQ,EAAWvQ,EAAK,GAChBkK,EAAO9J,KAAOJ,EAAK,GAAGI,IAG1BwrB,EAAa3a,EAAIlI,EAAOwH,EAAU,CAACrG,WAItCunB,EAAa3zB,SAAQ,SAASkC,GACzBA,EAAK,IAGT4rB,EAAa3a,EAAIjR,EAAK,GAAIA,EAAK,GAAI,OAKpCrG,EAAO4F,YAAW,WACX0R,GAAMA,EAAG+b,cAGf/b,EAAG+b,aAAalvB,SAAQ,SAAS6S,GAC5BA,EAAYoa,cACqB,QAAnCpa,EAAYoa,aAAalsB,OACzB8R,EAAYoa,aAAaE,sBAAsB5hB,OAAS,IACzDlL,QAAQ+nB,KAAK,sFAEbvV,EAAYoa,aAAaM,mBAAmB,UAG5C,KAEIthB,QAAQC,WAGhB7H,EAAkBsM,UAAUqkB,MAAQ,WACnC71B,KAAK+vB,aAAalvB,SAAQ,SAAS6S,GAM9BA,EAAYoa,cACfpa,EAAYoa,aAAa3O,OAEtBzL,EAAY0X,eACf1X,EAAY0X,cAAcjM,OAEvBzL,EAAY4X,WACf5X,EAAY4X,UAAUnM,OAEnBzL,EAAY6X,aACf7X,EAAY6X,YAAYpM,UAI1Bnf,KAAKowB,WAAY,EACjBpwB,KAAKu0B,sBAAsB,WAI5BrvB,EAAkBsM,UAAU+iB,sBAAwB,SAASuB,GAC5D91B,KAAK0Y,eAAiBod,EACtB,IAAItiB,EAAQ,IAAIC,MAAM,wBACtBzT,KAAK6uB,eAAe,uBAAwBrb,IAI7CtO,EAAkBsM,UAAUggB,4BAA8B,WACzD,IAAIxd,EAAKhU,KACmB,WAAxBA,KAAK0Y,iBAAwD,IAAzB1Y,KAAKivB,kBAG7CjvB,KAAKivB,iBAAkB,EACvBvyB,EAAO4F,YAAW,WACjB,GAAI0R,EAAGib,gBAAiB,CACvBjb,EAAGib,iBAAkB,EACrB,IAAIzb,EAAQ,IAAIC,MAAM,qBACtBO,EAAG6a,eAAe,oBAAqBrb,MAEtC,KAIJtO,EAAkBsM,UAAUshB,0BAA4B,WACvD,IAAIgD,EACAC,EAAS,CACZC,IAAO,EACPC,OAAQ,EACRzT,SAAU,EACV0T,UAAW,EACX3T,UAAW,EACX4T,aAAc,EACdC,OAAQ,GAuBT,GArBAp2B,KAAK+vB,aAAalvB,SAAQ,SAAS6S,GAC9BA,EAAYoa,eAAiBpa,EAAYsgB,UAC5C+B,EAAOriB,EAAYoa,aAAalsB,YAIlCk0B,EAAW,MACPC,EAAOK,OAAS,EACnBN,EAAW,SACDC,EAAOvT,SAAW,EAC5BsT,EAAW,WACDC,EAAOI,aAAe,EAChCL,EAAW,eACDC,EAAOC,IAAM,EACvBF,EAAW,MACDC,EAAOG,UAAY,EAC7BJ,EAAW,YACDC,EAAOxT,UAAY,IAC7BuT,EAAW,aAGRA,IAAa91B,KAAKuB,mBAAoB,CACzCvB,KAAKuB,mBAAqBu0B,EAC1B,IAAItiB,EAAQ,IAAIC,MAAM,4BACtBzT,KAAK6uB,eAAe,2BAA4Brb,KAKlDtO,EAAkBsM,UAAUuhB,uBAAyB,WACpD,IAAI+C,EACAC,EAAS,CACZC,IAAO,EACPC,OAAQ,EACRI,WAAY,EACZH,UAAW,EACX3T,UAAW,EACX4T,aAAc,EACdC,OAAQ,GAyBT,GAvBAp2B,KAAK+vB,aAAalvB,SAAQ,SAAS6S,GAC9BA,EAAYoa,cAAgBpa,EAAY0X,gBACzC1X,EAAYsgB,WACd+B,EAAOriB,EAAYoa,aAAalsB,SAChCm0B,EAAOriB,EAAY0X,cAAcxpB,aAInCm0B,EAAOG,WAAaH,EAAOxT,UAE3BuT,EAAW,MACPC,EAAOK,OAAS,EACnBN,EAAW,SACDC,EAAOM,WAAa,EAC9BP,EAAW,aACDC,EAAOI,aAAe,EAChCL,EAAW,eACDC,EAAOC,IAAM,EACvBF,EAAW,MACDC,EAAOG,UAAY,IAC7BJ,EAAW,aAGRA,IAAa91B,KAAK6iB,gBAAiB,CACtC7iB,KAAK6iB,gBAAkBiT,EACvB,IAAItiB,EAAQ,IAAIC,MAAM,yBACtBzT,KAAK6uB,eAAe,wBAAyBrb,KAI/CtO,EAAkBsM,UAAUiV,YAAc,WACzC,IAAIzS,EAAKhU,KAET,GAAIgU,EAAGoc,UACN,OAAOtjB,QAAQE,OAAOqhB,EAAU,oBAC9B,yCAGH,IAAIiI,EAAiBtiB,EAAG+b,aAAazV,QAAO,SAAS9M,GACpD,MAAkB,UAAXA,EAAE2G,QACP/H,OACCmqB,EAAiBviB,EAAG+b,aAAazV,QAAO,SAAS9M,GACpD,MAAkB,UAAXA,EAAE2G,QACP/H,OAGCob,EAAe5jB,UAAU,GAC7B,GAAI4jB,EAAc,CAEjB,GAAIA,EAAanM,WAAamM,EAAa3L,SAC1C,MAAM,IAAIoG,UACR,6DAEsC1T,IAArCiZ,EAAaC,sBAEf6O,GADwC,IAArC9O,EAAaC,oBACC,GAC8B,IAArCD,EAAaC,oBACN,EAEAD,EAAaC,0BAGSlZ,IAArCiZ,EAAaO,sBAEfwO,GADwC,IAArC/O,EAAaO,oBACC,GAC8B,IAArCP,EAAaO,oBACN,EAEAP,EAAaO,qBAoBjC,IAfA/T,EAAG+b,aAAalvB,SAAQ,SAAS6S,GACP,UAArBA,EAAYS,OACfmiB,EACqB,IACpB5iB,EAAY2d,aAAc,GAEI,UAArB3d,EAAYS,QACtBoiB,EACqB,IACpB7iB,EAAY2d,aAAc,MAMtBiF,EAAiB,GAAKC,EAAiB,GACzCD,EAAiB,IACpBtiB,EAAGgd,mBAAmB,SACtBsF,KAEGC,EAAiB,IACpBviB,EAAGgd,mBAAmB,SACtBuF,KAIF,IAAIte,EAAM0S,EAAS6L,wBAAwBxiB,EAAGgc,cAC5Chc,EAAGkc,sBACLlc,EAAG+b,aAAalvB,SAAQ,SAAS6S,EAAaqM,GAG7C,IAAIjU,EAAQ4H,EAAY5H,MACpBqI,EAAOT,EAAYS,KACnBkX,EAAM3X,EAAY2X,KAAOV,EAASqK,qBACtCthB,EAAY2X,IAAMA,EAEb3X,EAAYuX,cAChBvX,EAAYuX,YAAcjX,EAAG4d,mBAAmB7R,EAC9C/L,EAAGub,cAGN,IAAIzD,EAAoBpvB,EAAO6Y,aAAaggB,gBAAgBphB,GAGxDkQ,EAAc,QACjByH,EAAkBnmB,OAASmmB,EAAkBnmB,OAAO2U,QAClD,SAASkb,GACR,MAAsB,QAAfA,EAAMvyB,SAGjB6oB,EAAkBnmB,OAAO9E,SAAQ,SAAS20B,GAGtB,SAAfA,EAAMvyB,WACwCsL,IAAhDinB,EAAM3I,WAAW,6BAClB2I,EAAM3I,WAAW,2BAA6B,KAK3CnZ,EAAYqY,oBACdrY,EAAYqY,mBAAmBpmB,QAChC+N,EAAYqY,mBAAmBpmB,OAAO9E,SAAQ,SAAS41B,GAClDjB,EAAMvyB,KAAKxD,gBAAkBg3B,EAAYxzB,KAAKxD,eAChD+1B,EAAMxI,YAAcyJ,EAAYzJ,YACjCwI,EAAMlJ,qBAAuBmK,EAAYpK,mBAK7CP,EAAkBG,iBAAiBprB,SAAQ,SAAS61B,IAC5BhjB,EAAYqY,oBACjCrY,EAAYqY,mBAAmBE,kBAAoB,IACpCprB,SAAQ,SAAS81B,GAC7BD,EAAOlJ,MAAQmJ,EAAQnJ,MAC1BkJ,EAAOvzB,GAAKwzB,EAAQxzB,UAMvB,IAAIuoB,EAAyBhY,EAAYgY,wBAA0B,CAAC,CACnEvf,KAAgC,MAAzB,EAAI4T,EAAgB,KAExBjU,GAECuY,GAAe,OAAkB,UAATlQ,IACzBuX,EAAuB,GAAGC,MAC5BD,EAAuB,GAAGC,IAAM,CAC/Bxf,KAAMuf,EAAuB,GAAGvf,KAAO,IAKtCuH,EAAY2d,cACf3d,EAAY6X,YAAc,IAAI7uB,EAAOka,eACnClD,EAAY0X,cAAejX,IAG9BT,EAAYoY,kBAAoBA,EAChCpY,EAAYgY,uBAAyBA,KAIN,eAA5B1X,EAAG8b,QAAQN,eACdvX,GAAO,kBAAoBjE,EAAG+b,aAAarZ,KAAI,SAASlJ,GACvD,OAAOA,EAAE6d,OACPlsB,KAAK,KAAO,QAEhB8Y,GAAO,4BAEPjE,EAAG+b,aAAalvB,SAAQ,SAAS6S,EAAaqM,GAC7C9H,GAAO2S,EAAkBlX,EAAaA,EAAYoY,kBAChD,QAASpY,EAAYzG,OAAQ+G,EAAGmc,WAClClY,GAAO,oBAEHvE,EAAYuX,aAAwC,QAAzBjX,EAAGsb,mBACb,IAAlBvP,GAAwB/L,EAAGub,cAC7B7b,EAAYuX,YAAY2L,qBAAqB/1B,SAAQ,SAASsxB,GAC7DA,EAAKC,UAAY,EACjBna,GAAO,KAAO0S,EAAS4H,eAAeJ,GAAQ,UAGT,cAAlCze,EAAYuX,YAAYrpB,QAC3BqW,GAAO,+BAKV,IAAImB,EAAO,IAAI1c,EAAO6b,sBAAsB,CAC3C9a,KAAM,QACNwa,IAAKA,IAEN,OAAOnL,QAAQC,QAAQqM,IAGxBlU,EAAkBsM,UAAUmV,aAAe,WAC1C,IAAI3S,EAAKhU,KAET,GAAIgU,EAAGoc,UACN,OAAOtjB,QAAQE,OAAOqhB,EAAU,oBAC9B,0CAGH,GAA4B,sBAAtBra,EAAG0E,gBACe,wBAAtB1E,EAAG0E,eACJ,OAAO5L,QAAQE,OAAOqhB,EAAU,oBAC9B,+CAAiDra,EAAG0E,iBAGvD,IAAIT,EAAM0S,EAAS6L,wBAAwBxiB,EAAGgc,cAC5Chc,EAAGkc,sBACDlc,EAAGub,cACNtX,GAAO,kBAAoBjE,EAAG+b,aAAarZ,KAAI,SAASlJ,GACvD,OAAOA,EAAE6d,OACPlsB,KAAK,KAAO,QAEhB8Y,GAAO,4BAEP,IAAI4e,EAAuBlM,EAAS6H,iBAClCxe,EAAGqb,mBAAmBpX,KAAK7L,OAC7B4H,EAAG+b,aAAalvB,SAAQ,SAAS6S,EAAaqM,GAC7C,KAAIA,EAAgB,EAAI8W,GAAxB,CAGA,GAAInjB,EAAYsgB,SAkBf,MAjByB,gBAArBtgB,EAAYS,KACc,cAAzBT,EAAYlP,SACfyT,GAAO,qCAEPA,GAAO,mBAAqBvE,EAAYlP,SACtC,0BAE4B,UAArBkP,EAAYS,KACtB8D,GAAO,4DAEwB,UAArBvE,EAAYS,OACtB8D,GAAO,sEAGRA,GAAO,2CAEMvE,EAAY2X,IAAM,QAM/B,IAAIyL,EADL,GAAIpjB,EAAYzG,OAEU,UAArByG,EAAYS,KACf2iB,EAAapjB,EAAYzG,OAAOgS,iBAAiB,GAClB,UAArBvL,EAAYS,OACtB2iB,EAAapjB,EAAYzG,OAAOiS,iBAAiB,IAE9C4X,GAECzS,GAAe,OAA8B,UAArB3Q,EAAYS,OACrCT,EAAYgY,uBAAuB,GAAGC,MACxCjY,EAAYgY,uBAAuB,GAAGC,IAAM,CAC3Cxf,KAAMuH,EAAYgY,uBAAuB,GAAGvf,KAAO,IAOvD,IAAI6f,EAAqBH,EACvBnY,EAAYoY,kBACZpY,EAAYqY,qBAEDC,EAAmBrmB,OAAO2U,QAAO,SAAS5M,GACtD,MAAgC,QAAzBA,EAAEzK,KAAKxD,iBACZ2M,QACYsH,EAAYgY,uBAAuB,GAAGC,YAC7CjY,EAAYgY,uBAAuB,GAAGC,IAG9C1T,GAAO2S,EAAkBlX,EAAasY,EACpC,SAAUtY,EAAYzG,OAAQ+G,EAAGmc,WAC/Bzc,EAAYggB,gBACdhgB,EAAYggB,eAAeqD,cAC5B9e,GAAO,wBAIT,IAAImB,EAAO,IAAI1c,EAAO6b,sBAAsB,CAC3C9a,KAAM,SACNwa,IAAKA,IAEN,OAAOnL,QAAQC,QAAQqM,IAGxBlU,EAAkBsM,UAAUqI,gBAAkB,SAAS/P,GACtD,IACIqW,EADAnM,EAAKhU,KAET,OAAI8J,QAA2CyE,IAA5BzE,EAAUiW,gBAC3BjW,EAAUgW,OACJhT,QAAQE,OAAO,IAAIiV,UAAU,qCAI9B,IAAInV,SAAQ,SAASC,EAASC,GACpC,IAAKgH,EAAGqb,mBACP,OAAOriB,EAAOqhB,EAAU,oBACtB,2DACI,GAAKvkB,GAAqC,KAAxBA,EAAUA,UAe5B,CACN,IAAIiW,EAAgBjW,EAAUiW,cAC9B,GAAIjW,EAAUgW,OACb,IAAK,IAAI5iB,EAAI,EAAGA,EAAI8W,EAAG+b,aAAa3jB,OAAQlP,IAC3C,GAAI8W,EAAG+b,aAAa7yB,GAAGmuB,MAAQvhB,EAAUgW,OAAQ,CAChDC,EAAgB7iB,EAChB,MAIH,IAAIwW,EAAcM,EAAG+b,aAAahQ,GAClC,IAAIrM,EAqCH,OAAO1G,EAAOqhB,EAAU,iBACtB,8BArCF,GAAI3a,EAAYsgB,SACf,OAAOjnB,IAER,IAAIolB,EAAOv0B,OAAOmD,KAAK+I,EAAUA,WAAWsC,OAAS,EACnDue,EAASjL,eAAe5V,EAAUA,WAAa,GAEjD,GAAsB,QAAlBqoB,EAAK3tB,WAAqC,IAAd2tB,EAAKhE,MAA4B,IAAdgE,EAAKhE,MACvD,OAAOphB,IAGR,GAAIolB,EAAKC,WAAgC,IAAnBD,EAAKC,UAC1B,OAAOrlB,IAIR,IAAsB,IAAlBgT,GAAwBA,EAAgB,GAC1CrM,EAAYoa,eAAiB9Z,EAAG+b,aAAa,GAAGjC,gBAC5CD,EAAkBna,EAAYoa,aAAcqE,GAChD,OAAOnlB,EAAOqhB,EAAU,iBACtB,8BAKJ,IAAI2I,EAAkBltB,EAAUA,UAAUkZ,OACJ,IAAlCgU,EAAgBhvB,QAAQ,QAC3BgvB,EAAkBA,EAAgB1X,OAAO,KAE1Ca,EAAWwK,EAAS6H,iBAAiBxe,EAAGqb,mBAAmBpX,MAClD8H,IAAkB,MACxBoS,EAAK10B,KAAOu5B,EAAkB,qBAC7B,OACJhjB,EAAGqb,mBAAmBpX,IACpB0S,EAAS8H,eAAeze,EAAGqb,mBAAmBpX,KAC9CkI,EAAShhB,KAAK,SA5DjB,IAAK,IAAIiuB,EAAI,EAAGA,EAAIpZ,EAAG+b,aAAa3jB,SAC/B4H,EAAG+b,aAAa3C,GAAG4G,WAGvBhgB,EAAG+b,aAAa3C,GAAGU,aAAaM,mBAAmB,KACnDjO,EAAWwK,EAAS6H,iBAAiBxe,EAAGqb,mBAAmBpX,MAClDmV,IAAM,0BACfpZ,EAAGqb,mBAAmBpX,IACpB0S,EAAS8H,eAAeze,EAAGqb,mBAAmBpX,KAC9CkI,EAAShhB,KAAK,KACZ6U,EAAGub,cAVoCnC,KAkE7CrgB,QAIF7H,EAAkBsM,UAAUlR,SAAW,SAASyV,GAC/C,GAAIA,GAAYA,aAAoBrZ,EAAOuI,iBAAkB,CAC5D,IAAIgyB,EAAmB,KAUvB,GATAj3B,KAAK+vB,aAAalvB,SAAQ,SAAS6S,GAC9BA,EAAY4X,WACd5X,EAAY4X,UAAUxf,QAAUiK,EACjCkhB,EAAmBvjB,EAAY4X,UACrB5X,EAAY6X,aACrB7X,EAAY6X,YAAYzf,QAAUiK,IACnCkhB,EAAmBvjB,EAAY6X,iBAG5B0L,EACJ,MAAM5I,EAAU,qBAAsB,qBAEvC,OAAO4I,EAAiB32B,WAGzB,IAAI42B,EAAW,GASf,OARAl3B,KAAK+vB,aAAalvB,SAAQ,SAAS6S,GAClC,CAAC,YAAa,cAAe,cAAe,eAC1C,iBAAiB7S,SAAQ,SAASgY,GAC7BnF,EAAYmF,IACfqe,EAASp0B,KAAK4Q,EAAYmF,GAAQvY,kBAIhCwM,QAAQqqB,IAAID,GAAUx0B,MAAK,SAAS00B,GAC1C,IAAIx2B,EAAU,IAAI6V,IAMlB,OALA2gB,EAASv2B,SAAQ,SAAS2V,GACzBA,EAAM3V,SAAQ,SAASqC,GACtBtC,EAAQiS,IAAI3P,EAAKC,GAAID,SAGhBtC,MAKS,CAAC,eAAgB,iBAAkB,iBACpD,kBAAmB,oBACRC,SAAQ,SAASw2B,GAC5B,IAAIrzB,EAAMtH,EAAO26B,GACjB,GAAIrzB,GAAOA,EAAIwN,WAAaxN,EAAIwN,UAAUlR,SAAU,CACnD,IAAIg3B,EAAiBtzB,EAAIwN,UAAUlR,SACnC0D,EAAIwN,UAAUlR,SAAW,WACxB,OAAOg3B,EAAezjB,MAAM7T,MAC3B0C,MAAK,SAAS60B,GACd,IAAIC,EAAW,IAAI/gB,IAKnB,OAJA7Y,OAAOmD,KAAKw2B,GAAa12B,SAAQ,SAASsC,GA1uD/C,IAAsBD,EA2uDhBq0B,EAAYp0B,GAAI1F,KA1uDd,CACNmO,WAAY,cACZC,YAAa,eACbuZ,cAAe,iBACfla,eAAgB,kBAChBO,gBAAiB,qBANGvI,EA2uDoBq0B,EAAYp0B,IApuD9C1F,OAASyF,EAAKzF,KAquDhB+5B,EAAS3kB,IAAI1P,EAAIo0B,EAAYp0B,OAEvBq0B,UAOX,IAAIC,EAAU,CAAC,cAAe,gBA8D9B,OA7DAA,EAAQ52B,SAAQ,SAASgY,GACxB,IAAIC,EAAe5T,EAAkBsM,UAAUqH,GAC/C3T,EAAkBsM,UAAUqH,GAAU,WACrC,IAAIK,EAAOtV,UACX,MAAuB,mBAAZsV,EAAK,IACK,mBAAZA,EAAK,GACNJ,EAAajF,MAAM7T,KAAM,CAAC4D,UAAU,KAC1ClB,MAAK,SAASsV,GACS,mBAAZkB,EAAK,IACfA,EAAK,GAAGrF,MAAM,KAAM,CAACmE,OAEpB,SAAS7W,GACY,mBAAZ+X,EAAK,IACfA,EAAK,GAAGrF,MAAM,KAAM,CAAC1S,OAIjB2X,EAAajF,MAAM7T,KAAM4D,gBAIlC6zB,EAAU,CAAC,sBAAuB,uBAAwB,oBAClD52B,SAAQ,SAASgY,GACxB,IAAIC,EAAe5T,EAAkBsM,UAAUqH,GAC/C3T,EAAkBsM,UAAUqH,GAAU,WACrC,IAAIK,EAAOtV,UACX,MAAuB,mBAAZsV,EAAK,IACK,mBAAZA,EAAK,GACNJ,EAAajF,MAAM7T,KAAM4D,WAC/BlB,MAAK,WACkB,mBAAZwW,EAAK,IACfA,EAAK,GAAGrF,MAAM,SAEb,SAAS1S,GACY,mBAAZ+X,EAAK,IACfA,EAAK,GAAGrF,MAAM,KAAM,CAAC1S,OAIjB2X,EAAajF,MAAM7T,KAAM4D,eAMlC,CAAC,YAAY/C,SAAQ,SAASgY,GAC7B,IAAIC,EAAe5T,EAAkBsM,UAAUqH,GAC/C3T,EAAkBsM,UAAUqH,GAAU,WACrC,IAAIK,EAAOtV,UACX,MAAuB,mBAAZsV,EAAK,GACRJ,EAAajF,MAAM7T,KAAM4D,WAC/BlB,MAAK,WACkB,mBAAZwW,EAAK,IACfA,EAAK,GAAGrF,MAAM,SAIViF,EAAajF,MAAM7T,KAAM4D,eAI3BsB,IAGN,CAAC+S,IAAM,KAAKyf,GAAG,CAAC,SAAS98B,EAAQyR,EAAOC,GAE1C,aAGA,IAAIqe,EAAW,CAIfqK,mBAA8B,WAC7B,OAAOxT,KAAKmW,SAASpyB,SAAS,IAAI+Z,OAAO,EAAG,MAI7CqL,EAASiB,WAAajB,EAASqK,qBAG/BrK,EAAS+J,WAAa,SAASkD,GAC9B,OAAOA,EAAK5U,OAAOnb,MAAM,MAAM6O,KAAI,SAASzb,GAC3C,OAAOA,EAAK+nB,WAId2H,EAASvK,cAAgB,SAASwX,GAEjC,OADYA,EAAK/vB,MAAM,QACV6O,KAAI,SAASmhB,EAAM74B,GAC/B,OAAQA,EAAQ,EAAI,KAAO64B,EAAOA,GAAM7U,OAAS,WAKnD2H,EAAS8H,eAAiB,SAASmF,GAClC,IAAIzX,EAAWwK,EAASvK,cAAcwX,GACtC,OAAOzX,GAAYA,EAAS,IAI7BwK,EAAS6H,iBAAmB,SAASoF,GACpC,IAAIzX,EAAWwK,EAASvK,cAAcwX,GAEtC,OADAzX,EAASE,QACFF,GAIRwK,EAAS5J,YAAc,SAAS6W,EAAMxb,GACrC,OAAOuO,EAAS+J,WAAWkD,GAAMtd,QAAO,SAASrf,GAChD,OAAgC,IAAzBA,EAAK+M,QAAQoU,OAOtBuO,EAASjL,eAAiB,SAASzkB,GAqBlC,IApBA,IAAI68B,EAQAhuB,EAAY,CACfmkB,YANA6J,EADoC,IAAjC78B,EAAK+M,QAAQ,gBACR/M,EAAK88B,UAAU,IAAIlwB,MAAM,KAEzB5M,EAAK88B,UAAU,IAAIlwB,MAAM,MAIf,GAClBuqB,UAAWzmB,SAASmsB,EAAM,GAAI,IAC9BtzB,SAAUszB,EAAM,GAAGr4B,cACnB2L,SAAUO,SAASmsB,EAAM,GAAI,IAC7B5J,GAAI4J,EAAM,GACVE,QAASF,EAAM,GACf3J,KAAMxiB,SAASmsB,EAAM,GAAI,IAEzBr6B,KAAMq6B,EAAM,IAGJ56B,EAAI,EAAGA,EAAI46B,EAAM1rB,OAAQlP,GAAK,EACtC,OAAQ46B,EAAM56B,IACb,IAAK,QACJ4M,EAAUmuB,eAAiBH,EAAM56B,EAAI,GACrC,MACD,IAAK,QACJ4M,EAAUouB,YAAcvsB,SAASmsB,EAAM56B,EAAI,GAAI,IAC/C,MACD,IAAK,UACJ4M,EAAUquB,QAAUL,EAAM56B,EAAI,GAC9B,MACD,IAAK,QACJ4M,EAAUuoB,MAAQyF,EAAM56B,EAAI,GAC5B4M,EAAUkW,iBAAmB8X,EAAM56B,EAAI,GACvC,MACD,QACC4M,EAAUguB,EAAM56B,IAAM46B,EAAM56B,EAAI,GAInC,OAAO4M,GAIR6gB,EAAS4H,eAAiB,SAASzoB,GAClC,IAAImO,EAAM,GACVA,EAAInV,KAAKgH,EAAUmkB,YACnBhW,EAAInV,KAAKgH,EAAUsoB,WACnBna,EAAInV,KAAKgH,EAAUtF,SAAS8X,eAC5BrE,EAAInV,KAAKgH,EAAUsB,UACnB6M,EAAInV,KAAKgH,EAAUkuB,SAAWluB,EAAUokB,IACxCjW,EAAInV,KAAKgH,EAAUqkB,MAEnB,IAAI1wB,EAAOqM,EAAUrM,KAkBrB,OAjBAwa,EAAInV,KAAK,OACTmV,EAAInV,KAAKrF,GACI,SAATA,GAAmBqM,EAAUmuB,gBAC/BnuB,EAAUouB,cACXjgB,EAAInV,KAAK,SACTmV,EAAInV,KAAKgH,EAAUmuB,gBACnBhgB,EAAInV,KAAK,SACTmV,EAAInV,KAAKgH,EAAUouB,cAEhBpuB,EAAUquB,SAAgD,QAArCruB,EAAUtF,SAAS/E,gBAC3CwY,EAAInV,KAAK,WACTmV,EAAInV,KAAKgH,EAAUquB,WAEhBruB,EAAUkW,kBAAoBlW,EAAUuoB,SAC3Cpa,EAAInV,KAAK,SACTmV,EAAInV,KAAKgH,EAAUkW,kBAAoBlW,EAAUuoB,QAE3C,aAAepa,EAAI9Y,KAAK,MAKhCwrB,EAASyN,gBAAkB,SAASn9B,GACnC,OAAOA,EAAKqkB,OAAO,IAAIzX,MAAM,MAK9B8iB,EAAS0N,YAAc,SAASp9B,GAC/B,IAAI68B,EAAQ78B,EAAKqkB,OAAO,GAAGzX,MAAM,KAC7BywB,EAAS,CACZjM,YAAa1gB,SAASmsB,EAAMzX,QAAS,KAUtC,OAPAyX,EAAQA,EAAM,GAAGjwB,MAAM,KAEvBywB,EAAOr1B,KAAO60B,EAAM,GACpBQ,EAAOtL,UAAYrhB,SAASmsB,EAAM,GAAI,IACtCQ,EAAOC,SAA4B,IAAjBT,EAAM1rB,OAAeT,SAASmsB,EAAM,GAAI,IAAM,EAEhEQ,EAAOrL,YAAcqL,EAAOC,SACrBD,GAKR3N,EAAS6N,YAAc,SAAShD,GAC/B,IAAIpJ,EAAKoJ,EAAMnJ,iBACoB9d,IAA/BinB,EAAMlJ,uBACTF,EAAKoJ,EAAMlJ,sBAEZ,IAAIiM,EAAW/C,EAAM+C,UAAY/C,EAAMvI,aAAe,EACtD,MAAO,YAAcb,EAAK,IAAMoJ,EAAMvyB,KAAO,IAAMuyB,EAAMxI,WACzC,IAAbuL,EAAiB,IAAMA,EAAW,IAAM,QAM5C5N,EAAS8N,YAAc,SAASx9B,GAC/B,IAAI68B,EAAQ78B,EAAKqkB,OAAO,GAAGzX,MAAM,KACjC,MAAO,CACN1E,GAAIwI,SAASmsB,EAAM,GAAI,IACvBlQ,UAAWkQ,EAAM,GAAG9vB,QAAQ,KAAO,EAAI8vB,EAAM,GAAGjwB,MAAM,KAAK,GAAK,WAChE2lB,IAAKsK,EAAM,KAMbnN,EAAS+N,YAAc,SAASC,GAC/B,MAAO,aAAeA,EAAgBx1B,IAAMw1B,EAAgBC,cACzDD,EAAgB/Q,WAA2C,aAA9B+Q,EAAgB/Q,UAC1C,IAAM+Q,EAAgB/Q,UACtB,IACJ,IAAM+Q,EAAgBnL,IAAM,QAM/B7C,EAASkO,UAAY,SAAS59B,GAI7B,IAHA,IACI69B,EADAR,EAAS,GAETR,EAAQ78B,EAAKqkB,OAAOrkB,EAAK+M,QAAQ,KAAO,GAAGH,MAAM,KAC5CulB,EAAI,EAAGA,EAAI0K,EAAM1rB,OAAQghB,IAEjCkL,GADAQ,EAAKhB,EAAM1K,GAAGpK,OAAOnb,MAAM,MACjB,GAAGmb,QAAU8V,EAAG,GAE3B,OAAOR,GAIR3N,EAASoO,UAAY,SAASvD,GAC7B,IAAIv6B,EAAO,GACPmxB,EAAKoJ,EAAMnJ,YAIf,QAHmC9d,IAA/BinB,EAAMlJ,uBACTF,EAAKoJ,EAAMlJ,sBAERkJ,EAAM3I,YAAcjvB,OAAOmD,KAAKy0B,EAAM3I,YAAYzgB,OAAQ,CAC7D,IAAIinB,EAAS,GACbz1B,OAAOmD,KAAKy0B,EAAM3I,YAAYhsB,SAAQ,SAASm4B,GAC1CxD,EAAM3I,WAAWmM,GACpB3F,EAAOvwB,KAAKk2B,EAAQ,IAAMxD,EAAM3I,WAAWmM,IAE3C3F,EAAOvwB,KAAKk2B,MAGd/9B,GAAQ,UAAYmxB,EAAK,IAAMiH,EAAOl0B,KAAK,KAAO,OAEnD,OAAOlE,GAKR0vB,EAASsO,YAAc,SAASh+B,GAC/B,IAAI68B,EAAQ78B,EAAKqkB,OAAOrkB,EAAK+M,QAAQ,KAAO,GAAGH,MAAM,KACrD,MAAO,CACNpK,KAAMq6B,EAAMzX,QACZgN,UAAWyK,EAAM34B,KAAK,OAIxBwrB,EAASuO,YAAc,SAAS1D,GAC/B,IAAI/5B,EAAQ,GACR2wB,EAAKoJ,EAAMnJ,YAYf,YAXmC9d,IAA/BinB,EAAMlJ,uBACTF,EAAKoJ,EAAMlJ,sBAERkJ,EAAMtI,cAAgBsI,EAAMtI,aAAa9gB,QAE5CopB,EAAMtI,aAAarsB,SAAQ,SAASssB,GACnC1xB,GAAS,aAAe2wB,EAAK,IAAMe,EAAG1vB,MACrC0vB,EAAGE,WAAaF,EAAGE,UAAUjhB,OAAS,IAAM+gB,EAAGE,UAAY,IAC1D,UAGG5xB,GAKRkvB,EAASwO,eAAiB,SAASl+B,GAClC,IAAIm+B,EAAKn+B,EAAK+M,QAAQ,KAClB8vB,EAAQ,CACX3rB,KAAMR,SAAS1Q,EAAKqkB,OAAO,EAAG8Z,EAAK,GAAI,KAEpCC,EAAQp+B,EAAK+M,QAAQ,IAAKoxB,GAO9B,OANIC,GAAS,GACZvB,EAAMwB,UAAYr+B,EAAKqkB,OAAO8Z,EAAK,EAAGC,EAAQD,EAAK,GACnDtB,EAAMzpB,MAAQpT,EAAKqkB,OAAO+Z,EAAQ,IAElCvB,EAAMwB,UAAYr+B,EAAKqkB,OAAO8Z,EAAK,GAE7BtB,GAGRnN,EAAS4O,eAAiB,SAASt+B,GAClC,IAAI68B,EAAQ78B,EAAKqkB,OAAO,IAAIzX,MAAM,KAClC,MAAO,CACN2xB,UAAW1B,EAAMzX,QACjBoZ,MAAO3B,EAAMphB,KAAI,SAASvK,GACzB,OAAOR,SAASQ,EAAM,SAOzBwe,EAASoK,OAAS,SAASzU,GAC1B,IAAI+K,EAAMV,EAAS5J,YAAYT,EAAc,UAAU,GACvD,GAAI+K,EACH,OAAOA,EAAI/L,OAAO,IAIpBqL,EAAS+O,iBAAmB,SAASz+B,GACpC,IAAI68B,EAAQ78B,EAAKqkB,OAAO,IAAIzX,MAAM,KAClC,MAAO,CACN8xB,UAAW7B,EAAM,GAAGr4B,cACpB4O,MAAOypB,EAAM,KAOfnN,EAASyJ,kBAAoB,SAAS9T,EAAcsT,GAKnD,MAAO,CACNS,KAAM,OACNuF,aANWjP,EAAS5J,YAAYT,EAAesT,EAC9C,kBAKmBld,IAAIiU,EAAS+O,oBAKnC/O,EAASQ,oBAAsB,SAASkI,EAAQwG,GAC/C,IAAI5hB,EAAM,WAAa4hB,EAAY,OAInC,OAHAxG,EAAOuG,aAAa/4B,SAAQ,SAASi5B,GACpC7hB,GAAO,iBAAmB6hB,EAAGH,UAAY,IAAMG,EAAGzrB,MAAQ,UAEpD4J,GAKR0S,EAASuJ,iBAAmB,SAAS5T,EAAcsT,GAClD,IAAIn4B,EAAQkvB,EAAS+J,WAAWpU,GAWhC,MARoB,CACnBN,kBAFDvkB,EAAQA,EAAM+e,OAAOmQ,EAAS+J,WAAWd,KAEhBtZ,QAAO,SAASrf,GACvC,OAAwC,IAAjCA,EAAK+M,QAAQ,mBAClB,GAAGsX,OAAO,IACbya,SAAUt+B,EAAM6e,QAAO,SAASrf,GAC/B,OAAsC,IAA/BA,EAAK+M,QAAQ,iBAClB,GAAGsX,OAAO,MAMfqL,EAASK,mBAAqB,SAASqI,GACtC,MAAO,eAAiBA,EAAOrT,iBAAxB,iBACUqT,EAAO0G,SAAW,QAIpCpP,EAASkJ,mBAAqB,SAASvT,GAStC,IARA,IAAItI,EAAc,CACjBrS,OAAQ,GACRsmB,iBAAkB,GAClBC,cAAe,GACfqH,KAAM,IAGHyG,EADQrP,EAAS+J,WAAWpU,GACd,GAAGzY,MAAM,KAClB3K,EAAI,EAAGA,EAAI88B,EAAM5tB,OAAQlP,IAAK,CACtC,IAAIkvB,EAAK4N,EAAM98B,GACX+8B,EAAatP,EAAS5J,YACxBT,EAAc,YAAc8L,EAAK,KAAK,GACxC,GAAI6N,EAAY,CACf,IAAIzE,EAAQ7K,EAAS0N,YAAY4B,GAC7BC,EAAQvP,EAAS5J,YACnBT,EAAc,UAAY8L,EAAK,KAQjC,OANAoJ,EAAM3I,WAAaqN,EAAM9tB,OAASue,EAASkO,UAAUqB,EAAM,IAAM,GACjE1E,EAAMtI,aAAevC,EAAS5J,YAC5BT,EAAc,aAAe8L,EAAK,KAClC1V,IAAIiU,EAASsO,aACfjhB,EAAYrS,OAAO7C,KAAK0yB,GAEhBA,EAAMvyB,KAAKqZ,eAClB,IAAK,MACL,IAAK,SACJtE,EAAYkU,cAAcppB,KAAK0yB,EAAMvyB,KAAKqZ,iBAW9C,OAJAqO,EAAS5J,YAAYT,EAAc,aAAazf,SAAQ,SAAS5F,GAChE+c,EAAYiU,iBAAiBnpB,KAAK6nB,EAAS8N,YAAYx9B,OAGjD+c,GAKR2S,EAASI,oBAAsB,SAAS5W,EAAM0W,GAC7C,IAAI5S,EAAM,GAGVA,GAAO,KAAO9D,EAAO,IACrB8D,GAAO4S,EAAKllB,OAAOyG,OAAS,EAAI,IAAM,IACtC6L,GAAO,sBACPA,GAAO4S,EAAKllB,OAAO+Q,KAAI,SAAS8e,GAC/B,YAAmCjnB,IAA/BinB,EAAMlJ,qBACFkJ,EAAMlJ,qBAEPkJ,EAAMnJ,eACXltB,KAAK,KAAO,OAEf8Y,GAAO,uBACPA,GAAO,8BAGP4S,EAAKllB,OAAO9E,SAAQ,SAAS20B,GAC5Bvd,GAAO0S,EAAS6N,YAAYhD,GAC5Bvd,GAAO0S,EAASoO,UAAUvD,GAC1Bvd,GAAO0S,EAASuO,YAAY1D,MAE7B,IAAI2E,EAAW,EAiBf,OAhBAtP,EAAKllB,OAAO9E,SAAQ,SAAS20B,GACxBA,EAAM2E,SAAWA,IACpBA,EAAW3E,EAAM2E,aAGfA,EAAW,IACdliB,GAAO,cAAgBkiB,EAAW,QAEnCliB,GAAO,iBAEH4S,EAAKoB,kBACRpB,EAAKoB,iBAAiBprB,SAAQ,SAASu5B,GACtCniB,GAAO0S,EAAS+N,YAAY0B,MAIvBniB,GAKR0S,EAASsK,2BAA6B,SAAS3U,GAC9C,IAcI+Z,EAdAC,EAAqB,GACrBtiB,EAAc2S,EAASkJ,mBAAmBvT,GAC1Cia,GAAuD,IAA9CviB,EAAYkU,cAAclkB,QAAQ,OAC3CwyB,GAA6D,IAAjDxiB,EAAYkU,cAAclkB,QAAQ,UAG9CyxB,EAAQ9O,EAAS5J,YAAYT,EAAc,WAC9C5J,KAAI,SAASzb,GACb,OAAO0vB,EAASwO,eAAel+B,MAE/Bqf,QAAO,SAASwd,GAChB,MAA2B,UAApBA,EAAMwB,aAEVmB,EAAchB,EAAMrtB,OAAS,GAAKqtB,EAAM,GAAGttB,KAG3CuuB,EAAQ/P,EAAS5J,YAAYT,EAAc,oBAC9C5J,KAAI,SAASzb,GAEb,OADYA,EAAKqkB,OAAO,IAAIzX,MAAM,KACrB6O,KAAI,SAASmhB,GACzB,OAAOlsB,SAASksB,EAAM,UAGpB6C,EAAMtuB,OAAS,GAAKsuB,EAAM,GAAGtuB,OAAS,GAAKsuB,EAAM,GAAG,KAAOD,IAC9DJ,EAAgBK,EAAM,GAAG,IAG1B1iB,EAAYrS,OAAO9E,SAAQ,SAAS20B,GACnC,GAAiC,QAA7BA,EAAMvyB,KAAKqZ,eAA2BkZ,EAAM3I,WAAWC,IAAK,CAC/D,IAAI6N,EAAW,CACdxuB,KAAMsuB,EACNG,iBAAkBjvB,SAAS6pB,EAAM3I,WAAWC,IAAK,KAE9C2N,GAAeJ,IAClBM,EAAShP,IAAM,CAACxf,KAAMkuB,IAEvBC,EAAmBx3B,KAAK63B,GACpBJ,KACHI,EAAW/d,KAAKC,MAAMD,KAAKE,UAAU6d,KAC5BE,IAAM,CACd1uB,KAAMsuB,EACNK,UAAWN,EAAY,aAAe,OAEvCF,EAAmBx3B,KAAK63B,QAIO,IAA9BL,EAAmBluB,QAAgBquB,GACtCH,EAAmBx3B,KAAK,CACvBqJ,KAAMsuB,IAKR,IAAIz4B,EAAY2oB,EAAS5J,YAAYT,EAAc,MAenD,OAdIte,EAAUoK,SAEZpK,EADuC,IAApCA,EAAU,GAAGgG,QAAQ,WACZ2D,SAAS3J,EAAU,GAAGsd,OAAO,GAAI,IACD,IAAlCtd,EAAU,GAAGgG,QAAQ,SAEoB,IAAvC2D,SAAS3J,EAAU,GAAGsd,OAAO,GAAI,IAAa,IACtD,UAEQ/Q,EAEb+rB,EAAmBz5B,SAAQ,SAASwyB,GACnCA,EAAO0H,WAAa/4B,MAGfs4B,GAIR3P,EAASuK,oBAAsB,SAAS5U,GACvC,IAAIoT,EAAiB,GAIjBsH,EAAarQ,EAAS5J,YAAYT,EAAc,WACjD5J,KAAI,SAASzb,GACb,OAAO0vB,EAASwO,eAAel+B,MAE/Bqf,QAAO,SAAStW,GAChB,MAAyB,UAAlBA,EAAIs1B,aACT,GACD0B,IACHtH,EAAeF,MAAQwH,EAAW3sB,MAClCqlB,EAAevnB,KAAO6uB,EAAW7uB,MAKlC,IAAI8uB,EAAQtQ,EAAS5J,YAAYT,EAAc,gBAC/CoT,EAAeqD,YAAckE,EAAM7uB,OAAS,EAC5CsnB,EAAeD,SAA4B,IAAjBwH,EAAM7uB,OAIhC,IAAI8uB,EAAMvQ,EAAS5J,YAAYT,EAAc,cAG7C,OAFAoT,EAAewH,IAAMA,EAAI9uB,OAAS,EAE3BsnB,GAKR/I,EAASmK,UAAY,SAASxU,GAC7B,IAAIwX,EACAqD,EAAOxQ,EAAS5J,YAAYT,EAAc,WAC9C,GAAoB,IAAhB6a,EAAK/uB,OAER,MAAO,CAACa,QADR6qB,EAAQqD,EAAK,GAAG7b,OAAO,GAAGzX,MAAM,MACV,GAAIiE,MAAOgsB,EAAM,IAExC,IAAIsD,EAAQzQ,EAAS5J,YAAYT,EAAc,WAC9C5J,KAAI,SAASzb,GACb,OAAO0vB,EAASwO,eAAel+B,MAE/Bqf,QAAO,SAAS+gB,GAChB,MAA+B,SAAxBA,EAAU/B,aAElB,OAAI8B,EAAMhvB,OAAS,EAEX,CAACa,QADR6qB,EAAQsD,EAAM,GAAG/sB,MAAMxG,MAAM,MACP,GAAIiE,MAAOgsB,EAAM,SAFxC,GAUDnN,EAASsF,kBAAoB,WAC5B,OAAOzO,KAAKmW,SAASpyB,WAAW+Z,OAAO,EAAG,KAQ3CqL,EAAS6L,wBAA0B,SAAS8E,EAAQC,EAASC,GAC5D,IACIlkB,OAAsB/I,IAAZgtB,EAAwBA,EAAU,EAQhD,MAAO,aAFIC,GAAY,qBAGP,KARZF,GAGS3Q,EAASsF,qBAKY,IAAM3Y,EADjC,yCAORqT,EAASC,kBAAoB,SAASlX,EAAamX,EAAMptB,EAAMwP,GAC9D,IAAIgL,EAAM0S,EAASI,oBAAoBrX,EAAYS,KAAM0W,GAyBzD,GAtBA5S,GAAO0S,EAASK,mBACdtX,EAAYuX,YAAYC,sBAG1BjT,GAAO0S,EAASQ,oBACdzX,EAAY0X,cAAcF,qBACjB,UAATztB,EAAmB,UAAY,UAEjCwa,GAAO,SAAWvE,EAAY2X,IAAM,OAEhC3X,EAAYkU,UACf3P,GAAO,KAAOvE,EAAYkU,UAAY,OAC5BlU,EAAY4X,WAAa5X,EAAY6X,YAC/CtT,GAAO,iBACGvE,EAAY4X,UACtBrT,GAAO,iBACGvE,EAAY6X,YACtBtT,GAAO,iBAEPA,GAAO,iBAGJvE,EAAY4X,UAAW,CAE1B,IAAIG,EAAO,QAAUxe,EAAO9J,GAAK,IAC/BuQ,EAAY4X,UAAUxf,MAAM3I,GAAK,OACnC8U,GAAO,KAAOwT,EAGdxT,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGvf,KACvD,IAAMsf,EACJ/X,EAAYgY,uBAAuB,GAAGC,MACzC1T,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC3D,IAAMsf,EACRxT,GAAO,oBACLvE,EAAYgY,uBAAuB,GAAGvf,KAAO,IAC7CuH,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC1C,QAUJ,OANA8L,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGvf,KACvD,UAAYwe,EAASiB,WAAa,OAChClY,EAAY4X,WAAa5X,EAAYgY,uBAAuB,GAAGC,MAClE1T,GAAO,UAAYvE,EAAYgY,uBAAuB,GAAGC,IAAIxf,KAC3D,UAAYwe,EAASiB,WAAa,QAE9B3T,GAIR0S,EAASiK,aAAe,SAAStU,EAAcsT,GAG9C,IADA,IAAIn4B,EAAQkvB,EAAS+J,WAAWpU,GACvBpjB,EAAI,EAAGA,EAAIzB,EAAM2Q,OAAQlP,IACjC,OAAQzB,EAAMyB,IACb,IAAK,aACL,IAAK,aACL,IAAK,aACL,IAAK,aACJ,OAAOzB,EAAMyB,GAAGoiB,OAAO,GAK1B,OAAIsU,EACIjJ,EAASiK,aAAahB,GAEvB,YAGRjJ,EAASgK,QAAU,SAASrU,GAG3B,OAFYqK,EAAS+J,WAAWpU,GACd,GAAGzY,MAAM,KACd,GAAGyX,OAAO,IAGxBqL,EAASoJ,WAAa,SAASzT,GAC9B,MAAyC,MAAlCA,EAAazY,MAAM,IAAK,GAAG,IAGnC8iB,EAASnK,WAAa,SAASF,GAC9B,IACIwX,EADQnN,EAAS+J,WAAWpU,GACd,GAAGhB,OAAO,GAAGzX,MAAM,KACrC,MAAO,CACNsM,KAAM2jB,EAAM,GACZ3J,KAAMxiB,SAASmsB,EAAM,GAAI,IACzBtzB,SAAUszB,EAAM,GAChB2D,IAAK3D,EAAMtjB,MAAM,GAAGrV,KAAK,OAI3BwrB,EAAS+Q,WAAa,SAASpb,GAC9B,IACIwX,EADOnN,EAAS5J,YAAYT,EAAc,MAAM,GACnChB,OAAO,GAAGzX,MAAM,KACjC,MAAO,CACN8zB,SAAU7D,EAAM,GAChB8D,UAAW9D,EAAM,GACjB+D,eAAgBlwB,SAASmsB,EAAM,GAAI,IACnCgE,QAAShE,EAAM,GACfiE,YAAajE,EAAM,GACnBE,QAASF,EAAM,KAKjBnN,EAASqR,WAAa,SAASpE,GAC9B,GAAoB,iBAATA,GAAqC,IAAhBA,EAAKxrB,OACpC,OAAO,EAGR,IADA,IAAI3Q,EAAQkvB,EAAS+J,WAAWkD,GACvB16B,EAAI,EAAGA,EAAIzB,EAAM2Q,OAAQlP,IACjC,GAAIzB,EAAMyB,GAAGkP,OAAS,GAA4B,MAAvB3Q,EAAMyB,GAAGmf,OAAO,GAC1C,OAAO,EAIT,OAAO,GAIc,iBAAXhQ,IACVA,EAAOC,QAAUqe,IAGhB,KAAK,GAAG,CAAC,GA5sKmW,CA4sK/V;CC5sKhB,SAAU/c,GAAG,IAAgF7P,EAA5E8E,EAAE+K,EAAEquB,GAAGC,SAASze,EAAE,YAAY0e,EAAE,kCAAkCnf,EAAE,GAAG5P,EAAE,GAAKU,EAAE,CAAC7M,IAAI,EAAE4gB,KAAK,IAAIua,EAAE,EAAE1uB,EAAE,EAAE2uB,EAAE,GAAG,SAASC,EAAEv+B,EAAE0f,EAAE6e,EAAEp/B,GAAG,IAAIwQ,EAAE,CAACmU,KAAK3kB,IAAIugB,EAAEA,EAAEoE,KAAK,IAAI0a,MAAM9e,EAAEA,EAAE8e,MAAM,KAAKC,KAAK,KAAKC,OAAOhf,GAAG,KAAKif,MAAM,GAAGC,MAAMhvB,EAAEivB,KAAKC,EAAEC,KAAKC,EAAEtgC,KAAKugC,EAAEC,OAAOzvB,GAAkH,OAA/GzP,GAAG6P,EAAEsvB,OAAOxvB,EAAE3P,EAAE,CAAC2+B,MAAM,GAAGD,OAAOhf,IAAO6e,IAAG5uB,EAAE8uB,KAAKF,EAAE5uB,EAAEyvB,MAAMzvB,EAAEyvB,OAAOzvB,EAAE8uB,KAAK5uB,EAAEF,GAAGA,EAAEzM,MAAMm7B,GAAGC,EAAEjwB,OAAOgB,EAAE4P,GAAGof,GAAG1uB,GAASA,EAAqmF,SAASxQ,EAAEa,EAAEu+B,EAAElvB,GAAG,IAAI4P,EAAEtP,EAAEN,EAAEQ,EAAE8I,IAAItJ,GAAE,SAASQ,GAAG,MAAkB,iBAAJA,EAAa7P,EAAEkD,IAAI2M,EAAEyK,QAAQ,4CAA4C,MAAMoF,EAAE,KAAK1f,EAAEkD,IAAI,QAAQ2M,EAAE1Q,EAAE0Q,EAAE7P,EAAE6P,EAAEuvB,UAASp/B,EAAE,OAAGu+B,EAAS5uB,IAAEA,EAAEA,EAAEvO,KAAK,KAAMkZ,QAAQ,mDAAkD,SAASjL,EAAEM,EAAE3P,EAAE0f,GAAgB2f,EAAbpgB,EAAEpP,EAAE7P,GAAGyU,OAAc9E,IAAEsP,EAAEoQ,EAAE1f,GAAG8M,OAAOwC,IAAMS,IAAET,EAAEA,EAAExC,OAAO4S,EAAE3P,QAAaT,GAAIoQ,EAAE1f,IAAG,SAAS0f,EAAE1f,GAAG,IAAIsP,EAAEhgB,SAASC,cAAc,OAAqB,OAAd+f,EAAEzf,UAAUmQ,EAASE,EAAEyvB,UAAUrgB,EAAEsgB,YAAY,SAAS7vB,EAAEuP,GAAG,OAAO,IAAIugB,SAAS,SAAS,QAAQ,+DAA+D3vB,EAAEoV,KAAKhG,GAAG3E,QAAQ,WAAW,QAAQA,QAAQ,YAAY,KAAKA,QAAQ,kBAAkB,YAAYA,QAAQ,uGAAsG,SAAS+kB,EAAEf,EAAEjP,EAAE3P,EAAET,EAAEtP,EAAE3P,GAAG,IAAoBq+B,EAAEhvB,EAAEkvB,EAApBp/B,EAAE0Q,EAAE4uB,KAAKgB,IAAIpQ,GAAS,IAAIlwB,EAAE,KAAK,+BAA+BkwB,EAA2O,OAAzOgP,EAAEl/B,EAAEugC,UAAU,GAAM/vB,IAAI,MAAMpG,KAAK0V,KAAIA,GAAGtP,EAAEA,EAAE,IAAMsP,GAAGA,EAAE0gB,EAAE1gB,GAAGjf,EAAEA,EAAE,IAAI2/B,EAAE3/B,GAAG,IAAI2P,EAAE,IAAI,GAAGN,EAAEM,EAAEsP,EAAEhV,QAAQ,MAAM,EAAEgV,EAAEtP,EAAE,IAAIsP,EAAE,eAAejf,EAAEif,EAAEsf,EAAE5uB,EAAEN,EAAE,WAAW4P,EAAE,mBAAmBA,EAAE,kBAAkBA,EAAE,MAAUsf,EAAElvB,EAAEgvB,EAAEuB,IAAI,OAAOlgB,EAAEigB,EAAEjgB,GAAS,MAAMvgB,EAAEm/B,EAAE,QAAQ,QAAQx0B,MAAM,cAAc1I,KAAK6d,EAAE,UAAUA,EAAE,uBAAuBA,EAAE,UAAU,QAAQnV,MAAM,OAAO1I,KAAKm9B,GAAGz0B,MAAM,MAAM1I,KAAKiO,GAAGvF,MAAM,MAAM1I,KAAKse,EAAEA,EAAEpF,QAAQ,+BAA8B,SAASoF,EAAE/P,EAAEsP,EAAEpP,GAA0B,OAAvBA,EAAEA,EAAE,IAAIA,EAAE,IAAIoP,EAAE,IAAI,IAAY,IAAItP,EAAE,eAAeE,EAAE6P,KAAI2e,EAAEwB,IAAI,IAAI,cAAa,iBAAiB,SAASrwB,EAAEG,EAAEsP,GAAGtP,EAAE6uB,MAAMr/B,EAAEwQ,GAAE,EAAKE,EAAEiwB,QAAQ7gB,GAAGA,EAAE,CAACmf,EAAE70B,KAAK0V,GAAGA,EAAEpP,EAAEoP,GAAGvgB,SAAS0C,KAAK,IAAI,SAASu+B,EAAE9vB,GAAG,OAAOA,EAAEA,EAAEyK,QAAQ,OAAO,KAAKA,QAAQ,QAAQ,MAAM,KAA2G,SAAS+kB,EAAE3vB,GAAG,IAAYiwB,EAAEtQ,EAAOrvB,EAAE+P,EAAE5Q,EAArBqQ,EAAE,IAAIG,EAAM2uB,EAAE,GAAS,IAAIt+B,EAAE,EAAE+P,EAAEL,EAAErB,OAAOrO,EAAE+P,EAAE/P,IAAK,GAAuB,KAAnB2/B,EAAEjwB,EAAE1P,IAAI+/B,SAAZ,CAAgE,IAAI5gC,GAAlCkwB,EAAEsQ,EAAEK,qBAAqB,MAAa3xB,OAAO,EAAElP,GAAG,EAAEA,IAAIkgC,EAAEhQ,EAAElwB,IAAIkgC,EAAEM,GAAG,SAASN,EAAEhQ,GAAG,IAAItf,EAAM4vB,EAAE3/B,EAAEq/B,EAARlgC,EAAEkwB,EAAQ,GAAGgQ,EAAEhQ,EAAE4Q,aAAavgB,GAAG,CAAC,KAAMvgB,EAAE+gC,YAAwC,KAA3B/gC,EAAEA,EAAE+gC,YAAYH,YAAgBhwB,EAAE5Q,EAAE8gC,aAAavgB,MAAQ3P,IAAIsvB,IAAGlgC,EAAEA,EAAE+gC,WAAwB,KAAb/gC,EAAE4gC,SAAc,EAAE5gC,EAAE8gC,aAAavgB,IAAI,EAAE,GAAO1f,EAAEif,EAAEogB,OAAYr/B,EAAEu+B,EAATv+B,EAAEqP,EAAEgwB,GAASpgB,EAAE9f,IAAIkQ,EAAElQ,GAAG,MAAK,IAAQ+D,MAAMm7B,EAAEpf,EAAEof,GAAGr+B,GAAE2P,GAAGD,EAAE2vB,IAAGhQ,EAAE8Q,gBAAgBzgB,QAAW/P,IAAI3P,EAAE6P,EAAEiU,KAAKuL,EAAE,eAAc3f,EAAE1P,EAAEkD,KAAK+b,EAAEjf,EAAEkD,KAAKlD,EAAoCb,GAAlCA,EAAE0Q,EAAEiU,KAAKuL,EAAE6Q,WAAW,aAAgB/gC,EAAE+D,IAAI,GAAE,GAAGlD,EAAE,CAAK,IAAJ2/B,EAAE3/B,EAAQ2/B,GAAGA,EAAEz8B,KAAK/D,GAAGwgC,EAAEhB,MAAM55B,KAAKsqB,GAAGsQ,EAAEA,EAAEjB,cAAc1+B,EAAEo/B,aAAap/B,EAAEw+B,MAAM3uB,EAAEiU,KAAKuL,EAAE,WAAWrvB,GAAG,SAAS0P,EAAEG,GAAS7P,EAAEs+B,EAARzuB,GAAIL,GAAS8uB,EAAEzuB,IAAI0uB,EAAEv+B,EAAEif,EAAEjf,EAAE0+B,OAAOx7B,IAAIsM,IAAIxP,EAAE0+B,OAAO,MAAK,KAAQ,SAAS9uB,EAAEC,EAAE6P,EAAE/P,EAAEsP,GAAG,IAAIpP,EAAE,OAAOyuB,EAAEv0B,MAAMu0B,EAAEv5B,KAAK,CAACnI,EAAEiT,EAAE4uB,KAAK/e,EAAE1a,KAAK/C,KAAK6hB,KAAKnU,EAAEc,QAAQwO,IAAI,SAAS6f,EAAEpf,EAAE/P,EAAEsP,GAAG,OAAOpP,EAAE4uB,KAAK5uB,EAAEuwB,SAAS1gB,GAAG/P,EAAEsP,EAAEhd,MAAM,SAAS+8B,EAAE/f,EAAES,GAAG,IAAI/P,EAAEsP,EAAExO,SAAS,GAAe,OAAZd,EAAE0wB,QAAQ3gB,EAAS7P,EAAE4uB,KAAK5uB,EAAEuwB,SAASnhB,EAAEwf,MAAMxf,EAAE6E,KAAKnU,EAAEsP,EAAEja,MAAM,SAASi6B,EAAEvf,EAAE/P,GAAG,IAAIsP,EAAEhd,KAAKu8B,MAAM,OAAO3uB,EAAE8I,IAAI9I,EAAEA,EAAEiwB,QAAQ7gB,GAAGA,EAAE7d,KAAK,IAAI6d,GAAG1C,OAAOmD,GAAG,MAAK,SAAS7P,GAAG,OAAOF,EAAEE,EAAEywB,WAAWzwB,EAAE0wB,YAAY1wB,EAAE2wB,WAArtC,SAAWvhB,GAAG,IAAIpP,EAAE5Q,SAASC,cAAc,OAAwC,OAAjC2Q,EAAExQ,YAAY4f,EAAEwhB,WAAU,IAAc5wB,EAAErQ,UAAooC+X,CAAE1H,MAAK,SAASJ,IAAI,IAAIwP,EAAEhd,KAAK08B,MAAM9uB,EAAE4uB,KAAK,KAAK,KAAK,KAAKx8B,MAAMy+B,aAAazhB,EAAE,IAAIpP,EAAEoP,GAAG0hB,SAA/9K9wB,EAAE+wB,KAAK,CAACC,SAAS,SAASC,UAAU,UAAUJ,aAAa,SAASK,YAAY,QAAQC,WAAW,gBAAe,SAAS3xB,EAAEqQ,GAAG7P,EAAEquB,GAAG7uB,GAAG,SAASG,GAAG,IAAgBmwB,EAAEtB,EAAEgB,EAAEf,EAAlBC,EAAE,GAAGp/B,EAAE0Q,EAAEL,GAAW6f,EAAgB,IAAdptB,KAAKoM,QAAYpM,KAAK,GAAGi+B,WAAmB,GAARlgC,EAAEif,GAAG,GAAMoQ,GAAgB,KAAbA,EAAE0Q,UAAqC,IAAtB1Q,EAAEkQ,WAAWlxB,QAAuB,IAAXlP,EAAEkP,OAAYlP,EAAEugB,GAAGzd,KAAK,IAAIs8B,EAAEt8B,SAAS,CAAC,IAAIo8B,EAAE,EAAEgB,EAAElgC,EAAEkP,OAAOgwB,EAAEgB,EAAEhB,IAAK1uB,EAAE0uB,EAAEsB,GAAGtB,EAAE,EAAEp8B,KAAK0xB,OAAM,GAAM1xB,MAAMwS,MAAM5E,EAAEquB,GAAGxe,GAAG5J,MAAMjG,EAAE1Q,EAAEk/B,IAAIsB,GAAGpB,EAAEA,EAAE9hB,OAAOkjB,GAAGhwB,EAAE,EAAE4uB,EAAEt8B,KAAKg/B,UAAU1C,EAAElvB,EAAElQ,EAAE6Y,UAAwC,OAA9BsmB,EAAEt+B,EAAEA,EAAE,KAAK6P,EAAE4uB,KAAK9J,SAAS2J,GAAUC,MAAK1uB,EAAEquB,GAAGiB,OAAO,CAACV,KAAK,SAAS/e,EAAE/P,EAAEsP,GAAG,OAAOpP,EAAE4uB,KAAKx8B,KAAK,GAAGyd,EAAE/P,EAAEsP,IAAIiiB,SAAS,WAAW,OAAOrxB,EAAEqxB,SAASj/B,KAAK,KAAKm+B,SAAS,SAASnhB,GAAG,OAAOpP,EAAEuwB,SAASnhB,EAAEhd,KAAK,KAAKk8B,SAAS,SAASze,EAAE4e,EAAEjP,GAAG,GAAG3P,EAAE,IAAIA,EAAE,GAAGqgB,SAAS,CAA+C,IAA9C,IAA4C1B,EAAxChvB,EAAEQ,EAAEyvB,UAAUz5B,WAAW04B,EAAE7e,EAAErR,OAAOlP,EAAE,EAAUA,EAAEo/B,KAAKF,EAAExuB,EAAEiU,KAAKpE,EAAEvgB,KAAK,eAAiBo/B,EAAE,IAAElvB,EAAE,GAAG,CAACQ,EAAEyvB,UAAU5f,KAAO2e,GAAG1uB,IAAEN,EAAE,GAAG,SAAS4P,GAAGpP,EAAE4uB,KAAK0C,WAAWl/B,KAAKgd,EAAEoQ,KAAIvqB,EAAEgR,MAAM7T,KAAKoN,QAAQvK,EAAEgR,MAAM7T,KAAK4D,WAAsC,OAA3B8J,EAAE,GAAG3P,GAAG6P,EAAE4uB,KAAK9J,SAAS1V,GAAUhd,QAAQ4N,EAAEsvB,OAAO,CAACV,KAAK,SAAS/e,EAAE2e,EAAEr+B,EAAE2P,GAAG,IAAI0f,EAAEsQ,GAAGhwB,EAAE,GAAGgwB,EAAGhwB,EAAEI,EAAE2P,EAAE7P,EAAEuwB,SAAS1gB,IAAI7P,EAAEuwB,SAAS,KAAK1gB,GAAGrQ,EAAE,QAAQ,IAAIqQ,EAA4D,OAAzDA,EAAE/P,EAAE8uB,KAAKxf,EAAEtP,EAAEzM,KAAKyM,EAAEA,EAAEgvB,MAAM,GAAGhvB,EAAE0wB,SAAS7wB,EAAEG,EAAEA,EAAE0wB,SAAgBxwB,EAAE1Q,EAAEwQ,EAAE,KAAKA,EAAE8uB,KAAK5uB,EAAEF,KAAK,OAAI+P,GAAyB,mBAAJ2e,IAAeA,EAAEA,EAAEruB,KAAKL,GAAG,KAAI3P,GAAGA,EAAEqgC,SAAS7wB,EAAExP,EAAEA,EAAEqgC,SAAShR,EAAExf,EAAEiwB,QAAQzB,GAAGxuB,EAAE8I,IAAI0lB,GAAE,SAASxuB,GAAG,OAAOA,EAAE0uB,EAAEv+B,EAAE2P,EAAE+P,EAAE7P,GAAG,QAAO,CAAC0uB,EAAEv+B,EAAE2P,EAAE+P,EAAE2e,IAAWsB,EAAE9vB,EAAE1Q,EAAEwQ,EAAE,KAAK0f,IAAIA,GAA5K,IAA+K6R,SAAS,SAASjiB,GAAG,IAAItP,EAA2B,IAAtBsP,aAAapP,IAAEoP,EAAEA,EAAE,IAASA,GAAgB,IAAbA,EAAE8gB,YAAgBpwB,EAAEE,EAAEiU,KAAK7E,EAAE,eAAeA,EAAEA,EAAEihB,cAAa,OAAOvwB,GAAGI,GAAGqwB,SAAS,SAASzwB,EAAEsP,GAAG,OAAGA,GAAiB,iBAAJA,EAAaA,EAAEvP,EAAEuP,GAAWA,aAAapP,IAAEoP,EAAEA,EAAE,IAAI,IAAMA,EAAE8gB,WAAS9gB,EAAEpP,EAAEiU,KAAK7E,EAAE,SAASpP,EAAEiU,KAAK7E,EAAE,OAAOvP,EAAEuP,EAAEzf,aAA8B,iBAAJmQ,EAAcE,EAAEuwB,SAASzwB,GAAGsP,EAAGA,GAAStP,EAAa,iBAAJA,EAAaE,EAAEuwB,SAAS,KAAKzwB,GAAGE,EAAEuwB,SAASzwB,IAAIE,EAAEuwB,SAAS,KAAKhC,EAAE70B,KAAKoG,GAAGA,EAAEE,EAAEF,IAAI,MAAMyxB,OAAO,SAASvxB,GAAG,OAAO,GAAGA,GAAG/F,MAAM,KAAK1I,KAAK,QAAQ0I,MAAM,KAAK1I,KAAK,QAAQ0I,MAAM,KAAK1I,KAAK,SAAS0I,MAAM,KAAK1I,KAAK,YAAYyO,EAAEsvB,OAAOtvB,EAAE4uB,KAAK,CAACgB,IAAI,CAAChB,KAAK,CAACiB,SAAS,CAACG,GAAG,QAAQwB,KAAK,kDAAkDtC,KAAK,CAACW,SAAS,CAACG,GAAG,QAAQwB,KAAK,6BAA6BvJ,MAAM,2DAA2D8I,KAAK,CAAClB,SAAS,CAACG,GAAG,kBAAkBwB,KAAK,qDAAqDvJ,MAAM,SAASwJ,GAAK,CAACD,KAAK,2BAA2BvJ,MAAM,KAAKyJ,KAAO,CAAC7B,SAAS,CAACE,GAAG,QAAQyB,KAAK,kCAAkC3iC,KAAK,CAAC2iC,KAAK,gCAAgCG,IAAI,CAAC9B,SAAS,CAACE,GAAG,SAASyB,KAAK,0CAA0CI,IAAI,CAACJ,KAAK,KAAK1M,SAAS,WAAW1V,EAAE,IAAIkiB,WAAW,SAAS9xB,EAAE4P,EAAES,GAAG,IAAI1f,EAAe,KAAbif,EAAE8gB,SAAclwB,EAAEyvB,UAAUrgB,EAAEsgB,YAAyB,IAAbtgB,EAAE8gB,SAAa,CAAC9gB,GAAG,GAAGS,EAAE1P,KAAKX,EAAE4P,GAAGogB,EAAEr/B,GAAG2P,OAAj+F,CAAg3L+xB;ACAh3L,aAEA,IAAIC,UAAY,yDAEZC,MAAQ,WAEX,IAAIC,EAA2B,SAAkC7pB,GAChE,IAAI8pB,EAAWjhC,EAAEmX,GACjB,GAAI8pB,EAASzzB,QAAU,IAAMyzB,EAAS,GAAI,OAAO,EACjDA,EAASC,QAAQ,CAAEC,UAAWF,EAAS,GAAGG,cAAgB,CAAEC,SAAU,IAAKC,OAAO,KAG/EC,EAAgB,SAAuBC,GAC1C,IAAK1jC,OAAO2jC,MAAQ3jC,OAAO2jC,IAAIC,aAAc,OAAO,KACpD,IAAIx/B,EAASpE,OAAO2jC,IAAIC,aAAaC,oBAAoBjmB,QAAO,SAAiBkmB,GAChF,OAAOA,EAAKJ,SAAWA,KAGxB,OADWt/B,EAAOsL,OAAS,EAAItL,EAAO,GAAK,MAIxC2/B,EAAU,SAAiBC,GAC9B,OAAOA,EAAKn7B,WAAW9F,cAAcujB,OAAO3K,QAAQ,OAAQ,KAC3DA,QAAQ,KAAM,SACdA,QAAQ,YAAa,IACrBA,QAAQ,QAAS,KACjBA,QAAQ,MAAO,IACfA,QAAQ,MAAO,KAGbsoB,EAAkB,WACrB,OAAO/hC,EAAE5B,UAAU8B,KAAK,4BAA4BjC,YA0BrD,IA4CI+jC,EAAY,GAEZC,EAAa,CAChB/lC,OAAQ,GACRgmC,GAAI,SAAYC,EAAW9E,GAC1Bj8B,KAAKlF,OAAOimC,GAAa/gC,KAAKlF,OAAOimC,IAAc,GACnD/gC,KAAKlF,OAAOimC,GAAWj+B,KAAKm5B,IAE7B+E,IAAK,SAAaD,EAAW9E,GAC5B,GAAIj8B,KAAKlF,OAAOimC,GACf,IAAK,IAAI7jC,EAAI,EAAGA,EAAI8C,KAAKlF,OAAOimC,GAAW30B,OAAQlP,IAClD,GAAI8C,KAAKlF,OAAOimC,GAAW7jC,KAAO++B,EAAI,CACrCj8B,KAAKlF,OAAOimC,GAAWhsB,OAAO7X,EAAG,GACjC,QAKJ+jC,KAAM,SAAcF,GACnB,IAAK,IAAIG,EAAOt9B,UAAUwI,OAAQyV,EAAO/L,MAAMorB,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAGA,EAAOD,EAAMC,IAC/Ftf,EAAKsf,EAAO,GAAKv9B,UAAUu9B,GAGxBnhC,KAAKlF,OAAOimC,IACf/gC,KAAKlF,OAAOimC,GAAWlgC,SAAQ,SAAUo7B,GACxCA,EAAGpoB,WAAMtF,EAAWsT,QAMpBuf,EAAe,CAClBC,KAAM,SAAcljC,EAAUmjC,GAC7B,IAAIC,EAAoBC,WAAWC,OAAOF,mBAAqB,EAC3D1B,EAAWc,IAAkB7hC,KAAK,qBAAuBX,EAAW,wBACxE0hC,EAAS/gC,KAAK,WAAW4/B,SACzBmB,EAASpD,SAASx9B,IAAI,CAAEyiC,KAAMC,UAAUC,eAAe/B,EAASpD,UAAY,OAC5E7+B,OAAOmD,KAAKugC,GAAMzgC,SAAQ,SAAyBI,EAAKjC,GACvD,IAAI6iC,EAAa1B,EAAcmB,EAAKrgC,GAAKm/B,SAAW,CAAE0B,QAAS,GAAI7+B,KAAM,aACtE4+B,EAAWzB,SAEToB,WAAWO,iBAAmBP,WAAWO,gBAAgBF,EAAWzB,UACvEV,UAAY8B,WAAWO,gBAAgBF,EAAWzB,QAAQ4B,UAAYR,WAAWO,gBAAgBF,EAAWzB,QAAQ6B,KAEjHjjC,EAAQuiC,GACX1B,EAAS/gC,KAAK,eAAeojC,OAC7BrC,EAAShhC,OAAO,gCAAkCgjC,EAAWzB,OAAS,eAAiBV,UAAY,aAEnGG,EAAS/gC,KAAK,eAAeqjC,OAAOzB,KAAK,KAAO1hC,EAAQ,EAAIuiC,SAKhEa,KAAM,SAAcjkC,EAAUmjC,GAC7B,IAAIzB,EAAWjhC,EAAE5B,UAAU8B,KAAK,6CAChC+gC,EAAS/gC,KAAK,WAAW4/B,SACzB1+B,KAAKnB,OAAOyiC,EAAKe,KAAMxC,IAExByC,MAAO,SAAenkC,EAAUmjC,GAC/B,IAAIzB,EAAWjhC,EAAE5B,UAAU8B,KAAK,qCAChC+gC,EAAS/gC,KAAK,WAAW4/B,SACzB1+B,KAAKnB,OAAOyiC,EAAKe,KAAMxC,IAExBhhC,OAAQ,SAAuBwjC,EAAMxC,GACpC,IAAI0B,EAAoBC,WAAWC,OAAOF,mBAAqB,EAC/Dc,EAAKxhC,SAAQ,SAAyB0hC,EAAIvjC,GACzC,IAAI6iC,EAAa1B,EAAcoC,EAAGnC,SAAW,CAAE0B,QAAS,GAAI7+B,KAAM,aAC/D4+B,EAAWzB,SACToB,WAAWO,iBAAmBP,WAAWO,gBAAgBF,EAAWzB,UACvEV,UAAY8B,WAAWO,gBAAgBF,EAAWzB,QAAQ4B,UAAYR,WAAWO,gBAAgBF,EAAWzB,QAAQ6B,KAEjHjjC,EAAQuiC,GACX1B,EAAS/gC,KAAK,eAAeojC,OAC7BrC,EAAShhC,OAAO,gCAAkCgjC,EAAWzB,OAAS,eAAiBV,UAAY,aAEnGG,EAAS/gC,KAAK,eAAeqjC,OAAOzB,KAAK,KAAO1hC,EAAQ,EAAIuiC,UAuFjE,OAhFAV,EAAWC,GAAG,gBAAgB,SAAU0B,EAAarkC,EAAUuvB,EAAQ5T,EAAQ2oB,EAAUjiC,GACxF,KAAKgiC,GAAgBrkC,GAAauvB,GAAW+U,GAAa3oB,GAAQ,OAAO,EAErE8mB,EAAUziC,KAAWyiC,EAAUziC,GAAY,IAC3CyiC,EAAUziC,GAAUukC,QAAO9B,EAAUziC,GAAUukC,MAAQ,IAE3D,IAAIC,EAAQ/B,EAAUziC,GAAUukC,MAChC9B,EAAUziC,GAAU2b,GAAU2oB,EAI9BE,EAAQ,GAER/B,EAAUziC,GAAUikC,KAAKC,KAAKxhC,SAAQ,SAAU0hC,GAC1CI,EAAMJ,EAAGnC,UAASuC,EAAMJ,EAAGnC,QAAU,IAC1CuC,EAAMJ,EAAGnC,QAAUmC,KAGpB3B,EAAUziC,GAAUmkC,MAAMD,KAAKxhC,SAAQ,SAAU0hC,GAC3CI,EAAMJ,EAAGnC,UAASuC,EAAMJ,EAAGnC,QAAU,IAC1CuC,EAAMJ,EAAGnC,QAAUmC,KAGpBnB,EAAatnB,GAAQ3b,EAAUyiC,EAAUziC,GAAU2b,IACnDsnB,EAAaC,KAAKljC,EAAUwkC,GAExBniC,GAAUA,EAASogC,EAAUziC,OAGlC0iC,EAAWC,GAAG,wBAAwB,SAA4B3iC,EAAUykC,EAAS9oB,GACpF,IAAI+oB,EAAelC,IAAkB7hC,KAAK,IAAMX,GAE5C2kC,EAAYD,EAAa/jC,KAAK,gCAC9BikC,EAAWF,EAAa/jC,KAAK,+BAC7BkkC,EAAWH,EAAa/jC,KAAK,+BAElB,SAAXgb,GAAgC,UAAXA,IAExB+oB,EAAa/jC,KAAK,wBAA0Bgb,EAAS,MAAMta,KAAK,YAAY,GAC5EwjC,EAASxjC,KAAK,YAAY,IAGZ,SAAXsa,IAEHipB,EAASvjC,KAAK,YAAY,GAC1BsjC,EAAUtjC,KAAK,YAAY,GAC3BwjC,EAASxjC,KAAK,YAAY,OAI5BqhC,EAAWC,GAAG,uBAAuB,SAA2B3iC,EAAUuvB,EAAQ5T,GACjF,IAAI+oB,EAAelC,IAAkB7hC,KAAK,IAAMX,GAC5C8kC,EAAuB,SAAXvV,EAAoB,QAAU,OAE1CoV,EAAYD,EAAa/jC,KAAK,gCAC9BikC,EAAWF,EAAa/jC,KAAK,+BAC7BkkC,EAAWH,EAAa/jC,KAAK,+BAElB,SAAXgb,GAAgC,UAAXA,IAExB+oB,EAAa/jC,KAAK,wBAA0Bgb,EAAS,MAAMopB,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,GAE/GwjC,EAASE,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,IAG/C,aAAXsa,IAEHipB,EAASG,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,GAC7DsjC,EAAUI,KAAK,CAAEC,cAAeF,KAGlB,SAAXnpB,IAEHipB,EAASG,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,GAC7DsjC,EAAUI,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,GAC9DwjC,EAASE,KAAK,CAAEC,cAAeF,IAAazjC,KAAK,YAAY,OAKxD5B,OAAOC,OAAO,CACpBgjC,WAAAA,EACAD,UAAAA,EACAwC,eAlLoB,SAAwBX,EAAU1sB,GACtD,IAAK0sB,EAASJ,KAAM,OAAO,EAC3B,IAAIxC,EAA+B,iBAAb9pB,EAAwBnX,EAAE5B,UAAU8B,KAAKiX,GAAYA,EAC3E8pB,EAASwD,QACTZ,EAASJ,KAAKxhC,SAAQ,SAAyB0hC,GAC9C,IAAIV,EAAa1B,EAAcoC,EAAGnC,SAAW,CAAE0B,QAAS,GAAI7+B,KAAM,YAAam9B,OAAQ,WACnFoB,WAAWO,iBAAmBP,WAAWO,gBAAgBQ,EAAGnC,UAC/DV,UAAY8B,WAAWO,gBAAgBQ,EAAGnC,QAAQ4B,UAAYR,WAAWO,gBAAgBQ,EAAGnC,QAAQ6B,KAErGpC,EAAShhC,OAAO,eAAiB0jC,EAAGnC,OAAS,yBAA2ByB,EAAWC,QAAU,mCAAqCpC,UAAY,WAAamC,EAAW5+B,KAAO,aA0K9KqgC,kBA/LuB,WACvB3C,IAAkB7hC,KAAK,kBAAkB6/B,MAAK,SAAU3/B,EAAOqrB,GAC9D,IAAIkZ,EAAa3kC,EAAEyrB,GAAK6Y,KAAK,aACzBM,EAAc5kC,EAAEyrB,GAAK6Y,KAAK,cAC1BK,GAAcC,EACjB5kC,EAAEyrB,GAAKvrB,KAAK,0BAA0BM,SAAS,UAE/CR,EAAEyrB,GAAKvrB,KAAK,0BAA0BC,YAAY,cAyLpD0kC,oBAnNyB,SAA6B3pB,EAAQ4pB,EAAKhW,GACnE,IAEIiW,EAAU,0CAA4C7pB,EAAS,iCAAmC4pB,EAAIvlC,SAAW,kBAAoBulC,EAAIE,YAAc,UAEvJlD,EAAkB,SAAXhT,EAAoB,QAAU,SAEzC,GAAe,UAAX5T,EAAoB,CACvB,IAAI+pB,EAAc,4BAA8BH,EAAII,UAAY,IAAMJ,EAAIK,eAAiB,WAC3FL,EAAIhD,KAAO,SAAWA,EAAX,0gBAA0CiD,EAAUE,MAC1C,SAAX/pB,IACV4pB,EAAIhD,KAAO,SAAWA,EAAX,8bAAyCiD,GAGrDD,EAAI5pB,OAASA,EAjCd,SAA4B4pB,GAC3B,IAAIM,EAAc,UAAYN,EAAItD,OAAO/nB,QAAQ,cAAc,SAAiB3K,GAC/E,MAAU,MAANA,EAAkB,IACf,IAAMA,EAAEu2B,WAAW,GAAK,OAI5BC,EAAU,GAAK,IAAIC,KAAKT,EAAIU,MAAMC,aAClCC,EAAQ,GAAK,IAAIH,KAAKT,EAAIU,MAAMG,WACb,IAAnBL,EAAQ93B,SAAc83B,EAAU,IAAMA,GACrB,IAAjBI,EAAMl4B,SAAck4B,EAAQ,IAAMA,GACtC,IAAIE,EAAUF,EAAQ,IAAMJ,EAExBznC,EAAO,mBAAqBinC,EAAI5pB,OAAS,cAAgB4pB,EAAIvlC,SAAW,oBAAsBulC,EAAItD,OAAS,sBAAwBsD,EAAIvnC,OAAS,IAAM6nC,EAAc,QAAUN,EAAIe,SAAW,yBAA2BT,EAAc,KAAOQ,EAAU,WAAad,EAAIhD,KAAO,OAEnR9hC,EAAE5B,UAAU8B,KAAK,sBAAsBD,OAAOpC,GAC9CmjC,EAAyB,sBAmBzB8E,CAAmBhB,IAoMnBiB,gBA3OqB,SAAyBpoC,EAAcqoC,GAC5D,OAAOloC,OAAO6H,SAASsgC,OAASnoC,OAAO6H,SAASugC,SAAW,WAAarE,EAAQmE,GAAc,aAAeroC,EAAe,mBA2O5HokC,gBAAAA,EACAF,QAAAA,EACAb,yBAAAA,EACAO,cAAAA,IA7QU;ACJZ,aAEA,IAAI4E,SAAWnqC,QAAQ,wCAAwCmqC,SAE3DC,SAAW,WACd,IAAIC,EAAS,KACTC,EAAQ,KACRC,EAAc,GACdC,EAAW,KAEf,SAASC,EAAuB3B,GAC/B,IAAKA,IAAQyB,EAAY/E,OAAQ,OAAO,EAKxC,IAAI8D,EAAU,GAAK,IAAIC,KAAKT,EAAIU,MAAMC,aAClCC,EAAQ,GAAK,IAAIH,KAAKT,EAAIU,MAAMG,WACb,IAAnBL,EAAQ93B,SAAc83B,EAAU,IAAMA,GACrB,IAAjBI,EAAMl4B,SAAck4B,EAAQ,IAAMA,GACtC,IAAIE,EAAUF,EAAQ,IAAMJ,EAExBO,EAAW7lC,EAAE,OAAO8hC,KAAKgD,EAAIe,SAAW,MACxCa,EAAM1mC,EAAE,UAAUskC,KAAK,CAAEqC,MAAS,SAAU7E,KAAK8D,GAEjD9D,EAAOqE,SAASS,6BAA6B9B,EAAIhD,KAAM,UAgBvDt/B,EAAUxC,EAAE,OAAOskC,KAAK,CAC3BuC,gBAAiB/B,EAAIgC,SACnB7mC,OAAO4lC,GAAU5lC,OAAOymC,GAAKzmC,OAAO6hC,GAEvC9hC,EAAE,kBAAkBC,OAAOuC,GAC3Bu+B,MAAMC,yBAAyB,kBAgBhC,SAAS+F,IAGR,GAAgB,MAFFnyB,MAAMoyB,SAAWpyB,MAAMqyB,OAEjB,CACnB,IAAIC,EAAclnC,EAAEoB,MAAMqqB,MAC1B,IAAKyb,EAAa,OAAO,EACzBlnC,EAAEoB,MAAMqqB,IAAI,IACZ,IAAImW,EAAOb,MAAMQ,cAAcqB,WAAWpB,QAC1C,IAAII,EAAM,OAAO,EACjB,IAAIkD,EAAM,CAAEhD,KAAMoF,EAAarB,SAAUjE,EAAKv9B,KAAMyiC,OAAQlF,EAAKJ,OAAQgE,MAAM,IAAID,MAAO4B,WAC1Fd,EAAOhE,KAAK,kBAAmBiE,EAAOC,EAAYhnC,SAAUulC,GAAK,SAAyBsC,GACzFX,EAAuBW,OA6B1B,SAASC,EAAgB9nC,EAAUskC,GAClC,IAAIyD,EAAmBtnC,EAAE5B,UAAU8B,KAAK,yBAExConC,EAAiBnnC,YAAY,UAAUonC,WAAW,SAClDD,EAAiBpnC,KAAK,oBAAoB4/B,SAG1C,IAAI0H,EAAOxnC,EAAE5B,UAAU8B,KAAK,2CAC5BsnC,EAAKlD,KAAK,CAAEC,cAAe,aAC3BiD,EAAKtnC,KAAK,sBAAsBunC,SAChCD,EAAKtnC,KAAK,oBAAoBunC,SAG/B,SAASC,EAAcnoC,EAAUooC,EAAWzC,EAAWrB,GACtD,IAAKtkC,EAAU,OAAO,EACtB,IAAIqoC,EAAgB5nC,EAAE5B,UAAU8B,KAAK,yBACrC,GAAK0nC,EAAcp6B,OAQlBo6B,EAActD,KAAK,CAAEuD,UAAWtoC,IAAYW,KAAK,kCAAkCokC,KAAK,CAAEuD,UAAWtoC,IACrGqoC,EAAc1nC,KAAK,eAAe4hC,KAAK6F,OATb,CAC1B,IAAIG,EAAc9nC,EAAE,qBAAqB49B,KAAK,CAC7Cr+B,SAAUA,EACVooC,UAAWA,IAEZ3nC,EAAE,QAAQC,OAAO6nC,GAQlBpkC,YAAW,WACV1D,EAAE5B,UAAU8B,KAAK,yBAAyBM,SAAS,YACjD,KAEH6lC,EAAOnE,GAAG,sBAAwB3iC,GAAU,SAA4BwoC,EAAWjD,GAC9EiD,IAAcxoC,GACjBknC,EAAuB3B,MAIzBuB,EAAOhE,KAAK,kBAAmBiE,EAAO/mC,EAAU,IAAI,SAAyB0jB,GAC5EA,EAAKhhB,SAAQ,SAAU0hC,GACtB8C,EAAuB9C,SAIzB5C,MAAMyD,eAAeX,EAAU,gDAGhC,SAASmE,EAAc/kB,EAAM4gB,GAC5B,IAAK5gB,IAASA,EAAKue,OAAQ,OAAO,EAClC,IAAIjiC,EAAW0jB,EAAK1jB,SAChB0kC,EAAelD,MAAMgB,kBAAkB7hC,KAAK,IAAMX,GAClDooC,EAAY1D,EAAa/jC,KAAK,4BAA4B4hC,OAC1DoD,EAAYrB,EAASoE,QACzBhE,EAAa/jC,KAAK,kBAAkB4hC,KAAKoD,GAEzC,IAAItD,EAAOb,MAAMQ,cAActe,EAAKue,QAEpC,OAAKI,IAIeqC,EAAa/jC,KAAK,yCAA2C0hC,EAAKJ,OAAS,MAAMM,SAGrGf,MAAMyD,eAAeX,EAAUI,EAAa/jC,KAAK,8BACjD6gC,MAAMyD,eAAeX,EAAU,gDAiC3B5gB,EAAKue,SAAWoB,WAAWpB,SAC9B+E,EAActjB,EACdghB,EAAaK,KAAK,CAAE4D,aAAa,IACjCnH,MAAM2D,oBACNgD,EAAcnoC,EAAUooC,EAAWzC,EAAWrB,GAC9C9C,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,OAAQinC,SAGhEzF,MAAMkB,WAAWI,KAAK,eAAgBpf,EAAM1jB,EAAU,OAAQ,OAAQskC,GAAU,gBAGjF,SAASsE,EAAmBllB,EAAM4gB,EAAU3oB,EAAQvX,GACnD,IAAKsf,IAASA,EAAKue,OAAQ,OAAO,EAClC,IAAIjiC,EAAW0jB,EAAK1jB,SAChB0kC,EAAelD,MAAMgB,kBAAkB7hC,KAAK,IAAMX,GAGlD2lC,GAFYjB,EAAa/jC,KAAK,4BAA4B4hC,OAE9C+B,EAASoE,SACzBhE,EAAa/jC,KAAK,kBAAkB4hC,KAAKoD,GAEzC,IAAIkD,EAAoBnE,EAAa/jC,KAAK,6BAE1C6gC,MAAMyD,eAAeX,EAAUuE,GAC/BrH,MAAMyD,eAAeX,EAAU,+CAEb,IAAdqB,GACHkD,EAAkBnoC,OAAO,4GAA8GV,EAAW,qDA0B/I0jB,EAAKue,SAAWoB,WAAWpB,SAC9ByC,EAAasD,WAAW,aACxBxG,MAAM2D,oBACN6B,EAAc,GACdc,EAAgBpkB,EAAK1jB,UACrBwhC,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IAGjEzF,MAAMkB,WAAWI,KAAK,eAAgBpf,EAAM1jB,EAAU,QAAS,OAAQskC,GAAU,eAE7ElgC,GAAoB,mBAAPA,GAAmBA,IAmCrC,SAAS0kC,EAAsBC,EAAOC,EAAMrtB,GAC3C,IAAIstB,EAAY,GAEhBxpC,OAAOmD,KAAKmmC,GAAOrmC,SAAQ,SAAU1C,GACpC,IAAIskC,EAAW,CACdoE,QAASK,EAAM/oC,GAAUiO,OACzBi2B,KAAM6E,EAAM/oC,IAEbipC,EAAUjpC,GAAYskC,KAIvB7kC,OAAOmD,KAAKmmC,GAAOrmC,SAAQ,SAAU1C,GACpC+oC,EAAM/oC,GAAU0C,SAAQ,SAAU2/B,GACjCoG,EAAcpG,EAAM4G,EAAUjpC,UAejC,MAAO,CACNkpC,YAPD,SAAqBC,EAAMC,EAASC,EAAWC,GAC9CxC,EAASuC,EACTtC,EAAQuC,GAAS/qC,OAAO2jC,IAAIqH,WApP5B9oC,EAAE5B,UAAU8jC,GAAG,WAAY,+BAAgC6E,GAE3D/mC,EAAE5B,UAAU8jC,GAAG,QAAS,2CAA2C,WAClE,IAAIpT,EAAS9uB,EAAEoB,MAAMkjC,KAAK,eACtByE,EAAU/oC,EAAE,kBAAkBgpC,cAAgBhpC,EAAE,0BAA0BgpC,cAAgB,EAE9FhpC,EAAEoB,MAAMlB,KAAK,sBAAsBunC,SACnCznC,EAAEoB,MAAMlB,KAAK,oBAAoBunC,SAElB,aAAX3Y,GACH9uB,EAAEoB,MAAMkjC,KAAK,CAAEC,cAAe,WAC9BvkC,EAAE,yBAAyBK,IAAI,CAC9B4oC,UAAW,mBAAqBF,EAAU,UAG3C/oC,EAAEoB,MAAMkjC,KAAK,CAAEC,cAAe,aAC9BvkC,EAAE,yBAAyBK,IAAI,CAC9B4oC,UAAW,4BAyOdvB,cAAeA,EACfL,gBAAiBA,EACjB6B,SAjED,SAAkB3pC,EAAU4pC,EAAUC,GACrC,OAAKD,GAAaA,EAAS3H,OAMvB+E,GAAeA,EAAYhnC,WAAaA,GAC3CwhC,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IACzD,IAGRA,EAAW4C,EAEXrI,MAAMgB,kBAAkB7hC,KAAK,gCAAgCC,YAAY,eAEpEomC,EAAY/E,OAGhB6E,EAAOhE,KAAK,YAAaiE,EAAOC,EAAa,QAAQ,SAAmBtjB,EAAM4gB,EAAU3oB,GACvFitB,EAAmBllB,EAAM4gB,EAAU,GAAQ,WAC1CwC,EAAOhE,KAAK,WAAYiE,EAAO6C,EAAU,OAAQnB,SAJnD3B,EAAOhE,KAAK,WAAYiE,EAAO6C,EAAU,OAAQnB,MAfjDjH,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IACzD,IA+DR6C,UAvCD,SAAmB9pC,EAAU4pC,EAAUC,GACtC5C,EAAW4C,EACX/C,EAAOhE,KAAK,YAAaiE,EAAO6C,EAAU,OAAQhB,IAsClDA,mBAAoBA,EACpBH,cAAeA,EACfsB,gBAlBD,SAAyBC,GACxBlD,EAAOhE,KAAK,kBAAmBiE,EAAOiD,EAAU,OAAQlB,KA1T3C;ACJf,aAGA,IAAImB,UAAY,WACf,IAAInD,EAAS,KACTC,EAAQ,KACRC,EAAc,GACdkD,EAAc,KACdtE,EAAiB,EACjBqB,EAAW,KAmCf,SAASkD,EAAcr7B,EAAQmzB,GAC1BnzB,IACHA,EAAO2G,YAAY/S,SAAQ,SAAoBiL,GAC9CA,EAAMqT,UAEPlS,EAAS,MAsEX,SAAS25B,EAAc/kB,EAAM4gB,GAC5B,IAAK5gB,IAASA,EAAKue,OAAQ,OAAO,EAClC,IAAIjiC,EAAW0jB,EAAK1jB,SAChB0kC,EAAelD,MAAMgB,kBAAkB7hC,KAAK,IAAMX,GAClDylC,EAAcf,EAAa/jC,KAAK,4BAA4B4hC,OAE5DF,EAAOb,MAAMQ,cAActe,EAAKue,QAEpC,IAAKI,EAAM,OAAO,EAKlB,GADoBqC,EAAa/jC,KAAK,0CAA4C0hC,EAAKJ,OAAS,MAAMM,OACnF,OAAO,EAE1B,IAAIoD,EAAYrB,EAASoE,QAOzB,GANAhE,EAAa/jC,KAAK,mBAAmB4hC,KAAKoD,GAE1CllC,EAAE5B,UAAU8B,KAAK,qDAAqD4hC,KAAKoD,GAE3EnE,MAAMyD,eAAeX,EAAUI,EAAa/jC,KAAK,+BAE/B,QAAf+iB,EAAK6L,OAAiB,CAExB,IAAIgW,EAAM,CACTU,KAAM,IAAID,KACV/D,OAAQve,EAAKue,OACbqE,SAAUjE,EAAKv9B,MAAQ4e,EAAK5e,MAAQ,YACpC9E,SAAU0jB,EAAK1jB,SACf2lC,UAAWA,EACXF,YAAaA,EACbG,eAAgBA,GAGjBpE,MAAM8D,oBAAoB,QAASC,EAAK,QAarC7hB,EAAKue,SAAWoB,WAAWpB,SAC9ByC,EAAaK,KAAK,CAAEqF,cAAc,IAClC5I,MAAM2D,oBAEN1kC,EAAE,mBAAmBskC,KAAK,CAAEuD,UAAW5kB,EAAK1jB,WAAYuiC,KAAKkD,GAC7DhlC,EAAE,kCAAkCskC,KAAK,CAAEuD,UAAW5kB,EAAK1jB,WAE3DzB,OAAOyB,SAAW0jB,EAAK1jB,SACvBqqC,KAAKC,SAAS5mB,EAAK1jB,SAAUqiC,EAAKJ,QAClC+E,EAActjB,EAEdjjB,EAAE,WAAW8pC,QAAQ,yBAA2B9E,EAAc,SAE9DhlC,EAAE,eAAeK,IAAI,CACpB4oC,UAAW,qBACXc,QAAS,IACPzF,KAAK,CAAE0F,eAAe,IAEzBjJ,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,OAAQinC,GAE/DH,EAAOnE,GAAG,sBAAwB3iC,GAAU,SAA4BwoC,EAAWjD,GAClF,IAAImF,EAASjqC,EAAE5B,UAAU8B,KAAK,yBAAyBgqC,SAAS,UAC5DnC,IAAcxoC,GAAa0qC,GAC9B7D,SAAS8C,SAAS3pC,EAAU0jB,EAAM,YAMrC8d,MAAMkB,WAAWI,KAAK,eAAgBpf,EAAM1jB,EAAU,OAAQ,QAASskC,GAAU,eAGlF,SAASsG,EAAc5qC,EAAU6qC,EAAUhB,GAC1CrI,MAAMgB,kBAAkB7hC,KAAK,gCAAgCC,YAAY,UACzEqmC,EAAW4C,EAlJJtrC,OAAO8G,UAAUiJ,aAAa/I,aAAa,CAAE5B,OAAO,EAAMC,OAAO,IAmJjDW,MAAK,SAAiBuK,GAG5C,GAFAo7B,EAAcp7B,GAETk4B,EAAY/E,OAChB,OAAO6E,EAAOhE,KAAK,WAAYiE,EAAO8D,EAAU,QAASC,GAG1DhE,EAAOhE,KAAK,YAAaiE,EAAOC,EAAa,SAAS,SAAmB+D,EAAWzG,GACnF0G,EAAkBD,EAAWzG,GAAU,WACtCwC,EAAOhE,KAAK,WAAYiE,EAAO8D,EAAU,QAASC,YAG3C,OAAE,SAAU9xB,GACrBjW,QAAQC,MAAMgW,GACdwoB,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,GAChEH,EAAOhE,KAAK,YAAaiE,EAAOC,EAAa,SAAS,SAAmB+D,EAAWzG,GACnF0G,EAAkBD,EAAWzG,MAE9B+F,KAAKY,mBAAmBjyB,MAkC1B,SAASkyB,EAAqB5G,EAAU6G,EAAWC,GAClD,SAAI9G,GAAYA,EAASoE,SAAW9C,MAEpCuF,EAAYA,IAAa,KACPC,GACjB3qC,EAAE4qC,QAAQC,IAAI,CACbC,MAAO,wBACPhJ,KAAM,sGAAwGqD,EAAiB,IAC/H4F,QAAQ,EACRC,WAAY,QACZxF,KAAM,UAID,GAGR,SAAS6C,EAAsBC,EAAOC,EAAMrtB,GAC3C,IAAIstB,EAAY,GAEhBxpC,OAAOmD,KAAKmmC,GAAOrmC,SAAQ,SAAsB1C,GAChD,IAAIskC,EAAW,CACdoE,QAASK,EAAM/oC,GAAUiO,OACzBi2B,KAAM6E,EAAM/oC,IAEbipC,EAAUjpC,GAAYskC,KAIvB7kC,OAAOmD,KAAKmmC,GAAOrmC,SAAQ,SAAU1C,GACpC+oC,EAAM/oC,GAAU0C,SAAQ,SAAU2/B,GACjCyI,EAAiBzI,EAAM4G,EAAUjpC,IAAW,SAuB/C,SAAS8qC,EAAiBpnB,EAAM4gB,EAAU6G,EAAWO,GACpD,OAAKhoB,EAEDA,GAAQwnB,EAAqB5G,EAAU6G,EAAWO,IAE3CA,EADHjD,EAAc/kB,EAAM4gB,GAIrB6F,EAAcD,GAPHgB,EAAqB,MAAM,GAAM,GAUpD,SAASF,EAAkBtnB,EAAM4gB,EAAUlgC,IAjQ3C,SAA4Bsf,EAAM4gB,EAAUlgC,GAC3C,IAAKsf,IAAS4gB,IAAa5gB,EAAKue,OAAQ,OAAO,EAC/C,IAAIjiC,EAAW0jB,EAAK1jB,SAChB0kC,EAAelD,MAAMgB,kBAAkB7hC,KAAK,IAAMX,GAClDylC,EAAcf,EAAa/jC,KAAK,4BAA4B4hC,OAC5DoJ,EAAqBjH,EAAa/jC,KAAK,8BAE3C6gC,MAAMyD,eAAeX,EAAUqH,GAE/B,IAAIhG,EAAYrB,EAASoE,QACzBhE,EAAa/jC,KAAK,mBAAmB4hC,KAAKoD,GAExB,IAAdA,GACHgG,EAAmBjrC,OAAO,6GAA+GV,EAAW,uDAGrJ,IAAIqiC,EAAOb,MAAMQ,cAActe,EAAKue,QAEpC,GAAGI,GAAwB,SAAhB3e,EAAK6L,QAAqC,WAAhB7L,EAAK6L,OAAqB,CAE9D,IAAIgW,EAAM,CACTU,KAAM,IAAID,KACV/D,OAAQve,EAAKue,QAAUI,EAAKJ,OAC5BqE,SAAU5iB,EAAK5e,MAAQu9B,EAAKv9B,MAAQ,YACpC9E,SAAU0jB,EAAK1jB,SACf2lC,UAAWA,EACXF,YAAaA,EACbG,eAAgBA,GAEjBpE,MAAM8D,oBAAoB,QAASC,EAAK,SAGrC7hB,EAAKue,SAAWoB,WAAWpB,SAC9ByC,EAAasD,WAAW,cACxBxG,MAAM2D,oBACNkF,KAAKuB,WAAWloB,EAAKue,OAAQve,EAAK1jB,UAClCzB,OAAOyB,SAAW,KAElBgnC,EAAc,GAEdvmC,EAAE,eAAeK,IAAI,CACpB4oC,UAAW,yBACXc,QAAS,IACPzF,KAAK,CAAE0F,eAAe,IAEzBN,EAAcD,GACdpD,EAAO+E,eAAe,sBAAwBnoB,EAAK1jB,WAGhDoE,GAAoB,mBAAPA,GAAmBA,IAEpCo9B,MAAMkB,WAAWI,KAAK,eAAgBpf,EAAM1jB,EAAU,QAAS,QAASskC,GAAU,eAElF9C,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,GAEhEoD,KAAKP,UAAUpmB,EAAKue,QA2MpB2G,CAAmBllB,EAAM4gB,EAAUlgC,GAWpC,MAAO,CACN8kC,YATD,SAAqBC,EAAMC,EAASC,EAAWC,GAC9CxC,EAASuC,EACTtC,EAAQuC,GAAS/qC,OAAO2jC,IAAIqH,WAC5B3D,EAAiBvC,WAAWC,OAAOwI,eAzTnCzmC,UAAUiJ,aAAa6Q,mBAAmB5a,MAAK,SAA0Bmf,GACxE,IAAIqoB,EAAgBC,aAAaC,QAAQ,kBAAoB,CAAEC,WAAY,KAAMC,QAAS,KAAMC,OAAQ,MAE3E,iBAAlBL,IACVA,EAAgBttB,KAAKC,MAAMqtB,IAO5B,IAJA,IAAIM,EAAmBxtC,SAASytC,cAAc,sBAC1CC,EAAoB1tC,SAASytC,cAAc,sBAC3CE,EAAc3tC,SAASytC,cAAc,sBAEhCvtC,EAAI,EAAGA,IAAM2kB,EAAKzV,SAAUlP,EAAG,CACvC,IAAI0tC,EAAa/oB,EAAK3kB,GAClB2tC,EAAS7tC,SAASC,cAAc,UACpC4tC,EAAOx8B,MAAQu8B,EAAW/sB,SACF,eAApB+sB,EAAWz2B,MACd02B,EAAOnK,KAAOkK,EAAWjtB,OAAS,eAAiB6sB,EAAiBp+B,OAAS,GACzE89B,EAAcG,aAAeO,EAAW/sB,WAAUgtB,EAAOvgC,UAAW,GACxEkgC,EAAiBptC,YAAYytC,IACC,gBAApBD,EAAWz2B,MACrB02B,EAAOnK,KAAOkK,EAAWjtB,OAAS,YAAc+sB,EAAkBt+B,OAAS,GACvE89B,EAAcI,UAAYM,EAAW/sB,WAAUgtB,EAAOvgC,UAAW,GACrEogC,EAAkBttC,YAAYytC,IACA,eAApBD,EAAWz2B,OACrB02B,EAAOnK,KAAOkK,EAAWjtB,OAAS,WAAagtB,EAAYv+B,OAAS,GAChE89B,EAAcK,SAAWK,EAAW/sB,WAAUgtB,EAAOvgC,UAAW,GACpEqgC,EAAYvtC,YAAYytC,SAsS3BvE,cAnRD,aAoRCL,gBAlRD,aAmRC6B,SA9GD,SAAkB3pC,EAAU6qC,EAAUhB,GACrC,OAAKgB,GAAaA,EAAS5I,OAMvB+E,GAAeA,EAAYhnC,WAAaA,GAC3CwhC,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IACzD,QAGR2D,EAAc5qC,EAAU6qC,EAAUhB,IAVjCrI,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IACzD,IA4GR6C,UAvFD,SAAmB9pC,EAAU0jB,EAAMmmB,GAClC5C,EAAW4C,EACX/C,EAAOhE,KAAK,YAAaiE,EAAOrjB,EAAM,QAASsnB,IAsF/CF,iBAAkBA,EAClBE,kBAAmBA,EACnBjB,gBAjDD,SAAyBC,GACxBlD,EAAOhE,KAAK,kBAAmBiE,EAAOiD,EAAU,QAASlB,IAiDzD6D,cApGD,SAAuB3sC,EAAU6qC,EAAUhB,GAC1C,IAAKgB,IAAaA,EAAS5I,OAE1B,OADAT,MAAMkB,WAAWI,KAAK,sBAAuB9iC,EAAU,QAASinC,IACzD,EAGR2D,EAAc5qC,EAAU6qC,EAAUhB,KAlPpB;ACYhB,aAEA,IAAIQ,KAAO,WACV,IAkBIH,EAjBApD,EAAS,KACT8F,EAAa,CAAEC,MAAO,QAASC,MAAO,SACtC7jB,EAAW,GACXojB,EAAmB,KACnBG,EAAc,KACdD,EAAoB,KACpBrjB,EAAgB,CACnBxL,SAAU,CAAC,CACVqvB,sBAAsB,KAGpBC,EAAiB,CACpB9vB,UAAW,CACV+vB,qBAAqB,EACrBC,qBAAqB,IAInBC,EAAe,GACft3B,EAAK,GACLu3B,EAAY,GACZC,EAAiB,IAAIC,IACrBC,EAAoB,KAwCxB,IAAIr+B,EAAO,CAEVs+B,KAAMjvC,OAAO2jC,IACbgH,YAzCD,SAAqBC,EAAMC,EAASC,EAAWC,GACtCA,EACRxC,EAASuC,EAITpgB,EAASzD,WAAa,CAAC,CACtBa,KAAQ,CACP,+BACA,gCACA,gCACA,gDAICgd,WAAWC,QAAUD,WAAWC,OAAO9d,aAAYyD,EAASzD,WAAa6d,WAAWC,OAAO9d,YAE1F6d,WAAWC,OAAO1/B,MAAM6pC,MAAMZ,QACjCD,EAAWC,MAAQxJ,WAAWC,OAAO1/B,MAAM6pC,MAAMZ,MAAQ,MAEtDxJ,WAAWC,OAAO1/B,MAAM6pC,MAAMX,QACjCF,EAAWE,MAAQzJ,WAAWC,OAAO1/B,MAAM6pC,MAAMX,MAAQ,MAE1DzD,EAAU1G,GAAG,eAAe,SAASyG,GAChCA,EAAQ1lB,KAAKgqB,QAAQhqB,KAAK1jB,WAAazB,OAAOyB,UAAUkP,EAAKy+B,eAAevE,EAAQ1lB,KAAKgqB,YAG9FjtC,EAAE5B,UAAU8jC,GAAG,SAAU,qBAAsBzzB,EAAK0+B,uBACpDntC,EAAE5B,UAAU8jC,GAAG,SAAU,qBAAsBzzB,EAAK0+B,uBACpDntC,EAAE5B,UAAU8jC,GAAG,SAAU,qBAAsBzzB,EAAK2+B,wBAEpDptC,EAAElC,QAAQokC,GAAG,UAAU,WACtBzzB,EAAK4+B,gBAUNC,sBAAuB,WAEtB,IAAIC,EAAevtC,EAAE,wBAAwB49B,KAAK,CACjDyN,eAAgBzI,WAAWC,OAAOwI,eAClC9rC,SAAU,KAEPiuC,EAAcxtC,EAAE,qFACpBwtC,EAAYvtC,OAAOstC,GACnBvtC,EAAE,QAAQ8pC,QAAQ0D,GAClBxtC,EAAE5B,UAAU8jC,GAAG,QAAS,iCAAiC,WACxD,IAAIuL,EAAUztC,EAAEoB,MAAMy8B,SAASA,SAC3B/O,EAAS9uB,EAAEoB,MAAMkjC,KAAK,eACtBoJ,EAAW1tC,EAAE,6BAA6BgpC,cAE9ChpC,EAAEoB,MAAMlB,KAAK,sBAAsBunC,SACnCznC,EAAEoB,MAAMlB,KAAK,oBAAoBunC,SAElB,aAAX3Y,GACH9uB,EAAEoB,MAAMkjC,KAAK,CAAEC,cAAe,WAC9BkJ,EAAQvtC,KAAK,gBAAgBqnC,WAAW,UACxCvnC,EAAE,eAAeK,IAAI,CACpB4oC,UAAW,oBAAsByE,EAAW,UAG7C1tC,EAAEoB,MAAMkjC,KAAK,CAAEC,cAAe,aAC9BkJ,EAAQvtC,KAAK,gBAAgBokC,KAAK,CAAE2F,QAAQ,IAC5CjqC,EAAE,eAAeK,IAAI,CACpB4oC,UAAW,4BAKf0E,kBAAmB,SAA2BhF,GAC7C,GAAIA,EAAQ7B,OAAQ,CACnB,IAAIlF,EAAOnzB,EAAK8yB,cAAcoH,EAAQ7B,QAClClF,GACH5hC,EAAE,UAAY4hC,EAAKJ,OAAO/nB,QAAQ,MAAO,MAAMpZ,IAAI,CAClDutC,eAAgBhM,EAAKsB,UACnB2K,SAAS,cAAc/L,KAAKF,EAAKv9B,QAIvCglC,UAAW,SAAmB7H,GACzBA,GAAUpsB,EAAGosB,IAAS/yB,EAAKq/B,OAAOtM,GAAQ,IAM/C+B,KAAM,WACLvjC,EAAE,cAAcQ,SAAS,iBAE1BgqC,mBAAoB,SAA4BjyB,GAE/C,IAAIw1B,EAIJ,OAAQx1B,EAAIlU,MACX,IAAK,0BACJ0pC,EAAS,wRACTt/B,EAAKu/B,cAAc,gBACnB,MACD,IAAK,8BACJD,EAAS,uFACTt/B,EAAKu/B,cAAc,oBACnB,MACD,IAAK,kBAIsB,WAAtBroC,SAASC,UAA+C,cAAtBD,SAASsoC,UAAkD,cAAtBtoC,SAASsoC,UACnFF,EAAS,0EACTt/B,EAAKu/B,cAAc,gBAEnBD,EAAS,uFACTt/B,EAAKu/B,cAAc,qBAEpB,MACD,IAAK,gBACJD,EAAS,mJACTt/B,EAAKu/B,cAAc,YACnB,MACD,IAAK,mBAEJD,EAAS,mGAAqGx1B,EAAI/V,QAClHiM,EAAKu/B,cAAc,YACnB,MACD,IAAK,aAEJD,EAAS,2HAA6Hx1B,EAAI/V,QAC1IiM,EAAKu/B,cAAc,SACnB,MACD,QAECD,EAAS,6CAA+Cx1B,EACxD9J,EAAKu/B,cAAc,WAErBhuC,EAAE4qC,QAAQC,IAAI,CACbC,MAAO,QACPhJ,KAAMiM,EACNhD,QAAQ,EACRC,WAAY,UAEbv8B,EAAK60B,QAENA,KAAM,SAAc9B,GACnB,IAAKA,EAAQ,OAAO,EACpBA,EAASA,EAAOv4B,MAAM,KAAK,GAC3BjJ,EAAE,WAAWE,KAAK,YAAcshC,GAAQ3D,SAASiC,UAElD+J,SAAU,SAAkBtqC,GAC3BkP,EAAK80B,OACL90B,EAAK4+B,YACL5+B,EAAK3J,aAAavF,IASnB4rC,WAAY,SAAoB3J,EAAQjiC,GACvC,IAAKiiC,EAAQ,OAAO,EACpB/yB,EAAK60B,KAAK9B,GACV/yB,EAAK4+B,UAAU9tC,GACZ6V,EAAGosB,IAASpsB,EAAGosB,GAAQvK,QAEtBwS,IACHA,EAAYz0B,YAAY/S,SAAQ,SAAUiL,GAAQA,EAAMqT,UACxDkpB,EAAc,OAGhByE,YAAa,WACZ,IAAIC,EAAa1E,EAAYppB,iBAAiB,GAC9C,GAAI8tB,EAEH,OADAA,EAAW1pB,SAAW0pB,EAAW1pB,SACzB0pB,EAAW1pB,SAGrB2pB,YAAa,WACZ,IAAIC,EAAa5E,EAAYnpB,iBAAiB,GAC9C,GAAI+tB,EAEH,OADAA,EAAW5pB,SAAW4pB,EAAW5pB,SACzB4pB,EAAW5pB,SAGrB8c,cAAe,SAAuBC,GACrC,IAAK/yB,EAAKs+B,OAASt+B,EAAKs+B,KAAKrL,aAAc,OAAO,KAClD,IAAIx/B,EAASuM,EAAKs+B,KAAKrL,aAAaC,oBAAoBjmB,QAAO,SAAUkmB,GACxE,OAAOA,EAAKJ,SAAWA,KAGxB,OADWt/B,EAAOsL,OAAS,EAAItL,EAAO,GAAK,MAG5CosC,UAAW,SAAmB9M,EAAQnzB,GACrC,IAAKmzB,EAAQ,OAAO,EAEpB,IAAI+M,EAAU/M,IAAW/yB,EAAK+/B,YAC1BC,EAAU,SAAWjN,EAAO/nB,QAAQ,MAAO,KAC3CtW,EAAQnD,EAAE,IAAMyuC,GAAS,GAExBpgC,GAAQrO,EAAEmD,GAAO06B,SAASiC,SAE/B,IAAI8B,EAAOnzB,EAAK8yB,cAAcC,GAE9B,IAAKr+B,GAASkL,EAAQ,CACrB,IAAIqgC,EAAiB1uC,EAAE,iCAAiCK,IAAI,CAC3D2F,MAAOmmC,EAAWE,MAClBsC,aAAcxC,EAAWE,QACvBrM,SAAShgC,EAAE,8BAEd0uC,EAAezuC,OAAOD,EAAE,2BAA2B8hC,KAAKF,EAAKv9B,QAE7DlB,EAAQnD,EAAE,uBAAuBskC,KAAK,KAAMmK,GAASpuC,IAAI,CACxDutC,eAAgBhM,EAAKsB,QACrBl9B,MAAOmmC,EAAWE,MAClBsC,aAAcxC,EAAWE,QACvBnK,GAAG,CACL0M,eAAgB,WACfngC,EAAKogC,aAAarN,MAEjBxB,SAAS0O,GAAgB,IAEtBI,UAAW,EACbP,IACHG,EAAeluC,SAAS,cACxB2C,EAAM4rC,OAAQ,GAEftgC,EAAKogC,aAAarN,GAEfnzB,GAAQ2gC,EAAkB7rC,EAAOkL,IAEtCwgC,aAAc,SAAsBrN,GACnC,IAAKA,EAAQ,OAAO,EACpB,IAAI+M,EAAU/M,IAAW/yB,EAAK+/B,YAC1BC,EAAU,SAAWjN,EAAO/nB,QAAQ,MAAO,KAC3Cw1B,EAASjvC,EAAE,IAAMyuC,GAEjBS,EAAQlvC,EAAE,qDAAqDskC,KAAK,QAAS,QAAQpC,GAAG,CAC3FiN,MAAO,WACN,IAAIJ,EACAR,EACHQ,EAAQtgC,EAAKy/B,eAEbe,EAAO,GAAGF,OAASE,EAAO,GAAGF,MAC7BA,EAAQE,EAAO,GAAGF,OAEnBG,EAAM5K,KAAK,QAASyK,EAAQ,SAAW,QAAQK,YAAY,QAASL,MAGlEM,GAAe,EACfC,EAAgBf,EAAUvuC,EAAE,qDAAqDskC,KAAK,QAAS,iBAAiBpC,GAAG,CACtHiN,MAAO,WACN1gC,EAAK2/B,cACLiB,GAAgBA,EAChBC,EAAchL,KAAK,QAAS+K,EAAe,gBAAkB,gBAAgBD,YAAY,OAAQC,MAE9F,KAEDE,GAAgB,EAChBC,EAAcxvC,EAAE,uDAAuDskC,KAAK,QAAS,qBAAqBpC,GAAG,CAChHiN,MAAO,YACNI,GAAiBA,GAGhB3C,EAAe/B,IAAIrJ,GAEnBoL,EAAuB,OAAEpL,GAG1BgO,EAAYlL,KAAK,QAASiL,EAAgB,qBAAuB,qBAAqBH,YAAY,QAASG,GAE3G,IAAIE,EAAYzvC,EAAE5B,UAAU8B,KAAK,kCAAkCgqC,SAAS,SAAWiC,EAAWC,MAAQD,EAAWE,MACrH4C,EAAOpR,SAASx9B,IAAI,CAAE2F,MAAOypC,EAAWd,aAAcc,IACtDR,EAAO5uC,IAAI,CAAE2F,MAAOypC,EAAWd,aAAcc,OAgB/C,GAZGzvC,EAAE5B,UAAU8B,KAAK,kCAAkCgqC,SAAS,WAC9D+E,EAAOpR,SAASx9B,IAAI,CAAE2F,MAAOmmC,EAAWC,MAAOuC,aAAcxC,EAAWC,QACxE6C,EAAO5uC,IAAI,CAAE2F,MAAOmmC,EAAWC,MAAOuC,aAAcxC,EAAWC,SAG7DmC,IAASzB,EAAoBmC,GAEhCjvC,EAAE,cAAgByuC,GAAS3O,SAC3B9/B,EAAE,qCAAqCskC,KAAK,KAAM,aAAemK,GAASxuC,OAAOivC,GAAOjvC,OAAOqvC,GAAervC,OAAOuvC,GAAatP,YAAY+O,GAC9IxgC,EAAK2+B,yBAGFh4B,EAAGosB,GAAQ,CAIb9/B,SAAS0T,EAAGosB,IAAS,SAASt/B,GAC5BA,EAAO0F,eAAeO,OAAOF,UAC7B/F,EAAO0F,eAAeO,OAAOJ,cAC7B7F,EAAO0F,eAAeI,UAEtB9F,EAAOkB,UAAUC,MAGdqsC,UAAStxC,SAASytC,cAAc,uBAAuBpM,UAAa,cAXzE,SAAqBzwB,EAAEoP,EAAE,GAAG,GAAG,IAAIpP,EAAE,MAAM,UAAU,MAAMF,EAAE,EAAEsP,EAAE,EAAEA,EAAES,EAAE+D,KAAK+sB,MAAM/sB,KAAK7d,IAAIiK,GAAG4T,KAAK7d,IAAI,OAAO,OAAO6qC,YAAY5gC,EAAE4T,KAAKitB,IAAI,KAAKhxB,IAAIpV,QAAQqF,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM+P,GAWhIixB,CAAY5tC,EAAOkB,UAAUC,QAMlHnB,EAAOF,QAAQC,SAAQ,SAASkC,GAC9B,GAAkB,SAAdA,EAAKtF,MAAwC,oBAArBsF,EAAK4rC,YAAmC,CAChD5rC,EAAKoD,YACLpD,EAAK6rC,YACD7rC,EAAK8rC,gBACb9rC,EAAKwF,YACLxF,EAAK4E,UACH5E,EAAKI,GAAG6E,QAAQ,SAEhC9G,QAAQyC,IAAI,gBAAiBZ,EAAKI,GAAG0E,MAAM,SAASC,OACpD5G,QAAQyC,IAAI,yBAA0BZ,EAAK4E,iBAzB5B,OA6FvBilC,cAAe,SAAuBkC,GACrC,IAAIpL,EAAM,CAAEtR,UAAW,MAAO30B,KAAM,QAASokB,KAAM,CAAEitB,SAAUA,EAAUrxC,KAAM,gBAC/EyD,QAAQC,MAAM,WAAYuiC,IAG3BqL,YAAa,SAAqBC,EAAIntB,GACrCojB,EAAOhE,KAAK,cAAe,CAC1BxjC,KAAM,cACNwxC,OAAQ,CACP7O,OAAQoB,WAAWpB,OACnBn9B,KAAMu+B,WAAWiD,SACjBS,MAAM1D,WAAW0D,MACjB/mC,SAAUzB,OAAOyB,UAElB0tC,QAAS,CAAEhqB,KAAMA,EAAMmtB,GAAIA,MAG7BlD,eAAgB,SAAwBpI,GACvC,IAAIpiC,EAAOoiC,EAAIwL,KACXrtB,EAAO6hB,EAAI7hB,KACXpkB,EAAOokB,EAAKpkB,KAChB,GAAI6D,IAAS+L,EAAK+/B,YAQlB,GAAa,WAAT3vC,EACH4P,EAAKq/B,OAAOprC,GAAM,QACZ,GAAa,UAAT7D,EAAkB,CACxBuW,EAAG1S,IACN+L,EAAKq/B,OAAOprC,GAAM,GAClB+L,EAAK8hC,qBAAqB7tC,EAAMugB,EAAK1jB,WAErCkP,EAAK8hC,qBAAqB7tC,EAAMugB,EAAK1jB,UAElCkqC,IACCr0B,EAAG1S,GAAMkW,gBACPxD,EAAG1S,GAAMkW,kBAAkBpL,QAC/B4H,EAAG1S,GAAM2T,UAAUozB,GAEVr0B,EAAG1S,GAAM4tB,eACdlb,EAAG1S,GAAM4tB,aAAa9iB,QAC1B4H,EAAG1S,GAAM2T,UAAUozB,KAItB,IAAI1a,EAAQ,IAAIpV,sBAAsBsJ,EAAK8L,OAC3C3Z,EAAG1S,GAAM4R,qBAAqBya,GAAO,WACpC3Z,EAAG1S,GAAMqlB,cAAa,SAAUvN,GAC/BA,EAAKnB,IAAMm3B,EAAWh2B,EAAKnB,KAC3BjE,EAAG1S,GAAMgY,oBAAoBF,GAAM,WAClC/L,EAAK0hC,YAAYztC,EAAM,CAAE7D,KAAM,SAAUmwB,OAAQxU,EAAMjb,SAAU0jB,EAAK1jB,aACpEkxC,KACDA,EAAUlE,KACXkE,QACG,GAAa,WAAT5xC,GACV,GAAIuW,EAAG1S,GAAO,CACb,IAAIssB,EAAS,IAAIrV,sBAAsBsJ,EAAK+L,QAC5C5Z,EAAG1S,GAAM4R,qBAAqB0a,GAAQ,cAAgByhB,SAEjD,GAAa,iBAAT5xC,GACV,GAAIuW,EAAG1S,GAAO,CACb,IAAIwI,EAAY,IAAI6P,gBAAgBkI,EAAK/X,WACrCgE,EAAIkG,EAAG1S,GAAMuY,gBAAgB/P,GAC7BgE,GACHA,EAAEpL,MAAK,eAEG,OAAE,WACXxB,QAAQC,MAAM,0CAA2C0gB,YAK5D3gB,QAAQC,MAAM,kBAAmB0gB,IAInCoqB,UAAW,SAAmBqD,GAC7B1xC,OAAOmD,KAAKiT,GAAInT,SAAQ,SAAUu/B,GACjC/yB,EAAKq/B,OAAOtM,GAAQ,EAAMkP,OAG5B5C,OAAQ,SAAgBtM,EAAQmP,EAAQpxC,GACvCoxC,EAA8B,IAArB3rC,UAAUwI,QAAsBmjC,EACrCv7B,EAAGosB,IAAWA,IAAW/yB,EAAK+/B,cACjC//B,EAAK6/B,UAAU9M,EAAQ,MACvBpsB,EAAGosB,GAAQvK,eACJ7hB,EAAGosB,GACNmP,GAAQliC,EAAK0hC,YAAY3O,EAAQ,CAAE3iC,KAAM,SAAUU,SAAUA,MAInEivC,UAAW,WACV,OAAO5L,WAAWpB,QAAU1jC,OAAO2jC,IAAI+M,aAExCr/B,KAAM,SAAcqyB,EAAQjiC,GAC3B,GAAKkqC,EAAL,CAIA,IAAIx7B,EAAc,CAAEgP,SAAU,GAAIR,UAAW,IAE7C,GAA8B,WAA1Bm0B,EACH,IAAK,IAAIhwC,KAAQqN,EAAYwO,WACC,IAAzB7b,EAAKwI,QAAQ,eACT6E,EAAYwO,UAAU7b,GAIhCqN,EAqNF,SAA0B4iC,EAAOC,GAChC,IAAIC,EAASF,EACb,IAAK,IAAIxsC,KAAQysC,EAAMr0B,UACtBs0B,EAAOt0B,UAAUpY,GAAQysC,EAAMr0B,UAAUpY,GAG1C,OADA0sC,EAAO9zB,SAASrB,OAAOk1B,EAAM7zB,UACtB8zB,EA3NQC,CAAiB/iC,EAAas+B,GAEvCn3B,EAAGosB,IACP/yB,EAAK8hC,qBAAqB/O,EAAQjiC,GAEnC6V,EAAGosB,GAAQnrB,UAAUozB,GACrBr0B,EAAGosB,GAAQ3Z,aAAY,SAAUrN,GAChCA,EAAKnB,IAAMm3B,EAAWh2B,EAAKnB,KAC3BjE,EAAGosB,GAAQ9mB,oBAAoBF,GAAM,WACpC/L,EAAK0hC,YAAY3O,EAAQ,CAAE3iC,KAAM,QAASkwB,MAAOvU,EAAMjb,SAAUA,MAC/DkxC,KACDA,EAAUxiC,QAvBZ0+B,EAAUzoC,KAAKs9B,IAyBjB+O,qBAAsB,SAA8B/O,EAAQjiC,GACvD6V,EAAGosB,IACNl/B,QAAQ+nB,KAAK,wDAAyDmX,GAEvEpsB,EAAGosB,GAAU,IAAIl7B,kBAAkBkiB,EAAUC,GAC7CrT,EAAGosB,GAAQ/P,eAAiB,SAAU7c,GACjCA,EAAM1J,WACTuD,EAAK0hC,YAAY3O,EAAQ,CACxB3iC,KAAM,eACNU,SAAUA,EACV2L,UAAW0J,EAAM1J,aAIpBkK,EAAGosB,GAAQ9P,YAAc,SAAU9c,GAClC83B,EAAalL,GAAU5sB,EAAMvG,OAC7BI,EAAK6/B,UAAU9M,EAAQ5sB,EAAMvG,SAE9B+G,EAAGosB,GAAQ5P,eAAiB,WAC3BnjB,EAAK6/B,UAAU9M,EAAQ,QAIzB2L,sBAAuB,WACtB1D,EAAYz0B,YAAY/S,SAAQ,SAAUiL,GACzCA,EAAMqT,UAEP9R,EAAK3J,aAAahH,OAAOyB,WAE1B0xC,aAAc,SAAsBC,EAASC,GAExCD,GAAWA,EAAQ,SAAmC,IAAtBA,EAAQ,GAAGC,OAC9CD,EAAQ,GAAGE,UAAUD,GAAQrtC,KAAK,KAC/BxB,QAAQimC,KAAK,0CAA0C4I,KAC9C,MAAE5uC,IACX,IAAI8uC,EAAe9uC,EACA,kBAAfA,EAAM8B,OACTgtC,EAAe,4DAA4D9uC,GAE5ED,QAAQC,MAAM8uC,GAEdvF,EAAkBwF,cAAgB,IAGrChvC,QAAQ+nB,KAAK,sDAGf+iB,uBAAwB,WACvB,IACImE,EADoBnzC,SAASytC,cAAc,sBACNp8B,MACrC+hC,EAAe1E,EACnBr+B,EAAKwiC,aAAaO,EAAcD,IAEjCzsC,aAAc,SAAsBvF,GACnCqsC,EAAmBxtC,SAASytC,cAAc,sBAC1CE,EAAc3tC,SAASytC,cAAc,sBACrCC,EAAoB1tC,SAASytC,cAAc,sBAE3C,IAAI4F,EAAc7F,EAAiBn8B,MAC/BiiC,EAAc3F,EAAYt8B,MAC1BkiC,EAAc7F,EAAkBr8B,MAEhCmiC,EAAmB,CACtB1uC,OAAO,EACPC,MAAO,CACN8Z,SAAU,GACVR,UAAW,CACVI,SAAU,IACVC,UAAW,OAKV20B,IACHG,EAAiB1uC,MAAQ,CAAE+b,SAAU,CAAE7B,MAAOq0B,KAE3CC,IACHE,EAAiBzuC,MAAQ,CAAE8b,SAAU,CAAE7B,MAAOs0B,KAM/CnG,aAAasG,QAAQ,gBAAiB7zB,KAAKE,UAAU,CAAEutB,WAAYgG,EAAa/F,QAASiG,EAAahG,OAAQ+F,KAE9G5zC,OAAO8G,UAAUiJ,aAAa/I,aAAa8sC,GAAkB9tC,MAAK,SAAUuK,GAC3Eo7B,EAAcp7B,EACdI,EAAK6/B,UAAU7/B,EAAK+/B,YAAangC,GACjCI,EAAKs+B,KAAKrL,aAAaC,oBAAoB1/B,SAAQ,SAAU2/B,GACxDA,EAAKJ,SAAW/yB,EAAK+/B,cACpBp5B,EAAGwsB,EAAKJ,SACX/yB,EAAKq/B,OAAOlM,EAAKJ,QAAQ,EAAOjiC,GAEjCkP,EAAKU,KAAKyyB,EAAKJ,OAAQjiC,UAGhB,OAAE,SAAUgZ,GACrB9J,EAAK+7B,mBAAmBjyB,QAOvBy2B,EAAoB,SAA2BkC,EAAS7iC,QAC1B,IAAtB6iC,EAAQY,UAClBZ,EAAQY,UAAYzjC,OACsB,IAAzB6iC,EAAQa,aACzBb,EAAQa,aAAe1jC,OACU,IAAhB6iC,EAAQc,IACzBd,EAAQc,IAAM9rC,IAAIC,gBAAgBkI,GAElC/L,QAAQC,MAAM,qCAAsC2uC,IAGlDN,EAAwB,SAG5B,SAASqB,EAAW54B,GAKnB,IAJA,IAAI64B,EAAW74B,EAAIpQ,MAAM,QACrBkpC,EAAa,KAGR7zC,EAAI,EAAGA,EAAI4zC,EAAS1kC,OAAQlP,IACpC,IAAuC,IAAnC4zC,EAAS5zC,GAAGsE,OAAO,WAAmB,CACzCuvC,EAAa7zC,EACb,MAGF,GAAmB,OAAf6zC,EAAqB,OAAO94B,EAGhC,IAAK,IAAImV,EAAI,EAAGA,EAAI0jB,EAAS1kC,OAAQghB,IACpC,IAA0C,IAAtC0jB,EAAS1jB,GAAG5rB,OAAO,cAAsB,CAC5C,IAAIwvC,EAAcC,EAAWH,EAAS1jB,GAAI,uBACtC4jB,IAAaF,EAASC,GAAcG,EAAgBJ,EAASC,GAAaC,IAC9E,MAQF,OADA/4B,GAFA64B,EA4BD,SAAkBA,EAAUC,GAG3B,IAFA,IAAII,EAAgBL,EAASC,GAAYlpC,MAAM,KAEtC3K,EAAI4zC,EAAS1kC,OAAS,EAAGlP,GAAK,EAAGA,IAAK,CAC9C,IAAI2uC,EAAUoF,EAAWH,EAAS5zC,GAAI,2BACtC,GAAI2uC,EAAS,CACZ,IAAIuF,EAAQD,EAAcnpC,QAAQ6jC,IACnB,IAAXuF,GAEHD,EAAcp8B,OAAOq8B,EAAO,GAG7BN,EAAS/7B,OAAO7X,EAAG,IAKrB,OADA4zC,EAASC,GAAcI,EAAchyC,KAAK,KACnC2xC,EA7CIO,CAASP,EAAUC,IAEf5xC,KAAK,QAIrB,SAAS8xC,EAAWK,EAASC,GAC5B,IAAIzwC,EAASwwC,EAAQpyC,MAAMqyC,GAC3B,OAAOzwC,GAA4B,IAAlBA,EAAOsL,OAAetL,EAAO,GAAK,KAIpD,SAASowC,EAAgB3wB,EAAOsrB,GAI/B,IAHA,IAAI2F,EAAWjxB,EAAM1Y,MAAM,KACvB4pC,EAAU,GACVzyC,EAAQ,EACH9B,EAAI,EAAGA,EAAIs0C,EAASplC,OAAQlP,IACtB,IAAV8B,IAEHyyC,EAAQzyC,KAAW6sC,GAGhB2F,EAASt0C,KAAO2uC,IAAS4F,EAAQzyC,KAAWwyC,EAASt0C,IAE1D,OAAOu0C,EAAQtyC,KAAK,KA6BrB,SAASiwC,EAAWn3B,GAGnB,OADAA,EAPD,SAAiBA,EAAKy5B,GAErB,OADAA,EAAOA,GAAQ,QACRz5B,EAAII,QAAQ,cAAe,QAAUq5B,EAAO,MAK7CC,CADN15B,EAAM44B,EAAW54B,IAclB,SAASo3B,EAASluC,GAEjBD,QAAQC,MAAM,gBAAiBA,GAIhC,OADAkM,EAAK2G,GAAKA,EACH3G,EApvBG;ACjBX,aAOA,IAAIs0B,UAAY,WACf,IAAIt0B,EAAO,KACP43B,EAAS,KAETlB,EAAiB,EAsDrB,SAAS6N,EAAczzC,GACHwhC,MAAMgB,kBAAkB7hC,KAAK,UAAUjC,WAAWiC,KAAK,iBAC7DA,KAAK,iBAAuBX,GAAUwgC,MAAK,WACvD3+B,KAAK6xC,eAAe,CACnBC,SAAU,cAKb,SAASC,IACRnzC,EAAE,oCAAoCozC,QAAQ,SAqB/C,SAASC,EAAerP,EAASzkC,EAAU2b,GAS1C,GARsB,iBAAZ8oB,GACTA,EAAQ/iC,iBAGT1B,EAAWS,EAAEoB,MAAMkjC,KAAK,YAAc/kC,EACtCykC,EAAUhkC,EAAEoB,MAAMkjC,KAAK,gBAAkBN,EACzC9oB,EAASlb,EAAEoB,MAAMkjC,KAAK,cAAgBppB,GAEjC3b,IAAa2b,EAAS,OAAO,EAEnBlb,EAAEoB,MAAjB,IAEIgpC,EAAW,CACd9D,MAAO1D,WAAW0D,OAASxoC,OAAO2jC,IAAIqH,WACtCtH,OAAQoB,WAAWpB,QAAU1jC,OAAO2jC,IAAI+M,YACxC3I,SAAUjD,WAAWiD,UAAY,YACjCtmC,SAAUA,EACV2b,OAAQA,EACR4T,OAAQkV,GAKT,GAFAjD,MAAMkB,WAAWI,KAAK,uBAAwB9iC,EAAUykC,EAAS9oB,GAEjD,SAAZ8oB,EACH,OAAQ9oB,GACP,IAAK,QA5CR,SAAsB3b,EAAU6qC,EAAUlvB,GAEzCsuB,UAAUN,SAAS3pC,EAAU6qC,EAAU,QACvC+I,IA0CGG,CAAa/zC,EAAU6qC,GACvB,MACD,IAAK,QACJZ,UAAUN,SAAS3pC,EAAU6qC,EAAUlvB,GACvC,MACD,IAAK,OACJkrB,SAAS8C,SAAS3pC,EAAU6qC,EAAUlvB,GACtC,MACD,QACC,OAAO,OAEH,GAAgB,UAAZ8oB,EACV,OAAQ9oB,GACP,IAAK,QApDR,SAAuB3b,EAAU6qC,EAAUlvB,GAE1CsuB,UAAUH,UAAU9pC,EAAU6qC,EAAU,QACxC+I,IAkDGI,CAAch0C,EAAU6qC,GACxB,MACD,IAAK,QACJZ,UAAUH,UAAU9pC,EAAU6qC,EAAUlvB,GACxC,MACD,IAAK,OACJkrB,SAASiD,UAAU9pC,EAAU6qC,EAAUlvB,GACvC,MACD,QACC,OAAO,MAEY,WAAZ8oB,EACTwF,UAAU0C,cAAc3sC,EAAU6qC,EAAUlvB,EAAQ8oB,GAC/B,cAAZA,GAqCX,SAAwBzmC,EAAQ2d,GAC/B3d,EAASyC,EAAEoB,MAAMkjC,KAAK,YAAc/mC,EACpC2d,EAASlb,EAAEoB,MAAMkjC,KAAK,cAAgBppB,EACtC,IAAI4vB,EAAQ/J,MAAMgB,kBAAkB7hC,KAAK,kBAAoB3C,EAAS,eAAeukC,OAEjFmE,EAASnoC,OAAO6H,SAASsgC,OACzBuN,EAAW11C,OAAO6H,SAASugC,SAC3BuN,EAAOxN,EAASuN,EAAW,WAAazS,MAAMc,QAAQiJ,GAAS,OAASvtC,EAAS,WAAa2d,EAAS,aAEvGw4B,EAAQ1zC,EAAE,WACdA,EAAE,QAAQC,OAAOyzC,GACjBA,EAAMjoB,IAAIgoB,GAAME,SAChBv1C,SAAS8C,YAAY,QACrBwyC,EAAM5T,SAEN9/B,EAAE4qC,QAAQC,IAAI,CACbC,MAAO,SACPhJ,KAAM,iCACNiJ,QAAQ,EACRC,WAAY,sBACZxF,KAAM,SAxDNoO,CAAer0C,EAAU2b,GA4D3B,SAAS24B,EAAe5S,GACvB,IAAIh7B,EAASg7B,EAAS6S,cAClBC,EAAahT,MAAMgB,kBAAkB7hC,KAAK,4BAA4BG,IAAI,eAC1E2zC,EAAkBjnC,SAASgnC,EAAY,IAE3C,OADgBnxB,KAAKqxB,KAAKhT,EAASiT,SAASC,IAAMH,GAC/B/tC,EAAS,EAAI,GAGjC,SAAS+8B,EAAe/B,GACvB,IAAIj7B,EAAQi7B,EAASmT,aACjBC,EAActT,MAAMgB,kBAAkB7hC,KAAK,4BAA4BG,IAAI,gBAC3E2zC,EAAkBjnC,SAASsnC,EAAa,IAE5C,OADiBzxB,KAAKqxB,KAAKlT,MAAMgB,kBAAkB7hC,KAAK,4BAA4Bg0C,SAASpR,KAAOkR,GAChFhuC,EAAQ,EAyK7B,OAvGAyI,EAAO,CACNg6B,YAlRD,SAAqBC,EAAMC,EAASC,EAAWC,GAkN/C,IACKyL,EAlNJjO,EAASuC,EACDC,EACR1D,EAAiBvC,WAAWC,OAAOwI,eAEnChF,EAAOnE,GAAG,YAAY,SAAUjf,EAAM4gB,EAAU3oB,GAChC,UAAXA,EACHsuB,UAAUa,iBAAiBpnB,EAAM4gB,GAAU,GAE3CuC,SAAS4B,cAAc/kB,EAAM4gB,EAAU3oB,MAIzCmrB,EAAOnE,GAAG,aAAa,SAAUjf,EAAM4gB,EAAU3oB,GACjC,UAAXA,EACHsuB,UAAUe,kBAAkBtnB,EAAM4gB,EAAU3oB,GAE5CkrB,SAAS+B,mBAAmBllB,EAAM4gB,EAAU3oB,OAkM1Co5B,EAAiBvT,MAAMgB,mBAEZG,GAAG,QAAS,oCAAqCmR,GAChEiB,EAAepS,GAAG,QAAS,qCAAsCmR,GACjEiB,EAAepS,GAAG,QAAS,wCAAyCmR,GAEpErzC,EAAE5B,UAAU8jC,GAAG,QAAS,2BAA4BmR,GAEpDrzC,EAAE5B,UAAU8jC,GAAG,QAAS,oEAAqEmR,GAG7FiB,EAAepS,GAAG,QAAS,oBAAqBmR,GAChDrzC,EAAE5B,UAAU8jC,GAAG,QAAS,oBAAqBmR,GAS7CtS,MAAMgB,kBAAkBG,GAAG,QAAS,2CAA2C,WAC9E,IAxMsBJ,EACnB4R,EAuMCa,EAAYv0C,EAAEoB,MAAMlB,KAAK,SAASurB,MAxMhBqW,EAyMPyS,EAxMZb,EAAQ1zC,EAAE,WACdA,EAAE,QAAQC,OAAOyzC,GACjBA,EAAMjoB,IAAIqW,GAAM6R,SAChBv1C,SAAS8C,YAAY,QACrBwyC,EAAM5T,SACN9/B,EAAE4qC,QAAQC,IAAI,CACbC,MAAO,SACPhJ,KAAM,iCACNiJ,QAAQ,EACRC,WAAY,sBACZxF,KAAM,YAyMPxlC,EAAE5B,UAAU8jC,GAAG,QAAS,uCAAuC,WAE9D8Q,EADehzC,EAAEoB,MAAMkjC,KAAK,eAI7BtkC,EAAE5B,UAAU8jC,GAAG,QAAS,8BAA8B,WACrD,IAAKliC,EAAEoB,MAAMkjC,KAAK,UAAW,OAAO,EAEpCtkC,EAAEoB,MAAMguC,YAAY,SAEpBpvC,EAAE,6CAA6C+/B,MAAK,WACnD//B,EAAEoB,MAAMgyC,QAAQ,eAKlBpzC,EAAE5B,UAAU8jC,GAAG,QAAS,mCAAmC,WAC1D,IAAIgS,EAASl0C,EAAEoB,MAAMozC,WACjBC,EAAOz0C,EAAE5B,UAAU8B,KAAK,kBACxB8F,EAAQyuC,EAAKL,aACjBK,EAAKp0C,IAAI,CAACyiC,KAAMoR,EAAOpR,KAAO98B,EAAS,KAAKmuC,IAAKD,EAAOC,IAAM,EAAI,OAAO/E,YAAY,aAGtFpvC,EAAE5B,UAAU8jC,GAAG,QAAS,6BAA6B,WACpDliC,EAAE,kBAAkBovC,YAAY,aApPjC1rC,YAAW,YAiHZ,WACC,IAAIgxC,EAAY,IAAIC,gBAAgB72C,OAAO6H,SAAS/C,QAChDrD,EAAWm1C,EAAU9gC,IAAI,MACzBsH,EAASw5B,EAAU9gC,IAAI,UACvBrT,EAAOm0C,EAAU9gC,IAAI,QAEzB,IAAIrU,EAAU,OAAO,EAIrB,IAFgBwhC,MAAMgB,kBAAkB7hC,KAAK,IAAMX,GAErCiO,OAQb,OAPAxN,EAAE4qC,QAAQC,IAAI,CACbC,MAAO,QACPhJ,KAAM,yCACN0D,KAAM,IACNuF,QAAQ,EACRC,WAAY,WAEN,EAGJzrC,GACHyzC,EAAczzC,GAEF,SAATgB,IACH2a,EAASA,EAAOwC,cAChBha,YAAW,WACV2vC,EAAe,OAAQ9zC,EAAU2b,KAC/B,MA5IH05B,KACE,MAwPH5R,eAAgBA,EAChB2K,kBAAmB,SAA2BhF,GAC7C,GAAIA,EAAQ7B,OAAQ,CACnB,IAAIlF,EAAOb,MAAMQ,cAAcoH,EAAQ7B,QACnClF,IAEHb,MAAMgB,kBAAkB7hC,KAAK,yCAA2C0hC,EAAKJ,OAAS,MAAMnhC,IAAI,CAAEutC,eAAgBhM,EAAKsB,UAAWpB,KAAKF,EAAKv9B,MAC5I08B,MAAMgB,kBAAkB7hC,KAAK,0CAA4C0hC,EAAKJ,OAAS,MAAMnhC,IAAI,CAAEutC,eAAgBhM,EAAKsB,UAAWpB,KAAKF,EAAKv9B,SAIhJglC,UAAW,SAAmBV,EAAS/mC,GAGtCA,KAED0nC,gBAAiB,SAAyBC,GACzCC,UAAUF,gBAAgBC,GAC1BnD,SAASkD,gBAAgBC,IAE1BsL,iBAAkB,WAEjB,IAAIC,EAAY/T,MAAMgB,kBACjB+S,GAELA,EAAU50C,KAAK,2CAA2C6/B,MAAK,WAC9D,IAAIgV,EAAM/0C,EAAEoB,MAER4zC,EAAW,gBADFD,EAAIzQ,KAAK,MAElB2Q,EAAaH,EAAU50C,KAAK,UAAUjC,WAAWiC,KAAK,iBAAiBA,KAAK,IAAM80C,GAItF,GAAIC,EAAWznC,QAAU,EAExB,OADAunC,EAAIjV,UACG,EAGqB,WAAzBiV,EAAIzQ,KAAK,aAA0ByQ,EAAI10C,IAAI,CAAEyiC,KAAME,EAAe+R,GAAO,OAC7EA,EAAI10C,IAAI,CAAE8zC,IAAKN,EAAeoB,GAAc,WAG9CC,SAAU,WACT,IAAI3L,EAAW,GAEX4L,EAAQpU,MAAMgB,kBAAkB7hC,KAAK,UAAUjC,WAAWiC,KAAK,iBAAiBk1C,SAAS,OAAOA,SAnUtF,6CAoUVC,EAAiBtU,MAAMgB,kBAAkB7hC,KAAK,4BAA4Bg0C,SAC1Eh5B,EAAS6lB,MAAMgB,kBAAkB7hC,KAAK,iBACtCo1C,GAAe,EAEnBt1C,EAAEm1C,GAAOpV,MAAK,WACb,IAAIgV,EAAM/0C,EAAEoB,MAGRm0C,EAAO1B,EAAekB,GACtBS,EAAO5yB,KAAKqxB,KAAKoB,EAAevS,MAChCnlC,EAAeo3C,EAAI70C,KAAK,QAAQokC,KAAK,SAGzC,KAFA3mC,EAAe,qCAAqC83C,KAAK93C,IAIxD,OADA2E,QAAQ+nB,KAAK,wCACN,EAGR,IAAIpH,EAAO,CACVtlB,aAAcA,EAAa,GAE3B+3C,YAAaH,EACbI,aAAcH,EACd7N,UAAWoN,EAAIjT,OAEfuJ,eAAgBlG,GAQjB,GALKpE,MAAMiB,UAAU/e,EAAKtlB,gBAAeojC,MAAMiB,UAAU/e,EAAKtlB,cAAgB,CAAE+lC,MAAO,CAAED,KAAM,IAAMD,KAAM,CAAEC,KAAM,IAAMK,MAAO,KAK5H5oB,EAAOhb,KAAK,IAAM+iB,EAAKtlB,cAAc6P,QAAU,EAAG,CACrD,IAAIooC,EAAM51C,EAAE,kBAAkB49B,KAAK3a,GACnC/H,EAAOhb,KAAK,kBAAkBD,OAAO21C,GACrC,IAAIC,EAAY71C,EAAE,uBAAuB49B,KAAK3a,GAC9C/H,EAAOhb,KAAK,oBAAoBD,OAAO41C,GACvCP,GAAe,OAEft1C,EAAE5B,UAAU8B,KAAK,gBAAkB+iB,EAAKtlB,aAAe,uDAAyDslB,EAAKtlB,aAAe,KAAKmkC,KAAK7e,EAAK0kB,WACnJzsB,EAAOhb,KAAK,qBAAuB+iB,EAAKtlB,aAAe,gBAAgBmkC,KAAK7e,EAAK0kB,WACjF3nC,EAAE5B,UAAU8B,KAAK,iCAAmC+iB,EAAKtlB,aAAe,iBAAiBmkC,KAAK7e,EAAK0kB,WAGpG4B,EAASrlC,KAAK+e,MAGXqyB,IACH7mC,EAAK66B,gBAAgBC,GACrB+L,GAAe,KA7XH","file":"wrtc.heading.mini.js","sourcesContent":["\r\n// inspired by ep_comments_page plugin, used and modified copyPasteEvents.js\r\n\r\n'use strict';\r\nvar _ = require('ep_etherpad-lite/static/js/underscore');\r\nvar randomString = require('ep_etherpad-lite/static/js/pad_utils').randomString;\r\n\r\nvar events = (function events() {\r\n\r\n\tvar padInner = null;\r\n\r\n\tvar getFirstColumnOfSelection = function getFirstColumnOfSelection(line, rep, firstLineOfSelection) {\r\n\t\treturn line !== firstLineOfSelection ? 0 : rep.selStart[1];\r\n\t};\r\n\t\r\n\tvar getLength = function getLength(line, rep) {\r\n\t\tvar nextLine = line + 1;\r\n\t\tvar startLineOffset = rep.lines.offsetOfIndex(line);\r\n\t\tvar endLineOffset = rep.lines.offsetOfIndex(nextLine);\r\n\t\r\n\t\t// lineLength without \\n\r\n\t\tvar lineLength = endLineOffset - startLineOffset - 1;\r\n\t\r\n\t\treturn lineLength;\r\n\t};\r\n\t\r\n\tvar getLastColumnOfSelection = function getLastColumnOfSelection(line, rep, lastLineOfSelection) {\r\n\t\tvar lastColumnOfSelection;\r\n\t\tif (line !== lastLineOfSelection) {\r\n\t\t\tlastColumnOfSelection = getLength(line, rep); // length of line\r\n\t\t} else {\r\n\t\t\tlastColumnOfSelection = rep.selEnd[1] - 1; // position of last character selected\r\n\t\t}\r\n\t\treturn lastColumnOfSelection;\r\n\t};\r\n\t\r\n\t\r\n\tvar hasCommentOnLine = function hasCommentOnLine(lineNumber, firstColumn, lastColumn, attributeManager) {\r\n\t\tvar foundHeadOnLine = false;\r\n\t\tvar headId = null;\r\n\t\tfor (var column = firstColumn; column <= lastColumn && !foundHeadOnLine; column++) {\r\n\t\t\theadId = _.object(attributeManager.getAttributesOnPosition(lineNumber, column)).headingTagId;\r\n\t\t\tif (headId) {\r\n\t\t\t\tfoundHeadOnLine = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { foundHeadOnLine: foundHeadOnLine, headId: headId };\r\n\t};\r\n\t\r\n\tvar hasCommentOnMultipleLineSelection = function hasCommentOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager) {\r\n\t\tvar foundLineWithComment = false;\r\n\t\tfor (var line = firstLineOfSelection; line <= lastLineOfSelection && !foundLineWithComment; line++) {\r\n\t\t\tvar firstColumn = getFirstColumnOfSelection(line, rep, firstLineOfSelection);\r\n\t\t\tvar lastColumn = getLastColumnOfSelection(line, rep, lastLineOfSelection);\r\n\t\t\tvar hasComment = hasCommentOnLine(line, firstColumn, lastColumn, attributeManager);\r\n\t\t\tif (hasComment) {\r\n\t\t\t\tfoundLineWithComment = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn foundLineWithComment;\r\n\t};\r\n\t\r\n\tvar hasMultipleLineSelected = function hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection) {\r\n\t\treturn firstLineOfSelection !== lastLineOfSelection;\r\n\t};\r\n\t\r\n\tvar hasHeaderOnSelection = function hasHeaderOnSelection() {\r\n\t\tvar hasVideoHeader;\r\n\t\tvar attributeManager = this.documentAttributeManager;\r\n\t\tvar rep = this.rep;\r\n\t\tvar firstLineOfSelection = rep.selStart[0];\r\n\t\tvar firstColumn = rep.selStart[1];\r\n\t\tvar lastColumn = rep.selEnd[1];\r\n\t\tvar lastLineOfSelection = rep.selEnd[0];\r\n\t\tvar selectionOfMultipleLine = hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection);\r\n\t\tif (selectionOfMultipleLine) {\r\n\t\t\thasVideoHeader = hasCommentOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager);\r\n\t\t} else {\r\n\t\t\thasVideoHeader = hasCommentOnLine(firstLineOfSelection, firstColumn, lastColumn, attributeManager);\r\n\t\t}\r\n\t\treturn { hasVideoHeader: hasVideoHeader.foundHeadOnLine, headId: hasVideoHeader.headId, hasMultipleLine: selectionOfMultipleLine };\r\n\t};\r\n\t\r\n\tfunction getSelectionHtml() {\r\n\t\tvar html = '';\r\n\t\tif (typeof window.getSelection !== 'undefined') {\r\n\t\t\tvar sel = padInner.contents()[0].getSelection();\r\n\t\t\tif (sel.rangeCount) {\r\n\t\t\t\tvar container = document.createElement('div');\r\n\t\t\t\tfor (var i = 0, len = sel.rangeCount; i < len; ++i) {\r\n\t\t\t\t\tcontainer.appendChild(sel.getRangeAt(i).cloneContents());\r\n\t\t\t\t}\r\n\t\t\t\thtml = container.innerHTML;\r\n\t\t\t}\r\n\t\t} else if (typeof document.selection !== 'undefined') {\r\n\t\t\tif (document.selection.type === 'Text') {\r\n\t\t\t\thtml = document.selection.createRange().htmlText;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n\t\r\n\tfunction selectionMultipleLine() {\r\n\t\tvar rawHtml = getSelectionHtml();\r\n\t\trawHtml = $('<div></div>').append(rawHtml);\r\n\t\trawHtml.find(':header span').removeClass(function removeClass(index, css) {\r\n\t\t\treturn (css.match(/\\headingTagId_\\S+/g) || []).join(' ');\r\n\t\t}).addClass(function addClass(index, css) {\r\n\t\t\treturn 'headingTagId_' + randomString(16) + ' ' + css;\r\n\t\t});\r\n\t\treturn rawHtml.html();\r\n\t}\r\n\t\r\n\tfunction selectionOneLine(headerId) {\r\n\t\tvar hTag = padInner.contents().find('.headingTagId_' + headerId).closest(':header').eq(0).prop(\"tagName\").toLowerCase();\r\n\t\tvar content = padInner.contents().find('.headingTagId_' + headerId).closest(':header span').removeClass(function(index, css) {\r\n\t\t\treturn (css.match(/\\headingTagId_\\S+/g) || []).join(' ');\r\n\t\t}).html();\r\n\t\tif(!hTag && !content) return false;\r\n\t\tvar rawHtml = $('<div></div>').append('<' + hTag + \"><span class='headingTagId_\" + randomString(16) + \"'>\" + content + '</span></' + hTag + '>');\r\n\t\treturn rawHtml.html();\r\n\t}\r\n\t\r\n\tvar addTextOnClipboard = function addTextOnClipboard(e, aces, inner, removeSelection) {\r\n\t\tpadInner = inner;\r\n\t\r\n\t\tvar selection;\r\n\t\taces.callWithAce(function callWithAce(ace) {\r\n\t\t\tselection = ace.ace_hasHeaderOnSelection();\r\n\t\t});\r\n\t\r\n\t\tif (selection.hasVideoHeader || selection.hasMultipleLine) {\r\n\t\t\tvar rawHtml;\r\n\t\t\tif (selection.hasMultipleLine) {\r\n\t\t\t\tvar htmlSelection = getSelectionHtml();\r\n\t\t\t\trawHtml = selectionMultipleLine(htmlSelection);\r\n\t\t\t} else {\r\n\t\t\t\tif(!selection.headId) return false;\r\n\t\t\t\trawHtml = selectionOneLine(selection.headId);\r\n\t\t\t}\r\n\t\r\n\t\t\tif (rawHtml) {\r\n\t\t\t\te.originalEvent.clipboardData.setData('text/html', rawHtml);\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\r\n\t\t\t// if it is a cut event we have to remove the selection\r\n\t\t\tif (removeSelection) {\r\n\t\t\t\tpadInner.contents()[0].execCommand('delete');\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\treturn Object.freeze({\r\n\t\taddTextOnClipboard,\r\n\t\thasHeaderOnSelection\r\n\t})\r\n\r\n})();","'use strict';\r\n\r\n// Last time updated: 2019-02-20 3:31:30 PM UTC\r\n\r\n// _______________\r\n// getStats v1.2.0\r\n\r\n// Open-Sourced: https://github.com/muaz-khan/getStats\r\n\r\n// --------------------------------------------------\r\n// Muaz Khan     - www.MuazKhan.com\r\n// MIT License   - www.WebRTC-Experiment.com/licence\r\n// --------------------------------------------------\r\n\r\n\"use strict\";var getStats=function(mediaStreamTrack,callback,interval){function getStatsLooper(){getStatsWrapper(function(results){if(results&&results.forEach){results.forEach(function(result){Object.keys(getStatsParser).forEach(function(key){if(\"function\"==typeof getStatsParser[key])try{getStatsParser[key](result)}catch(e){console.error(e.message,e.stack,e)}})});try{peer.iceConnectionState.search(/failed|closed|disconnected/gi)!==-1&&(nomore=!0)}catch(e){nomore=!0}nomore===!0&&(getStatsResult.datachannel&&(getStatsResult.datachannel.state=\"close\"),getStatsResult.ended=!0),getStatsResult.results=results,getStatsResult.audio&&getStatsResult.video&&(getStatsResult.bandwidth.speed=getStatsResult.audio.bytesSent-getStatsResult.bandwidth.helper.audioBytesSent+(getStatsResult.video.bytesSent-getStatsResult.bandwidth.helper.videoBytesSent),getStatsResult.bandwidth.helper.audioBytesSent=getStatsResult.audio.bytesSent,getStatsResult.bandwidth.helper.videoBytesSent=getStatsResult.video.bytesSent),callback(getStatsResult),nomore||void 0!=typeof interval&&interval&&setTimeout(getStatsLooper,interval||1e3)}})}function getStatsWrapper(cb){\"undefined\"!=typeof window.InstallTrigger||isSafari?peer.getStats(window.mediaStreamTrack||null).then(function(res){var items=[];res.forEach(function(r){items.push(r)}),cb(items)})[\"catch\"](cb):peer.getStats(function(res){var items=[];res.result().forEach(function(res){var item={};res.names().forEach(function(name){item[name]=res.stat(name)}),item.id=res.id,item.type=res.type,item.timestamp=res.timestamp,items.push(item)}),cb(items)})}var browserFakeUserAgent=\"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45\";!function(that){that&&\"undefined\"==typeof window&&\"undefined\"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),\"undefined\"!=typeof global.console.log&&\"undefined\"!=typeof global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),\"undefined\"==typeof document&&(that.document={documentElement:{appendChild:function(){return\"\"}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var obj={getContext:function(){return obj},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return\"\"}};return obj},that.HTMLVideoElement=function(){}),\"undefined\"==typeof location&&(that.location={protocol:\"file:\",href:\"\",hash:\"\"}),\"undefined\"==typeof screen&&(that.screen={width:0,height:0}),\"undefined\"==typeof URL&&(that.URL={createObjectURL:function(){return\"\"},revokeObjectURL:function(){return\"\"}}),\"undefined\"==typeof MediaStreamTrack&&(that.MediaStreamTrack=function(){}),\"undefined\"==typeof RTCPeerConnection&&(that.RTCPeerConnection=function(){}),that.window=global)}(\"undefined\"!=typeof global?global:null);var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;\"undefined\"==typeof MediaStreamTrack&&(MediaStreamTrack={});var systemNetworkType=((navigator.connection||{}).type||\"unknown\").toString().toLowerCase(),getStatsResult={encryption:\"sha-256\",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:systemNetworkType,systemIpAddress:\"192.168.1.2\",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){nomore=!0}},getStatsParser={checkIfOfferer:function(result){\"googLibjingleSession\"===result.type&&(getStatsResult.isOfferer=result.googInitiator)}},isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),peer=this;if(!(arguments[0]instanceof RTCPeerConnection))throw\"1st argument is not instance of RTCPeerConnection.\";peer=arguments[0],arguments[1]instanceof MediaStreamTrack&&(mediaStreamTrack=arguments[1],callback=arguments[2],interval=arguments[3]);var nomore=!1;getStatsParser.datachannel=function(result){\"datachannel\"===result.type&&(getStatsResult.datachannel={state:result.state})},getStatsParser.googCertificate=function(result){\"googCertificate\"==result.type&&(getStatsResult.encryption=result.googFingerprintAlgorithm),\"certificate\"==result.type&&(getStatsResult.encryption=result.fingerprintAlgorithm)},getStatsParser.checkAudioTracks=function(result){if(\"audio\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.audio[sendrecvType].codecs.indexOf(result.googCodecName||\"opus\")===-1&&getStatsResult.audio[sendrecvType].codecs.push(result.googCodecName||\"opus\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesSent||(getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.audio[sendrecvType].prevBytesSent;getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.audio[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.audio.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesReceived||(getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.audio[sendrecvType].prevBytesReceived;getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.audio.bytesReceived=kilobytes.toFixed(1)}if(result.googTrackId&&getStatsResult.audio[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.audio[sendrecvType].tracks.push(result.googTrackId),result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.audio.prevGoogCurrentDelayMs||(getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.audio.prevGoogCurrentDelayMs;getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.audio.latency=bytes.toFixed(1),getStatsResult.audio.latency<0&&(getStatsResult.audio.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.audio.prevPacketsLost||(getStatsResult.internal.audio.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.audio.prevPacketsLost;getStatsResult.internal.audio.prevPacketsLost=result.packetsLost,getStatsResult.audio.packetsLost=bytes.toFixed(1),getStatsResult.audio.packetsLost<0&&(getStatsResult.audio.packetsLost=0)}}}},getStatsParser.checkVideoTracks=function(result){if(\"video\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.video[sendrecvType].codecs.indexOf(result.googCodecName||\"VP8\")===-1&&getStatsResult.video[sendrecvType].codecs.push(result.googCodecName||\"VP8\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.googFrameHeightReceived&&result.googFrameWidthReceived&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthReceived,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightReceived),result.googFrameHeightSent&&result.googFrameWidthSent&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthSent,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightSent),result.googTrackId&&getStatsResult.video[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.video[sendrecvType].tracks.push(result.googTrackId),result.framerateMean){getStatsResult.bandwidth.framerateMean=result.framerateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevFramerateMean||(getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevFramerateMean;getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.framerateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].framerateMean=bytes.toFixed(1)}if(result.bitrateMean){getStatsResult.bandwidth.bitrateMean=result.bitrateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBitrateMean||(getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBitrateMean;getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].bitrateMean=bytes.toFixed(1)}if(result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.video.prevGoogCurrentDelayMs||(getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.video.prevGoogCurrentDelayMs;getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.video.latency=bytes.toFixed(1),getStatsResult.video.latency<0&&(getStatsResult.video.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.video.prevPacketsLost||(getStatsResult.internal.video.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.video.prevPacketsLost;getStatsResult.internal.video.prevPacketsLost=result.packetsLost,getStatsResult.video.packetsLost=bytes.toFixed(1),getStatsResult.video.packetsLost<0&&(getStatsResult.video.packetsLost=0)}}}},getStatsParser.bweforvideo=function(result){\"VideoBwe\"===result.type&&(getStatsResult.bandwidth.availableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googActualEncBitrate=result.googActualEncBitrate,getStatsResult.bandwidth.googAvailableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googAvailableReceiveBandwidth=result.googAvailableReceiveBandwidth,getStatsResult.bandwidth.googRetransmitBitrate=result.googRetransmitBitrate,getStatsResult.bandwidth.googTargetEncBitrate=result.googTargetEncBitrate,getStatsResult.bandwidth.googBucketDelay=result.googBucketDelay,getStatsResult.bandwidth.googTransmitBitrate=result.googTransmitBitrate)},getStatsParser.candidatePair=function(result){if(\"googCandidatePair\"===result.type||\"candidate-pair\"===result.type||\"local-candidate\"===result.type||\"remote-candidate\"===result.type){if(\"true\"==result.googActiveConnection){Object.keys(getStatsResult.internal.candidates).forEach(function(cid){var candidate=getStatsResult.internal.candidates[cid];candidate.ipAddress.indexOf(result.googLocalAddress)!==-1&&(getStatsResult.connectionType.local.candidateType=candidate.candidateType,getStatsResult.connectionType.local.ipAddress=candidate.ipAddress,getStatsResult.connectionType.local.networkType=candidate.networkType,getStatsResult.connectionType.local.transport=candidate.transport),candidate.ipAddress.indexOf(result.googRemoteAddress)!==-1&&(getStatsResult.connectionType.remote.candidateType=candidate.candidateType,getStatsResult.connectionType.remote.ipAddress=candidate.ipAddress,getStatsResult.connectionType.remote.networkType=candidate.networkType,getStatsResult.connectionType.remote.transport=candidate.transport)}),getStatsResult.connectionType.transport=result.googTransportType;var localCandidate=getStatsResult.internal.candidates[result.localCandidateId];localCandidate&&localCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=localCandidate.ipAddress);var remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];remoteCandidate&&remoteCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=remoteCandidate.ipAddress)}if(\"candidate-pair\"===result.type&&result.selected===!0&&result.nominated===!0&&\"succeeded\"===result.state)var localCandidate=getStatsResult.internal.candidates[result.remoteCandidateId],remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];if(\"local-candidate\"===result.type&&(getStatsResult.connectionType.local.candidateType=result.candidateType,getStatsResult.connectionType.local.ipAddress=result.ipAddress,getStatsResult.connectionType.local.networkType=result.networkType,getStatsResult.connectionType.local.transport=result.mozLocalTransport||result.transport),\"remote-candidate\"===result.type&&(getStatsResult.connectionType.remote.candidateType=result.candidateType,getStatsResult.connectionType.remote.ipAddress=result.ipAddress,getStatsResult.connectionType.remote.networkType=result.networkType,getStatsResult.connectionType.remote.transport=result.mozRemoteTransport||result.transport),isSafari){var sendrecvType=result.localCandidateId?\"send\":\"recv\";if(!sendrecvType)return;if(result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.availableOutgoingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate);var bytes=result.availableOutgoingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableOutgoingBitrate=kilobytes.toFixed(1)}if(result.availableIncomingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate);var bytes=result.availableIncomingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableIncomingBitrate=kilobytes.toFixed(1)}}}};var LOCAL_candidateType={},LOCAL_transport={},LOCAL_ipAddress={},LOCAL_networkType={};getStatsParser.localcandidate=function(result){\"localcandidate\"!==result.type&&\"local-candidate\"!==result.type||result.id&&(LOCAL_candidateType[result.id]||(LOCAL_candidateType[result.id]=[]),LOCAL_transport[result.id]||(LOCAL_transport[result.id]=[]),LOCAL_ipAddress[result.id]||(LOCAL_ipAddress[result.id]=[]),LOCAL_networkType[result.id]||(LOCAL_networkType[result.id]=[]),result.candidateType&&LOCAL_candidateType[result.id].indexOf(result.candidateType)===-1&&LOCAL_candidateType[result.id].push(result.candidateType),result.transport&&LOCAL_transport[result.id].indexOf(result.transport)===-1&&LOCAL_transport[result.id].push(result.transport),result.ipAddress&&LOCAL_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&LOCAL_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&LOCAL_networkType[result.id].indexOf(result.networkType)===-1&&LOCAL_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:LOCAL_candidateType[result.id],ipAddress:LOCAL_ipAddress[result.id],portNumber:result.portNumber,networkType:LOCAL_networkType[result.id],priority:result.priority,transport:LOCAL_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.local.candidateType=LOCAL_candidateType[result.id],getStatsResult.connectionType.local.ipAddress=LOCAL_ipAddress[result.id],getStatsResult.connectionType.local.networkType=LOCAL_networkType[result.id],getStatsResult.connectionType.local.transport=LOCAL_transport[result.id])};var REMOTE_candidateType={},REMOTE_transport={},REMOTE_ipAddress={},REMOTE_networkType={};getStatsParser.remotecandidate=function(result){\"remotecandidate\"!==result.type&&\"remote-candidate\"!==result.type||result.id&&(REMOTE_candidateType[result.id]||(REMOTE_candidateType[result.id]=[]),REMOTE_transport[result.id]||(REMOTE_transport[result.id]=[]),REMOTE_ipAddress[result.id]||(REMOTE_ipAddress[result.id]=[]),REMOTE_networkType[result.id]||(REMOTE_networkType[result.id]=[]),result.candidateType&&REMOTE_candidateType[result.id].indexOf(result.candidateType)===-1&&REMOTE_candidateType[result.id].push(result.candidateType),result.transport&&REMOTE_transport[result.id].indexOf(result.transport)===-1&&REMOTE_transport[result.id].push(result.transport),result.ipAddress&&REMOTE_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&REMOTE_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&REMOTE_networkType[result.id].indexOf(result.networkType)===-1&&REMOTE_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:REMOTE_candidateType[result.id],ipAddress:REMOTE_ipAddress[result.id],portNumber:result.portNumber,networkType:REMOTE_networkType[result.id],priority:result.priority,transport:REMOTE_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.remote.candidateType=REMOTE_candidateType[result.id],getStatsResult.connectionType.remote.ipAddress=REMOTE_ipAddress[result.id],getStatsResult.connectionType.remote.networkType=REMOTE_networkType[result.id],getStatsResult.connectionType.remote.transport=REMOTE_transport[result.id])},getStatsParser.dataSentReceived=function(result){!result.googCodecName||\"video\"!==result.mediaType&&\"audio\"!==result.mediaType||(result.bytesSent&&(getStatsResult[result.mediaType].bytesSent=parseInt(result.bytesSent)),result.bytesReceived&&(getStatsResult[result.mediaType].bytesReceived=parseInt(result.bytesReceived)))},getStatsParser.inboundrtp=function(result){if(isSafari&&\"inbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.outboundrtp=function(result){if(isSafari&&\"outbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.track=function(result){if(isSafari&&\"track\"===result.type){var sendrecvType=result.remoteSource===!0?\"send\":\"recv\";result.frameWidth&&result.frameHeight&&(getStatsResult.resolutions[sendrecvType].width=result.frameWidth,getStatsResult.resolutions[sendrecvType].height=result.frameHeight)}};var SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}};getStatsParser.ssrc=function(result){if(result.googCodecName&&(\"video\"===result.mediaType||\"audio\"===result.mediaType)&&\"ssrc\"===result.type){var sendrecvType=result.id.split(\"_\").pop();SSRC[result.mediaType][sendrecvType].indexOf(result.ssrc)===-1&&SSRC[result.mediaType][sendrecvType].push(result.ssrc),getStatsResult[result.mediaType][sendrecvType].streams=SSRC[result.mediaType][sendrecvType].length}},getStatsLooper()};\"undefined\"!=typeof module&&(module.exports=getStats),\"function\"==typeof define&&define.amd&&define(\"getStats\",[],function(){return getStats});","(function() {\r\n  if (!navigator.mediaDevices) navigator.mediaDevices = {};\r\n  if (!navigator.mediaDevices.getUserMedia) {\r\n    var getUserMedia =\r\n      navigator.webkitGetUserMedia ||\r\n      navigator.mozGetUserMedia ||\r\n      navigator.msGetUserMedia ||\r\n      navigator.getUserMedia;\r\n\r\n    if (getUserMedia) {\r\n      navigator.mediaDevices.getUserMedia = function(constraints) {\r\n        return new Promise(function(resolve, reject) {\r\n          getUserMedia(\r\n            constraints,\r\n            function(stream) {\r\n              resolve(stream);\r\n            },\r\n            function(error) {\r\n              reject(error);\r\n            }\r\n          );\r\n        });\r\n      };\r\n    } else {\r\n      navigator.mediaDevices.getUserMedia = function() {\r\n        // A missing `getUserMedia` seemingly can mean one of two things:\r\n        //\r\n        // 1) WebRTC is unsupported or disabled on this browser\r\n        // 2) This is an insecure connection\r\n        //   * This handling of insecure connections happens only on certain browsers.\r\n        //     It was observed in Chromium 80 and Firefox 75, but not Firefox 68. I suspect it's the new behavior.\r\n        //   * In other browsers, it handles insecure connections by throwing `NotAllowedError`.\r\n        //     We still handle this case in the calling function.\r\n        //   * See: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n        //     As of this writing, this claims that the browser does *both* of these things for\r\n        //     insecure connections, which is of course impossible and thus confusing.\r\n        //\r\n        // We will attempt to distinguish these two cases by checking for various webrtc-related fields on\r\n        // `window` (inspired by github.com/muaz-khan/DetectRTC). If none of those fields exist, we assume\r\n        // that WebRTC is not supported on this browser.\r\n        return new Promise(function(resolve, reject) {\r\n          if (!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection || window.RTCIceGatherer)) {\r\n            var e = new Error(\"getUserMedia is not supported in this browser.\");\r\n            // I'd use NotSupportedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomNotSupportedError';\r\n            reject(e);\r\n          } else {\r\n            var e = new Error(\"insecure connection\");\r\n            // I'd use NotAllowedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomSecureConnectionError';\r\n            reject(e);\r\n          }\r\n        });\r\n      };\r\n    }\r\n  }\r\n})();","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t\r\n\t'use strict';\r\n\t\r\n\tvar _adapter_factory = require('./adapter_factory.js');\r\n\t\r\n\tvar adapter = (0, _adapter_factory.adapterFactory)({ window: window });\r\n\tmodule.exports = adapter; // this is the difference from adapter_core.\r\n\t\r\n\t},{\"./adapter_factory.js\":2}],2:[function(require,module,exports){\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.adapterFactory = adapterFactory;\r\n\t\r\n\tvar _utils = require('./utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tvar _chrome_shim = require('./chrome/chrome_shim');\r\n\t\r\n\tvar chromeShim = _interopRequireWildcard(_chrome_shim);\r\n\t\r\n\tvar _edge_shim = require('./edge/edge_shim');\r\n\t\r\n\tvar edgeShim = _interopRequireWildcard(_edge_shim);\r\n\t\r\n\tvar _firefox_shim = require('./firefox/firefox_shim');\r\n\t\r\n\tvar firefoxShim = _interopRequireWildcard(_firefox_shim);\r\n\t\r\n\tvar _safari_shim = require('./safari/safari_shim');\r\n\t\r\n\tvar safariShim = _interopRequireWildcard(_safari_shim);\r\n\t\r\n\tvar _common_shim = require('./common_shim');\r\n\t\r\n\tvar commonShim = _interopRequireWildcard(_common_shim);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\t// Shimming starts here.\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\tfunction adapterFactory() {\r\n\t\tvar _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\r\n\t\t\t\twindow = _ref.window;\r\n\t\r\n\t\tvar options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\r\n\t\t\tshimChrome: true,\r\n\t\t\tshimFirefox: true,\r\n\t\t\tshimEdge: true,\r\n\t\t\tshimSafari: true\r\n\t\t};\r\n\t\r\n\t\t// Utils.\r\n\t\tvar logging = utils.log;\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tvar adapter = {\r\n\t\t\tbrowserDetails: browserDetails,\r\n\t\t\tcommonShim: commonShim,\r\n\t\t\textractVersion: utils.extractVersion,\r\n\t\t\tdisableLog: utils.disableLog,\r\n\t\t\tdisableWarnings: utils.disableWarnings\r\n\t\t};\r\n\t\r\n\t\t// Shim browser if found.\r\n\t\tswitch (browserDetails.browser) {\r\n\t\t\tcase 'chrome':\r\n\t\t\t\tif (!chromeShim || !chromeShim.shimPeerConnection || !options.shimChrome) {\r\n\t\t\t\t\tlogging('Chrome shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming chrome.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = chromeShim;\r\n\t\r\n\t\t\t\tchromeShim.shimGetUserMedia(window);\r\n\t\t\t\tchromeShim.shimMediaStream(window);\r\n\t\t\t\tchromeShim.shimPeerConnection(window);\r\n\t\t\t\tchromeShim.shimOnTrack(window);\r\n\t\t\t\tchromeShim.shimAddTrackRemoveTrack(window);\r\n\t\t\t\tchromeShim.shimGetSendersWithDtmf(window);\r\n\t\t\t\tchromeShim.shimGetStats(window);\r\n\t\t\t\tchromeShim.shimSenderReceiverGetStats(window);\r\n\t\t\t\tchromeShim.fixNegotiationNeeded(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimConnectionState(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tcommonShim.removeAllowExtmapMixed(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'firefox':\r\n\t\t\t\tif (!firefoxShim || !firefoxShim.shimPeerConnection || !options.shimFirefox) {\r\n\t\t\t\t\tlogging('Firefox shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming firefox.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = firefoxShim;\r\n\t\r\n\t\t\t\tfirefoxShim.shimGetUserMedia(window);\r\n\t\t\t\tfirefoxShim.shimPeerConnection(window);\r\n\t\t\t\tfirefoxShim.shimOnTrack(window);\r\n\t\t\t\tfirefoxShim.shimRemoveStream(window);\r\n\t\t\t\tfirefoxShim.shimSenderGetStats(window);\r\n\t\t\t\tfirefoxShim.shimReceiverGetStats(window);\r\n\t\t\t\tfirefoxShim.shimRTCDataChannel(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimConnectionState(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'edge':\r\n\t\t\t\tif (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\r\n\t\t\t\t\tlogging('MS edge shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming edge.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = edgeShim;\r\n\t\r\n\t\t\t\tedgeShim.shimGetUserMedia(window);\r\n\t\t\t\tedgeShim.shimGetDisplayMedia(window);\r\n\t\t\t\tedgeShim.shimPeerConnection(window);\r\n\t\t\t\tedgeShim.shimReplaceTrack(window);\r\n\t\r\n\t\t\t\t// the edge shim implements the full RTCIceCandidate object.\r\n\t\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'safari':\r\n\t\t\t\tif (!safariShim || !options.shimSafari) {\r\n\t\t\t\t\tlogging('Safari shim is not included in this adapter release.');\r\n\t\t\t\t\treturn adapter;\r\n\t\t\t\t}\r\n\t\t\t\tlogging('adapter.js shimming safari.');\r\n\t\t\t\t// Export to the adapter global object visible in the browser.\r\n\t\t\t\tadapter.browserShim = safariShim;\r\n\t\r\n\t\t\t\tsafariShim.shimRTCIceServerUrls(window);\r\n\t\t\t\tsafariShim.shimCreateOfferLegacy(window);\r\n\t\t\t\tsafariShim.shimCallbacksAPI(window);\r\n\t\t\t\tsafariShim.shimLocalStreamsAPI(window);\r\n\t\t\t\tsafariShim.shimRemoteStreamsAPI(window);\r\n\t\t\t\tsafariShim.shimTrackEventTransceiver(window);\r\n\t\t\t\tsafariShim.shimGetUserMedia(window);\r\n\t\r\n\t\t\t\tcommonShim.shimRTCIceCandidate(window);\r\n\t\t\t\tcommonShim.shimMaxMessageSize(window);\r\n\t\t\t\tcommonShim.shimSendThrowTypeError(window);\r\n\t\t\t\tcommonShim.removeAllowExtmapMixed(window);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tlogging('Unsupported browser!');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\r\n\t\treturn adapter;\r\n\t}\r\n\t\r\n\t// Browser shims.\r\n\t\r\n\t},{\"./chrome/chrome_shim\":3,\"./common_shim\":6,\"./edge/edge_shim\":7,\"./firefox/firefox_shim\":11,\"./safari/safari_shim\":14,\"./utils\":15}],3:[function(require,module,exports){\r\n\t\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimMediaStream = shimMediaStream;\r\n\texports.shimOnTrack = shimOnTrack;\r\n\texports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\r\n\texports.shimGetStats = shimGetStats;\r\n\texports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\r\n\texports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\r\n\texports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.fixNegotiationNeeded = fixNegotiationNeeded;\r\n\t\r\n\tvar _utils = require('../utils.js');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tfunction shimMediaStream(window) {\r\n\t\twindow.MediaStream = window.MediaStream || window.webkitMediaStream;\r\n\t}\r\n\t\r\n\tfunction shimOnTrack(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn this._ontrack;\r\n\t\t\t\t},\r\n\t\t\t\tset: function set(f) {\r\n\t\t\t\t\tif (this._ontrack) {\r\n\t\t\t\t\t\tthis.removeEventListener('track', this._ontrack);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addEventListener('track', this._ontrack = f);\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tconfigurable: true\r\n\t\t\t});\r\n\t\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tif (!this._ontrackpoly) {\r\n\t\t\t\t\tthis._ontrackpoly = function (e) {\r\n\t\t\t\t\t\t// onaddstream does not fire when a track is added to an existing\r\n\t\t\t\t\t\t// stream. But stream.onaddtrack is implemented so we use that.\r\n\t\t\t\t\t\te.stream.addEventListener('addtrack', function (te) {\r\n\t\t\t\t\t\t\tvar receiver = void 0;\r\n\t\t\t\t\t\t\tif (window.RTCPeerConnection.prototype.getReceivers) {\r\n\t\t\t\t\t\t\t\treceiver = _this.getReceivers().find(function (r) {\r\n\t\t\t\t\t\t\t\t\treturn r.track && r.track.id === te.track.id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treceiver = { track: te.track };\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\tvar event = new Event('track');\r\n\t\t\t\t\t\t\tevent.track = te.track;\r\n\t\t\t\t\t\t\tevent.receiver = receiver;\r\n\t\t\t\t\t\t\tevent.transceiver = { receiver: receiver };\r\n\t\t\t\t\t\t\tevent.streams = [e.stream];\r\n\t\t\t\t\t\t\t_this.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\te.stream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t\t\tvar receiver = void 0;\r\n\t\t\t\t\t\t\tif (window.RTCPeerConnection.prototype.getReceivers) {\r\n\t\t\t\t\t\t\t\treceiver = _this.getReceivers().find(function (r) {\r\n\t\t\t\t\t\t\t\t\treturn r.track && r.track.id === track.id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treceiver = { track: track };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar event = new Event('track');\r\n\t\t\t\t\t\t\tevent.track = track;\r\n\t\t\t\t\t\t\tevent.receiver = receiver;\r\n\t\t\t\t\t\t\tevent.transceiver = { receiver: receiver };\r\n\t\t\t\t\t\t\tevent.streams = [e.stream];\r\n\t\t\t\t\t\t\t_this.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.addEventListener('addstream', this._ontrackpoly);\r\n\t\t\t\t}\r\n\t\t\t\treturn origSetRemoteDescription.apply(this, arguments);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\t// even if RTCRtpTransceiver is in window, it is only used and\r\n\t\t\t// emitted in unified-plan. Unfortunately this means we need\r\n\t\t\t// to unconditionally wrap the event.\r\n\t\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\t\tif (!e.transceiver) {\r\n\t\t\t\t\tObject.defineProperty(e, 'transceiver', { value: { receiver: e.receiver } });\r\n\t\t\t\t}\r\n\t\t\t\treturn e;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimGetSendersWithDtmf(window) {\r\n\t\t// Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\r\n\t\t\tvar shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttrack: track,\r\n\t\t\t\t\tget dtmf() {\r\n\t\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\t\tif (track.kind === 'audio') {\r\n\t\t\t\t\t\t\t\tthis._dtmf = pc.createDTMFSender(track);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t\t},\r\n\t\t\t\t\t_pc: pc\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\r\n\t\t\t// augment addTrack when getSenders is not available.\r\n\t\t\tif (!window.RTCPeerConnection.prototype.getSenders) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\t\treturn this._senders.slice(); // return a copy of the internal state.\r\n\t\t\t\t};\r\n\t\t\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\t\tif (!sender) {\r\n\t\t\t\t\t\tsender = shimSenderWithDtmf(this, track);\r\n\t\t\t\t\t\tthis._senders.push(sender);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn sender;\r\n\t\t\t\t};\r\n\t\r\n\t\t\t\tvar origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n\t\t\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\t\t\torigRemoveTrack.apply(this, arguments);\r\n\t\t\t\t\tvar idx = this._senders.indexOf(sender);\r\n\t\t\t\t\tif (idx !== -1) {\r\n\t\t\t\t\t\tthis._senders.splice(idx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\torigAddStream.apply(this, [stream]);\r\n\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t_this2._senders.push(shimSenderWithDtmf(_this2, track));\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\r\n\t\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\t\tthis._senders = this._senders || [];\r\n\t\t\t\torigRemoveStream.apply(this, [stream]);\r\n\t\r\n\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\tvar sender = _this3._senders.find(function (s) {\r\n\t\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (sender) {\r\n\t\t\t\t\t\t// remove sender\r\n\t\t\t\t\t\t_this3._senders.splice(_this3._senders.indexOf(sender), 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t} else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n\t\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\tvar _this4 = this;\r\n\t\r\n\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\treturn sender._pc = _this4;\r\n\t\t\t\t});\r\n\t\t\t\treturn senders;\r\n\t\t\t};\r\n\t\r\n\t\t\tObject.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\tif (this.track.kind === 'audio') {\r\n\t\t\t\t\t\t\tthis._dtmf = this._pc.createDTMFSender(this.track);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimGetStats(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tvar _this5 = this;\r\n\t\r\n\t\t\tvar _arguments = Array.prototype.slice.call(arguments),\r\n\t\t\t\t\tselector = _arguments[0],\r\n\t\t\t\t\tonSucc = _arguments[1],\r\n\t\t\t\t\tonErr = _arguments[2];\r\n\t\r\n\t\t\t// If selector is a function then we are in the old style stats so just\r\n\t\t\t// pass back the original getStats format to avoid breaking old users.\r\n\t\r\n\t\r\n\t\t\tif (arguments.length > 0 && typeof selector === 'function') {\r\n\t\t\t\treturn origGetStats.apply(this, arguments);\r\n\t\t\t}\r\n\t\r\n\t\t\t// When spec-style getStats is supported, return those when called with\r\n\t\t\t// either no arguments or the selector argument is null.\r\n\t\t\tif (origGetStats.length === 0 && (arguments.length === 0 || typeof selector !== 'function')) {\r\n\t\t\t\treturn origGetStats.apply(this, []);\r\n\t\t\t}\r\n\t\r\n\t\t\tvar fixChromeStats_ = function fixChromeStats_(response) {\r\n\t\t\t\tvar standardReport = {};\r\n\t\t\t\tvar reports = response.result();\r\n\t\t\t\treports.forEach(function (report) {\r\n\t\t\t\t\tvar standardStats = {\r\n\t\t\t\t\t\tid: report.id,\r\n\t\t\t\t\t\ttimestamp: report.timestamp,\r\n\t\t\t\t\t\ttype: {\r\n\t\t\t\t\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\t\t\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t\t\t\t\t}[report.type] || report.type\r\n\t\t\t\t\t};\r\n\t\t\t\t\treport.names().forEach(function (name) {\r\n\t\t\t\t\t\tstandardStats[name] = report.stat(name);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tstandardReport[standardStats.id] = standardStats;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\treturn standardReport;\r\n\t\t\t};\r\n\t\r\n\t\t\t// shim getStats with maplike support\r\n\t\t\tvar makeMapStats = function makeMapStats(stats) {\r\n\t\t\t\treturn new Map(Object.keys(stats).map(function (key) {\r\n\t\t\t\t\treturn [key, stats[key]];\r\n\t\t\t\t}));\r\n\t\t\t};\r\n\t\r\n\t\t\tif (arguments.length >= 2) {\r\n\t\t\t\tvar successCallbackWrapper_ = function successCallbackWrapper_(response) {\r\n\t\t\t\t\tonSucc(makeMapStats(fixChromeStats_(response)));\r\n\t\t\t\t};\r\n\t\r\n\t\t\t\treturn origGetStats.apply(this, [successCallbackWrapper_, selector]);\r\n\t\t\t}\r\n\t\r\n\t\t\t// promise-support\r\n\t\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\t\torigGetStats.apply(_this5, [function (response) {\r\n\t\t\t\t\tresolve(makeMapStats(fixChromeStats_(response)));\r\n\t\t\t\t}, reject]);\r\n\t\t\t}).then(onSucc, onErr);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSenderReceiverGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim sender stats.\r\n\t\tif (!('getStats' in window.RTCRtpSender.prototype)) {\r\n\t\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\t\tif (origGetSenders) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\t\tvar _this6 = this;\r\n\t\r\n\t\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\t\treturn sender._pc = _this6;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn senders;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\tif (origAddTrack) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n\t\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\t\tsender._pc = this;\r\n\t\t\t\t\treturn sender;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\twindow.RTCRtpSender.prototype.getStats = function getStats() {\r\n\t\t\t\tvar sender = this;\r\n\t\t\t\treturn this._pc.getStats().then(function (result) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t/* Note: this will include stats of all senders that\r\n\t\t\t\t\t\t *   send a track with the same id as sender.track as\r\n\t\t\t\t\t\t *   it is not possible to identify the RTCRtpSender.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tutils.filterStats(result, sender.track, true)\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\t// shim receiver stats.\r\n\t\tif (!('getStats' in window.RTCRtpReceiver.prototype)) {\r\n\t\t\tvar origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n\t\t\tif (origGetReceivers) {\r\n\t\t\t\twindow.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n\t\t\t\t\tvar _this7 = this;\r\n\t\r\n\t\t\t\t\tvar receivers = origGetReceivers.apply(this, []);\r\n\t\t\t\t\treceivers.forEach(function (receiver) {\r\n\t\t\t\t\t\treturn receiver._pc = _this7;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn receivers;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\t\te.receiver._pc = e.srcElement;\r\n\t\t\t\treturn e;\r\n\t\t\t});\r\n\t\t\twindow.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n\t\t\t\tvar receiver = this;\r\n\t\t\t\treturn this._pc.getStats().then(function (result) {\r\n\t\t\t\t\treturn utils.filterStats(result, receiver.track, false);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tif (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim RTCPeerConnection.getStats(track).\r\n\t\tvar origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tif (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\r\n\t\t\t\tvar track = arguments[0];\r\n\t\t\t\tvar sender = void 0;\r\n\t\t\t\tvar receiver = void 0;\r\n\t\t\t\tvar err = void 0;\r\n\t\t\t\tthis.getSenders().forEach(function (s) {\r\n\t\t\t\t\tif (s.track === track) {\r\n\t\t\t\t\t\tif (sender) {\r\n\t\t\t\t\t\t\terr = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsender = s;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.getReceivers().forEach(function (r) {\r\n\t\t\t\t\tif (r.track === track) {\r\n\t\t\t\t\t\tif (receiver) {\r\n\t\t\t\t\t\t\terr = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treceiver = r;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn r.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (err || sender && receiver) {\r\n\t\t\t\t\treturn Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\r\n\t\t\t\t} else if (sender) {\r\n\t\t\t\t\treturn sender.getStats();\r\n\t\t\t\t} else if (receiver) {\r\n\t\t\t\t\treturn receiver.getStats();\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\r\n\t\t\t}\r\n\t\t\treturn origGetStats.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimAddTrackRemoveTrackWithNative(window) {\r\n\t\t// shim addTrack/removeTrack with native variants in order to make\r\n\t\t// the interactions with legacy getLocalStreams behave as in other browsers.\r\n\t\t// Keeps a mapping stream.id => [stream, rtpsenders...]\r\n\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\tvar _this8 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\treturn Object.keys(this._shimmedLocalStreams).map(function (streamId) {\r\n\t\t\t\treturn _this8._shimmedLocalStreams[streamId][0];\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\tif (!stream) {\r\n\t\t\t\treturn origAddTrack.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\r\n\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\tif (!this._shimmedLocalStreams[stream.id]) {\r\n\t\t\t\tthis._shimmedLocalStreams[stream.id] = [stream, sender];\r\n\t\t\t} else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\r\n\t\t\t\tthis._shimmedLocalStreams[stream.id].push(sender);\r\n\t\t\t}\r\n\t\t\treturn sender;\r\n\t\t};\r\n\t\r\n\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\tvar _this9 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\r\n\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\tvar alreadyExists = _this9.getSenders().find(function (s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (alreadyExists) {\r\n\t\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar existingSenders = this.getSenders();\r\n\t\t\torigAddStream.apply(this, arguments);\r\n\t\t\tvar newSenders = this.getSenders().filter(function (newSender) {\r\n\t\t\t\treturn existingSenders.indexOf(newSender) === -1;\r\n\t\t\t});\r\n\t\t\tthis._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\tdelete this._shimmedLocalStreams[stream.id];\r\n\t\t\treturn origRemoveStream.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\tvar _this10 = this;\r\n\t\r\n\t\t\tthis._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\t\t\tif (sender) {\r\n\t\t\t\tObject.keys(this._shimmedLocalStreams).forEach(function (streamId) {\r\n\t\t\t\t\tvar idx = _this10._shimmedLocalStreams[streamId].indexOf(sender);\r\n\t\t\t\t\tif (idx !== -1) {\r\n\t\t\t\t\t\t_this10._shimmedLocalStreams[streamId].splice(idx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_this10._shimmedLocalStreams[streamId].length === 1) {\r\n\t\t\t\t\t\tdelete _this10._shimmedLocalStreams[streamId];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn origRemoveTrack.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimAddTrackRemoveTrack(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\t// shim addTrack and removeTrack.\r\n\t\tif (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\r\n\t\t\treturn shimAddTrackRemoveTrackWithNative(window);\r\n\t\t}\r\n\t\r\n\t\t// also shim pc.getLocalStreams when addTrack is shimmed\r\n\t\t// to return the original streams.\r\n\t\tvar origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\r\n\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\tvar _this11 = this;\r\n\t\r\n\t\t\tvar nativeStreams = origGetLocalStreams.apply(this);\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\t\treturn nativeStreams.map(function (stream) {\r\n\t\t\t\treturn _this11._reverseStreams[stream.id];\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\tvar _this12 = this;\r\n\t\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\r\n\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\tvar alreadyExists = _this12.getSenders().find(function (s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (alreadyExists) {\r\n\t\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// Add identity mapping for consistency with addTrack.\r\n\t\t\t// Unless this is being used with a stream from addTrack.\r\n\t\t\tif (!this._reverseStreams[stream.id]) {\r\n\t\t\t\tvar newStream = new window.MediaStream(stream.getTracks());\r\n\t\t\t\tthis._streams[stream.id] = newStream;\r\n\t\t\t\tthis._reverseStreams[newStream.id] = stream;\r\n\t\t\t\tstream = newStream;\r\n\t\t\t}\r\n\t\t\torigAddStream.apply(this, [stream]);\r\n\t\t};\r\n\t\r\n\t\tvar origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\r\n\t\t\torigRemoveStream.apply(this, [this._streams[stream.id] || stream]);\r\n\t\t\tdelete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\r\n\t\t\tdelete this._streams[stream.id];\r\n\t\t};\r\n\t\r\n\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n\t\t\tvar _this13 = this;\r\n\t\r\n\t\t\tif (this.signalingState === 'closed') {\r\n\t\t\t\tthrow new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n\t\t\t}\r\n\t\t\tvar streams = [].slice.call(arguments, 1);\r\n\t\t\tif (streams.length !== 1 || !streams[0].getTracks().find(function (t) {\r\n\t\t\t\treturn t === track;\r\n\t\t\t})) {\r\n\t\t\t\t// this is not fully correct but all we can manage without\r\n\t\t\t\t// [[associated MediaStreams]] internal slot.\r\n\t\t\t\tthrow new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar alreadyExists = this.getSenders().find(function (s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\t\tif (alreadyExists) {\r\n\t\t\t\tthrow new DOMException('Track already exists.', 'InvalidAccessError');\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tthis._reverseStreams = this._reverseStreams || {};\r\n\t\t\tvar oldStream = this._streams[stream.id];\r\n\t\t\tif (oldStream) {\r\n\t\t\t\t// this is using odd Chrome behaviour, use with caution:\r\n\t\t\t\t// https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\r\n\t\t\t\t// Note: we rely on the high-level addTrack/dtmf shim to\r\n\t\t\t\t// create the sender with a dtmf sender.\r\n\t\t\t\toldStream.addTrack(track);\r\n\t\r\n\t\t\t\t// Trigger ONN async.\r\n\t\t\t\tPromise.resolve().then(function () {\r\n\t\t\t\t\t_this13.dispatchEvent(new Event('negotiationneeded'));\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvar newStream = new window.MediaStream([track]);\r\n\t\t\t\tthis._streams[stream.id] = newStream;\r\n\t\t\t\tthis._reverseStreams[newStream.id] = stream;\r\n\t\t\t\tthis.addStream(newStream);\r\n\t\t\t}\r\n\t\t\treturn this.getSenders().find(function (s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\t// replace the internal stream id with the external one and\r\n\t\t// vice versa.\r\n\t\tfunction replaceInternalStreamId(pc, description) {\r\n\t\t\tvar sdp = description.sdp;\r\n\t\t\tObject.keys(pc._reverseStreams || []).forEach(function (internalId) {\r\n\t\t\t\tvar externalStream = pc._reverseStreams[internalId];\r\n\t\t\t\tvar internalStream = pc._streams[externalStream.id];\r\n\t\t\t\tsdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\r\n\t\t\t});\r\n\t\t\treturn new RTCSessionDescription({\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction replaceExternalStreamId(pc, description) {\r\n\t\t\tvar sdp = description.sdp;\r\n\t\t\tObject.keys(pc._reverseStreams || []).forEach(function (internalId) {\r\n\t\t\t\tvar externalStream = pc._reverseStreams[internalId];\r\n\t\t\t\tvar internalStream = pc._streams[externalStream.id];\r\n\t\t\t\tsdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\r\n\t\t\t});\r\n\t\t\treturn new RTCSessionDescription({\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t}\r\n\t\t['createOffer', 'createAnswer'].forEach(function (method) {\r\n\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\tvar _this14 = this;\r\n\t\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tvar isLegacyCall = arguments.length && typeof arguments[0] === 'function';\r\n\t\t\t\tif (isLegacyCall) {\r\n\t\t\t\t\treturn nativeMethod.apply(this, [function (description) {\r\n\t\t\t\t\t\tvar desc = replaceInternalStreamId(_this14, description);\r\n\t\t\t\t\t\targs[0].apply(null, [desc]);\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (args[1]) {\r\n\t\t\t\t\t\t\targs[1].apply(null, err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, arguments[2]]);\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments).then(function (description) {\r\n\t\t\t\t\treturn replaceInternalStreamId(_this14, description);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t});\r\n\t\r\n\t\tvar origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {\r\n\t\t\tif (!arguments.length || !arguments[0].type) {\r\n\t\t\t\treturn origSetLocalDescription.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\targuments[0] = replaceExternalStreamId(this, arguments[0]);\r\n\t\t\treturn origSetLocalDescription.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\t// TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\r\n\t\r\n\t\tvar origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\r\n\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\r\n\t\t\tget: function get() {\r\n\t\t\t\tvar description = origLocalDescription.get.apply(this);\r\n\t\t\t\tif (description.type === '') {\r\n\t\t\t\t\treturn description;\r\n\t\t\t\t}\r\n\t\t\t\treturn replaceInternalStreamId(this, description);\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\twindow.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n\t\t\tvar _this15 = this;\r\n\t\r\n\t\t\tif (this.signalingState === 'closed') {\r\n\t\t\t\tthrow new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n\t\t\t}\r\n\t\t\t// We can not yet check for sender instanceof RTCRtpSender\r\n\t\t\t// since we shim RTPSender. So we check if sender._pc is set.\r\n\t\t\tif (!sender._pc) {\r\n\t\t\t\tthrow new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\r\n\t\t\t}\r\n\t\t\tvar isLocal = sender._pc === this;\r\n\t\t\tif (!isLocal) {\r\n\t\t\t\tthrow new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\r\n\t\t\t}\r\n\t\r\n\t\t\t// Search for the native stream the senders track belongs to.\r\n\t\t\tthis._streams = this._streams || {};\r\n\t\t\tvar stream = void 0;\r\n\t\t\tObject.keys(this._streams).forEach(function (streamid) {\r\n\t\t\t\tvar hasTrack = _this15._streams[streamid].getTracks().find(function (track) {\r\n\t\t\t\t\treturn sender.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (hasTrack) {\r\n\t\t\t\t\tstream = _this15._streams[streamid];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (stream) {\r\n\t\t\t\tif (stream.getTracks().length === 1) {\r\n\t\t\t\t\t// if this is the last track of the stream, remove the stream. This\r\n\t\t\t\t\t// takes care of any shimmed _senders.\r\n\t\t\t\t\tthis.removeStream(this._reverseStreams[stream.id]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// relying on the same odd chrome behaviour as above.\r\n\t\t\t\t\tstream.removeTrack(sender.track);\r\n\t\t\t\t}\r\n\t\t\t\tthis.dispatchEvent(new Event('negotiationneeded'));\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\r\n\t\t\t// very basic support for old versions.\r\n\t\t\twindow.RTCPeerConnection = window.webkitRTCPeerConnection;\r\n\t\t}\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// shim implicit creation of RTCSessionDescription/RTCIceCandidate\r\n\t\tif (browserDetails.version < 53) {\r\n\t\t\t['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\r\n\t\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\t\targuments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t\t});\r\n\t\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// support for addIceCandidate(null or undefined)\r\n\t\tvar nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n\t\twindow.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n\t\t\tif (!arguments[0]) {\r\n\t\t\t\tif (arguments[1]) {\r\n\t\t\t\t\targuments[1].apply(null);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\t// Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n\t\t\t// in older versions. Native support planned for Chrome M77.\r\n\t\t\tif (browserDetails.version < 78 && arguments[0] && arguments[0].candidate === '') {\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\treturn nativeAddIceCandidate.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction fixNegotiationNeeded(window) {\r\n\t\tutils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {\r\n\t\t\tvar pc = e.target;\r\n\t\t\tif (pc.signalingState !== 'stable') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\t},{\"../utils.js\":15,\"./getdisplaymedia\":4,\"./getusermedia\":5}],4:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window, getSourceId) {\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// getSourceId is a function that returns a promise resolving with\r\n\t\t// the sourceId of the screen/window/tab to be shared.\r\n\t\tif (typeof getSourceId !== 'function') {\r\n\t\t\tconsole.error('shimGetDisplayMedia: getSourceId argument is not ' + 'a function');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n\t\t\treturn getSourceId(constraints).then(function (sourceId) {\r\n\t\t\t\tvar widthSpecified = constraints.video && constraints.video.width;\r\n\t\t\t\tvar heightSpecified = constraints.video && constraints.video.height;\r\n\t\t\t\tvar frameRateSpecified = constraints.video && constraints.video.frameRate;\r\n\t\t\t\tconstraints.video = {\r\n\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\r\n\t\t\t\t\t\tchromeMediaSourceId: sourceId,\r\n\t\t\t\t\t\tmaxFrameRate: frameRateSpecified || 3\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tif (widthSpecified) {\r\n\t\t\t\t\tconstraints.video.mandatory.maxWidth = widthSpecified;\r\n\t\t\t\t}\r\n\t\t\t\tif (heightSpecified) {\r\n\t\t\t\t\tconstraints.video.mandatory.maxHeight = heightSpecified;\r\n\t\t\t\t}\r\n\t\t\t\treturn window.navigator.mediaDevices.getUserMedia(constraints);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],5:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\t\r\n\tvar _utils = require('../utils.js');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tvar logging = utils.log;\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tif (!navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tvar constraintsToChrome_ = function constraintsToChrome_(c) {\r\n\t\t\tif ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.mandatory || c.optional) {\r\n\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t\tvar cc = {};\r\n\t\t\tObject.keys(c).forEach(function (key) {\r\n\t\t\t\tif (key === 'require' || key === 'advanced' || key === 'mediaSource') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar r = _typeof(c[key]) === 'object' ? c[key] : { ideal: c[key] };\r\n\t\t\t\tif (r.exact !== undefined && typeof r.exact === 'number') {\r\n\t\t\t\t\tr.min = r.max = r.exact;\r\n\t\t\t\t}\r\n\t\t\t\tvar oldname_ = function oldname_(prefix, name) {\r\n\t\t\t\t\tif (prefix) {\r\n\t\t\t\t\t\treturn prefix + name.charAt(0).toUpperCase() + name.slice(1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn name === 'deviceId' ? 'sourceId' : name;\r\n\t\t\t\t};\r\n\t\t\t\tif (r.ideal !== undefined) {\r\n\t\t\t\t\tcc.optional = cc.optional || [];\r\n\t\t\t\t\tvar oc = {};\r\n\t\t\t\t\tif (typeof r.ideal === 'number') {\r\n\t\t\t\t\t\toc[oldname_('min', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t\toc = {};\r\n\t\t\t\t\t\toc[oldname_('max', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toc[oldname_('', key)] = r.ideal;\r\n\t\t\t\t\t\tcc.optional.push(oc);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (r.exact !== undefined && typeof r.exact !== 'number') {\r\n\t\t\t\t\tcc.mandatory = cc.mandatory || {};\r\n\t\t\t\t\tcc.mandatory[oldname_('', key)] = r.exact;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t['min', 'max'].forEach(function (mix) {\r\n\t\t\t\t\t\tif (r[mix] !== undefined) {\r\n\t\t\t\t\t\t\tcc.mandatory = cc.mandatory || {};\r\n\t\t\t\t\t\t\tcc.mandatory[oldname_(mix, key)] = r[mix];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (c.advanced) {\r\n\t\t\t\tcc.optional = (cc.optional || []).concat(c.advanced);\r\n\t\t\t}\r\n\t\t\treturn cc;\r\n\t\t};\r\n\t\r\n\t\tvar shimConstraints_ = function shimConstraints_(constraints, func) {\r\n\t\t\tif (browserDetails.version >= 61) {\r\n\t\t\t\treturn func(constraints);\r\n\t\t\t}\r\n\t\t\tconstraints = JSON.parse(JSON.stringify(constraints));\r\n\t\t\tif (constraints && _typeof(constraints.audio) === 'object') {\r\n\t\t\t\tvar remap = function remap(obj, a, b) {\r\n\t\t\t\t\tif (a in obj && !(b in obj)) {\r\n\t\t\t\t\t\tobj[b] = obj[a];\r\n\t\t\t\t\t\tdelete obj[a];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconstraints = JSON.parse(JSON.stringify(constraints));\r\n\t\t\t\tremap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\r\n\t\t\t\tremap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\r\n\t\t\t\tconstraints.audio = constraintsToChrome_(constraints.audio);\r\n\t\t\t}\r\n\t\t\tif (constraints && _typeof(constraints.video) === 'object') {\r\n\t\t\t\t// Shim facingMode for mobile & surface pro.\r\n\t\t\t\tvar face = constraints.video.facingMode;\r\n\t\t\t\tface = face && ((typeof face === 'undefined' ? 'undefined' : _typeof(face)) === 'object' ? face : { ideal: face });\r\n\t\t\t\tvar getSupportedFacingModeLies = browserDetails.version < 66;\r\n\t\r\n\t\t\t\tif (face && (face.exact === 'user' || face.exact === 'environment' || face.ideal === 'user' || face.ideal === 'environment') && !(navigator.mediaDevices.getSupportedConstraints && navigator.mediaDevices.getSupportedConstraints().facingMode && !getSupportedFacingModeLies)) {\r\n\t\t\t\t\tdelete constraints.video.facingMode;\r\n\t\t\t\t\tvar matches = void 0;\r\n\t\t\t\t\tif (face.exact === 'environment' || face.ideal === 'environment') {\r\n\t\t\t\t\t\tmatches = ['back', 'rear'];\r\n\t\t\t\t\t} else if (face.exact === 'user' || face.ideal === 'user') {\r\n\t\t\t\t\t\tmatches = ['front'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t// Look for matches in label, or use last cam for back (typical).\r\n\t\t\t\t\t\treturn navigator.mediaDevices.enumerateDevices().then(function (devices) {\r\n\t\t\t\t\t\t\tdevices = devices.filter(function (d) {\r\n\t\t\t\t\t\t\t\treturn d.kind === 'videoinput';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar dev = devices.find(function (d) {\r\n\t\t\t\t\t\t\t\treturn matches.some(function (match) {\r\n\t\t\t\t\t\t\t\t\treturn d.label.toLowerCase().includes(match);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (!dev && devices.length && matches.includes('back')) {\r\n\t\t\t\t\t\t\t\tdev = devices[devices.length - 1]; // more likely the back cam\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (dev) {\r\n\t\t\t\t\t\t\t\tconstraints.video.deviceId = face.exact ? { exact: dev.deviceId } : { ideal: dev.deviceId };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconstraints.video = constraintsToChrome_(constraints.video);\r\n\t\t\t\t\t\t\tlogging('chrome: ' + JSON.stringify(constraints));\r\n\t\t\t\t\t\t\treturn func(constraints);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconstraints.video = constraintsToChrome_(constraints.video);\r\n\t\t\t}\r\n\t\t\tlogging('chrome: ' + JSON.stringify(constraints));\r\n\t\t\treturn func(constraints);\r\n\t\t};\r\n\t\r\n\t\tvar shimError_ = function shimError_(e) {\r\n\t\t\tif (browserDetails.version >= 64) {\r\n\t\t\t\treturn e;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tname: {\r\n\t\t\t\t\tPermissionDeniedError: 'NotAllowedError',\r\n\t\t\t\t\tPermissionDismissedError: 'NotAllowedError',\r\n\t\t\t\t\tInvalidStateError: 'NotAllowedError',\r\n\t\t\t\t\tDevicesNotFoundError: 'NotFoundError',\r\n\t\t\t\t\tConstraintNotSatisfiedError: 'OverconstrainedError',\r\n\t\t\t\t\tTrackStartError: 'NotReadableError',\r\n\t\t\t\t\tMediaDeviceFailedDueToShutdown: 'NotAllowedError',\r\n\t\t\t\t\tMediaDeviceKillSwitchOn: 'NotAllowedError',\r\n\t\t\t\t\tTabCaptureError: 'AbortError',\r\n\t\t\t\t\tScreenCaptureError: 'AbortError',\r\n\t\t\t\t\tDeviceCaptureError: 'AbortError'\r\n\t\t\t\t}[e.name] || e.name,\r\n\t\t\t\tmessage: e.message,\r\n\t\t\t\tconstraint: e.constraint || e.constraintName,\r\n\t\t\t\ttoString: function toString() {\r\n\t\t\t\t\treturn this.name + (this.message && ': ') + this.message;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\tvar getUserMedia_ = function getUserMedia_(constraints, onSuccess, onError) {\r\n\t\t\tshimConstraints_(constraints, function (c) {\r\n\t\t\t\tnavigator.webkitGetUserMedia(c, onSuccess, function (e) {\r\n\t\t\t\t\tif (onError) {\r\n\t\t\t\t\t\tonError(shimError_(e));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\tnavigator.getUserMedia = getUserMedia_.bind(navigator);\r\n\t\r\n\t\t// Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\r\n\t\t// function which returns a Promise, it does not accept spec-style\r\n\t\t// constraints.\r\n\t\tif (navigator.mediaDevices.getUserMedia) {\r\n\t\t\tvar origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (cs) {\r\n\t\t\t\treturn shimConstraints_(cs, function (c) {\r\n\t\t\t\t\treturn origGetUserMedia(c).then(function (stream) {\r\n\t\t\t\t\t\tif (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {\r\n\t\t\t\t\t\t\tstream.getTracks().forEach(function (track) {\r\n\t\t\t\t\t\t\t\ttrack.stop();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tthrow new DOMException('', 'NotFoundError');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn stream;\r\n\t\t\t\t\t}, function (e) {\r\n\t\t\t\t\t\treturn Promise.reject(shimError_(e));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils.js\":15}],6:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimRTCIceCandidate = shimRTCIceCandidate;\r\n\texports.shimMaxMessageSize = shimMaxMessageSize;\r\n\texports.shimSendThrowTypeError = shimSendThrowTypeError;\r\n\texports.shimConnectionState = shimConnectionState;\r\n\texports.removeAllowExtmapMixed = removeAllowExtmapMixed;\r\n\t\r\n\tvar _sdp = require('sdp');\r\n\t\r\n\tvar _sdp2 = _interopRequireDefault(_sdp);\r\n\t\r\n\tvar _utils = require('./utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\t\r\n\tfunction shimRTCIceCandidate(window) {\r\n\t\t// foundation is arbitrarily chosen as an indicator for full support for\r\n\t\t// https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\r\n\t\tif (!window.RTCIceCandidate || window.RTCIceCandidate && 'foundation' in window.RTCIceCandidate.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tvar NativeRTCIceCandidate = window.RTCIceCandidate;\r\n\t\twindow.RTCIceCandidate = function RTCIceCandidate(args) {\r\n\t\t\t// Remove the a= which shouldn't be part of the candidate string.\r\n\t\t\tif ((typeof args === 'undefined' ? 'undefined' : _typeof(args)) === 'object' && args.candidate && args.candidate.indexOf('a=') === 0) {\r\n\t\t\t\targs = JSON.parse(JSON.stringify(args));\r\n\t\t\t\targs.candidate = args.candidate.substr(2);\r\n\t\t\t}\r\n\t\r\n\t\t\tif (args.candidate && args.candidate.length) {\r\n\t\t\t\t// Augment the native candidate with the parsed fields.\r\n\t\t\t\tvar nativeCandidate = new NativeRTCIceCandidate(args);\r\n\t\t\t\tvar parsedCandidate = _sdp2.default.parseCandidate(args.candidate);\r\n\t\t\t\tvar augmentedCandidate = Object.assign(nativeCandidate, parsedCandidate);\r\n\t\r\n\t\t\t\t// Add a serializer that does not serialize the extra attributes.\r\n\t\t\t\taugmentedCandidate.toJSON = function toJSON() {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tcandidate: augmentedCandidate.candidate,\r\n\t\t\t\t\t\tsdpMid: augmentedCandidate.sdpMid,\r\n\t\t\t\t\t\tsdpMLineIndex: augmentedCandidate.sdpMLineIndex,\r\n\t\t\t\t\t\tusernameFragment: augmentedCandidate.usernameFragment\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t\treturn augmentedCandidate;\r\n\t\t\t}\r\n\t\t\treturn new NativeRTCIceCandidate(args);\r\n\t\t};\r\n\t\twindow.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\r\n\t\r\n\t\t// Hook up the augmented candidate in onicecandidate and\r\n\t\t// addEventListener('icecandidate', ...)\r\n\t\tutils.wrapPeerConnectionEvent(window, 'icecandidate', function (e) {\r\n\t\t\tif (e.candidate) {\r\n\t\t\t\tObject.defineProperty(e, 'candidate', {\r\n\t\t\t\t\tvalue: new window.RTCIceCandidate(e.candidate),\r\n\t\t\t\t\twritable: 'false'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction shimMaxMessageSize(window) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (!('sctp' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn typeof this._sctp === 'undefined' ? null : this._sctp;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\tvar sctpInDescription = function sctpInDescription(description) {\r\n\t\t\tif (!description || !description.sdp) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar sections = _sdp2.default.splitSections(description.sdp);\r\n\t\t\tsections.shift();\r\n\t\t\treturn sections.some(function (mediaSection) {\r\n\t\t\t\tvar mLine = _sdp2.default.parseMLine(mediaSection);\r\n\t\t\t\treturn mLine && mLine.kind === 'application' && mLine.protocol.indexOf('SCTP') !== -1;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tvar getRemoteFirefoxVersion = function getRemoteFirefoxVersion(description) {\r\n\t\t\t// TODO: Is there a better solution for detecting Firefox?\r\n\t\t\tvar match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\r\n\t\t\tif (match === null || match.length < 2) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tvar version = parseInt(match[1], 10);\r\n\t\t\t// Test for NaN (yes, this is ugly)\r\n\t\t\treturn version !== version ? -1 : version;\r\n\t\t};\r\n\t\r\n\t\tvar getCanSendMaxMessageSize = function getCanSendMaxMessageSize(remoteIsFirefox) {\r\n\t\t\t// Every implementation we know can send at least 64 KiB.\r\n\t\t\t// Note: Although Chrome is technically able to send up to 256 KiB, the\r\n\t\t\t//       data does not reach the other peer reliably.\r\n\t\t\t//       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\r\n\t\t\tvar canSendMaxMessageSize = 65536;\r\n\t\t\tif (browserDetails.browser === 'firefox') {\r\n\t\t\t\tif (browserDetails.version < 57) {\r\n\t\t\t\t\tif (remoteIsFirefox === -1) {\r\n\t\t\t\t\t\t// FF < 57 will send in 16 KiB chunks using the deprecated PPID\r\n\t\t\t\t\t\t// fragmentation.\r\n\t\t\t\t\t\tcanSendMaxMessageSize = 16384;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// However, other FF (and RAWRTC) can reassemble PPID-fragmented\r\n\t\t\t\t\t\t// messages. Thus, supporting ~2 GiB when sending.\r\n\t\t\t\t\t\tcanSendMaxMessageSize = 2147483637;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (browserDetails.version < 60) {\r\n\t\t\t\t\t// Currently, all FF >= 57 will reset the remote maximum message size\r\n\t\t\t\t\t// to the default value when a data channel is created at a later\r\n\t\t\t\t\t// stage. :(\r\n\t\t\t\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n\t\t\t\t\tcanSendMaxMessageSize = browserDetails.version === 57 ? 65535 : 65536;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// FF >= 60 supports sending ~2 GiB\r\n\t\t\t\t\tcanSendMaxMessageSize = 2147483637;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn canSendMaxMessageSize;\r\n\t\t};\r\n\t\r\n\t\tvar getMaxMessageSize = function getMaxMessageSize(description, remoteIsFirefox) {\r\n\t\t\t// Note: 65536 bytes is the default value from the SDP spec. Also,\r\n\t\t\t//       every implementation we know supports receiving 65536 bytes.\r\n\t\t\tvar maxMessageSize = 65536;\r\n\t\r\n\t\t\t// FF 57 has a slightly incorrect default remote max message size, so\r\n\t\t\t// we need to adjust it here to avoid a failure when sending.\r\n\t\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\r\n\t\t\tif (browserDetails.browser === 'firefox' && browserDetails.version === 57) {\r\n\t\t\t\tmaxMessageSize = 65535;\r\n\t\t\t}\r\n\t\r\n\t\t\tvar match = _sdp2.default.matchPrefix(description.sdp, 'a=max-message-size:');\r\n\t\t\tif (match.length > 0) {\r\n\t\t\t\tmaxMessageSize = parseInt(match[0].substr(19), 10);\r\n\t\t\t} else if (browserDetails.browser === 'firefox' && remoteIsFirefox !== -1) {\r\n\t\t\t\t// If the maximum message size is not present in the remote SDP and\r\n\t\t\t\t// both local and remote are Firefox, the remote peer can receive\r\n\t\t\t\t// ~2 GiB.\r\n\t\t\t\tmaxMessageSize = 2147483637;\r\n\t\t\t}\r\n\t\t\treturn maxMessageSize;\r\n\t\t};\r\n\t\r\n\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\tthis._sctp = null;\r\n\t\t\t// Chrome decided to not expose .sctp in plan-b mode.\r\n\t\t\t// As usual, adapter.js has to do an 'ugly worakaround'\r\n\t\t\t// to cover up the mess.\r\n\t\t\tif (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\r\n\t\t\t\tvar _getConfiguration = this.getConfiguration(),\r\n\t\t\t\t\t\tsdpSemantics = _getConfiguration.sdpSemantics;\r\n\t\r\n\t\t\t\tif (sdpSemantics === 'plan-b') {\r\n\t\t\t\t\tObject.defineProperty(this, 'sctp', {\r\n\t\t\t\t\t\tget: function get() {\r\n\t\t\t\t\t\t\treturn typeof this._sctp === 'undefined' ? null : this._sctp;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\tenumerable: true,\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tif (sctpInDescription(arguments[0])) {\r\n\t\t\t\t// Check if the remote is FF.\r\n\t\t\t\tvar isFirefox = getRemoteFirefoxVersion(arguments[0]);\r\n\t\r\n\t\t\t\t// Get the maximum message size the local peer is capable of sending\r\n\t\t\t\tvar canSendMMS = getCanSendMaxMessageSize(isFirefox);\r\n\t\r\n\t\t\t\t// Get the maximum message size of the remote peer.\r\n\t\t\t\tvar remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\r\n\t\r\n\t\t\t\t// Determine final maximum message size\r\n\t\t\t\tvar maxMessageSize = void 0;\r\n\t\t\t\tif (canSendMMS === 0 && remoteMMS === 0) {\r\n\t\t\t\t\tmaxMessageSize = Number.POSITIVE_INFINITY;\r\n\t\t\t\t} else if (canSendMMS === 0 || remoteMMS === 0) {\r\n\t\t\t\t\tmaxMessageSize = Math.max(canSendMMS, remoteMMS);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmaxMessageSize = Math.min(canSendMMS, remoteMMS);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Create a dummy RTCSctpTransport object and the 'maxMessageSize'\r\n\t\t\t\t// attribute.\r\n\t\t\t\tvar sctp = {};\r\n\t\t\t\tObject.defineProperty(sctp, 'maxMessageSize', {\r\n\t\t\t\t\tget: function get() {\r\n\t\t\t\t\t\treturn maxMessageSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis._sctp = sctp;\r\n\t\t\t}\r\n\t\r\n\t\t\treturn origSetRemoteDescription.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSendThrowTypeError(window) {\r\n\t\tif (!(window.RTCPeerConnection && 'createDataChannel' in window.RTCPeerConnection.prototype)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\t// Note: Although Firefox >= 57 has a native implementation, the maximum\r\n\t\t//       message size can be reset for all data channels at a later stage.\r\n\t\t//       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n\t\r\n\t\tfunction wrapDcSend(dc, pc) {\r\n\t\t\tvar origDataChannelSend = dc.send;\r\n\t\t\tdc.send = function send() {\r\n\t\t\t\tvar data = arguments[0];\r\n\t\t\t\tvar length = data.length || data.size || data.byteLength;\r\n\t\t\t\tif (dc.readyState === 'open' && pc.sctp && length > pc.sctp.maxMessageSize) {\r\n\t\t\t\t\tthrow new TypeError('Message too large (can send a maximum of ' + pc.sctp.maxMessageSize + ' bytes)');\r\n\t\t\t\t}\r\n\t\t\t\treturn origDataChannelSend.apply(dc, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar origCreateDataChannel = window.RTCPeerConnection.prototype.createDataChannel;\r\n\t\twindow.RTCPeerConnection.prototype.createDataChannel = function createDataChannel() {\r\n\t\t\tvar dataChannel = origCreateDataChannel.apply(this, arguments);\r\n\t\t\twrapDcSend(dataChannel, this);\r\n\t\t\treturn dataChannel;\r\n\t\t};\r\n\t\tutils.wrapPeerConnectionEvent(window, 'datachannel', function (e) {\r\n\t\t\twrapDcSend(e.channel, e.target);\r\n\t\t\treturn e;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\r\n\t * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\r\n\t * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\r\n\t * since DTLS failures would be hidden. See\r\n\t * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\r\n\t * for the Firefox tracking bug.\r\n\t */\r\n\tfunction shimConnectionState(window) {\r\n\t\tif (!window.RTCPeerConnection || 'connectionState' in window.RTCPeerConnection.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar proto = window.RTCPeerConnection.prototype;\r\n\t\tObject.defineProperty(proto, 'connectionState', {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcompleted: 'connected',\r\n\t\t\t\t\tchecking: 'connecting'\r\n\t\t\t\t}[this.iceConnectionState] || this.iceConnectionState;\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t\tObject.defineProperty(proto, 'onconnectionstatechange', {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn this._onconnectionstatechange || null;\r\n\t\t\t},\r\n\t\t\tset: function set(cb) {\r\n\t\t\t\tif (this._onconnectionstatechange) {\r\n\t\t\t\t\tthis.removeEventListener('connectionstatechange', this._onconnectionstatechange);\r\n\t\t\t\t\tdelete this._onconnectionstatechange;\r\n\t\t\t\t}\r\n\t\t\t\tif (cb) {\r\n\t\t\t\t\tthis.addEventListener('connectionstatechange', this._onconnectionstatechange = cb);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t\r\n\t\t['setLocalDescription', 'setRemoteDescription'].forEach(function (method) {\r\n\t\t\tvar origMethod = proto[method];\r\n\t\t\tproto[method] = function () {\r\n\t\t\t\tif (!this._connectionstatechangepoly) {\r\n\t\t\t\t\tthis._connectionstatechangepoly = function (e) {\r\n\t\t\t\t\t\tvar pc = e.target;\r\n\t\t\t\t\t\tif (pc._lastConnectionState !== pc.connectionState) {\r\n\t\t\t\t\t\t\tpc._lastConnectionState = pc.connectionState;\r\n\t\t\t\t\t\t\tvar newEvent = new Event('connectionstatechange', e);\r\n\t\t\t\t\t\t\tpc.dispatchEvent(newEvent);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn e;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.addEventListener('iceconnectionstatechange', this._connectionstatechangepoly);\r\n\t\t\t\t}\r\n\t\t\t\treturn origMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction removeAllowExtmapMixed(window) {\r\n\t\t/* remove a=extmap-allow-mixed for Chrome < M71 */\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\tif (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription(desc) {\r\n\t\t\tif (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\r\n\t\t\t\tdesc.sdp = desc.sdp.split('\\n').filter(function (line) {\r\n\t\t\t\t\treturn line.trim() !== 'a=extmap-allow-mixed';\r\n\t\t\t\t}).join('\\n');\r\n\t\t\t}\r\n\t\t\treturn nativeSRD.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{\"./utils\":15,\"sdp\":17}],7:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.shimReplaceTrack = shimReplaceTrack;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tvar _filtericeservers = require('./filtericeservers');\r\n\t\r\n\tvar _rtcpeerconnectionShim = require('rtcpeerconnection-shim');\r\n\t\r\n\tvar _rtcpeerconnectionShim2 = _interopRequireDefault(_rtcpeerconnectionShim);\r\n\t\r\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif (window.RTCIceGatherer) {\r\n\t\t\tif (!window.RTCIceCandidate) {\r\n\t\t\t\twindow.RTCIceCandidate = function RTCIceCandidate(args) {\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!window.RTCSessionDescription) {\r\n\t\t\t\twindow.RTCSessionDescription = function RTCSessionDescription(args) {\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// this adds an additional event listener to MediaStrackTrack that signals\r\n\t\t\t// when a tracks enabled property was changed. Workaround for a bug in\r\n\t\t\t// addStream, see below. No longer required in 15025+\r\n\t\t\tif (browserDetails.version < 15025) {\r\n\t\t\t\tvar origMSTEnabled = Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype, 'enabled');\r\n\t\t\t\tObject.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\r\n\t\t\t\t\tset: function set(value) {\r\n\t\t\t\t\t\torigMSTEnabled.set.call(this, value);\r\n\t\t\t\t\t\tvar ev = new Event('enabled');\r\n\t\t\t\t\t\tev.enabled = value;\r\n\t\t\t\t\t\tthis.dispatchEvent(ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t// ORTC defines the DTMF sender a bit different.\r\n\t\t// https://github.com/w3c/ortc/issues/714\r\n\t\tif (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\tif (this._dtmf === undefined) {\r\n\t\t\t\t\t\tif (this.track.kind === 'audio') {\r\n\t\t\t\t\t\t\tthis._dtmf = new window.RTCDtmfSender(this);\r\n\t\t\t\t\t\t} else if (this.track.kind === 'video') {\r\n\t\t\t\t\t\t\tthis._dtmf = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this._dtmf;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// Edge currently only implements the RTCDtmfSender, not the\r\n\t\t// RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\r\n\t\tif (window.RTCDtmfSender && !window.RTCDTMFSender) {\r\n\t\t\twindow.RTCDTMFSender = window.RTCDtmfSender;\r\n\t\t}\r\n\t\r\n\t\tvar RTCPeerConnectionShim = (0, _rtcpeerconnectionShim2.default)(window, browserDetails.version);\r\n\t\twindow.RTCPeerConnection = function RTCPeerConnection(config) {\r\n\t\t\tif (config && config.iceServers) {\r\n\t\t\t\tconfig.iceServers = (0, _filtericeservers.filterIceServers)(config.iceServers, browserDetails.version);\r\n\t\t\t\tutils.log('ICE servers after filtering:', config.iceServers);\r\n\t\t\t}\r\n\t\t\treturn new RTCPeerConnectionShim(config);\r\n\t\t};\r\n\t\twindow.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\r\n\t}\r\n\t\r\n\tfunction shimReplaceTrack(window) {\r\n\t\t// ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\r\n\t\tif (window.RTCRtpSender && !('replaceTrack' in window.RTCRtpSender.prototype)) {\r\n\t\t\twindow.RTCRtpSender.prototype.replaceTrack = window.RTCRtpSender.prototype.setTrack;\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15,\"./filtericeservers\":8,\"./getdisplaymedia\":9,\"./getusermedia\":10,\"rtcpeerconnection-shim\":16}],8:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.filterIceServers = filterIceServers;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\t// Edge does not like\r\n\t// 1) stun: filtered after 14393 unless ?transport=udp is present\r\n\t// 2) turn: that does not have all of turn:host:port?transport=udp\r\n\t// 3) turn: with ipv6 addresses\r\n\t// 4) turn: occurring muliple times\r\n\tfunction filterIceServers(iceServers, edgeVersion) {\r\n\t\tvar hasTurn = false;\r\n\t\ticeServers = JSON.parse(JSON.stringify(iceServers));\r\n\t\treturn iceServers.filter(function (server) {\r\n\t\t\tif (server && (server.urls || server.url)) {\r\n\t\t\t\tvar urls = server.urls || server.url;\r\n\t\t\t\tif (server.url && !server.urls) {\r\n\t\t\t\t\tutils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n\t\t\t\t}\r\n\t\t\t\tvar isString = typeof urls === 'string';\r\n\t\t\t\tif (isString) {\r\n\t\t\t\t\turls = [urls];\r\n\t\t\t\t}\r\n\t\t\t\turls = urls.filter(function (url) {\r\n\t\t\t\t\t// filter STUN unconditionally.\r\n\t\t\t\t\tif (url.indexOf('stun:') === 0) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar validTurn = url.startsWith('turn') && !url.startsWith('turn:[') && url.includes('transport=udp');\r\n\t\t\t\t\tif (validTurn && !hasTurn) {\r\n\t\t\t\t\t\thasTurn = true;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn validTurn && !hasTurn;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tdelete server.url;\r\n\t\t\t\tserver.urls = isString ? urls[0] : urls;\r\n\t\t\t\treturn !!urls.length;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],9:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window) {\r\n\t\tif (!('getDisplayMedia' in window.navigator)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = window.navigator.getDisplayMedia.bind(window.navigator);\r\n\t}\r\n\t\r\n\t},{}],10:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tvar shimError_ = function shimError_(e) {\r\n\t\t\treturn {\r\n\t\t\t\tname: { PermissionDeniedError: 'NotAllowedError' }[e.name] || e.name,\r\n\t\t\t\tmessage: e.message,\r\n\t\t\t\tconstraint: e.constraint,\r\n\t\t\t\ttoString: function toString() {\r\n\t\t\t\t\treturn this.name;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\t// getUserMedia error shim.\r\n\t\tvar origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\tnavigator.mediaDevices.getUserMedia = function (c) {\r\n\t\t\treturn origGetUserMedia(c).catch(function (e) {\r\n\t\t\t\treturn Promise.reject(shimError_(e));\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],11:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\tvar _getusermedia = require('./getusermedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetUserMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getusermedia.shimGetUserMedia;\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar _getdisplaymedia = require('./getdisplaymedia');\r\n\t\r\n\tObject.defineProperty(exports, 'shimGetDisplayMedia', {\r\n\t\tenumerable: true,\r\n\t\tget: function get() {\r\n\t\t\treturn _getdisplaymedia.shimGetDisplayMedia;\r\n\t\t}\r\n\t});\r\n\texports.shimOnTrack = shimOnTrack;\r\n\texports.shimPeerConnection = shimPeerConnection;\r\n\texports.shimSenderGetStats = shimSenderGetStats;\r\n\texports.shimReceiverGetStats = shimReceiverGetStats;\r\n\texports.shimRemoveStream = shimRemoveStream;\r\n\texports.shimRTCDataChannel = shimRTCDataChannel;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tfunction shimOnTrack(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn { receiver: this.receiver };\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimPeerConnection(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\r\n\t\t\treturn; // probably media.peerconnection.enabled=false in about:config\r\n\t\t}\r\n\t\tif (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\r\n\t\t\t// very basic support for old versions.\r\n\t\t\twindow.RTCPeerConnection = window.mozRTCPeerConnection;\r\n\t\t}\r\n\t\r\n\t\tif (browserDetails.version < 53) {\r\n\t\t\t// shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\r\n\t\t\t['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\r\n\t\t\t\tvar nativeMethod = window.RTCPeerConnection.prototype[method];\r\n\t\t\t\tvar methodObj = _defineProperty({}, method, function () {\r\n\t\t\t\t\targuments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t\t});\r\n\t\t\t\twindow.RTCPeerConnection.prototype[method] = methodObj[method];\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// support for addIceCandidate(null or undefined)\r\n\t\tvar nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n\t\twindow.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n\t\t\tif (!arguments[0]) {\r\n\t\t\t\tif (arguments[1]) {\r\n\t\t\t\t\targuments[1].apply(null);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\t// Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n\t\t\t// in older versions.\r\n\t\t\tif (browserDetails.version < 68 && arguments[0] && arguments[0].candidate === '') {\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\treturn nativeAddIceCandidate.apply(this, arguments);\r\n\t\t};\r\n\t\r\n\t\tvar modernStatsTypes = {\r\n\t\t\tinboundrtp: 'inbound-rtp',\r\n\t\t\toutboundrtp: 'outbound-rtp',\r\n\t\t\tcandidatepair: 'candidate-pair',\r\n\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t};\r\n\t\r\n\t\tvar nativeGetStats = window.RTCPeerConnection.prototype.getStats;\r\n\t\twindow.RTCPeerConnection.prototype.getStats = function getStats() {\r\n\t\t\tvar _arguments = Array.prototype.slice.call(arguments),\r\n\t\t\t\t\tselector = _arguments[0],\r\n\t\t\t\t\tonSucc = _arguments[1],\r\n\t\t\t\t\tonErr = _arguments[2];\r\n\t\r\n\t\t\treturn nativeGetStats.apply(this, [selector || null]).then(function (stats) {\r\n\t\t\t\tif (browserDetails.version < 53 && !onSucc) {\r\n\t\t\t\t\t// Shim only promise getStats with spec-hyphens in type names\r\n\t\t\t\t\t// Leave callback version alone; misc old uses of forEach before Map\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tstats.forEach(function (stat) {\r\n\t\t\t\t\t\t\tstat.type = modernStatsTypes[stat.type] || stat.type;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tif (e.name !== 'TypeError') {\r\n\t\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\r\n\t\t\t\t\t\tstats.forEach(function (stat, i) {\r\n\t\t\t\t\t\t\tstats.set(i, Object.assign({}, stat, {\r\n\t\t\t\t\t\t\t\ttype: modernStatsTypes[stat.type] || stat.type\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn stats;\r\n\t\t\t}).then(onSucc, onErr);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimSenderGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n\t\tif (origGetSenders) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tvar senders = origGetSenders.apply(this, []);\r\n\t\t\t\tsenders.forEach(function (sender) {\r\n\t\t\t\t\treturn sender._pc = _this;\r\n\t\t\t\t});\r\n\t\t\t\treturn senders;\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tvar origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\tif (origAddTrack) {\r\n\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n\t\t\t\tvar sender = origAddTrack.apply(this, arguments);\r\n\t\t\t\tsender._pc = this;\r\n\t\t\t\treturn sender;\r\n\t\t\t};\r\n\t\t}\r\n\t\twindow.RTCRtpSender.prototype.getStats = function getStats() {\r\n\t\t\treturn this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimReceiverGetStats(window) {\r\n\t\tif (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n\t\tif (origGetReceivers) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tvar receivers = origGetReceivers.apply(this, []);\r\n\t\t\t\treceivers.forEach(function (receiver) {\r\n\t\t\t\t\treturn receiver._pc = _this2;\r\n\t\t\t\t});\r\n\t\t\t\treturn receivers;\r\n\t\t\t};\r\n\t\t}\r\n\t\tutils.wrapPeerConnectionEvent(window, 'track', function (e) {\r\n\t\t\te.receiver._pc = e.srcElement;\r\n\t\t\treturn e;\r\n\t\t});\r\n\t\twindow.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n\t\t\treturn this._pc.getStats(this.track);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimRemoveStream(window) {\r\n\t\tif (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\tutils.deprecated('removeStream', 'removeTrack');\r\n\t\t\tthis.getSenders().forEach(function (sender) {\r\n\t\t\t\tif (sender.track && stream.getTracks().includes(sender.track)) {\r\n\t\t\t\t\t_this3.removeTrack(sender);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction shimRTCDataChannel(window) {\r\n\t\t// rename DataChannel to RTCDataChannel (native fix in FF60):\r\n\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\r\n\t\tif (window.DataChannel && !window.RTCDataChannel) {\r\n\t\t\twindow.RTCDataChannel = window.DataChannel;\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15,\"./getdisplaymedia\":12,\"./getusermedia\":13}],12:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\texports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n\tfunction shimGetDisplayMedia(window, preferredMediaSource) {\r\n\t\tif (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.navigator.mediaDevices) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n\t\t\tif (!(constraints && constraints.video)) {\r\n\t\t\t\tvar err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');\r\n\t\t\t\terr.name = 'NotFoundError';\r\n\t\t\t\t// from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n\t\t\t\terr.code = 8;\r\n\t\t\t\treturn Promise.reject(err);\r\n\t\t\t}\r\n\t\t\tif (constraints.video === true) {\r\n\t\t\t\tconstraints.video = { mediaSource: preferredMediaSource };\r\n\t\t\t} else {\r\n\t\t\t\tconstraints.video.mediaSource = preferredMediaSource;\r\n\t\t\t}\r\n\t\t\treturn window.navigator.mediaDevices.getUserMedia(constraints);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{}],13:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar browserDetails = utils.detectBrowser(window);\r\n\t\tvar navigator = window && window.navigator;\r\n\t\tvar MediaStreamTrack = window && window.MediaStreamTrack;\r\n\t\r\n\t\tnavigator.getUserMedia = function (constraints, onSuccess, onError) {\r\n\t\t\t// Replace Firefox 44+'s deprecation warning with unprefixed version.\r\n\t\t\tutils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');\r\n\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\r\n\t\t};\r\n\t\r\n\t\tif (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\r\n\t\t\tvar remap = function remap(obj, a, b) {\r\n\t\t\t\tif (a in obj && !(b in obj)) {\r\n\t\t\t\t\tobj[b] = obj[a];\r\n\t\t\t\t\tdelete obj[a];\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\tvar nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (c) {\r\n\t\t\t\tif ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object' && _typeof(c.audio) === 'object') {\r\n\t\t\t\t\tc = JSON.parse(JSON.stringify(c));\r\n\t\t\t\t\tremap(c.audio, 'autoGainControl', 'mozAutoGainControl');\r\n\t\t\t\t\tremap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeGetUserMedia(c);\r\n\t\t\t};\r\n\t\r\n\t\t\tif (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\r\n\t\t\t\tvar nativeGetSettings = MediaStreamTrack.prototype.getSettings;\r\n\t\t\t\tMediaStreamTrack.prototype.getSettings = function () {\r\n\t\t\t\t\tvar obj = nativeGetSettings.apply(this, arguments);\r\n\t\t\t\t\tremap(obj, 'mozAutoGainControl', 'autoGainControl');\r\n\t\t\t\t\tremap(obj, 'mozNoiseSuppression', 'noiseSuppression');\r\n\t\t\t\t\treturn obj;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\r\n\t\t\tif (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\r\n\t\t\t\tvar nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\r\n\t\t\t\tMediaStreamTrack.prototype.applyConstraints = function (c) {\r\n\t\t\t\t\tif (this.kind === 'audio' && (typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object') {\r\n\t\t\t\t\t\tc = JSON.parse(JSON.stringify(c));\r\n\t\t\t\t\t\tremap(c, 'autoGainControl', 'mozAutoGainControl');\r\n\t\t\t\t\t\tremap(c, 'noiseSuppression', 'mozNoiseSuppression');\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn nativeApplyConstraints.apply(this, [c]);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],14:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.shimLocalStreamsAPI = shimLocalStreamsAPI;\r\n\texports.shimRemoteStreamsAPI = shimRemoteStreamsAPI;\r\n\texports.shimCallbacksAPI = shimCallbacksAPI;\r\n\texports.shimGetUserMedia = shimGetUserMedia;\r\n\texports.shimConstraints = shimConstraints;\r\n\texports.shimRTCIceServerUrls = shimRTCIceServerUrls;\r\n\texports.shimTrackEventTransceiver = shimTrackEventTransceiver;\r\n\texports.shimCreateOfferLegacy = shimCreateOfferLegacy;\r\n\t\r\n\tvar _utils = require('../utils');\r\n\t\r\n\tvar utils = _interopRequireWildcard(_utils);\r\n\t\r\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\t\r\n\tfunction shimLocalStreamsAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\treturn this._localStreams;\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('addStream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tvar _addTrack = window.RTCPeerConnection.prototype.addTrack;\r\n\t\t\twindow.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n\t\t\t\tvar _this = this;\r\n\t\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._localStreams.includes(stream)) {\r\n\t\t\t\t\tthis._localStreams.push(stream);\r\n\t\t\t\t}\r\n\t\t\t\t// Try to emulate Chrome's behaviour of adding in audio-video order.\r\n\t\t\t\t// Safari orders by track id.\r\n\t\t\t\tstream.getAudioTracks().forEach(function (track) {\r\n\t\t\t\t\treturn _addTrack.call(_this, track, stream);\r\n\t\t\t\t});\r\n\t\t\t\tstream.getVideoTracks().forEach(function (track) {\r\n\t\t\t\t\treturn _addTrack.call(_this, track, stream);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\r\n\t\t\twindow.RTCPeerConnection.prototype.addTrack = function addTrack(track) {\r\n\t\t\t\tvar stream = arguments[1];\r\n\t\t\t\tif (stream) {\r\n\t\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\t\tthis._localStreams = [stream];\r\n\t\t\t\t\t} else if (!this._localStreams.includes(stream)) {\r\n\t\t\t\t\t\tthis._localStreams.push(stream);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn _addTrack.apply(this, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('removeStream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n\t\t\t\tvar _this2 = this;\r\n\t\r\n\t\t\t\tif (!this._localStreams) {\r\n\t\t\t\t\tthis._localStreams = [];\r\n\t\t\t\t}\r\n\t\t\t\tvar index = this._localStreams.indexOf(stream);\r\n\t\t\t\tif (index === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._localStreams.splice(index, 1);\r\n\t\t\t\tvar tracks = stream.getTracks();\r\n\t\t\t\tthis.getSenders().forEach(function (sender) {\r\n\t\t\t\t\tif (tracks.includes(sender.track)) {\r\n\t\t\t\t\t\t_this2.removeTrack(sender);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimRemoteStreamsAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\r\n\t\t\twindow.RTCPeerConnection.prototype.getRemoteStreams = function getRemoteStreams() {\r\n\t\t\t\treturn this._remoteStreams ? this._remoteStreams : [];\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!('onaddstream' in window.RTCPeerConnection.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn this._onaddstream;\r\n\t\t\t\t},\r\n\t\t\t\tset: function set(f) {\r\n\t\t\t\t\tvar _this3 = this;\r\n\t\r\n\t\t\t\t\tif (this._onaddstream) {\r\n\t\t\t\t\t\tthis.removeEventListener('addstream', this._onaddstream);\r\n\t\t\t\t\t\tthis.removeEventListener('track', this._onaddstreampoly);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addEventListener('addstream', this._onaddstream = f);\r\n\t\t\t\t\tthis.addEventListener('track', this._onaddstreampoly = function (e) {\r\n\t\t\t\t\t\te.streams.forEach(function (stream) {\r\n\t\t\t\t\t\t\tif (!_this3._remoteStreams) {\r\n\t\t\t\t\t\t\t\t_this3._remoteStreams = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (_this3._remoteStreams.includes(stream)) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_this3._remoteStreams.push(stream);\r\n\t\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\t\t_this3.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n\t\t\twindow.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n\t\t\t\tvar pc = this;\r\n\t\t\t\tif (!this._onaddstreampoly) {\r\n\t\t\t\t\tthis.addEventListener('track', this._onaddstreampoly = function (e) {\r\n\t\t\t\t\t\te.streams.forEach(function (stream) {\r\n\t\t\t\t\t\t\tif (!pc._remoteStreams) {\r\n\t\t\t\t\t\t\t\tpc._remoteStreams = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (pc._remoteStreams.indexOf(stream) >= 0) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tpc._remoteStreams.push(stream);\r\n\t\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\t\tpc.dispatchEvent(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn origSetRemoteDescription.apply(pc, arguments);\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimCallbacksAPI(window) {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar prototype = window.RTCPeerConnection.prototype;\r\n\t\tvar origCreateOffer = prototype.createOffer;\r\n\t\tvar origCreateAnswer = prototype.createAnswer;\r\n\t\tvar setLocalDescription = prototype.setLocalDescription;\r\n\t\tvar setRemoteDescription = prototype.setRemoteDescription;\r\n\t\tvar addIceCandidate = prototype.addIceCandidate;\r\n\t\r\n\t\tprototype.createOffer = function createOffer(successCallback, failureCallback) {\r\n\t\t\tvar options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n\t\t\tvar promise = origCreateOffer.apply(this, [options]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tprototype.createAnswer = function createAnswer(successCallback, failureCallback) {\r\n\t\t\tvar options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n\t\t\tvar promise = origCreateAnswer.apply(this, [options]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tvar withCallback = function withCallback(description, successCallback, failureCallback) {\r\n\t\t\tvar promise = setLocalDescription.apply(this, [description]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.setLocalDescription = withCallback;\r\n\t\r\n\t\twithCallback = function withCallback(description, successCallback, failureCallback) {\r\n\t\t\tvar promise = setRemoteDescription.apply(this, [description]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.setRemoteDescription = withCallback;\r\n\t\r\n\t\twithCallback = function withCallback(candidate, successCallback, failureCallback) {\r\n\t\t\tvar promise = addIceCandidate.apply(this, [candidate]);\r\n\t\t\tif (!failureCallback) {\r\n\t\t\t\treturn promise;\r\n\t\t\t}\r\n\t\t\tpromise.then(successCallback, failureCallback);\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\tprototype.addIceCandidate = withCallback;\r\n\t}\r\n\t\r\n\tfunction shimGetUserMedia(window) {\r\n\t\tvar navigator = window && window.navigator;\r\n\t\r\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\t// shim not needed in Safari 12.1\r\n\t\t\tvar mediaDevices = navigator.mediaDevices;\r\n\t\t\tvar _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\r\n\t\t\tnavigator.mediaDevices.getUserMedia = function (constraints) {\r\n\t\t\t\treturn _getUserMedia(shimConstraints(constraints));\r\n\t\t\t};\r\n\t\t}\r\n\t\r\n\t\tif (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\tnavigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\r\n\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\r\n\t\t\t}.bind(navigator);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimConstraints(constraints) {\r\n\t\tif (constraints && constraints.video !== undefined) {\r\n\t\t\treturn Object.assign({}, constraints, { video: utils.compactObject(constraints.video) });\r\n\t\t}\r\n\t\r\n\t\treturn constraints;\r\n\t}\r\n\t\r\n\tfunction shimRTCIceServerUrls(window) {\r\n\t\t// migrate from non-spec RTCIceServer.url to RTCIceServer.urls\r\n\t\tvar OrigPeerConnection = window.RTCPeerConnection;\r\n\t\twindow.RTCPeerConnection = function RTCPeerConnection(pcConfig, pcConstraints) {\r\n\t\t\tif (pcConfig && pcConfig.iceServers) {\r\n\t\t\t\tvar newIceServers = [];\r\n\t\t\t\tfor (var i = 0; i < pcConfig.iceServers.length; i++) {\r\n\t\t\t\t\tvar server = pcConfig.iceServers[i];\r\n\t\t\t\t\tif (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\r\n\t\t\t\t\t\tutils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n\t\t\t\t\t\tserver = JSON.parse(JSON.stringify(server));\r\n\t\t\t\t\t\tserver.urls = server.url;\r\n\t\t\t\t\t\tdelete server.url;\r\n\t\t\t\t\t\tnewIceServers.push(server);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewIceServers.push(pcConfig.iceServers[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpcConfig.iceServers = newIceServers;\r\n\t\t\t}\r\n\t\t\treturn new OrigPeerConnection(pcConfig, pcConstraints);\r\n\t\t};\r\n\t\twindow.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\r\n\t\t// wrap static methods. Currently just generateCertificate.\r\n\t\tif ('generateCertificate' in window.RTCPeerConnection) {\r\n\t\t\tObject.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn OrigPeerConnection.generateCertificate;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimTrackEventTransceiver(window) {\r\n\t\t// Add event.transceiver member over deprecated event.receiver\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n\t\t\tObject.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n\t\t\t\tget: function get() {\r\n\t\t\t\t\treturn { receiver: this.receiver };\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction shimCreateOfferLegacy(window) {\r\n\t\tvar origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\r\n\t\twindow.RTCPeerConnection.prototype.createOffer = function createOffer(offerOptions) {\r\n\t\t\tif (offerOptions) {\r\n\t\t\t\tif (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\r\n\t\t\t\t\t// support bit values\r\n\t\t\t\t\tofferOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\r\n\t\t\t\t}\r\n\t\t\t\tvar audioTransceiver = this.getTransceivers().find(function (transceiver) {\r\n\t\t\t\t\treturn transceiver.receiver.track.kind === 'audio';\r\n\t\t\t\t});\r\n\t\t\t\tif (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\r\n\t\t\t\t\tif (audioTransceiver.direction === 'sendrecv') {\r\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\r\n\t\t\t\t\t\t\taudioTransceiver.setDirection('sendonly');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\taudioTransceiver.direction = 'sendonly';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (audioTransceiver.direction === 'recvonly') {\r\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\r\n\t\t\t\t\t\t\taudioTransceiver.setDirection('inactive');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\taudioTransceiver.direction = 'inactive';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\r\n\t\t\t\t\tthis.addTransceiver('audio');\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\r\n\t\t\t\t\t// support bit values\r\n\t\t\t\t\tofferOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\r\n\t\t\t\t}\r\n\t\t\t\tvar videoTransceiver = this.getTransceivers().find(function (transceiver) {\r\n\t\t\t\t\treturn transceiver.receiver.track.kind === 'video';\r\n\t\t\t\t});\r\n\t\t\t\tif (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\r\n\t\t\t\t\tif (videoTransceiver.direction === 'sendrecv') {\r\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\r\n\t\t\t\t\t\t\tvideoTransceiver.setDirection('sendonly');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvideoTransceiver.direction = 'sendonly';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (videoTransceiver.direction === 'recvonly') {\r\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\r\n\t\t\t\t\t\t\tvideoTransceiver.setDirection('inactive');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvideoTransceiver.direction = 'inactive';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\r\n\t\t\t\t\tthis.addTransceiver('video');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn origCreateOffer.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\t\r\n\t},{\"../utils\":15}],15:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t/* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tObject.defineProperty(exports, \"__esModule\", {\r\n\t\tvalue: true\r\n\t});\r\n\t\r\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\t\r\n\texports.extractVersion = extractVersion;\r\n\texports.wrapPeerConnectionEvent = wrapPeerConnectionEvent;\r\n\texports.disableLog = disableLog;\r\n\texports.disableWarnings = disableWarnings;\r\n\texports.log = log;\r\n\texports.deprecated = deprecated;\r\n\texports.detectBrowser = detectBrowser;\r\n\texports.compactObject = compactObject;\r\n\texports.walkStats = walkStats;\r\n\texports.filterStats = filterStats;\r\n\t\r\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\t\r\n\tvar logDisabled_ = true;\r\n\tvar deprecationWarnings_ = true;\r\n\t\r\n\t/**\r\n\t * Extract browser version out of the provided user agent string.\r\n\t *\r\n\t * @param {!string} uastring userAgent string.\r\n\t * @param {!string} expr Regular expression used as match criteria.\r\n\t * @param {!number} pos position in the version string to be returned.\r\n\t * @return {!number} browser version.\r\n\t */\r\n\tfunction extractVersion(uastring, expr, pos) {\r\n\t\tvar match = uastring.match(expr);\r\n\t\treturn match && match.length >= pos && parseInt(match[pos], 10);\r\n\t}\r\n\t\r\n\t// Wraps the peerconnection event eventNameToWrap in a function\r\n\t// which returns the modified event object (or false to prevent\r\n\t// the event).\r\n\tfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\r\n\t\tif (!window.RTCPeerConnection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar proto = window.RTCPeerConnection.prototype;\r\n\t\tvar nativeAddEventListener = proto.addEventListener;\r\n\t\tproto.addEventListener = function (nativeEventName, cb) {\r\n\t\t\tif (nativeEventName !== eventNameToWrap) {\r\n\t\t\t\treturn nativeAddEventListener.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tvar wrappedCallback = function wrappedCallback(e) {\r\n\t\t\t\tvar modifiedEvent = wrapper(e);\r\n\t\t\t\tif (modifiedEvent) {\r\n\t\t\t\t\tcb(modifiedEvent);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis._eventMap = this._eventMap || {};\r\n\t\t\tthis._eventMap[cb] = wrappedCallback;\r\n\t\t\treturn nativeAddEventListener.apply(this, [nativeEventName, wrappedCallback]);\r\n\t\t};\r\n\t\r\n\t\tvar nativeRemoveEventListener = proto.removeEventListener;\r\n\t\tproto.removeEventListener = function (nativeEventName, cb) {\r\n\t\t\tif (nativeEventName !== eventNameToWrap || !this._eventMap || !this._eventMap[cb]) {\r\n\t\t\t\treturn nativeRemoveEventListener.apply(this, arguments);\r\n\t\t\t}\r\n\t\t\tvar unwrappedCb = this._eventMap[cb];\r\n\t\t\tdelete this._eventMap[cb];\r\n\t\t\treturn nativeRemoveEventListener.apply(this, [nativeEventName, unwrappedCb]);\r\n\t\t};\r\n\t\r\n\t\tObject.defineProperty(proto, 'on' + eventNameToWrap, {\r\n\t\t\tget: function get() {\r\n\t\t\t\treturn this['_on' + eventNameToWrap];\r\n\t\t\t},\r\n\t\t\tset: function set(cb) {\r\n\t\t\t\tif (this['_on' + eventNameToWrap]) {\r\n\t\t\t\t\tthis.removeEventListener(eventNameToWrap, this['_on' + eventNameToWrap]);\r\n\t\t\t\t\tdelete this['_on' + eventNameToWrap];\r\n\t\t\t\t}\r\n\t\t\t\tif (cb) {\r\n\t\t\t\t\tthis.addEventListener(eventNameToWrap, this['_on' + eventNameToWrap] = cb);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction disableLog(bool) {\r\n\t\tif (typeof bool !== 'boolean') {\r\n\t\t\treturn new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\r\n\t\t}\r\n\t\tlogDisabled_ = bool;\r\n\t\treturn bool ? 'adapter.js logging disabled' : 'adapter.js logging enabled';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Disable or enable deprecation warnings\r\n\t * @param {!boolean} bool set to true to disable warnings.\r\n\t */\r\n\tfunction disableWarnings(bool) {\r\n\t\tif (typeof bool !== 'boolean') {\r\n\t\t\treturn new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\r\n\t\t}\r\n\t\tdeprecationWarnings_ = !bool;\r\n\t\treturn 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\r\n\t}\r\n\t\r\n\tfunction log() {\r\n\t\tif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object') {\r\n\t\t\tif (logDisabled_) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (typeof console !== 'undefined' && typeof console.log === 'function') {\r\n\t\t\t\tconsole.log.apply(console, arguments);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Shows a deprecation warning suggesting the modern and spec-compatible API.\r\n\t */\r\n\tfunction deprecated(oldMethod, newMethod) {\r\n\t\tif (!deprecationWarnings_) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.warn(oldMethod + ' is deprecated, please use ' + newMethod + ' instead.');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Browser detector.\r\n\t *\r\n\t * @return {object} result containing browser and version\r\n\t *     properties.\r\n\t */\r\n\tfunction detectBrowser(window) {\r\n\t\tvar navigator = window.navigator;\r\n\t\r\n\t\t// Returned result object.\r\n\t\r\n\t\tvar result = { browser: null, version: null };\r\n\t\r\n\t\t// Fail early if it's not a browser\r\n\t\tif (typeof window === 'undefined' || !window.navigator) {\r\n\t\t\tresult.browser = 'Not a browser.';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\r\n\t\tif (navigator.mozGetUserMedia) {\r\n\t\t\t// Firefox.\r\n\t\t\tresult.browser = 'firefox';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Firefox\\/(\\d+)\\./, 1);\r\n\t\t} else if (navigator.webkitGetUserMedia || window.isSecureContext === false && window.webkitRTCPeerConnection && !window.RTCIceGatherer) {\r\n\t\t\t// Chrome, Chromium, Webview, Opera.\r\n\t\t\t// Version matches Chrome/WebRTC version.\r\n\t\t\t// Chrome 74 removed webkitGetUserMedia on http as well so we need the\r\n\t\t\t// more complicated fallback to webkitRTCPeerConnection.\r\n\t\t\tresult.browser = 'chrome';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Chrom(e|ium)\\/(\\d+)\\./, 2);\r\n\t\t} else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\r\n\t\t\t// Edge.\r\n\t\t\tresult.browser = 'edge';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2);\r\n\t\t} else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\r\n\t\t\t// Safari.\r\n\t\t\tresult.browser = 'safari';\r\n\t\t\tresult.version = extractVersion(navigator.userAgent, /AppleWebKit\\/(\\d+)\\./, 1);\r\n\t\t\tresult.supportsUnifiedPlan = window.RTCRtpTransceiver && 'currentDirection' in window.RTCRtpTransceiver.prototype;\r\n\t\t} else {\r\n\t\t\t// Default fallthrough: not supported.\r\n\t\t\tresult.browser = 'Not a supported browser.';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Checks if something is an object.\r\n\t *\r\n\t * @param {*} val The something you want to check.\r\n\t * @return true if val is an object, false otherwise.\r\n\t */\r\n\tfunction isObject(val) {\r\n\t\treturn Object.prototype.toString.call(val) === '[object Object]';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Remove all empty objects and undefined values\r\n\t * from a nested object -- an enhanced and vanilla version\r\n\t * of Lodash's `compact`.\r\n\t */\r\n\tfunction compactObject(data) {\r\n\t\tif (!isObject(data)) {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\r\n\t\treturn Object.keys(data).reduce(function (accumulator, key) {\r\n\t\t\tvar isObj = isObject(data[key]);\r\n\t\t\tvar value = isObj ? compactObject(data[key]) : data[key];\r\n\t\t\tvar isEmptyObject = isObj && !Object.keys(value).length;\r\n\t\t\tif (value === undefined || isEmptyObject) {\r\n\t\t\t\treturn accumulator;\r\n\t\t\t}\r\n\t\t\treturn Object.assign(accumulator, _defineProperty({}, key, value));\r\n\t\t}, {});\r\n\t}\r\n\t\r\n\t/* iterates the stats graph recursively. */\r\n\tfunction walkStats(stats, base, resultSet) {\r\n\t\tif (!base || resultSet.has(base.id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tresultSet.set(base.id, base);\r\n\t\tObject.keys(base).forEach(function (name) {\r\n\t\t\tif (name.endsWith('Id')) {\r\n\t\t\t\twalkStats(stats, stats.get(base[name]), resultSet);\r\n\t\t\t} else if (name.endsWith('Ids')) {\r\n\t\t\t\tbase[name].forEach(function (id) {\r\n\t\t\t\t\twalkStats(stats, stats.get(id), resultSet);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/* filter getStats for a sender/receiver track. */\r\n\tfunction filterStats(result, track, outbound) {\r\n\t\tvar streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\r\n\t\tvar filteredResult = new Map();\r\n\t\tif (track === null) {\r\n\t\t\treturn filteredResult;\r\n\t\t}\r\n\t\tvar trackStats = [];\r\n\t\tresult.forEach(function (value) {\r\n\t\t\tif (value.type === 'track' && value.trackIdentifier === track.id) {\r\n\t\t\t\ttrackStats.push(value);\r\n\t\t\t}\r\n\t\t});\r\n\t\ttrackStats.forEach(function (trackStat) {\r\n\t\t\tresult.forEach(function (stats) {\r\n\t\t\t\tif (stats.type === streamStatsType && stats.trackId === trackStat.id) {\r\n\t\t\t\t\twalkStats(result, stats, filteredResult);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn filteredResult;\r\n\t}\r\n\t\r\n\t},{}],16:[function(require,module,exports){\r\n\t/*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t /* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\tvar SDPUtils = require('sdp');\r\n\t\r\n\tfunction fixStatsType(stat) {\r\n\t\treturn {\r\n\t\t\tinboundrtp: 'inbound-rtp',\r\n\t\t\toutboundrtp: 'outbound-rtp',\r\n\t\t\tcandidatepair: 'candidate-pair',\r\n\t\t\tlocalcandidate: 'local-candidate',\r\n\t\t\tremotecandidate: 'remote-candidate'\r\n\t\t}[stat.type] || stat.type;\r\n\t}\r\n\t\r\n\tfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\r\n\t\tvar sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\t\r\n\t\t// Map ICE parameters (ufrag, pwd) to SDP.\r\n\t\tsdp += SDPUtils.writeIceParameters(\r\n\t\t\t\ttransceiver.iceGatherer.getLocalParameters());\r\n\t\r\n\t\t// Map DTLS parameters to SDP.\r\n\t\tsdp += SDPUtils.writeDtlsParameters(\r\n\t\t\t\ttransceiver.dtlsTransport.getLocalParameters(),\r\n\t\t\t\ttype === 'offer' ? 'actpass' : dtlsRole || 'active');\r\n\t\r\n\t\tsdp += 'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\r\n\t\tif (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=sendrecv\\r\\n';\r\n\t\t} else if (transceiver.rtpSender) {\r\n\t\t\tsdp += 'a=sendonly\\r\\n';\r\n\t\t} else if (transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=recvonly\\r\\n';\r\n\t\t} else {\r\n\t\t\tsdp += 'a=inactive\\r\\n';\r\n\t\t}\r\n\t\r\n\t\tif (transceiver.rtpSender) {\r\n\t\t\tvar trackId = transceiver.rtpSender._initialTrackId ||\r\n\t\t\t\t\ttransceiver.rtpSender.track.id;\r\n\t\t\ttransceiver.rtpSender._initialTrackId = trackId;\r\n\t\t\t// spec.\r\n\t\t\tvar msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\r\n\t\t\t\t\ttrackId + '\\r\\n';\r\n\t\t\tsdp += 'a=' + msid;\r\n\t\t\t// for Chrome. Legacy should no longer be required.\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t\t' ' + msid;\r\n\t\r\n\t\t\t// RTX\r\n\t\t\tif (transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t' ' + msid;\r\n\t\t\t\tsdp += 'a=ssrc-group:FID ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].ssrc + ' ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t}\r\n\t\t}\r\n\t\t// FIXME: this should be written by writeRtpDescription.\r\n\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\tif (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\t}\r\n\t\treturn sdp;\r\n\t}\r\n\t\r\n\t// Edge does not like\r\n\t// 1) stun: filtered after 14393 unless ?transport=udp is present\r\n\t// 2) turn: that does not have all of turn:host:port?transport=udp\r\n\t// 3) turn: with ipv6 addresses\r\n\t// 4) turn: occurring muliple times\r\n\tfunction filterIceServers(iceServers, edgeVersion) {\r\n\t\tvar hasTurn = false;\r\n\t\ticeServers = JSON.parse(JSON.stringify(iceServers));\r\n\t\treturn iceServers.filter(function(server) {\r\n\t\t\tif (server && (server.urls || server.url)) {\r\n\t\t\t\tvar urls = server.urls || server.url;\r\n\t\t\t\tif (server.url && !server.urls) {\r\n\t\t\t\t\tconsole.warn('RTCIceServer.url is deprecated! Use urls instead.');\r\n\t\t\t\t}\r\n\t\t\t\tvar isString = typeof urls === 'string';\r\n\t\t\t\tif (isString) {\r\n\t\t\t\t\turls = [urls];\r\n\t\t\t\t}\r\n\t\t\t\turls = urls.filter(function(url) {\r\n\t\t\t\t\tvar validTurn = url.indexOf('turn:') === 0 &&\r\n\t\t\t\t\t\t\turl.indexOf('transport=udp') !== -1 &&\r\n\t\t\t\t\t\t\turl.indexOf('turn:[') === -1 &&\r\n\t\t\t\t\t\t\t!hasTurn;\r\n\t\r\n\t\t\t\t\tif (validTurn) {\r\n\t\t\t\t\t\thasTurn = true;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\r\n\t\t\t\t\t\t\turl.indexOf('?transport=udp') === -1;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tdelete server.url;\r\n\t\t\t\tserver.urls = isString ? urls[0] : urls;\r\n\t\t\t\treturn !!urls.length;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t// Determines the intersection of local and remote capabilities.\r\n\tfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\r\n\t\tvar commonCapabilities = {\r\n\t\t\tcodecs: [],\r\n\t\t\theaderExtensions: [],\r\n\t\t\tfecMechanisms: []\r\n\t\t};\r\n\t\r\n\t\tvar findCodecByPayloadType = function(pt, codecs) {\r\n\t\t\tpt = parseInt(pt, 10);\r\n\t\t\tfor (var i = 0; i < codecs.length; i++) {\r\n\t\t\t\tif (codecs[i].payloadType === pt ||\r\n\t\t\t\t\t\tcodecs[i].preferredPayloadType === pt) {\r\n\t\t\t\t\treturn codecs[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tvar rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\r\n\t\t\tvar lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\r\n\t\t\tvar rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\r\n\t\t\treturn lCodec && rCodec &&\r\n\t\t\t\t\tlCodec.name.toLowerCase() === rCodec.name.toLowerCase();\r\n\t\t};\r\n\t\r\n\t\tlocalCapabilities.codecs.forEach(function(lCodec) {\r\n\t\t\tfor (var i = 0; i < remoteCapabilities.codecs.length; i++) {\r\n\t\t\t\tvar rCodec = remoteCapabilities.codecs[i];\r\n\t\t\t\tif (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\tlCodec.clockRate === rCodec.clockRate) {\r\n\t\t\t\t\tif (lCodec.name.toLowerCase() === 'rtx' &&\r\n\t\t\t\t\t\t\tlCodec.parameters && rCodec.parameters.apt) {\r\n\t\t\t\t\t\t// for RTX we need to find the local rtx that has a apt\r\n\t\t\t\t\t\t// which points to the same local codec as the remote one.\r\n\t\t\t\t\t\tif (!rtxCapabilityMatches(lCodec, rCodec,\r\n\t\t\t\t\t\t\t\tlocalCapabilities.codecs, remoteCapabilities.codecs)) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\trCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\r\n\t\t\t\t\t// number of channels is the highest common number of channels\r\n\t\t\t\t\trCodec.numChannels = Math.min(lCodec.numChannels,\r\n\t\t\t\t\t\t\trCodec.numChannels);\r\n\t\t\t\t\t// push rCodec so we reply with offerer payload type\r\n\t\t\t\t\tcommonCapabilities.codecs.push(rCodec);\r\n\t\r\n\t\t\t\t\t// determine common feedback mechanisms\r\n\t\t\t\t\trCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\r\n\t\t\t\t\t\tfor (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\r\n\t\t\t\t\t\t\tif (lCodec.rtcpFeedback[j].type === fb.type &&\r\n\t\t\t\t\t\t\t\t\tlCodec.rtcpFeedback[j].parameter === fb.parameter) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// FIXME: also need to determine .parameters\r\n\t\t\t\t\t//  see https://github.com/openpeer/ortc/issues/569\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\tlocalCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\r\n\t\t\tfor (var i = 0; i < remoteCapabilities.headerExtensions.length;\r\n\t\t\t\t\t i++) {\r\n\t\t\t\tvar rHeaderExtension = remoteCapabilities.headerExtensions[i];\r\n\t\t\t\tif (lHeaderExtension.uri === rHeaderExtension.uri) {\r\n\t\t\t\t\tcommonCapabilities.headerExtensions.push(rHeaderExtension);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// FIXME: fecMechanisms\r\n\t\treturn commonCapabilities;\r\n\t}\r\n\t\r\n\t// is action=setLocalDescription with type allowed in signalingState\r\n\tfunction isActionAllowedInSignalingState(action, type, signalingState) {\r\n\t\treturn {\r\n\t\t\toffer: {\r\n\t\t\t\tsetLocalDescription: ['stable', 'have-local-offer'],\r\n\t\t\t\tsetRemoteDescription: ['stable', 'have-remote-offer']\r\n\t\t\t},\r\n\t\t\tanswer: {\r\n\t\t\t\tsetLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\r\n\t\t\t\tsetRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\r\n\t\t\t}\r\n\t\t}[type][action].indexOf(signalingState) !== -1;\r\n\t}\r\n\t\r\n\tfunction maybeAddCandidate(iceTransport, candidate) {\r\n\t\t// Edge's internal representation adds some fields therefore\r\n\t\t// not all fieldѕ are taken into account.\r\n\t\tvar alreadyAdded = iceTransport.getRemoteCandidates()\r\n\t\t\t\t.find(function(remoteCandidate) {\r\n\t\t\t\t\treturn candidate.foundation === remoteCandidate.foundation &&\r\n\t\t\t\t\t\t\tcandidate.ip === remoteCandidate.ip &&\r\n\t\t\t\t\t\t\tcandidate.port === remoteCandidate.port &&\r\n\t\t\t\t\t\t\tcandidate.priority === remoteCandidate.priority &&\r\n\t\t\t\t\t\t\tcandidate.protocol === remoteCandidate.protocol &&\r\n\t\t\t\t\t\t\tcandidate.type === remoteCandidate.type;\r\n\t\t\t\t});\r\n\t\tif (!alreadyAdded) {\r\n\t\t\ticeTransport.addRemoteCandidate(candidate);\r\n\t\t}\r\n\t\treturn !alreadyAdded;\r\n\t}\r\n\t\r\n\t\r\n\tfunction makeError(name, description) {\r\n\t\tvar e = new Error(description);\r\n\t\te.name = name;\r\n\t\t// legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n\t\te.code = {\r\n\t\t\tNotSupportedError: 9,\r\n\t\t\tInvalidStateError: 11,\r\n\t\t\tInvalidAccessError: 15,\r\n\t\t\tTypeError: undefined,\r\n\t\t\tOperationError: undefined\r\n\t\t}[name];\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\tmodule.exports = function(window, edgeVersion) {\r\n\t\t// https://w3c.github.io/mediacapture-main/#mediastream\r\n\t\t// Helper function to add the track to the stream and\r\n\t\t// dispatch the event ourselves.\r\n\t\tfunction addTrackToStreamAndFireEvent(track, stream) {\r\n\t\t\tstream.addTrack(track);\r\n\t\t\tstream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\r\n\t\t\t\t\t{track: track}));\r\n\t\t}\r\n\t\r\n\t\tfunction removeTrackFromStreamAndFireEvent(track, stream) {\r\n\t\t\tstream.removeTrack(track);\r\n\t\t\tstream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\r\n\t\t\t\t\t{track: track}));\r\n\t\t}\r\n\t\r\n\t\tfunction fireAddTrack(pc, track, receiver, streams) {\r\n\t\t\tvar trackEvent = new Event('track');\r\n\t\t\ttrackEvent.track = track;\r\n\t\t\ttrackEvent.receiver = receiver;\r\n\t\t\ttrackEvent.transceiver = {receiver: receiver};\r\n\t\t\ttrackEvent.streams = streams;\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tpc._dispatchEvent('track', trackEvent);\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\tvar RTCPeerConnection = function(config) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tvar _eventTarget = document.createDocumentFragment();\r\n\t\t\t['addEventListener', 'removeEventListener', 'dispatchEvent']\r\n\t\t\t\t\t.forEach(function(method) {\r\n\t\t\t\t\t\tpc[method] = _eventTarget[method].bind(_eventTarget);\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\tthis.canTrickleIceCandidates = null;\r\n\t\r\n\t\t\tthis.needNegotiation = false;\r\n\t\r\n\t\t\tthis.localStreams = [];\r\n\t\t\tthis.remoteStreams = [];\r\n\t\r\n\t\t\tthis._localDescription = null;\r\n\t\t\tthis._remoteDescription = null;\r\n\t\r\n\t\t\tthis.signalingState = 'stable';\r\n\t\t\tthis.iceConnectionState = 'new';\r\n\t\t\tthis.connectionState = 'new';\r\n\t\t\tthis.iceGatheringState = 'new';\r\n\t\r\n\t\t\tconfig = JSON.parse(JSON.stringify(config || {}));\r\n\t\r\n\t\t\tthis.usingBundle = config.bundlePolicy === 'max-bundle';\r\n\t\t\tif (config.rtcpMuxPolicy === 'negotiate') {\r\n\t\t\t\tthrow(makeError('NotSupportedError',\r\n\t\t\t\t\t\t'rtcpMuxPolicy \\'negotiate\\' is not supported'));\r\n\t\t\t} else if (!config.rtcpMuxPolicy) {\r\n\t\t\t\tconfig.rtcpMuxPolicy = 'require';\r\n\t\t\t}\r\n\t\r\n\t\t\tswitch (config.iceTransportPolicy) {\r\n\t\t\t\tcase 'all':\r\n\t\t\t\tcase 'relay':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconfig.iceTransportPolicy = 'all';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\r\n\t\t\tswitch (config.bundlePolicy) {\r\n\t\t\t\tcase 'balanced':\r\n\t\t\t\tcase 'max-compat':\r\n\t\t\t\tcase 'max-bundle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconfig.bundlePolicy = 'balanced';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\r\n\t\t\tconfig.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\r\n\t\r\n\t\t\tthis._iceGatherers = [];\r\n\t\t\tif (config.iceCandidatePoolSize) {\r\n\t\t\t\tfor (var i = config.iceCandidatePoolSize; i > 0; i--) {\r\n\t\t\t\t\tthis._iceGatherers.push(new window.RTCIceGatherer({\r\n\t\t\t\t\t\ticeServers: config.iceServers,\r\n\t\t\t\t\t\tgatherPolicy: config.iceTransportPolicy\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconfig.iceCandidatePoolSize = 0;\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._config = config;\r\n\t\r\n\t\t\t// per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\r\n\t\t\t// everything that is needed to describe a SDP m-line.\r\n\t\t\tthis.transceivers = [];\r\n\t\r\n\t\t\tthis._sdpSessionId = SDPUtils.generateSessionId();\r\n\t\t\tthis._sdpSessionVersion = 0;\r\n\t\r\n\t\t\tthis._dtlsRole = undefined; // role for a=setup to use in answers.\r\n\t\r\n\t\t\tthis._isClosed = false;\r\n\t\t};\r\n\t\r\n\t\tObject.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\r\n\t\t\tconfigurable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn this._localDescription;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\r\n\t\t\tconfigurable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn this._remoteDescription;\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// set up event handlers on prototype\r\n\t\tRTCPeerConnection.prototype.onicecandidate = null;\r\n\t\tRTCPeerConnection.prototype.onaddstream = null;\r\n\t\tRTCPeerConnection.prototype.ontrack = null;\r\n\t\tRTCPeerConnection.prototype.onremovestream = null;\r\n\t\tRTCPeerConnection.prototype.onsignalingstatechange = null;\r\n\t\tRTCPeerConnection.prototype.oniceconnectionstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onconnectionstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onicegatheringstatechange = null;\r\n\t\tRTCPeerConnection.prototype.onnegotiationneeded = null;\r\n\t\tRTCPeerConnection.prototype.ondatachannel = null;\r\n\t\r\n\t\tRTCPeerConnection.prototype._dispatchEvent = function(name, event) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.dispatchEvent(event);\r\n\t\t\tif (typeof this['on' + name] === 'function') {\r\n\t\t\t\tthis['on' + name](event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype._emitGatheringStateChange = function() {\r\n\t\t\tvar event = new Event('icegatheringstatechange');\r\n\t\t\tthis._dispatchEvent('icegatheringstatechange', event);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getConfiguration = function() {\r\n\t\t\treturn this._config;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getLocalStreams = function() {\r\n\t\t\treturn this.localStreams;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getRemoteStreams = function() {\r\n\t\t\treturn this.remoteStreams;\r\n\t\t};\r\n\t\r\n\t\t// internal helper to create a transceiver object.\r\n\t\t// (which is not yet the same as the WebRTC 1.0 transceiver)\r\n\t\tRTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\r\n\t\t\tvar hasBundleTransport = this.transceivers.length > 0;\r\n\t\t\tvar transceiver = {\r\n\t\t\t\ttrack: null,\r\n\t\t\t\ticeGatherer: null,\r\n\t\t\t\ticeTransport: null,\r\n\t\t\t\tdtlsTransport: null,\r\n\t\t\t\tlocalCapabilities: null,\r\n\t\t\t\tremoteCapabilities: null,\r\n\t\t\t\trtpSender: null,\r\n\t\t\t\trtpReceiver: null,\r\n\t\t\t\tkind: kind,\r\n\t\t\t\tmid: null,\r\n\t\t\t\tsendEncodingParameters: null,\r\n\t\t\t\trecvEncodingParameters: null,\r\n\t\t\t\tstream: null,\r\n\t\t\t\tassociatedRemoteMediaStreams: [],\r\n\t\t\t\twantReceive: true\r\n\t\t\t};\r\n\t\t\tif (this.usingBundle && hasBundleTransport) {\r\n\t\t\t\ttransceiver.iceTransport = this.transceivers[0].iceTransport;\r\n\t\t\t\ttransceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\r\n\t\t\t} else {\r\n\t\t\t\tvar transports = this._createIceAndDtlsTransports();\r\n\t\t\t\ttransceiver.iceTransport = transports.iceTransport;\r\n\t\t\t\ttransceiver.dtlsTransport = transports.dtlsTransport;\r\n\t\t\t}\r\n\t\t\tif (!doNotAdd) {\r\n\t\t\t\tthis.transceivers.push(transceiver);\r\n\t\t\t}\r\n\t\t\treturn transceiver;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addTrack = function(track, stream) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\tthrow makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Attempted to call addTrack on a closed peerconnection.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar alreadyExists = this.transceivers.find(function(s) {\r\n\t\t\t\treturn s.track === track;\r\n\t\t\t});\r\n\t\r\n\t\t\tif (alreadyExists) {\r\n\t\t\t\tthrow makeError('InvalidAccessError', 'Track already exists.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar transceiver;\r\n\t\t\tfor (var i = 0; i < this.transceivers.length; i++) {\r\n\t\t\t\tif (!this.transceivers[i].track &&\r\n\t\t\t\t\t\tthis.transceivers[i].kind === track.kind) {\r\n\t\t\t\t\ttransceiver = this.transceivers[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!transceiver) {\r\n\t\t\t\ttransceiver = this._createTransceiver(track.kind);\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._maybeFireNegotiationNeeded();\r\n\t\r\n\t\t\tif (this.localStreams.indexOf(stream) === -1) {\r\n\t\t\t\tthis.localStreams.push(stream);\r\n\t\t\t}\r\n\t\r\n\t\t\ttransceiver.track = track;\r\n\t\t\ttransceiver.stream = stream;\r\n\t\t\ttransceiver.rtpSender = new window.RTCRtpSender(track,\r\n\t\t\t\t\ttransceiver.dtlsTransport);\r\n\t\t\treturn transceiver.rtpSender;\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addStream = function(stream) {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (edgeVersion >= 15025) {\r\n\t\t\t\tstream.getTracks().forEach(function(track) {\r\n\t\t\t\t\tpc.addTrack(track, stream);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Clone is necessary for local demos mostly, attaching directly\r\n\t\t\t\t// to two different senders does not work (build 10547).\r\n\t\t\t\t// Fixed in 15025 (or earlier)\r\n\t\t\t\tvar clonedStream = stream.clone();\r\n\t\t\t\tstream.getTracks().forEach(function(track, idx) {\r\n\t\t\t\t\tvar clonedTrack = clonedStream.getTracks()[idx];\r\n\t\t\t\t\ttrack.addEventListener('enabled', function(event) {\r\n\t\t\t\t\t\tclonedTrack.enabled = event.enabled;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tclonedStream.getTracks().forEach(function(track) {\r\n\t\t\t\t\tpc.addTrack(track, clonedStream);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.removeTrack = function(sender) {\r\n\t\t\tif (this._isClosed) {\r\n\t\t\t\tthrow makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Attempted to call removeTrack on a closed peerconnection.');\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!(sender instanceof window.RTCRtpSender)) {\r\n\t\t\t\tthrow new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\r\n\t\t\t\t\t\t'does not implement interface RTCRtpSender.');\r\n\t\t\t}\r\n\t\r\n\t\t\tvar transceiver = this.transceivers.find(function(t) {\r\n\t\t\t\treturn t.rtpSender === sender;\r\n\t\t\t});\r\n\t\r\n\t\t\tif (!transceiver) {\r\n\t\t\t\tthrow makeError('InvalidAccessError',\r\n\t\t\t\t\t\t'Sender was not created by this connection.');\r\n\t\t\t}\r\n\t\t\tvar stream = transceiver.stream;\r\n\t\r\n\t\t\ttransceiver.rtpSender.stop();\r\n\t\t\ttransceiver.rtpSender = null;\r\n\t\t\ttransceiver.track = null;\r\n\t\t\ttransceiver.stream = null;\r\n\t\r\n\t\t\t// remove the stream from the set of local streams\r\n\t\t\tvar localStreams = this.transceivers.map(function(t) {\r\n\t\t\t\treturn t.stream;\r\n\t\t\t});\r\n\t\t\tif (localStreams.indexOf(stream) === -1 &&\r\n\t\t\t\t\tthis.localStreams.indexOf(stream) > -1) {\r\n\t\t\t\tthis.localStreams.splice(this.localStreams.indexOf(stream), 1);\r\n\t\t\t}\r\n\t\r\n\t\t\tthis._maybeFireNegotiationNeeded();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.removeStream = function(stream) {\r\n\t\t\tvar pc = this;\r\n\t\t\tstream.getTracks().forEach(function(track) {\r\n\t\t\t\tvar sender = pc.getSenders().find(function(s) {\r\n\t\t\t\t\treturn s.track === track;\r\n\t\t\t\t});\r\n\t\t\t\tif (sender) {\r\n\t\t\t\t\tpc.removeTrack(sender);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getSenders = function() {\r\n\t\t\treturn this.transceivers.filter(function(transceiver) {\r\n\t\t\t\treturn !!transceiver.rtpSender;\r\n\t\t\t})\r\n\t\t\t.map(function(transceiver) {\r\n\t\t\t\treturn transceiver.rtpSender;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getReceivers = function() {\r\n\t\t\treturn this.transceivers.filter(function(transceiver) {\r\n\t\t\t\treturn !!transceiver.rtpReceiver;\r\n\t\t\t})\r\n\t\t\t.map(function(transceiver) {\r\n\t\t\t\treturn transceiver.rtpReceiver;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\r\n\t\tRTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\r\n\t\t\t\tusingBundle) {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (usingBundle && sdpMLineIndex > 0) {\r\n\t\t\t\treturn this.transceivers[0].iceGatherer;\r\n\t\t\t} else if (this._iceGatherers.length) {\r\n\t\t\t\treturn this._iceGatherers.shift();\r\n\t\t\t}\r\n\t\t\tvar iceGatherer = new window.RTCIceGatherer({\r\n\t\t\t\ticeServers: this._config.iceServers,\r\n\t\t\t\tgatherPolicy: this._config.iceTransportPolicy\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(iceGatherer, 'state',\r\n\t\t\t\t\t{value: 'new', writable: true}\r\n\t\t\t);\r\n\t\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\r\n\t\t\t\tvar end = !event.candidate || Object.keys(event.candidate).length === 0;\r\n\t\t\t\t// polyfill since RTCIceGatherer.state is not implemented in\r\n\t\t\t\t// Edge 10547 yet.\r\n\t\t\t\ticeGatherer.state = end ? 'completed' : 'gathering';\r\n\t\t\t\tif (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ticeGatherer.addEventListener('localcandidate',\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates);\r\n\t\t\treturn iceGatherer;\r\n\t\t};\r\n\t\r\n\t\t// start gathering from an RTCIceGatherer.\r\n\t\tRTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\tif (iceGatherer.onlocalcandidate) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar bufferedCandidateEvents =\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents;\r\n\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\r\n\t\t\ticeGatherer.removeEventListener('localcandidate',\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferCandidates);\r\n\t\t\ticeGatherer.onlocalcandidate = function(evt) {\r\n\t\t\t\tif (pc.usingBundle && sdpMLineIndex > 0) {\r\n\t\t\t\t\t// if we know that we use bundle we can drop candidates with\r\n\t\t\t\t\t// ѕdpMLineIndex > 0. If we don't do this then our state gets\r\n\t\t\t\t\t// confused since we dispose the extra ice gatherer.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar event = new Event('icecandidate');\r\n\t\t\t\tevent.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\r\n\t\r\n\t\t\t\tvar cand = evt.candidate;\r\n\t\t\t\t// Edge emits an empty object for RTCIceCandidateComplete‥\r\n\t\t\t\tvar end = !cand || Object.keys(cand).length === 0;\r\n\t\t\t\tif (end) {\r\n\t\t\t\t\t// polyfill since RTCIceGatherer.state is not implemented in\r\n\t\t\t\t\t// Edge 10547 yet.\r\n\t\t\t\t\tif (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\r\n\t\t\t\t\t\ticeGatherer.state = 'completed';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (iceGatherer.state === 'new') {\r\n\t\t\t\t\t\ticeGatherer.state = 'gathering';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// RTCIceCandidate doesn't have a component, needs to be added\r\n\t\t\t\t\tcand.component = 1;\r\n\t\t\t\t\t// also the usernameFragment. TODO: update SDP to take both variants.\r\n\t\t\t\t\tcand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\r\n\t\r\n\t\t\t\t\tvar serializedCandidate = SDPUtils.writeCandidate(cand);\r\n\t\t\t\t\tevent.candidate = Object.assign(event.candidate,\r\n\t\t\t\t\t\t\tSDPUtils.parseCandidate(serializedCandidate));\r\n\t\r\n\t\t\t\t\tevent.candidate.candidate = serializedCandidate;\r\n\t\t\t\t\tevent.candidate.toJSON = function() {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcandidate: event.candidate.candidate,\r\n\t\t\t\t\t\t\tsdpMid: event.candidate.sdpMid,\r\n\t\t\t\t\t\t\tsdpMLineIndex: event.candidate.sdpMLineIndex,\r\n\t\t\t\t\t\t\tusernameFragment: event.candidate.usernameFragment\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// update local description.\r\n\t\t\t\tvar sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tsections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t'a=' + event.candidate.candidate + '\\r\\n';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t'a=end-of-candidates\\r\\n';\r\n\t\t\t\t}\r\n\t\t\t\tpc._localDescription.sdp =\r\n\t\t\t\t\t\tSDPUtils.getDescription(pc._localDescription.sdp) +\r\n\t\t\t\t\t\tsections.join('');\r\n\t\t\t\tvar complete = pc.transceivers.every(function(transceiver) {\r\n\t\t\t\t\treturn transceiver.iceGatherer &&\r\n\t\t\t\t\t\t\ttransceiver.iceGatherer.state === 'completed';\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tif (pc.iceGatheringState !== 'gathering') {\r\n\t\t\t\t\tpc.iceGatheringState = 'gathering';\r\n\t\t\t\t\tpc._emitGatheringStateChange();\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Emit candidate. Also emit null candidate when all gatherers are\r\n\t\t\t\t// complete.\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tpc._dispatchEvent('icecandidate', event);\r\n\t\t\t\t}\r\n\t\t\t\tif (complete) {\r\n\t\t\t\t\tpc._dispatchEvent('icecandidate', new Event('icecandidate'));\r\n\t\t\t\t\tpc.iceGatheringState = 'complete';\r\n\t\t\t\t\tpc._emitGatheringStateChange();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\r\n\t\t\t// emit already gathered candidates.\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tbufferedCandidateEvents.forEach(function(e) {\r\n\t\t\t\t\ticeGatherer.onlocalcandidate(e);\r\n\t\t\t\t});\r\n\t\t\t}, 0);\r\n\t\t};\r\n\t\r\n\t\t// Create ICE transport and DTLS transport.\r\n\t\tRTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar iceTransport = new window.RTCIceTransport(null);\r\n\t\t\ticeTransport.onicestatechange = function() {\r\n\t\t\t\tpc._updateIceConnectionState();\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\r\n\t\t\tvar dtlsTransport = new window.RTCDtlsTransport(iceTransport);\r\n\t\t\tdtlsTransport.ondtlsstatechange = function() {\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\t\tdtlsTransport.onerror = function() {\r\n\t\t\t\t// onerror does not set state to failed by itself.\r\n\t\t\t\tObject.defineProperty(dtlsTransport, 'state',\r\n\t\t\t\t\t\t{value: 'failed', writable: true});\r\n\t\t\t\tpc._updateConnectionState();\r\n\t\t\t};\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\ticeTransport: iceTransport,\r\n\t\t\t\tdtlsTransport: dtlsTransport\r\n\t\t\t};\r\n\t\t};\r\n\t\r\n\t\t// Destroy ICE gatherer, ICE transport and DTLS transport.\r\n\t\t// Without triggering the callbacks.\r\n\t\tRTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\r\n\t\t\t\tsdpMLineIndex) {\r\n\t\t\tvar iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\tif (iceGatherer) {\r\n\t\t\t\tdelete iceGatherer.onlocalcandidate;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].iceGatherer;\r\n\t\t\t}\r\n\t\t\tvar iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\r\n\t\t\tif (iceTransport) {\r\n\t\t\t\tdelete iceTransport.onicestatechange;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].iceTransport;\r\n\t\t\t}\r\n\t\t\tvar dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\r\n\t\t\tif (dtlsTransport) {\r\n\t\t\t\tdelete dtlsTransport.ondtlsstatechange;\r\n\t\t\t\tdelete dtlsTransport.onerror;\r\n\t\t\t\tdelete this.transceivers[sdpMLineIndex].dtlsTransport;\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Start the RTP Sender and Receiver for a transceiver.\r\n\t\tRTCPeerConnection.prototype._transceive = function(transceiver,\r\n\t\t\t\tsend, recv) {\r\n\t\t\tvar params = getCommonCapabilities(transceiver.localCapabilities,\r\n\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\t\tif (send && transceiver.rtpSender) {\r\n\t\t\t\tparams.encodings = transceiver.sendEncodingParameters;\r\n\t\t\t\tparams.rtcp = {\r\n\t\t\t\t\tcname: SDPUtils.localCName,\r\n\t\t\t\t\tcompound: transceiver.rtcpParameters.compound\r\n\t\t\t\t};\r\n\t\t\t\tif (transceiver.recvEncodingParameters.length) {\r\n\t\t\t\t\tparams.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\r\n\t\t\t\t}\r\n\t\t\t\ttransceiver.rtpSender.send(params);\r\n\t\t\t}\r\n\t\t\tif (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\r\n\t\t\t\t// remove RTX field in Edge 14942\r\n\t\t\t\tif (transceiver.kind === 'video'\r\n\t\t\t\t\t\t&& transceiver.recvEncodingParameters\r\n\t\t\t\t\t\t&& edgeVersion < 15019) {\r\n\t\t\t\t\ttransceiver.recvEncodingParameters.forEach(function(p) {\r\n\t\t\t\t\t\tdelete p.rtx;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.recvEncodingParameters.length) {\r\n\t\t\t\t\tparams.encodings = transceiver.recvEncodingParameters;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.encodings = [{}];\r\n\t\t\t\t}\r\n\t\t\t\tparams.rtcp = {\r\n\t\t\t\t\tcompound: transceiver.rtcpParameters.compound\r\n\t\t\t\t};\r\n\t\t\t\tif (transceiver.rtcpParameters.cname) {\r\n\t\t\t\t\tparams.rtcp.cname = transceiver.rtcpParameters.cname;\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.sendEncodingParameters.length) {\r\n\t\t\t\t\tparams.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\r\n\t\t\t\t}\r\n\t\t\t\ttransceiver.rtpReceiver.receive(params);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.setLocalDescription = function(description) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\t// Note: pranswer is not supported.\r\n\t\t\tif (['offer', 'answer'].indexOf(description.type) === -1) {\r\n\t\t\t\treturn Promise.reject(makeError('TypeError',\r\n\t\t\t\t\t\t'Unsupported type \"' + description.type + '\"'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!isActionAllowedInSignalingState('setLocalDescription',\r\n\t\t\t\t\tdescription.type, pc.signalingState) || pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not set local ' + description.type +\r\n\t\t\t\t\t\t' in state ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sections;\r\n\t\t\tvar sessionpart;\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\t// VERY limited support for SDP munging. Limited to:\r\n\t\t\t\t// * changing the order of codecs\r\n\t\t\t\tsections = SDPUtils.splitSections(description.sdp);\r\n\t\t\t\tsessionpart = sections.shift();\r\n\t\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\t\tvar caps = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].localCapabilities = caps;\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\t\tpc._gather(transceiver.mid, sdpMLineIndex);\r\n\t\t\t\t});\r\n\t\t\t} else if (description.type === 'answer') {\r\n\t\t\t\tsections = SDPUtils.splitSections(pc._remoteDescription.sdp);\r\n\t\t\t\tsessionpart = sections.shift();\r\n\t\t\t\tvar isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t\t'a=ice-lite').length > 0;\r\n\t\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\t\tvar transceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\tvar iceGatherer = transceiver.iceGatherer;\r\n\t\t\t\t\tvar iceTransport = transceiver.iceTransport;\r\n\t\t\t\t\tvar dtlsTransport = transceiver.dtlsTransport;\r\n\t\t\t\t\tvar localCapabilities = transceiver.localCapabilities;\r\n\t\t\t\t\tvar remoteCapabilities = transceiver.remoteCapabilities;\r\n\t\r\n\t\t\t\t\t// treat bundle-only as not-rejected.\r\n\t\t\t\t\tvar rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n\t\r\n\t\t\t\t\tif (!rejected && !transceiver.rejected) {\r\n\t\t\t\t\t\tvar remoteIceParameters = SDPUtils.getIceParameters(\r\n\t\t\t\t\t\t\t\tmediaSection, sessionpart);\r\n\t\t\t\t\t\tvar remoteDtlsParameters = SDPUtils.getDtlsParameters(\r\n\t\t\t\t\t\t\t\tmediaSection, sessionpart);\r\n\t\t\t\t\t\tif (isIceLite) {\r\n\t\t\t\t\t\t\tremoteDtlsParameters.role = 'server';\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif (!pc.usingBundle || sdpMLineIndex === 0) {\r\n\t\t\t\t\t\t\tpc._gather(transceiver.mid, sdpMLineIndex);\r\n\t\t\t\t\t\t\tif (iceTransport.state === 'new') {\r\n\t\t\t\t\t\t\t\ticeTransport.start(iceGatherer, remoteIceParameters,\r\n\t\t\t\t\t\t\t\t\t\tisIceLite ? 'controlling' : 'controlled');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (dtlsTransport.state === 'new') {\r\n\t\t\t\t\t\t\t\tdtlsTransport.start(remoteDtlsParameters);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t// Calculate intersection of capabilities.\r\n\t\t\t\t\t\tvar params = getCommonCapabilities(localCapabilities,\r\n\t\t\t\t\t\t\t\tremoteCapabilities);\r\n\t\r\n\t\t\t\t\t\t// Start the RTCRtpSender. The RTCRtpReceiver for this\r\n\t\t\t\t\t\t// transceiver has already been started in setRemoteDescription.\r\n\t\t\t\t\t\tpc._transceive(transceiver,\r\n\t\t\t\t\t\t\t\tparams.codecs.length > 0,\r\n\t\t\t\t\t\t\t\tfalse);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\r\n\t\t\tpc._localDescription = {\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: description.sdp\r\n\t\t\t};\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\tpc._updateSignalingState('have-local-offer');\r\n\t\t\t} else {\r\n\t\t\t\tpc._updateSignalingState('stable');\r\n\t\t\t}\r\n\t\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.setRemoteDescription = function(description) {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\t// Note: pranswer is not supported.\r\n\t\t\tif (['offer', 'answer'].indexOf(description.type) === -1) {\r\n\t\t\t\treturn Promise.reject(makeError('TypeError',\r\n\t\t\t\t\t\t'Unsupported type \"' + description.type + '\"'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!isActionAllowedInSignalingState('setRemoteDescription',\r\n\t\t\t\t\tdescription.type, pc.signalingState) || pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not set remote ' + description.type +\r\n\t\t\t\t\t\t' in state ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar streams = {};\r\n\t\t\tpc.remoteStreams.forEach(function(stream) {\r\n\t\t\t\tstreams[stream.id] = stream;\r\n\t\t\t});\r\n\t\t\tvar receiverList = [];\r\n\t\t\tvar sections = SDPUtils.splitSections(description.sdp);\r\n\t\t\tvar sessionpart = sections.shift();\r\n\t\t\tvar isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=ice-lite').length > 0;\r\n\t\t\tvar usingBundle = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=group:BUNDLE ').length > 0;\r\n\t\t\tpc.usingBundle = usingBundle;\r\n\t\t\tvar iceOptions = SDPUtils.matchPrefix(sessionpart,\r\n\t\t\t\t\t'a=ice-options:')[0];\r\n\t\t\tif (iceOptions) {\r\n\t\t\t\tpc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\r\n\t\t\t\t\t\t.indexOf('trickle') >= 0;\r\n\t\t\t} else {\r\n\t\t\t\tpc.canTrickleIceCandidates = false;\r\n\t\t\t}\r\n\t\r\n\t\t\tsections.forEach(function(mediaSection, sdpMLineIndex) {\r\n\t\t\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\t\t\tvar kind = SDPUtils.getKind(mediaSection);\r\n\t\t\t\t// treat bundle-only as not-rejected.\r\n\t\t\t\tvar rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n\t\t\t\tvar protocol = lines[0].substr(2).split(' ')[2];\r\n\t\r\n\t\t\t\tvar direction = SDPUtils.getDirection(mediaSection, sessionpart);\r\n\t\t\t\tvar remoteMsid = SDPUtils.parseMsid(mediaSection);\r\n\t\r\n\t\t\t\tvar mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\r\n\t\r\n\t\t\t\t// Reject datachannels which are not implemented yet.\r\n\t\t\t\tif (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\r\n\t\t\t\t\t\tprotocol === 'UDP/DTLS/SCTP'))) {\r\n\t\t\t\t\t// TODO: this is dangerous in the case where a non-rejected m-line\r\n\t\t\t\t\t//     becomes rejected.\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex] = {\r\n\t\t\t\t\t\tmid: mid,\r\n\t\t\t\t\t\tkind: kind,\r\n\t\t\t\t\t\tprotocol: protocol,\r\n\t\t\t\t\t\trejected: true\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (!rejected && pc.transceivers[sdpMLineIndex] &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rejected) {\r\n\t\t\t\t\t// recycle a rejected transceiver.\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tvar transceiver;\r\n\t\t\t\tvar iceGatherer;\r\n\t\t\t\tvar iceTransport;\r\n\t\t\t\tvar dtlsTransport;\r\n\t\t\t\tvar rtpReceiver;\r\n\t\t\t\tvar sendEncodingParameters;\r\n\t\t\t\tvar recvEncodingParameters;\r\n\t\t\t\tvar localCapabilities;\r\n\t\r\n\t\t\t\tvar track;\r\n\t\t\t\t// FIXME: ensure the mediaSection has rtcp-mux set.\r\n\t\t\t\tvar remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\t\t\tvar remoteIceParameters;\r\n\t\t\t\tvar remoteDtlsParameters;\r\n\t\t\t\tif (!rejected) {\r\n\t\t\t\t\tremoteIceParameters = SDPUtils.getIceParameters(mediaSection,\r\n\t\t\t\t\t\t\tsessionpart);\r\n\t\t\t\t\tremoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\r\n\t\t\t\t\t\t\tsessionpart);\r\n\t\t\t\t\tremoteDtlsParameters.role = 'client';\r\n\t\t\t\t}\r\n\t\t\t\trecvEncodingParameters =\r\n\t\t\t\t\t\tSDPUtils.parseRtpEncodingParameters(mediaSection);\r\n\t\r\n\t\t\t\tvar rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\r\n\t\r\n\t\t\t\tvar isComplete = SDPUtils.matchPrefix(mediaSection,\r\n\t\t\t\t\t\t'a=end-of-candidates', sessionpart).length > 0;\r\n\t\t\t\tvar cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\r\n\t\t\t\t\t\t.map(function(cand) {\r\n\t\t\t\t\t\t\treturn SDPUtils.parseCandidate(cand);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.filter(function(cand) {\r\n\t\t\t\t\t\t\treturn cand.component === 1;\r\n\t\t\t\t\t\t});\r\n\t\r\n\t\t\t\t// Check if we can use BUNDLE and dispose transports.\r\n\t\t\t\tif ((description.type === 'offer' || description.type === 'answer') &&\r\n\t\t\t\t\t\t!rejected && usingBundle && sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex]) {\r\n\t\t\t\t\tpc._disposeIceAndDtlsTransports(sdpMLineIndex);\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].iceGatherer =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceGatherer;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].iceTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceTransport;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].dtlsTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport;\r\n\t\t\t\t\tif (pc.transceivers[sdpMLineIndex].rtpSender) {\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtpSender.setTransport(\r\n\t\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pc.transceivers[sdpMLineIndex].rtpReceiver) {\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\r\n\t\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (description.type === 'offer' && !rejected) {\r\n\t\t\t\t\ttransceiver = pc.transceivers[sdpMLineIndex] ||\r\n\t\t\t\t\t\t\tpc._createTransceiver(kind);\r\n\t\t\t\t\ttransceiver.mid = mid;\r\n\t\r\n\t\t\t\t\tif (!transceiver.iceGatherer) {\r\n\t\t\t\t\t\ttransceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n\t\t\t\t\t\t\t\tusingBundle);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif (cands.length && transceiver.iceTransport.state === 'new') {\r\n\t\t\t\t\t\tif (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.setRemoteCandidates(cands);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcands.forEach(function(candidate) {\r\n\t\t\t\t\t\t\t\tmaybeAddCandidate(transceiver.iceTransport, candidate);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tlocalCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\r\n\t\r\n\t\t\t\t\t// filter RTX until additional stuff needed for RTX is implemented\r\n\t\t\t\t\t// in adapter.js\r\n\t\t\t\t\tif (edgeVersion < 15019) {\r\n\t\t\t\t\t\tlocalCapabilities.codecs = localCapabilities.codecs.filter(\r\n\t\t\t\t\t\t\t\tfunction(codec) {\r\n\t\t\t\t\t\t\t\t\treturn codec.name !== 'rtx';\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tsendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n\t\t\t\t\t\tssrc: (2 * sdpMLineIndex + 2) * 1001\r\n\t\t\t\t\t}];\r\n\t\r\n\t\t\t\t\t// TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n\t\t\t\t\tvar isNewTrack = false;\r\n\t\t\t\t\tif (direction === 'sendrecv' || direction === 'sendonly') {\r\n\t\t\t\t\t\tisNewTrack = !transceiver.rtpReceiver;\r\n\t\t\t\t\t\trtpReceiver = transceiver.rtpReceiver ||\r\n\t\t\t\t\t\t\t\tnew window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\r\n\t\r\n\t\t\t\t\t\tif (isNewTrack) {\r\n\t\t\t\t\t\t\tvar stream;\r\n\t\t\t\t\t\t\ttrack = rtpReceiver.track;\r\n\t\t\t\t\t\t\t// FIXME: does not work with Plan B.\r\n\t\t\t\t\t\t\tif (remoteMsid && remoteMsid.stream === '-') {\r\n\t\t\t\t\t\t\t\t// no-op. a stream id of '-' means: no associated stream.\r\n\t\t\t\t\t\t\t} else if (remoteMsid) {\r\n\t\t\t\t\t\t\t\tif (!streams[remoteMsid.stream]) {\r\n\t\t\t\t\t\t\t\t\tstreams[remoteMsid.stream] = new window.MediaStream();\r\n\t\t\t\t\t\t\t\t\tObject.defineProperty(streams[remoteMsid.stream], 'id', {\r\n\t\t\t\t\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\t\t\t\t\treturn remoteMsid.stream;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tObject.defineProperty(track, 'id', {\r\n\t\t\t\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\t\t\t\treturn remoteMsid.track;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tstream = streams[remoteMsid.stream];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!streams.default) {\r\n\t\t\t\t\t\t\t\t\tstreams.default = new window.MediaStream();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstream = streams.default;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (stream) {\r\n\t\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, stream);\r\n\t\t\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams.push(stream);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, stream]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\r\n\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams.forEach(function(s) {\r\n\t\t\t\t\t\t\tvar nativeTrack = s.getTracks().find(function(t) {\r\n\t\t\t\t\t\t\t\treturn t.id === transceiver.rtpReceiver.track.id;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (nativeTrack) {\r\n\t\t\t\t\t\t\t\tremoveTrackFromStreamAndFireEvent(nativeTrack, s);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\ttransceiver.associatedRemoteMediaStreams = [];\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\ttransceiver.localCapabilities = localCapabilities;\r\n\t\t\t\t\ttransceiver.remoteCapabilities = remoteCapabilities;\r\n\t\t\t\t\ttransceiver.rtpReceiver = rtpReceiver;\r\n\t\t\t\t\ttransceiver.rtcpParameters = rtcpParameters;\r\n\t\t\t\t\ttransceiver.sendEncodingParameters = sendEncodingParameters;\r\n\t\t\t\t\ttransceiver.recvEncodingParameters = recvEncodingParameters;\r\n\t\r\n\t\t\t\t\t// Start the RTCRtpReceiver now. The RTPSender is started in\r\n\t\t\t\t\t// setLocalDescription.\r\n\t\t\t\t\tpc._transceive(pc.transceivers[sdpMLineIndex],\r\n\t\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t\tisNewTrack);\r\n\t\t\t\t} else if (description.type === 'answer' && !rejected) {\r\n\t\t\t\t\ttransceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\ticeGatherer = transceiver.iceGatherer;\r\n\t\t\t\t\ticeTransport = transceiver.iceTransport;\r\n\t\t\t\t\tdtlsTransport = transceiver.dtlsTransport;\r\n\t\t\t\t\trtpReceiver = transceiver.rtpReceiver;\r\n\t\t\t\t\tsendEncodingParameters = transceiver.sendEncodingParameters;\r\n\t\t\t\t\tlocalCapabilities = transceiver.localCapabilities;\r\n\t\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].recvEncodingParameters =\r\n\t\t\t\t\t\t\trecvEncodingParameters;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].remoteCapabilities =\r\n\t\t\t\t\t\t\tremoteCapabilities;\r\n\t\t\t\t\tpc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\r\n\t\r\n\t\t\t\t\tif (cands.length && iceTransport.state === 'new') {\r\n\t\t\t\t\t\tif ((isIceLite || isComplete) &&\r\n\t\t\t\t\t\t\t\t(!usingBundle || sdpMLineIndex === 0)) {\r\n\t\t\t\t\t\t\ticeTransport.setRemoteCandidates(cands);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcands.forEach(function(candidate) {\r\n\t\t\t\t\t\t\t\tmaybeAddCandidate(transceiver.iceTransport, candidate);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif (!usingBundle || sdpMLineIndex === 0) {\r\n\t\t\t\t\t\tif (iceTransport.state === 'new') {\r\n\t\t\t\t\t\t\ticeTransport.start(iceGatherer, remoteIceParameters,\r\n\t\t\t\t\t\t\t\t\t'controlling');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (dtlsTransport.state === 'new') {\r\n\t\t\t\t\t\t\tdtlsTransport.start(remoteDtlsParameters);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// If the offer contained RTX but the answer did not,\r\n\t\t\t\t\t// remove RTX from sendEncodingParameters.\r\n\t\t\t\t\tvar commonCapabilities = getCommonCapabilities(\r\n\t\t\t\t\t\ttransceiver.localCapabilities,\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\r\n\t\t\t\t\tvar hasRtx = commonCapabilities.codecs.filter(function(c) {\r\n\t\t\t\t\t\treturn c.name.toLowerCase() === 'rtx';\r\n\t\t\t\t\t}).length;\r\n\t\t\t\t\tif (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\tdelete transceiver.sendEncodingParameters[0].rtx;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tpc._transceive(transceiver,\r\n\t\t\t\t\t\t\tdirection === 'sendrecv' || direction === 'recvonly',\r\n\t\t\t\t\t\t\tdirection === 'sendrecv' || direction === 'sendonly');\r\n\t\r\n\t\t\t\t\t// TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n\t\t\t\t\tif (rtpReceiver &&\r\n\t\t\t\t\t\t\t(direction === 'sendrecv' || direction === 'sendonly')) {\r\n\t\t\t\t\t\ttrack = rtpReceiver.track;\r\n\t\t\t\t\t\tif (remoteMsid) {\r\n\t\t\t\t\t\t\tif (!streams[remoteMsid.stream]) {\r\n\t\t\t\t\t\t\t\tstreams[remoteMsid.stream] = new window.MediaStream();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (!streams.default) {\r\n\t\t\t\t\t\t\t\tstreams.default = new window.MediaStream();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\taddTrackToStreamAndFireEvent(track, streams.default);\r\n\t\t\t\t\t\t\treceiverList.push([track, rtpReceiver, streams.default]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// FIXME: actually the receiver should be created later.\r\n\t\t\t\t\t\tdelete transceiver.rtpReceiver;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (pc._dtlsRole === undefined) {\r\n\t\t\t\tpc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\r\n\t\t\t}\r\n\t\r\n\t\t\tpc._remoteDescription = {\r\n\t\t\t\ttype: description.type,\r\n\t\t\t\tsdp: description.sdp\r\n\t\t\t};\r\n\t\t\tif (description.type === 'offer') {\r\n\t\t\t\tpc._updateSignalingState('have-remote-offer');\r\n\t\t\t} else {\r\n\t\t\t\tpc._updateSignalingState('stable');\r\n\t\t\t}\r\n\t\t\tObject.keys(streams).forEach(function(sid) {\r\n\t\t\t\tvar stream = streams[sid];\r\n\t\t\t\tif (stream.getTracks().length) {\r\n\t\t\t\t\tif (pc.remoteStreams.indexOf(stream) === -1) {\r\n\t\t\t\t\t\tpc.remoteStreams.push(stream);\r\n\t\t\t\t\t\tvar event = new Event('addstream');\r\n\t\t\t\t\t\tevent.stream = stream;\r\n\t\t\t\t\t\twindow.setTimeout(function() {\r\n\t\t\t\t\t\t\tpc._dispatchEvent('addstream', event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\treceiverList.forEach(function(item) {\r\n\t\t\t\t\t\tvar track = item[0];\r\n\t\t\t\t\t\tvar receiver = item[1];\r\n\t\t\t\t\t\tif (stream.id !== item[2].id) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfireAddTrack(pc, track, receiver, [stream]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treceiverList.forEach(function(item) {\r\n\t\t\t\tif (item[2]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfireAddTrack(pc, item[0], item[1], []);\r\n\t\t\t});\r\n\t\r\n\t\t\t// check whether addIceCandidate({}) was called within four seconds after\r\n\t\t\t// setRemoteDescription.\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tif (!(pc && pc.transceivers)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpc.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t\tif (transceiver.iceTransport &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.state === 'new' &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.getRemoteCandidates().length > 0) {\r\n\t\t\t\t\t\tconsole.warn('Timeout for addRemoteCandidate. Consider sending ' +\r\n\t\t\t\t\t\t\t\t'an end-of-candidates notification');\r\n\t\t\t\t\t\ttransceiver.iceTransport.addRemoteCandidate({});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 4000);\r\n\t\r\n\t\t\treturn Promise.resolve();\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.close = function() {\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t/* not yet\r\n\t\t\t\tif (transceiver.iceGatherer) {\r\n\t\t\t\t\ttransceiver.iceGatherer.close();\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (transceiver.iceTransport) {\r\n\t\t\t\t\ttransceiver.iceTransport.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.dtlsTransport) {\r\n\t\t\t\t\ttransceiver.dtlsTransport.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rtpSender) {\r\n\t\t\t\t\ttransceiver.rtpSender.stop();\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rtpReceiver) {\r\n\t\t\t\t\ttransceiver.rtpReceiver.stop();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// FIXME: clean up tracks, local streams, remote streams, etc\r\n\t\t\tthis._isClosed = true;\r\n\t\t\tthis._updateSignalingState('closed');\r\n\t\t};\r\n\t\r\n\t\t// Update the signaling state.\r\n\t\tRTCPeerConnection.prototype._updateSignalingState = function(newState) {\r\n\t\t\tthis.signalingState = newState;\r\n\t\t\tvar event = new Event('signalingstatechange');\r\n\t\t\tthis._dispatchEvent('signalingstatechange', event);\r\n\t\t};\r\n\t\r\n\t\t// Determine whether to fire the negotiationneeded event.\r\n\t\tRTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\r\n\t\t\tvar pc = this;\r\n\t\t\tif (this.signalingState !== 'stable' || this.needNegotiation === true) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.needNegotiation = true;\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tif (pc.needNegotiation) {\r\n\t\t\t\t\tpc.needNegotiation = false;\r\n\t\t\t\t\tvar event = new Event('negotiationneeded');\r\n\t\t\t\t\tpc._dispatchEvent('negotiationneeded', event);\r\n\t\t\t\t}\r\n\t\t\t}, 0);\r\n\t\t};\r\n\t\r\n\t\t// Update the ice connection state.\r\n\t\tRTCPeerConnection.prototype._updateIceConnectionState = function() {\r\n\t\t\tvar newState;\r\n\t\t\tvar states = {\r\n\t\t\t\t'new': 0,\r\n\t\t\t\tclosed: 0,\r\n\t\t\t\tchecking: 0,\r\n\t\t\t\tconnected: 0,\r\n\t\t\t\tcompleted: 0,\r\n\t\t\t\tdisconnected: 0,\r\n\t\t\t\tfailed: 0\r\n\t\t\t};\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.iceTransport && !transceiver.rejected) {\r\n\t\t\t\t\tstates[transceiver.iceTransport.state]++;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tnewState = 'new';\r\n\t\t\tif (states.failed > 0) {\r\n\t\t\t\tnewState = 'failed';\r\n\t\t\t} else if (states.checking > 0) {\r\n\t\t\t\tnewState = 'checking';\r\n\t\t\t} else if (states.disconnected > 0) {\r\n\t\t\t\tnewState = 'disconnected';\r\n\t\t\t} else if (states.new > 0) {\r\n\t\t\t\tnewState = 'new';\r\n\t\t\t} else if (states.connected > 0) {\r\n\t\t\t\tnewState = 'connected';\r\n\t\t\t} else if (states.completed > 0) {\r\n\t\t\t\tnewState = 'completed';\r\n\t\t\t}\r\n\t\r\n\t\t\tif (newState !== this.iceConnectionState) {\r\n\t\t\t\tthis.iceConnectionState = newState;\r\n\t\t\t\tvar event = new Event('iceconnectionstatechange');\r\n\t\t\t\tthis._dispatchEvent('iceconnectionstatechange', event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Update the connection state.\r\n\t\tRTCPeerConnection.prototype._updateConnectionState = function() {\r\n\t\t\tvar newState;\r\n\t\t\tvar states = {\r\n\t\t\t\t'new': 0,\r\n\t\t\t\tclosed: 0,\r\n\t\t\t\tconnecting: 0,\r\n\t\t\t\tconnected: 0,\r\n\t\t\t\tcompleted: 0,\r\n\t\t\t\tdisconnected: 0,\r\n\t\t\t\tfailed: 0\r\n\t\t\t};\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.iceTransport && transceiver.dtlsTransport &&\r\n\t\t\t\t\t\t!transceiver.rejected) {\r\n\t\t\t\t\tstates[transceiver.iceTransport.state]++;\r\n\t\t\t\t\tstates[transceiver.dtlsTransport.state]++;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// ICETransport.completed and connected are the same for this purpose.\r\n\t\t\tstates.connected += states.completed;\r\n\t\r\n\t\t\tnewState = 'new';\r\n\t\t\tif (states.failed > 0) {\r\n\t\t\t\tnewState = 'failed';\r\n\t\t\t} else if (states.connecting > 0) {\r\n\t\t\t\tnewState = 'connecting';\r\n\t\t\t} else if (states.disconnected > 0) {\r\n\t\t\t\tnewState = 'disconnected';\r\n\t\t\t} else if (states.new > 0) {\r\n\t\t\t\tnewState = 'new';\r\n\t\t\t} else if (states.connected > 0) {\r\n\t\t\t\tnewState = 'connected';\r\n\t\t\t}\r\n\t\r\n\t\t\tif (newState !== this.connectionState) {\r\n\t\t\t\tthis.connectionState = newState;\r\n\t\t\t\tvar event = new Event('connectionstatechange');\r\n\t\t\t\tthis._dispatchEvent('connectionstatechange', event);\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.createOffer = function() {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tif (pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createOffer after close'));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar numAudioTracks = pc.transceivers.filter(function(t) {\r\n\t\t\t\treturn t.kind === 'audio';\r\n\t\t\t}).length;\r\n\t\t\tvar numVideoTracks = pc.transceivers.filter(function(t) {\r\n\t\t\t\treturn t.kind === 'video';\r\n\t\t\t}).length;\r\n\t\r\n\t\t\t// Determine number of audio and video tracks we need to send/recv.\r\n\t\t\tvar offerOptions = arguments[0];\r\n\t\t\tif (offerOptions) {\r\n\t\t\t\t// Reject Chrome legacy constraints.\r\n\t\t\t\tif (offerOptions.mandatory || offerOptions.optional) {\r\n\t\t\t\t\tthrow new TypeError(\r\n\t\t\t\t\t\t\t'Legacy mandatory/optional constraints not supported.');\r\n\t\t\t\t}\r\n\t\t\t\tif (offerOptions.offerToReceiveAudio !== undefined) {\r\n\t\t\t\t\tif (offerOptions.offerToReceiveAudio === true) {\r\n\t\t\t\t\t\tnumAudioTracks = 1;\r\n\t\t\t\t\t} else if (offerOptions.offerToReceiveAudio === false) {\r\n\t\t\t\t\t\tnumAudioTracks = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnumAudioTracks = offerOptions.offerToReceiveAudio;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (offerOptions.offerToReceiveVideo !== undefined) {\r\n\t\t\t\t\tif (offerOptions.offerToReceiveVideo === true) {\r\n\t\t\t\t\t\tnumVideoTracks = 1;\r\n\t\t\t\t\t} else if (offerOptions.offerToReceiveVideo === false) {\r\n\t\t\t\t\t\tnumVideoTracks = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnumVideoTracks = offerOptions.offerToReceiveVideo;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tpc.transceivers.forEach(function(transceiver) {\r\n\t\t\t\tif (transceiver.kind === 'audio') {\r\n\t\t\t\t\tnumAudioTracks--;\r\n\t\t\t\t\tif (numAudioTracks < 0) {\r\n\t\t\t\t\t\ttransceiver.wantReceive = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\tnumVideoTracks--;\r\n\t\t\t\t\tif (numVideoTracks < 0) {\r\n\t\t\t\t\t\ttransceiver.wantReceive = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\t// Create M-lines for recvonly streams.\r\n\t\t\twhile (numAudioTracks > 0 || numVideoTracks > 0) {\r\n\t\t\t\tif (numAudioTracks > 0) {\r\n\t\t\t\t\tpc._createTransceiver('audio');\r\n\t\t\t\t\tnumAudioTracks--;\r\n\t\t\t\t}\r\n\t\t\t\tif (numVideoTracks > 0) {\r\n\t\t\t\t\tpc._createTransceiver('video');\r\n\t\t\t\t\tnumVideoTracks--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n\t\t\t\t\tpc._sdpSessionVersion++);\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\t// For each track, create an ice gatherer, ice transport,\r\n\t\t\t\t// dtls transport, potentially rtpsender and rtpreceiver.\r\n\t\t\t\tvar track = transceiver.track;\r\n\t\t\t\tvar kind = transceiver.kind;\r\n\t\t\t\tvar mid = transceiver.mid || SDPUtils.generateIdentifier();\r\n\t\t\t\ttransceiver.mid = mid;\r\n\t\r\n\t\t\t\tif (!transceiver.iceGatherer) {\r\n\t\t\t\t\ttransceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n\t\t\t\t\t\t\tpc.usingBundle);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tvar localCapabilities = window.RTCRtpSender.getCapabilities(kind);\r\n\t\t\t\t// filter RTX until additional stuff needed for RTX is implemented\r\n\t\t\t\t// in adapter.js\r\n\t\t\t\tif (edgeVersion < 15019) {\r\n\t\t\t\t\tlocalCapabilities.codecs = localCapabilities.codecs.filter(\r\n\t\t\t\t\t\t\tfunction(codec) {\r\n\t\t\t\t\t\t\t\treturn codec.name !== 'rtx';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tlocalCapabilities.codecs.forEach(function(codec) {\r\n\t\t\t\t\t// work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\r\n\t\t\t\t\t// by adding level-asymmetry-allowed=1\r\n\t\t\t\t\tif (codec.name === 'H264' &&\r\n\t\t\t\t\t\t\tcodec.parameters['level-asymmetry-allowed'] === undefined) {\r\n\t\t\t\t\t\tcodec.parameters['level-asymmetry-allowed'] = '1';\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// for subsequent offers, we might have to re-use the payload\r\n\t\t\t\t\t// type of the last offer.\r\n\t\t\t\t\tif (transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.codecs) {\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\r\n\t\t\t\t\t\t\tif (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\t\t\t\tcodec.clockRate === remoteCodec.clockRate) {\r\n\t\t\t\t\t\t\t\tcodec.preferredPayloadType = remoteCodec.payloadType;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlocalCapabilities.headerExtensions.forEach(function(hdrExt) {\r\n\t\t\t\t\tvar remoteExtensions = transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.headerExtensions || [];\r\n\t\t\t\t\tremoteExtensions.forEach(function(rHdrExt) {\r\n\t\t\t\t\t\tif (hdrExt.uri === rHdrExt.uri) {\r\n\t\t\t\t\t\t\thdrExt.id = rHdrExt.id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\t// generate an ssrc now, to be used later in rtpSender.send\r\n\t\t\t\tvar sendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n\t\t\t\t\tssrc: (2 * sdpMLineIndex + 1) * 1001\r\n\t\t\t\t}];\r\n\t\t\t\tif (track) {\r\n\t\t\t\t\t// add RTX\r\n\t\t\t\t\tif (edgeVersion >= 15019 && kind === 'video' &&\r\n\t\t\t\t\t\t\t!sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\tsendEncodingParameters[0].rtx = {\r\n\t\t\t\t\t\t\tssrc: sendEncodingParameters[0].ssrc + 1\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (transceiver.wantReceive) {\r\n\t\t\t\t\ttransceiver.rtpReceiver = new window.RTCRtpReceiver(\r\n\t\t\t\t\t\t\ttransceiver.dtlsTransport, kind);\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\ttransceiver.localCapabilities = localCapabilities;\r\n\t\t\t\ttransceiver.sendEncodingParameters = sendEncodingParameters;\r\n\t\t\t});\r\n\t\r\n\t\t\t// always offer BUNDLE and dispose on return if not supported.\r\n\t\t\tif (pc._config.bundlePolicy !== 'max-compat') {\r\n\t\t\t\tsdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\r\n\t\t\t\t\treturn t.mid;\r\n\t\t\t\t}).join(' ') + '\\r\\n';\r\n\t\t\t}\r\n\t\t\tsdp += 'a=ice-options:trickle\\r\\n';\r\n\t\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\tsdp += writeMediaSection(transceiver, transceiver.localCapabilities,\r\n\t\t\t\t\t\t'offer', transceiver.stream, pc._dtlsRole);\r\n\t\t\t\tsdp += 'a=rtcp-rsize\\r\\n';\r\n\t\r\n\t\t\t\tif (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\r\n\t\t\t\t\t\t(sdpMLineIndex === 0 || !pc.usingBundle)) {\r\n\t\t\t\t\ttransceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\r\n\t\t\t\t\t\tcand.component = 1;\r\n\t\t\t\t\t\tsdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\tif (transceiver.iceGatherer.state === 'completed') {\r\n\t\t\t\t\t\tsdp += 'a=end-of-candidates\\r\\n';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tvar desc = new window.RTCSessionDescription({\r\n\t\t\t\ttype: 'offer',\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t\treturn Promise.resolve(desc);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.createAnswer = function() {\r\n\t\t\tvar pc = this;\r\n\t\r\n\t\t\tif (pc._isClosed) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createAnswer after close'));\r\n\t\t\t}\r\n\t\r\n\t\t\tif (!(pc.signalingState === 'have-remote-offer' ||\r\n\t\t\t\t\tpc.signalingState === 'have-local-pranswer')) {\r\n\t\t\t\treturn Promise.reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t'Can not call createAnswer in signalingState ' + pc.signalingState));\r\n\t\t\t}\r\n\t\r\n\t\t\tvar sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n\t\t\t\t\tpc._sdpSessionVersion++);\r\n\t\t\tif (pc.usingBundle) {\r\n\t\t\t\tsdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\r\n\t\t\t\t\treturn t.mid;\r\n\t\t\t\t}).join(' ') + '\\r\\n';\r\n\t\t\t}\r\n\t\t\tsdp += 'a=ice-options:trickle\\r\\n';\r\n\t\r\n\t\t\tvar mediaSectionsInOffer = SDPUtils.getMediaSections(\r\n\t\t\t\t\tpc._remoteDescription.sdp).length;\r\n\t\t\tpc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n\t\t\t\tif (sdpMLineIndex + 1 > mediaSectionsInOffer) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (transceiver.rejected) {\r\n\t\t\t\t\tif (transceiver.kind === 'application') {\r\n\t\t\t\t\t\tif (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\r\n\t\t\t\t\t\t\tsdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsdp += 'm=application 0 ' + transceiver.protocol +\r\n\t\t\t\t\t\t\t\t\t' webrtc-datachannel\\r\\n';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (transceiver.kind === 'audio') {\r\n\t\t\t\t\t\tsdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:0 PCMU/8000\\r\\n';\r\n\t\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\t\tsdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:120 VP8/90000\\r\\n';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsdp += 'c=IN IP4 0.0.0.0\\r\\n' +\r\n\t\t\t\t\t\t\t'a=inactive\\r\\n' +\r\n\t\t\t\t\t\t\t'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// FIXME: look at direction.\r\n\t\t\t\tif (transceiver.stream) {\r\n\t\t\t\t\tvar localTrack;\r\n\t\t\t\t\tif (transceiver.kind === 'audio') {\r\n\t\t\t\t\t\tlocalTrack = transceiver.stream.getAudioTracks()[0];\r\n\t\t\t\t\t} else if (transceiver.kind === 'video') {\r\n\t\t\t\t\t\tlocalTrack = transceiver.stream.getVideoTracks()[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (localTrack) {\r\n\t\t\t\t\t\t// add RTX\r\n\t\t\t\t\t\tif (edgeVersion >= 15019 && transceiver.kind === 'video' &&\r\n\t\t\t\t\t\t\t\t!transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx = {\r\n\t\t\t\t\t\t\t\tssrc: transceiver.sendEncodingParameters[0].ssrc + 1\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t// Calculate intersection of capabilities.\r\n\t\t\t\tvar commonCapabilities = getCommonCapabilities(\r\n\t\t\t\t\t\ttransceiver.localCapabilities,\r\n\t\t\t\t\t\ttransceiver.remoteCapabilities);\r\n\t\r\n\t\t\t\tvar hasRtx = commonCapabilities.codecs.filter(function(c) {\r\n\t\t\t\t\treturn c.name.toLowerCase() === 'rtx';\r\n\t\t\t\t}).length;\r\n\t\t\t\tif (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\t\tdelete transceiver.sendEncodingParameters[0].rtx;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tsdp += writeMediaSection(transceiver, commonCapabilities,\r\n\t\t\t\t\t\t'answer', transceiver.stream, pc._dtlsRole);\r\n\t\t\t\tif (transceiver.rtcpParameters &&\r\n\t\t\t\t\t\ttransceiver.rtcpParameters.reducedSize) {\r\n\t\t\t\t\tsdp += 'a=rtcp-rsize\\r\\n';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tvar desc = new window.RTCSessionDescription({\r\n\t\t\t\ttype: 'answer',\r\n\t\t\t\tsdp: sdp\r\n\t\t\t});\r\n\t\t\treturn Promise.resolve(desc);\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.addIceCandidate = function(candidate) {\r\n\t\t\tvar pc = this;\r\n\t\t\tvar sections;\r\n\t\t\tif (candidate && !(candidate.sdpMLineIndex !== undefined ||\r\n\t\t\t\t\tcandidate.sdpMid)) {\r\n\t\t\t\treturn Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\r\n\t\t\t}\r\n\t\r\n\t\t\t// TODO: needs to go into ops queue.\r\n\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\tif (!pc._remoteDescription) {\r\n\t\t\t\t\treturn reject(makeError('InvalidStateError',\r\n\t\t\t\t\t\t\t'Can not add ICE candidate without a remote description'));\r\n\t\t\t\t} else if (!candidate || candidate.candidate === '') {\r\n\t\t\t\t\tfor (var j = 0; j < pc.transceivers.length; j++) {\r\n\t\t\t\t\t\tif (pc.transceivers[j].rejected) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpc.transceivers[j].iceTransport.addRemoteCandidate({});\r\n\t\t\t\t\t\tsections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n\t\t\t\t\t\tsections[j] += 'a=end-of-candidates\\r\\n';\r\n\t\t\t\t\t\tpc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n\t\t\t\t\t\tif (pc.usingBundle) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar sdpMLineIndex = candidate.sdpMLineIndex;\r\n\t\t\t\t\tif (candidate.sdpMid) {\r\n\t\t\t\t\t\tfor (var i = 0; i < pc.transceivers.length; i++) {\r\n\t\t\t\t\t\t\tif (pc.transceivers[i].mid === candidate.sdpMid) {\r\n\t\t\t\t\t\t\t\tsdpMLineIndex = i;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar transceiver = pc.transceivers[sdpMLineIndex];\r\n\t\t\t\t\tif (transceiver) {\r\n\t\t\t\t\t\tif (transceiver.rejected) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar cand = Object.keys(candidate.candidate).length > 0 ?\r\n\t\t\t\t\t\t\t\tSDPUtils.parseCandidate(candidate.candidate) : {};\r\n\t\t\t\t\t\t// Ignore Chrome's invalid candidates since Edge does not like them.\r\n\t\t\t\t\t\tif (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Ignore RTCP candidates, we assume RTCP-MUX.\r\n\t\t\t\t\t\tif (cand.component && cand.component !== 1) {\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// when using bundle, avoid adding candidates to the wrong\r\n\t\t\t\t\t\t// ice transport. And avoid adding candidates added in the SDP.\r\n\t\t\t\t\t\tif (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\t\t\ttransceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\r\n\t\t\t\t\t\t\tif (!maybeAddCandidate(transceiver.iceTransport, cand)) {\r\n\t\t\t\t\t\t\t\treturn reject(makeError('OperationError',\r\n\t\t\t\t\t\t\t\t\t\t'Can not add ICE candidate'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t// update the remoteDescription.\r\n\t\t\t\t\t\tvar candidateString = candidate.candidate.trim();\r\n\t\t\t\t\t\tif (candidateString.indexOf('a=') === 0) {\r\n\t\t\t\t\t\t\tcandidateString = candidateString.substr(2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n\t\t\t\t\t\tsections[sdpMLineIndex] += 'a=' +\r\n\t\t\t\t\t\t\t\t(cand.type ? candidateString : 'end-of-candidates')\r\n\t\t\t\t\t\t\t\t+ '\\r\\n';\r\n\t\t\t\t\t\tpc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn reject(makeError('OperationError',\r\n\t\t\t\t\t\t\t\t'Can not add ICE candidate'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\tRTCPeerConnection.prototype.getStats = function(selector) {\r\n\t\t\tif (selector && selector instanceof window.MediaStreamTrack) {\r\n\t\t\t\tvar senderOrReceiver = null;\r\n\t\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t\tif (transceiver.rtpSender &&\r\n\t\t\t\t\t\t\ttransceiver.rtpSender.track === selector) {\r\n\t\t\t\t\t\tsenderOrReceiver = transceiver.rtpSender;\r\n\t\t\t\t\t} else if (transceiver.rtpReceiver &&\r\n\t\t\t\t\t\t\ttransceiver.rtpReceiver.track === selector) {\r\n\t\t\t\t\t\tsenderOrReceiver = transceiver.rtpReceiver;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (!senderOrReceiver) {\r\n\t\t\t\t\tthrow makeError('InvalidAccessError', 'Invalid selector.');\r\n\t\t\t\t}\r\n\t\t\t\treturn senderOrReceiver.getStats();\r\n\t\t\t}\r\n\t\r\n\t\t\tvar promises = [];\r\n\t\t\tthis.transceivers.forEach(function(transceiver) {\r\n\t\t\t\t['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\r\n\t\t\t\t\t\t'dtlsTransport'].forEach(function(method) {\r\n\t\t\t\t\t\t\tif (transceiver[method]) {\r\n\t\t\t\t\t\t\t\tpromises.push(transceiver[method].getStats());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn Promise.all(promises).then(function(allStats) {\r\n\t\t\t\tvar results = new Map();\r\n\t\t\t\tallStats.forEach(function(stats) {\r\n\t\t\t\t\tstats.forEach(function(stat) {\r\n\t\t\t\t\t\tresults.set(stat.id, stat);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn results;\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t\t// fix low-level stat names and return Map instead of object.\r\n\t\tvar ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\r\n\t\t\t'RTCIceTransport', 'RTCDtlsTransport'];\r\n\t\tortcObjects.forEach(function(ortcObjectName) {\r\n\t\t\tvar obj = window[ortcObjectName];\r\n\t\t\tif (obj && obj.prototype && obj.prototype.getStats) {\r\n\t\t\t\tvar nativeGetstats = obj.prototype.getStats;\r\n\t\t\t\tobj.prototype.getStats = function() {\r\n\t\t\t\t\treturn nativeGetstats.apply(this)\r\n\t\t\t\t\t.then(function(nativeStats) {\r\n\t\t\t\t\t\tvar mapStats = new Map();\r\n\t\t\t\t\t\tObject.keys(nativeStats).forEach(function(id) {\r\n\t\t\t\t\t\t\tnativeStats[id].type = fixStatsType(nativeStats[id]);\r\n\t\t\t\t\t\t\tmapStats.set(id, nativeStats[id]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn mapStats;\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\t// legacy callback shims. Should be moved to adapter.js some days.\r\n\t\tvar methods = ['createOffer', 'createAnswer'];\r\n\t\tmethods.forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[0] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[1] === 'function') { // legacy\r\n\t\t\t\t\treturn nativeMethod.apply(this, [arguments[2]])\r\n\t\t\t\t\t.then(function(description) {\r\n\t\t\t\t\t\tif (typeof args[0] === 'function') {\r\n\t\t\t\t\t\t\targs[0].apply(null, [description]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null, [error]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\tmethods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\r\n\t\tmethods.forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[1] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[2] === 'function') { // legacy\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments)\r\n\t\t\t\t\t.then(function() {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\tif (typeof args[2] === 'function') {\r\n\t\t\t\t\t\t\targs[2].apply(null, [error]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\t// getStats is special. It doesn't have a spec legacy method yet we support\r\n\t\t// getStats(something, cb) without error callbacks.\r\n\t\t['getStats'].forEach(function(method) {\r\n\t\t\tvar nativeMethod = RTCPeerConnection.prototype[method];\r\n\t\t\tRTCPeerConnection.prototype[method] = function() {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\treturn nativeMethod.apply(this, arguments)\r\n\t\t\t\t\t.then(function() {\r\n\t\t\t\t\t\tif (typeof args[1] === 'function') {\r\n\t\t\t\t\t\t\targs[1].apply(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn nativeMethod.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\r\n\t\treturn RTCPeerConnection;\r\n\t};\r\n\t\r\n\t},{\"sdp\":17}],17:[function(require,module,exports){\r\n\t /* eslint-env node */\r\n\t'use strict';\r\n\t\r\n\t// SDP helpers.\r\n\tvar SDPUtils = {};\r\n\t\r\n\t// Generate an alphanumeric identifier for cname or mids.\r\n\t// TODO: use UUIDs instead? https://gist.github.com/jed/982883\r\n\tSDPUtils.generateIdentifier = function() {\r\n\t\treturn Math.random().toString(36).substr(2, 10);\r\n\t};\r\n\t\r\n\t// The RTCP CNAME used by all peerconnections from the same JS.\r\n\tSDPUtils.localCName = SDPUtils.generateIdentifier();\r\n\t\r\n\t// Splits SDP into lines, dealing with both CRLF and LF.\r\n\tSDPUtils.splitLines = function(blob) {\r\n\t\treturn blob.trim().split('\\n').map(function(line) {\r\n\t\t\treturn line.trim();\r\n\t\t});\r\n\t};\r\n\t// Splits SDP into sessionpart and mediasections. Ensures CRLF.\r\n\tSDPUtils.splitSections = function(blob) {\r\n\t\tvar parts = blob.split('\\nm=');\r\n\t\treturn parts.map(function(part, index) {\r\n\t\t\treturn (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\r\n\t\t});\r\n\t};\r\n\t\r\n\t// returns the session description.\r\n\tSDPUtils.getDescription = function(blob) {\r\n\t\tvar sections = SDPUtils.splitSections(blob);\r\n\t\treturn sections && sections[0];\r\n\t};\r\n\t\r\n\t// returns the individual media sections.\r\n\tSDPUtils.getMediaSections = function(blob) {\r\n\t\tvar sections = SDPUtils.splitSections(blob);\r\n\t\tsections.shift();\r\n\t\treturn sections;\r\n\t};\r\n\t\r\n\t// Returns lines that start with a certain prefix.\r\n\tSDPUtils.matchPrefix = function(blob, prefix) {\r\n\t\treturn SDPUtils.splitLines(blob).filter(function(line) {\r\n\t\t\treturn line.indexOf(prefix) === 0;\r\n\t\t});\r\n\t};\r\n\t\r\n\t// Parses an ICE candidate line. Sample input:\r\n\t// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\r\n\t// rport 55996\"\r\n\tSDPUtils.parseCandidate = function(line) {\r\n\t\tvar parts;\r\n\t\t// Parse both variants.\r\n\t\tif (line.indexOf('a=candidate:') === 0) {\r\n\t\t\tparts = line.substring(12).split(' ');\r\n\t\t} else {\r\n\t\t\tparts = line.substring(10).split(' ');\r\n\t\t}\r\n\t\r\n\t\tvar candidate = {\r\n\t\t\tfoundation: parts[0],\r\n\t\t\tcomponent: parseInt(parts[1], 10),\r\n\t\t\tprotocol: parts[2].toLowerCase(),\r\n\t\t\tpriority: parseInt(parts[3], 10),\r\n\t\t\tip: parts[4],\r\n\t\t\taddress: parts[4], // address is an alias for ip.\r\n\t\t\tport: parseInt(parts[5], 10),\r\n\t\t\t// skip parts[6] == 'typ'\r\n\t\t\ttype: parts[7]\r\n\t\t};\r\n\t\r\n\t\tfor (var i = 8; i < parts.length; i += 2) {\r\n\t\t\tswitch (parts[i]) {\r\n\t\t\t\tcase 'raddr':\r\n\t\t\t\t\tcandidate.relatedAddress = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rport':\r\n\t\t\t\t\tcandidate.relatedPort = parseInt(parts[i + 1], 10);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'tcptype':\r\n\t\t\t\t\tcandidate.tcpType = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ufrag':\r\n\t\t\t\t\tcandidate.ufrag = parts[i + 1]; // for backward compability.\r\n\t\t\t\t\tcandidate.usernameFragment = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: // extension handling, in particular ufrag\r\n\t\t\t\t\tcandidate[parts[i]] = parts[i + 1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn candidate;\r\n\t};\r\n\t\r\n\t// Translates a candidate object into SDP candidate attribute.\r\n\tSDPUtils.writeCandidate = function(candidate) {\r\n\t\tvar sdp = [];\r\n\t\tsdp.push(candidate.foundation);\r\n\t\tsdp.push(candidate.component);\r\n\t\tsdp.push(candidate.protocol.toUpperCase());\r\n\t\tsdp.push(candidate.priority);\r\n\t\tsdp.push(candidate.address || candidate.ip);\r\n\t\tsdp.push(candidate.port);\r\n\t\r\n\t\tvar type = candidate.type;\r\n\t\tsdp.push('typ');\r\n\t\tsdp.push(type);\r\n\t\tif (type !== 'host' && candidate.relatedAddress &&\r\n\t\t\t\tcandidate.relatedPort) {\r\n\t\t\tsdp.push('raddr');\r\n\t\t\tsdp.push(candidate.relatedAddress);\r\n\t\t\tsdp.push('rport');\r\n\t\t\tsdp.push(candidate.relatedPort);\r\n\t\t}\r\n\t\tif (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\r\n\t\t\tsdp.push('tcptype');\r\n\t\t\tsdp.push(candidate.tcpType);\r\n\t\t}\r\n\t\tif (candidate.usernameFragment || candidate.ufrag) {\r\n\t\t\tsdp.push('ufrag');\r\n\t\t\tsdp.push(candidate.usernameFragment || candidate.ufrag);\r\n\t\t}\r\n\t\treturn 'candidate:' + sdp.join(' ');\r\n\t};\r\n\t\r\n\t// Parses an ice-options line, returns an array of option tags.\r\n\t// a=ice-options:foo bar\r\n\tSDPUtils.parseIceOptions = function(line) {\r\n\t\treturn line.substr(14).split(' ');\r\n\t};\r\n\t\r\n\t// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\r\n\t// a=rtpmap:111 opus/48000/2\r\n\tSDPUtils.parseRtpMap = function(line) {\r\n\t\tvar parts = line.substr(9).split(' ');\r\n\t\tvar parsed = {\r\n\t\t\tpayloadType: parseInt(parts.shift(), 10) // was: id\r\n\t\t};\r\n\t\r\n\t\tparts = parts[0].split('/');\r\n\t\r\n\t\tparsed.name = parts[0];\r\n\t\tparsed.clockRate = parseInt(parts[1], 10); // was: clockrate\r\n\t\tparsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\r\n\t\t// legacy alias, got renamed back to channels in ORTC.\r\n\t\tparsed.numChannels = parsed.channels;\r\n\t\treturn parsed;\r\n\t};\r\n\t\r\n\t// Generate an a=rtpmap line from RTCRtpCodecCapability or\r\n\t// RTCRtpCodecParameters.\r\n\tSDPUtils.writeRtpMap = function(codec) {\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tvar channels = codec.channels || codec.numChannels || 1;\r\n\t\treturn 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\r\n\t\t\t\t(channels !== 1 ? '/' + channels : '') + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\r\n\t// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\n\t// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\r\n\tSDPUtils.parseExtmap = function(line) {\r\n\t\tvar parts = line.substr(9).split(' ');\r\n\t\treturn {\r\n\t\t\tid: parseInt(parts[0], 10),\r\n\t\t\tdirection: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\r\n\t\t\turi: parts[1]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\r\n\t// RTCRtpHeaderExtension.\r\n\tSDPUtils.writeExtmap = function(headerExtension) {\r\n\t\treturn 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\r\n\t\t\t\t(headerExtension.direction && headerExtension.direction !== 'sendrecv'\r\n\t\t\t\t\t\t? '/' + headerExtension.direction\r\n\t\t\t\t\t\t: '') +\r\n\t\t\t\t' ' + headerExtension.uri + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses an ftmp line, returns dictionary. Sample input:\r\n\t// a=fmtp:96 vbr=on;cng=on\r\n\t// Also deals with vbr=on; cng=on\r\n\tSDPUtils.parseFmtp = function(line) {\r\n\t\tvar parsed = {};\r\n\t\tvar kv;\r\n\t\tvar parts = line.substr(line.indexOf(' ') + 1).split(';');\r\n\t\tfor (var j = 0; j < parts.length; j++) {\r\n\t\t\tkv = parts[j].trim().split('=');\r\n\t\t\tparsed[kv[0].trim()] = kv[1];\r\n\t\t}\r\n\t\treturn parsed;\r\n\t};\r\n\t\r\n\t// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n\tSDPUtils.writeFmtp = function(codec) {\r\n\t\tvar line = '';\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tif (codec.parameters && Object.keys(codec.parameters).length) {\r\n\t\t\tvar params = [];\r\n\t\t\tObject.keys(codec.parameters).forEach(function(param) {\r\n\t\t\t\tif (codec.parameters[param]) {\r\n\t\t\t\t\tparams.push(param + '=' + codec.parameters[param]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.push(param);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tline += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\r\n\t\t}\r\n\t\treturn line;\r\n\t};\r\n\t\r\n\t// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\r\n\t// a=rtcp-fb:98 nack rpsi\r\n\tSDPUtils.parseRtcpFb = function(line) {\r\n\t\tvar parts = line.substr(line.indexOf(' ') + 1).split(' ');\r\n\t\treturn {\r\n\t\t\ttype: parts.shift(),\r\n\t\t\tparameter: parts.join(' ')\r\n\t\t};\r\n\t};\r\n\t// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n\tSDPUtils.writeRtcpFb = function(codec) {\r\n\t\tvar lines = '';\r\n\t\tvar pt = codec.payloadType;\r\n\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\tpt = codec.preferredPayloadType;\r\n\t\t}\r\n\t\tif (codec.rtcpFeedback && codec.rtcpFeedback.length) {\r\n\t\t\t// FIXME: special handling for trr-int?\r\n\t\t\tcodec.rtcpFeedback.forEach(function(fb) {\r\n\t\t\t\tlines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\r\n\t\t\t\t(fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn lines;\r\n\t};\r\n\t\r\n\t// Parses an RFC 5576 ssrc media attribute. Sample input:\r\n\t// a=ssrc:3735928559 cname:something\r\n\tSDPUtils.parseSsrcMedia = function(line) {\r\n\t\tvar sp = line.indexOf(' ');\r\n\t\tvar parts = {\r\n\t\t\tssrc: parseInt(line.substr(7, sp - 7), 10)\r\n\t\t};\r\n\t\tvar colon = line.indexOf(':', sp);\r\n\t\tif (colon > -1) {\r\n\t\t\tparts.attribute = line.substr(sp + 1, colon - sp - 1);\r\n\t\t\tparts.value = line.substr(colon + 1);\r\n\t\t} else {\r\n\t\t\tparts.attribute = line.substr(sp + 1);\r\n\t\t}\r\n\t\treturn parts;\r\n\t};\r\n\t\r\n\tSDPUtils.parseSsrcGroup = function(line) {\r\n\t\tvar parts = line.substr(13).split(' ');\r\n\t\treturn {\r\n\t\t\tsemantics: parts.shift(),\r\n\t\t\tssrcs: parts.map(function(ssrc) {\r\n\t\t\t\treturn parseInt(ssrc, 10);\r\n\t\t\t})\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Extracts the MID (RFC 5888) from a media section.\r\n\t// returns the MID or undefined if no mid line was found.\r\n\tSDPUtils.getMid = function(mediaSection) {\r\n\t\tvar mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\r\n\t\tif (mid) {\r\n\t\t\treturn mid.substr(6);\r\n\t\t}\r\n\t};\r\n\t\r\n\tSDPUtils.parseFingerprint = function(line) {\r\n\t\tvar parts = line.substr(14).split(' ');\r\n\t\treturn {\r\n\t\t\talgorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\r\n\t\t\tvalue: parts[1]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Extracts DTLS parameters from SDP media section or sessionpart.\r\n\t// FIXME: for consistency with other functions this should only\r\n\t//   get the fingerprint line as input. See also getIceParameters.\r\n\tSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\r\n\t\tvar lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\r\n\t\t\t\t'a=fingerprint:');\r\n\t\t// Note: a=setup line is ignored since we use the 'auto' role.\r\n\t\t// Note2: 'algorithm' is not case sensitive except in Edge.\r\n\t\treturn {\r\n\t\t\trole: 'auto',\r\n\t\t\tfingerprints: lines.map(SDPUtils.parseFingerprint)\r\n\t\t};\r\n\t};\r\n\t\r\n\t// Serializes DTLS parameters to SDP.\r\n\tSDPUtils.writeDtlsParameters = function(params, setupType) {\r\n\t\tvar sdp = 'a=setup:' + setupType + '\\r\\n';\r\n\t\tparams.fingerprints.forEach(function(fp) {\r\n\t\t\tsdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\r\n\t\t});\r\n\t\treturn sdp;\r\n\t};\r\n\t// Parses ICE information from SDP media section or sessionpart.\r\n\t// FIXME: for consistency with other functions this should only\r\n\t//   get the ice-ufrag and ice-pwd lines as input.\r\n\tSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\t// Search in session part, too.\r\n\t\tlines = lines.concat(SDPUtils.splitLines(sessionpart));\r\n\t\tvar iceParameters = {\r\n\t\t\tusernameFragment: lines.filter(function(line) {\r\n\t\t\t\treturn line.indexOf('a=ice-ufrag:') === 0;\r\n\t\t\t})[0].substr(12),\r\n\t\t\tpassword: lines.filter(function(line) {\r\n\t\t\t\treturn line.indexOf('a=ice-pwd:') === 0;\r\n\t\t\t})[0].substr(10)\r\n\t\t};\r\n\t\treturn iceParameters;\r\n\t};\r\n\t\r\n\t// Serializes ICE parameters to SDP.\r\n\tSDPUtils.writeIceParameters = function(params) {\r\n\t\treturn 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\r\n\t\t\t\t'a=ice-pwd:' + params.password + '\\r\\n';\r\n\t};\r\n\t\r\n\t// Parses the SDP media section and returns RTCRtpParameters.\r\n\tSDPUtils.parseRtpParameters = function(mediaSection) {\r\n\t\tvar description = {\r\n\t\t\tcodecs: [],\r\n\t\t\theaderExtensions: [],\r\n\t\t\tfecMechanisms: [],\r\n\t\t\trtcp: []\r\n\t\t};\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar mline = lines[0].split(' ');\r\n\t\tfor (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\r\n\t\t\tvar pt = mline[i];\r\n\t\t\tvar rtpmapline = SDPUtils.matchPrefix(\r\n\t\t\t\t\tmediaSection, 'a=rtpmap:' + pt + ' ')[0];\r\n\t\t\tif (rtpmapline) {\r\n\t\t\t\tvar codec = SDPUtils.parseRtpMap(rtpmapline);\r\n\t\t\t\tvar fmtps = SDPUtils.matchPrefix(\r\n\t\t\t\t\t\tmediaSection, 'a=fmtp:' + pt + ' ');\r\n\t\t\t\t// Only the first a=fmtp:<pt> is considered.\r\n\t\t\t\tcodec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\r\n\t\t\t\tcodec.rtcpFeedback = SDPUtils.matchPrefix(\r\n\t\t\t\t\t\tmediaSection, 'a=rtcp-fb:' + pt + ' ')\r\n\t\t\t\t\t.map(SDPUtils.parseRtcpFb);\r\n\t\t\t\tdescription.codecs.push(codec);\r\n\t\t\t\t// parse FEC mechanisms from rtpmap lines.\r\n\t\t\t\tswitch (codec.name.toUpperCase()) {\r\n\t\t\t\t\tcase 'RED':\r\n\t\t\t\t\tcase 'ULPFEC':\r\n\t\t\t\t\t\tdescription.fecMechanisms.push(codec.name.toUpperCase());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault: // only RED and ULPFEC are recognized as FEC mechanisms.\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tSDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\r\n\t\t\tdescription.headerExtensions.push(SDPUtils.parseExtmap(line));\r\n\t\t});\r\n\t\t// FIXME: parse rtcp.\r\n\t\treturn description;\r\n\t};\r\n\t\r\n\t// Generates parts of the SDP media section describing the capabilities /\r\n\t// parameters.\r\n\tSDPUtils.writeRtpDescription = function(kind, caps) {\r\n\t\tvar sdp = '';\r\n\t\r\n\t\t// Build the mline.\r\n\t\tsdp += 'm=' + kind + ' ';\r\n\t\tsdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\r\n\t\tsdp += ' UDP/TLS/RTP/SAVPF ';\r\n\t\tsdp += caps.codecs.map(function(codec) {\r\n\t\t\tif (codec.preferredPayloadType !== undefined) {\r\n\t\t\t\treturn codec.preferredPayloadType;\r\n\t\t\t}\r\n\t\t\treturn codec.payloadType;\r\n\t\t}).join(' ') + '\\r\\n';\r\n\t\r\n\t\tsdp += 'c=IN IP4 0.0.0.0\\r\\n';\r\n\t\tsdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\r\n\t\r\n\t\t// Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\r\n\t\tcaps.codecs.forEach(function(codec) {\r\n\t\t\tsdp += SDPUtils.writeRtpMap(codec);\r\n\t\t\tsdp += SDPUtils.writeFmtp(codec);\r\n\t\t\tsdp += SDPUtils.writeRtcpFb(codec);\r\n\t\t});\r\n\t\tvar maxptime = 0;\r\n\t\tcaps.codecs.forEach(function(codec) {\r\n\t\t\tif (codec.maxptime > maxptime) {\r\n\t\t\t\tmaxptime = codec.maxptime;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (maxptime > 0) {\r\n\t\t\tsdp += 'a=maxptime:' + maxptime + '\\r\\n';\r\n\t\t}\r\n\t\tsdp += 'a=rtcp-mux\\r\\n';\r\n\t\r\n\t\tif (caps.headerExtensions) {\r\n\t\t\tcaps.headerExtensions.forEach(function(extension) {\r\n\t\t\t\tsdp += SDPUtils.writeExtmap(extension);\r\n\t\t\t});\r\n\t\t}\r\n\t\t// FIXME: write fecMechanisms.\r\n\t\treturn sdp;\r\n\t};\r\n\t\r\n\t// Parses the SDP media section and returns an array of\r\n\t// RTCRtpEncodingParameters.\r\n\tSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\r\n\t\tvar encodingParameters = [];\r\n\t\tvar description = SDPUtils.parseRtpParameters(mediaSection);\r\n\t\tvar hasRed = description.fecMechanisms.indexOf('RED') !== -1;\r\n\t\tvar hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\r\n\t\r\n\t\t// filter a=ssrc:... cname:, ignore PlanB-msid\r\n\t\tvar ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t.map(function(line) {\r\n\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t})\r\n\t\t.filter(function(parts) {\r\n\t\t\treturn parts.attribute === 'cname';\r\n\t\t});\r\n\t\tvar primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\r\n\t\tvar secondarySsrc;\r\n\t\r\n\t\tvar flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\r\n\t\t.map(function(line) {\r\n\t\t\tvar parts = line.substr(17).split(' ');\r\n\t\t\treturn parts.map(function(part) {\r\n\t\t\t\treturn parseInt(part, 10);\r\n\t\t\t});\r\n\t\t});\r\n\t\tif (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\r\n\t\t\tsecondarySsrc = flows[0][1];\r\n\t\t}\r\n\t\r\n\t\tdescription.codecs.forEach(function(codec) {\r\n\t\t\tif (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\r\n\t\t\t\tvar encParam = {\r\n\t\t\t\t\tssrc: primarySsrc,\r\n\t\t\t\t\tcodecPayloadType: parseInt(codec.parameters.apt, 10)\r\n\t\t\t\t};\r\n\t\t\t\tif (primarySsrc && secondarySsrc) {\r\n\t\t\t\t\tencParam.rtx = {ssrc: secondarySsrc};\r\n\t\t\t\t}\r\n\t\t\t\tencodingParameters.push(encParam);\r\n\t\t\t\tif (hasRed) {\r\n\t\t\t\t\tencParam = JSON.parse(JSON.stringify(encParam));\r\n\t\t\t\t\tencParam.fec = {\r\n\t\t\t\t\t\tssrc: primarySsrc,\r\n\t\t\t\t\t\tmechanism: hasUlpfec ? 'red+ulpfec' : 'red'\r\n\t\t\t\t\t};\r\n\t\t\t\t\tencodingParameters.push(encParam);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (encodingParameters.length === 0 && primarySsrc) {\r\n\t\t\tencodingParameters.push({\r\n\t\t\t\tssrc: primarySsrc\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t// we support both b=AS and b=TIAS but interpret AS as TIAS.\r\n\t\tvar bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\r\n\t\tif (bandwidth.length) {\r\n\t\t\tif (bandwidth[0].indexOf('b=TIAS:') === 0) {\r\n\t\t\t\tbandwidth = parseInt(bandwidth[0].substr(7), 10);\r\n\t\t\t} else if (bandwidth[0].indexOf('b=AS:') === 0) {\r\n\t\t\t\t// use formula from JSEP to convert b=AS to TIAS value.\r\n\t\t\t\tbandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\r\n\t\t\t\t\t\t- (50 * 40 * 8);\r\n\t\t\t} else {\r\n\t\t\t\tbandwidth = undefined;\r\n\t\t\t}\r\n\t\t\tencodingParameters.forEach(function(params) {\r\n\t\t\t\tparams.maxBitrate = bandwidth;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn encodingParameters;\r\n\t};\r\n\t\r\n\t// parses http://draft.ortc.org/#rtcrtcpparameters*\r\n\tSDPUtils.parseRtcpParameters = function(mediaSection) {\r\n\t\tvar rtcpParameters = {};\r\n\t\r\n\t\t// Gets the first SSRC. Note tha with RTX there might be multiple\r\n\t\t// SSRCs.\r\n\t\tvar remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t\t\t.map(function(line) {\r\n\t\t\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t\t\t})\r\n\t\t\t\t.filter(function(obj) {\r\n\t\t\t\t\treturn obj.attribute === 'cname';\r\n\t\t\t\t})[0];\r\n\t\tif (remoteSsrc) {\r\n\t\t\trtcpParameters.cname = remoteSsrc.value;\r\n\t\t\trtcpParameters.ssrc = remoteSsrc.ssrc;\r\n\t\t}\r\n\t\r\n\t\t// Edge uses the compound attribute instead of reducedSize\r\n\t\t// compound is !reducedSize\r\n\t\tvar rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\r\n\t\trtcpParameters.reducedSize = rsize.length > 0;\r\n\t\trtcpParameters.compound = rsize.length === 0;\r\n\t\r\n\t\t// parses the rtcp-mux attrіbute.\r\n\t\t// Note that Edge does not support unmuxed RTCP.\r\n\t\tvar mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\r\n\t\trtcpParameters.mux = mux.length > 0;\r\n\t\r\n\t\treturn rtcpParameters;\r\n\t};\r\n\t\r\n\t// parses either a=msid: or a=ssrc:... msid lines and returns\r\n\t// the id of the MediaStream and MediaStreamTrack.\r\n\tSDPUtils.parseMsid = function(mediaSection) {\r\n\t\tvar parts;\r\n\t\tvar spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\r\n\t\tif (spec.length === 1) {\r\n\t\t\tparts = spec[0].substr(7).split(' ');\r\n\t\t\treturn {stream: parts[0], track: parts[1]};\r\n\t\t}\r\n\t\tvar planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n\t\t.map(function(line) {\r\n\t\t\treturn SDPUtils.parseSsrcMedia(line);\r\n\t\t})\r\n\t\t.filter(function(msidParts) {\r\n\t\t\treturn msidParts.attribute === 'msid';\r\n\t\t});\r\n\t\tif (planB.length > 0) {\r\n\t\t\tparts = planB[0].value.split(' ');\r\n\t\t\treturn {stream: parts[0], track: parts[1]};\r\n\t\t}\r\n\t};\r\n\t\r\n\t// Generate a session ID for SDP.\r\n\t// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\r\n\t// recommends using a cryptographically random +ve 64-bit value\r\n\t// but right now this should be acceptable and within the right range\r\n\tSDPUtils.generateSessionId = function() {\r\n\t\treturn Math.random().toString().substr(2, 21);\r\n\t};\r\n\t\r\n\t// Write boilder plate for start of SDP\r\n\t// sessId argument is optional - if not supplied it will\r\n\t// be generated randomly\r\n\t// sessVersion is optional and defaults to 2\r\n\t// sessUser is optional and defaults to 'thisisadapterortc'\r\n\tSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\r\n\t\tvar sessionId;\r\n\t\tvar version = sessVer !== undefined ? sessVer : 2;\r\n\t\tif (sessId) {\r\n\t\t\tsessionId = sessId;\r\n\t\t} else {\r\n\t\t\tsessionId = SDPUtils.generateSessionId();\r\n\t\t}\r\n\t\tvar user = sessUser || 'thisisadapterortc';\r\n\t\t// FIXME: sess-id should be an NTP timestamp.\r\n\t\treturn 'v=0\\r\\n' +\r\n\t\t\t\t'o=' + user + ' ' + sessionId + ' ' + version +\r\n\t\t\t\t\t' IN IP4 127.0.0.1\\r\\n' +\r\n\t\t\t\t's=-\\r\\n' +\r\n\t\t\t\t't=0 0\\r\\n';\r\n\t};\r\n\t\r\n\tSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\r\n\t\tvar sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\t\r\n\t\t// Map ICE parameters (ufrag, pwd) to SDP.\r\n\t\tsdp += SDPUtils.writeIceParameters(\r\n\t\t\t\ttransceiver.iceGatherer.getLocalParameters());\r\n\t\r\n\t\t// Map DTLS parameters to SDP.\r\n\t\tsdp += SDPUtils.writeDtlsParameters(\r\n\t\t\t\ttransceiver.dtlsTransport.getLocalParameters(),\r\n\t\t\t\ttype === 'offer' ? 'actpass' : 'active');\r\n\t\r\n\t\tsdp += 'a=mid:' + transceiver.mid + '\\r\\n';\r\n\t\r\n\t\tif (transceiver.direction) {\r\n\t\t\tsdp += 'a=' + transceiver.direction + '\\r\\n';\r\n\t\t} else if (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=sendrecv\\r\\n';\r\n\t\t} else if (transceiver.rtpSender) {\r\n\t\t\tsdp += 'a=sendonly\\r\\n';\r\n\t\t} else if (transceiver.rtpReceiver) {\r\n\t\t\tsdp += 'a=recvonly\\r\\n';\r\n\t\t} else {\r\n\t\t\tsdp += 'a=inactive\\r\\n';\r\n\t\t}\r\n\t\r\n\t\tif (transceiver.rtpSender) {\r\n\t\t\t// spec.\r\n\t\t\tvar msid = 'msid:' + stream.id + ' ' +\r\n\t\t\t\t\ttransceiver.rtpSender.track.id + '\\r\\n';\r\n\t\t\tsdp += 'a=' + msid;\r\n\t\r\n\t\t\t// for Chrome.\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t\t' ' + msid;\r\n\t\t\tif (transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t' ' + msid;\r\n\t\t\t\tsdp += 'a=ssrc-group:FID ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].ssrc + ' ' +\r\n\t\t\t\t\t\ttransceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t\t'\\r\\n';\r\n\t\t\t}\r\n\t\t}\r\n\t\t// FIXME: this should be written by writeRtpDescription.\r\n\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\tif (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n\t\t\tsdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n\t\t\t\t\t' cname:' + SDPUtils.localCName + '\\r\\n';\r\n\t\t}\r\n\t\treturn sdp;\r\n\t};\r\n\t\r\n\t// Gets the direction from the mediaSection or the sessionpart.\r\n\tSDPUtils.getDirection = function(mediaSection, sessionpart) {\r\n\t\t// Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tswitch (lines[i]) {\r\n\t\t\t\tcase 'a=sendrecv':\r\n\t\t\t\tcase 'a=sendonly':\r\n\t\t\t\tcase 'a=recvonly':\r\n\t\t\t\tcase 'a=inactive':\r\n\t\t\t\t\treturn lines[i].substr(2);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// FIXME: What should happen here?\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sessionpart) {\r\n\t\t\treturn SDPUtils.getDirection(sessionpart);\r\n\t\t}\r\n\t\treturn 'sendrecv';\r\n\t};\r\n\t\r\n\tSDPUtils.getKind = function(mediaSection) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar mline = lines[0].split(' ');\r\n\t\treturn mline[0].substr(2);\r\n\t};\r\n\t\r\n\tSDPUtils.isRejected = function(mediaSection) {\r\n\t\treturn mediaSection.split(' ', 2)[1] === '0';\r\n\t};\r\n\t\r\n\tSDPUtils.parseMLine = function(mediaSection) {\r\n\t\tvar lines = SDPUtils.splitLines(mediaSection);\r\n\t\tvar parts = lines[0].substr(2).split(' ');\r\n\t\treturn {\r\n\t\t\tkind: parts[0],\r\n\t\t\tport: parseInt(parts[1], 10),\r\n\t\t\tprotocol: parts[2],\r\n\t\t\tfmt: parts.slice(3).join(' ')\r\n\t\t};\r\n\t};\r\n\t\r\n\tSDPUtils.parseOLine = function(mediaSection) {\r\n\t\tvar line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\r\n\t\tvar parts = line.substr(2).split(' ');\r\n\t\treturn {\r\n\t\t\tusername: parts[0],\r\n\t\t\tsessionId: parts[1],\r\n\t\t\tsessionVersion: parseInt(parts[2], 10),\r\n\t\t\tnetType: parts[3],\r\n\t\t\taddressType: parts[4],\r\n\t\t\taddress: parts[5]\r\n\t\t};\r\n\t};\r\n\t\r\n\t// a very naive interpretation of a valid SDP.\r\n\tSDPUtils.isValidSDP = function(blob) {\r\n\t\tif (typeof blob !== 'string' || blob.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar lines = SDPUtils.splitLines(blob);\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tif (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// TODO: check the modifier a bit more.\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\t\r\n\t// Expose public methods.\r\n\tif (typeof module === 'object') {\r\n\t\tmodule.exports = SDPUtils;\r\n\t}\r\n\t\r\n\t},{}]},{},[1])(1)\r\n\t});","(function(a){var r=a.fn.domManip,d=\"_tmplitem\",q=/^[^<]*(<[\\w\\W]+>)[^>]*$|\\{\\{\\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],\"tmplItem\")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h===\"function\")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,\"tmplItem\"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b===\"string\")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,\"tmpl\")||a.data(b,\"tmpl\",o(b.innerHTML));return typeof c===\"string\"?(a.template[c]=b):b}return c?typeof c!==\"string\"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(\"\"+a).split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\").split('\"').join(\"&#34;\").split(\"'\").join(\"&#39;\")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:\"null\"},open:\"if($notnull_1){_=_.concat($item.nest($1,$2));}\"},wrap:{_default:{$2:\"null\"},open:\"$item.calls(_,$1,$2);_=[];\",close:\"call=$item.calls();_=call._.concat($item.wrap(call,_));\"},each:{_default:{$2:\"$index, $value\"},open:\"if($notnull_1){$.each($1a,function($2){with(this){\",close:\"}});}\"},\"if\":{open:\"if(($notnull_1) && $1a){\",close:\"}\"},\"else\":{_default:{$1:\"true\"},open:\"}else if(($notnull_1) && $1a){\"},html:{open:\"if($notnull_1){_.push($1a);}\"},\"=\":{_default:{$1:\"$data\"},open:\"if($notnull_1){_.push($.encode($1a));}\"},\"!\":{open:\"\"}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a===\"string\"?e.key?a.replace(/(<\\w+)(?=[\\s>])(?![^>]*_tmplitem)([^>]*)/g,\"$1 \"+d+'=\"'+e.key+'\" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join(\"\");c.replace(/^\\s*([^<\\s][^<]*)?(<[\\w\\W]+>)([^>]*[^>\\s])?\\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement(\"div\");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function(\"jQuery\",\"$item\",\"var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('\"+a.trim(b).replace(/([\\\\'])/g,\"\\\\$1\").replace(/[\\r\\t\\n]/g,\" \").replace(/\\$\\{([^\\}]*)\\}/g,\"{{= $1}}\").replace(/\\{\\{(\\/?)(\\w+|.)(?:\\(((?:[^\\}]|\\}(?!\\}))*?)?\\))?(?:\\s+(.*?)?)?(\\(((?:[^\\}]|\\}(?!\\}))*?)\\))?\\s*\\}\\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw\"Template command not found: \"+j;h=i._default||[];if(c&&!/\\w$/.test(b)){b+=c;c=\"\"}if(b){b=k(b);e=e?\",\"+k(e)+\")\":c?\")\":\"\";f=c?b.indexOf(\".\")>-1?b+c:\"(\"+b+\").call($item\"+e:b;g=c?f:\"(typeof(\"+b+\")==='function'?(\"+b+\").call($item):(\"+b+\"))\"}else g=f=h.$1||\"null\";d=k(d);return\"');\"+i[l?\"close\":\"open\"].split(\"$notnull_1\").join(b?\"typeof(\"+b+\")!=='undefined' && (\"+b+\")!=null\":\"true\").split(\"$1a\").join(g).split(\"$1\").join(f).split(\"$2\").join(d?d.replace(/\\s*([^\\(]+)\\s*(\\((.*?)\\))?/g,function(d,c,b,a){a=a?\",\"+a+\")\":b?\")\":\"\";return a?\"(\"+c+\").call($item\"+a:d}):h.$2||\"\")+\"_.push('\"})+\"');}return _;\")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join(\"\")}function k(a){return a?a.replace(/\\\\'/g,\"'\").replace(/\\\\\\\\/g,\"\\\\\"):null}function s(b){var a=document.createElement(\"div\");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n=\"_\"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName(\"*\");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,\"tmplItem\"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,\"tmplItem\");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,\"tmplItem\",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(\"\"):b).filter(d||\"*\"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery)","'use strict';\r\n\r\nvar avatarUrl = '../static/plugins/ep_profile_modal/static/img/user.png';\r\n\r\nvar share = (function textChat() {\r\n\t\r\n\tvar scrollDownToLastChatText = function scrollDownToLastChatText(selector) {\r\n\t\tvar $element = $(selector);\r\n\t\tif ($element.length <= 0 || !$element[0]) return true;\r\n\t\t$element.animate({ scrollTop: $element[0].scrollHeight }, { duration: 400, queue: false });\r\n\t};\r\n\t\r\n\tvar getUserFromId = function getUserFromId(userId) {\r\n\t\tif (!window.pad || !window.pad.collabClient) return null;\r\n\t\tvar result = window.pad.collabClient.getConnectedUsers().filter(function getUser(user) {\r\n\t\t\treturn user.userId === userId;\r\n\t\t});\r\n\t\tvar user = result.length > 0 ? result[0] : null;\r\n\t\treturn user;\r\n\t};\r\n\t\r\n\tvar slugify = function slugify(text) {\r\n\t\treturn text.toString().toLowerCase().trim().replace(/\\s+/g, '-') // Replace spaces with -\r\n\t\t.replace(/&/g, '-and-') // Replace & with 'and'\r\n\t\t.replace(/[^\\w\\-]+/g, '') // Remove all non-word chars\r\n\t\t.replace(/\\--+/g, '-') // Replace multiple - with single -\r\n\t\t.replace(/^-+/, '') // Trim - from start of text\r\n\t\t.replace(/-+$/, ''); // Trim - from end of text\r\n\t};\r\n\t\r\n\tvar $body_ace_outer = function $body_ace_outer() {\r\n\t\treturn $(document).find('iframe[name=\"ace_outer\"]').contents();\r\n\t};\r\n\t\r\n\tvar createShareLink = function createShareLink(headingTagId, headerText) {\r\n\t\treturn window.location.origin + window.location.pathname + '?header=' + slugify(headerText) + '&headerId=' + headingTagId + '&joinvideo=true';\r\n\t};\r\n\t\r\n\tfunction addTextChatMessage(msg) {\r\n\t\tvar authorClass = 'author-' + msg.userId.replace(/[^a-y0-9]/g, function replace(c) {\r\n\t\t\tif (c === '.') return '-';\r\n\t\t\treturn 'z' + c.charCodeAt(0) + 'z';\r\n\t\t});\r\n\t\r\n\t\t// create the time string\r\n\t\tvar minutes = '' + new Date(msg.time).getMinutes();\r\n\t\tvar hours = '' + new Date(msg.time).getHours();\r\n\t\tif (minutes.length === 1) minutes = '0' + minutes;\r\n\t\tif (hours.length === 1) hours = '0' + hours;\r\n\t\tvar timeStr = hours + ':' + minutes;\r\n\t\r\n\t\tvar html = \"<p data-target='\" + msg.target + \"' data-id='\" + msg.headerId + \"' data-authorId='\" + msg.userId + \"' class='wrtc_text \" + msg.headId + ' ' + authorClass + \"'><b>\" + msg.userName + \"</b><span class='time \" + authorClass + \"'>\" + timeStr + '</span> ' + msg.text + '</p>';\r\n\t\r\n\t\t$(document).find('#chatbox #chattext').append(html);\r\n\t\tscrollDownToLastChatText('#chatbox #chattext');\r\n\t}\r\n\t\r\n\tvar notifyNewUserJoined = function notifyNewUserJoined(target, msg, action) {\r\n\t\tvar videoIcon = '<span class=\"videoIcon\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"video\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\" class=\"svg-inline--fa fa-video fa-w-18 fa-2x\"><path fill=\"currentColor\" d=\"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z\" class=\"\"></path></svg></span>';\r\n\t\tvar textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n\t\tvar btnJoin = \"<span class='wrtc_roomLink' data-join='\" + target + \"' data-action='JOIN' data-id='\" + msg.headerId + \"' title='Join'>\" + msg.headerTitle + '</span>';\r\n\t\r\n\t\tvar text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\t\r\n\t\tif (target === 'VIDEO') {\r\n\t\t\tvar roomCounter = \"<span class='userCount'>(\" + msg.userCount + '/' + msg.VIDEOCHATLIMIT + ')</span>';\r\n\t\t\tmsg.text = '<span>' + text + '</span>' + videoIcon + btnJoin + roomCounter;\r\n\t\t} else if (target === 'TEXT') {\r\n\t\t\tmsg.text = '<span>' + text + '</span>' + textIcon + btnJoin;\r\n\t\t}\r\n\t\r\n\t\tmsg.target = target;\r\n\t\r\n\t\taddTextChatMessage(msg);\r\n\t};\r\n\t\r\n\tvar roomBoxIconActive = function roomBoxIconActive() {\r\n\t\t$body_ace_outer().find('.wbrtc_roomBox').each(function (index, val) {\r\n\t\t\tvar textActive = $(val).attr('data-text');\r\n\t\t\tvar videoActive = $(val).attr('data-video');\r\n\t\t\tif (textActive || videoActive) {\r\n\t\t\t\t$(val).find('.btn_joinChat_chatRoom').addClass('active');\r\n\t\t\t} else {\r\n\t\t\t\t$(val).find('.btn_joinChat_chatRoom').removeClass('active');\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\t\r\n\tvar appendUserList = function appendUserList(roomInfo, selector) {\r\n\t\tif (!roomInfo.list) return true;\r\n\t\tvar $element = typeof selector === 'string' ? $(document).find(selector) : selector;\r\n\t\t$element.empty();\r\n\t\troomInfo.list.forEach(function reOrderUserList(el) {\r\n\t\t\tvar userInList = getUserFromId(el.userId) || { colorId: '', name: 'anonymous', userId: '0000000' };\r\n\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[el.userId]) {\r\n\t\t\t\tavatarUrl = clientVars.ep_profile_list[el.userId].imageUrl || clientVars.ep_profile_list[el.userId].img;\r\n\t\t\t}\r\n\t\t\t$element.append('<li data-id=' + el.userId + \" style='border-color: \" + userInList.colorId + \"'><div class='avatar'><img src='\" + avatarUrl + \"'></div>\" + userInList.name + '</li>');\r\n\t\t});\r\n\t};\r\n\t\r\n\tvar wrtcStore = {};\r\n\t\r\n\tvar wrtcPubsub = {\r\n\t\tevents: {},\r\n\t\ton: function on(eventName, fn) {\r\n\t\t\tthis.events[eventName] = this.events[eventName] || [];\r\n\t\t\tthis.events[eventName].push(fn);\r\n\t\t},\r\n\t\toff: function off(eventName, fn) {\r\n\t\t\tif (this.events[eventName]) {\r\n\t\t\t\tfor (var i = 0; i < this.events[eventName].length; i++) {\r\n\t\t\t\t\tif (this.events[eventName][i] === fn) {\r\n\t\t\t\t\t\tthis.events[eventName].splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\temit: function emit(eventName) {\r\n\t\t\tfor (var _len = arguments.length, data = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\r\n\t\t\t\tdata[_key - 1] = arguments[_key];\r\n\t\t\t}\r\n\t\r\n\t\t\tif (this.events[eventName]) {\r\n\t\t\t\tthis.events[eventName].forEach(function (fn) {\r\n\t\t\t\t\tfn.apply(undefined, data);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar inlineAvatar = {\r\n\t\tROOM: function ROOM(headerId, room) {\r\n\t\t\tvar inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n\t\t\tvar $element = $body_ace_outer().find('#wbrtc_avatarCol .' + headerId + ' .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\t$element.parent().css({ left: WRTC_Room.getHeaderRoomX($element.parent()) + 'px' });\r\n\t\t\tObject.keys(room).forEach(function reOrderUserList(key, index) {\r\n\t\t\t\tvar userInList = getUserFromId(room[key].userId) || { colorId: '', name: 'anonymous'};\r\n\t\t\t\tif(userInList.userId){\r\n\t\t\t\t\t// TODO: If the user is not found, we hangup the user.\r\n\t\t\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[userInList.userId]) {\r\n\t\t\t\t\t\tavatarUrl = clientVars.ep_profile_list[userInList.userId].imageUrl || clientVars.ep_profile_list[userInList.userId].img;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (index < inlineAvatarLimit) {\r\n\t\t\t\t\t\t$element.find('.avatarMore').hide();\r\n\t\t\t\t\t\t$element.append('<div class=\"avatar\" data-id=\"' + userInList.userId + '\"><img src=\"' + avatarUrl + '\"></div>');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$element.find('.avatarMore').show().text('+' + (index + 1 - inlineAvatarLimit));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tTEXT: function TEXT(headerId, room) {\r\n\t\t\tvar $element = $(document).find('#wrtc_textChatWrapper .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\tthis.append(room.list, $element);\r\n\t\t},\r\n\t\tVIDEO: function VIDEO(headerId, room) {\r\n\t\t\tvar $element = $(document).find('#werc_toolbar .wrtc_inlineAvatars');\r\n\t\t\t$element.find('.avatar').remove();\r\n\t\t\tthis.append(room.list, $element);\r\n\t\t},\r\n\t\tappend: function appendAvatart(list, $element) {\r\n\t\t\tvar inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n\t\t\tlist.forEach(function reOrderUserList(el, index) {\r\n\t\t\t\tvar userInList = getUserFromId(el.userId) || { colorId: '', name: 'anonymous'};\r\n\t\t\t\tif(userInList.userId){\r\n\t\t\t\t\tif (clientVars.ep_profile_list && clientVars.ep_profile_list[userInList.userId]) {\r\n\t\t\t\t\t\tavatarUrl = clientVars.ep_profile_list[userInList.userId].imageUrl || clientVars.ep_profile_list[userInList.userId].img;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (index < inlineAvatarLimit) {\r\n\t\t\t\t\t\t$element.find('.avatarMore').hide();\r\n\t\t\t\t\t\t$element.append('<div class=\"avatar\" data-id=\"' + userInList.userId + '\"><img src=\"' + avatarUrl + '\"></div>');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$element.find('.avatarMore').show().text('+' + (index + 1 - inlineAvatarLimit));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t\r\n\twrtcPubsub.on('update store', function (requestUser, headerId, action, target, roomInfo, callback) {\r\n\t\tif (!requestUser || !headerId || !action || !roomInfo || !target) return false;\r\n\t\r\n\t\tif(!wrtcStore[headerId]) wrtcStore[headerId] = {};\r\n\t\tif(!wrtcStore[headerId].USERS) wrtcStore[headerId].USERS = {};\r\n\t\r\n\t\tvar users = wrtcStore[headerId].USERS;\r\n\t\twrtcStore[headerId][target] = roomInfo;\r\n\t\t// if(action === \"JOIN\"){}\r\n\t\t// if(action === \"LEAVE\"){}\r\n\t\t// remove all users\r\n\t\tusers = {};\r\n\t\r\n\t\twrtcStore[headerId].TEXT.list.forEach(function (el) {\r\n\t\t\tif (!users[el.userId]) users[el.userId] = {};\r\n\t\t\tusers[el.userId] = el;\r\n\t\t});\r\n\t\r\n\t\twrtcStore[headerId].VIDEO.list.forEach(function (el) {\r\n\t\t\tif (!users[el.userId]) users[el.userId] = {};\r\n\t\t\tusers[el.userId] = el;\r\n\t\t});\r\n\t\r\n\t\tinlineAvatar[target](headerId, wrtcStore[headerId][target]);\r\n\t\tinlineAvatar.ROOM(headerId, users);\r\n\t\r\n\t\tif (callback) callback(wrtcStore[headerId]);\r\n\t});\r\n\t\r\n\twrtcPubsub.on('disable room buttons', function disableRoomButtons(headerId, actions, target) {\r\n\t\tvar $headingRoom = $body_ace_outer().find('#' + headerId);\r\n\t\r\n\t\tvar $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n\t\tvar $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n\t\tvar $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\t\r\n\t\tif (target === 'TEXT' || target === 'VIDEO') {\r\n\t\t\t// disable target and plus buttton\r\n\t\t\t$headingRoom.find('.btn_icon[data-join=\"' + target + '\"]').prop('disabled', true);\r\n\t\t\t$btnPlus.prop('disabled', true);\r\n\t\t}\r\n\t\r\n\t\tif (target === 'PLUS') {\r\n\t\t\t// disable all buttons\r\n\t\t\t$btnText.prop('disabled', true);\r\n\t\t\t$btnVideo.prop('disabled', true);\r\n\t\t\t$btnPlus.prop('disabled', true);\r\n\t\t}\r\n\t});\r\n\t\r\n\twrtcPubsub.on('enable room buttons', function enableRoomButtons(headerId, action, target) {\r\n\t\tvar $headingRoom = $body_ace_outer().find('#' + headerId);\r\n\t\tvar newAction = action === 'JOIN' ? 'LEAVE' : 'JOIN';\r\n\t\r\n\t\tvar $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n\t\tvar $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n\t\tvar $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\t\r\n\t\tif (target === 'TEXT' || target === 'VIDEO') {\r\n\t\t\t// enable target and plus buttton\r\n\t\t\t$headingRoom.find('.btn_icon[data-join=\"' + target + '\"]').attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\r\n\t\t\t$btnPlus.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t}\r\n\t\r\n\t\tif (target === 'TEXTPLUS') {\r\n\t\t\t// enable text button\r\n\t\t\t$btnText.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnVideo.attr({ 'data-action': newAction });\r\n\t\t}\r\n\t\r\n\t\tif (target === 'PLUS') {\r\n\t\t\t// make enable and action toggle all buttons\r\n\t\t\t$btnText.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnVideo.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t\t$btnPlus.attr({ 'data-action': newAction }).prop('disabled', false);\r\n\t\t}\r\n\t});\r\n\t\r\n\r\n\treturn Object.freeze({\r\n\t\twrtcPubsub,\r\n\t\twrtcStore,\r\n\t\tappendUserList,\r\n\t\troomBoxIconActive,\r\n\t\tnotifyNewUserJoined,\r\n\t\tcreateShareLink,\r\n\t\t$body_ace_outer,\r\n\t\tslugify,\r\n\t\tscrollDownToLastChatText,\r\n\t\tgetUserFromId\r\n\t})\r\n\r\n\r\n})();\r\n\r\n\r\n\r\n\r\n/* Helper */","'use strict';\r\n// var share = require('ep_wrtc_heading/static/js/clientShare');\r\nvar padutils = require('ep_etherpad-lite/static/js/pad_utils').padutils;\r\n\r\nvar textChat = (function textChat() {\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar currentRoom = {};\r\n\tvar $joinBtn = null;\r\n\r\n\tfunction createAndAppendMessage(msg) {\r\n\t\tif (!msg || !currentRoom.userId) return true;\r\n\r\n\t\t// correct the time\r\n\t\t// msg.time += window.clientTimeOffset;\r\n\r\n\t\tvar minutes = '' + new Date(msg.time).getMinutes();\r\n\t\tvar hours = '' + new Date(msg.time).getHours();\r\n\t\tif (minutes.length === 1) minutes = '0' + minutes;\r\n\t\tif (hours.length === 1) hours = '0' + hours;\r\n\t\tvar timeStr = hours + ':' + minutes;\r\n\r\n\t\tvar userName = $('<b>').text(msg.userName + ': ');\r\n\t\tvar tim = $('<span>').attr({ 'class': 'time' }).text(timeStr);\r\n\r\n\t\tvar text = padutils.escapeHtmlWithClickableLinks(msg.text, \"_blank\");\r\n\r\n\t\t// var urlParams = new URLSearchParams(msg.text.split(\"?\")[1]);\r\n\r\n\t\t// if(urlParams.get('id')) {\r\n\t\t// \tvar headerId = urlParams.get('id');\r\n\t\t// \tvar target = urlParams.get('target');\r\n\t\t// \tvar join = urlParams.get('join');\r\n\t\t// \ttext = $(text).attr({\r\n\t\t// \t\t\"data-join\": join,\r\n\t\t// \t\t\"data-action\":\"JOIN\",\r\n\t\t// \t\t\"data-id\": headerId\r\n\t\t// \t}).addClass('btn_roomHandler')\r\n\t\t// }\r\n\r\n\r\n\t\tvar message = $('<p>').attr({\r\n\t\t\t'data-authorid': msg.author\r\n\t\t}).append(userName).append(tim).append(text);\r\n\r\n\t\t$('#wrtc_textChat').append(message);\r\n\t\tshare.scrollDownToLastChatText('#wrtc_textChat');\r\n\t}\r\n\r\n\t// function privateNotifyNewUserJoined(target, msg, action) {\r\n\t// \tvar textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n\t// \tvar btnJoin = \"<span class='wrtc_roomLink' data-join='\" + target + \"' data-action='JOIN' data-id='\" + msg.headerId + \"' title='Join'>\" + msg.headerTitle + '</span>';\r\n\r\n\t// \tvar text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\r\n\t// \tmsg.text = '<span>' + text + '</span>' + textIcon + btnJoin;\r\n\r\n\t// \tmsg.target = target;\r\n\r\n\t// \tcreateAndAppendMessage(msg);\r\n\t// }\r\n\r\n\tfunction eventTextChatInput() {\r\n\t\tvar keycode = event.keyCode || event.which;\r\n\t\t// when press Enter key\r\n\t\tif (keycode === 13) {\r\n\t\t\tvar textMessage = $(this).val();\r\n\t\t\tif (!textMessage) return true;\r\n\t\t\t$(this).val('');\r\n\t\t\tvar user = share.getUserFromId(clientVars.userId);\r\n\t\t\tif(!user) return true;\r\n\t\t\tvar msg = { text: textMessage, userName: user.name, author: user.userId, time: new Date().getTime() };\r\n\t\t\tsocket.emit('sendTextMessage', padId, currentRoom.headerId, msg, function sendTextMessage(incomMsg) {\r\n\t\t\t\tcreateAndAppendMessage(incomMsg);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction eventListers() {\r\n\t\t$(document).on('keypress', '#wrtc_textChatInputBox input', eventTextChatInput);\r\n\r\n\t\t$(document).on('click', '#wrtc_textChatWrapper .btn_toggle_modal', function click() {\r\n\t\t\tvar action = $(this).attr('data-action');\r\n\t\t\tvar chatBox = $('#wrtc_textChat').innerHeight() + $('#wrtc_textChatInputBox').innerHeight() + 1;\r\n\r\n\t\t\t$(this).find('.fa_arrow-from-top').toggle();\r\n\t\t\t$(this).find('.fa_arrow-to-top').toggle();\r\n\r\n\t\t\tif (action === 'collapse') {\r\n\t\t\t\t$(this).attr({ 'data-action': 'expand' });\r\n\t\t\t\t$('#wrtc_textChatWrapper').css({\r\n\t\t\t\t\ttransform: 'translate(-50%, ' + chatBox + 'px)'\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$(this).attr({ 'data-action': 'collapse' });\r\n\t\t\t\t$('#wrtc_textChatWrapper').css({\r\n\t\t\t\t\ttransform: 'translate(-50%, 0)'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction deactivateModal(headerId, roomInfo) {\r\n\t\tvar $TextChatWrapper = $(document).find('#wrtc_textChatWrapper');\r\n\r\n\t\t$TextChatWrapper.removeClass('active').removeAttr('style');\r\n\t\t$TextChatWrapper.find('#wrtc_textChat p').remove();\r\n\t\t// socket.removeListener('receiveTextMessage:' + headerId);\r\n\r\n\t\tvar $btn = $(document).find('#wrtc_textChatWrapper .btn_toggle_modal');\r\n\t\t$btn.attr({ 'data-action': 'collapse' });\r\n\t\t$btn.find('.fa_arrow-from-top').toggle();\r\n\t\t$btn.find('.fa_arrow-to-top').toggle();\r\n\t}\r\n\r\n\tfunction activateModal(headerId, headTitle, userCount, roomInfo) {\r\n\t\tif (!headerId) return false;\r\n\t\tvar existTextChat = $(document).find('#wrtc_textChatWrapper');\r\n\t\tif (!existTextChat.length) {\r\n\t\t\tvar textChatBox = $('#wrtc_textChatBox').tmpl({\r\n\t\t\t\theaderId: headerId,\r\n\t\t\t\theadTitle: headTitle\r\n\t\t\t});\r\n\t\t\t$('body').append(textChatBox);\r\n\t\t} else {\r\n\t\t\t// TODO: change this to template\r\n\t\t\texistTextChat.attr({ 'data-id': headerId }).find('.textChatToolbar b, .btn_leave').attr({ 'data-id': headerId });\r\n\t\t\texistTextChat.find('.nd_title b').text(headTitle);\r\n\t\t}\r\n\r\n\t\t// for animation pop up\r\n\t\tsetTimeout(function setTimeout() {\r\n\t\t\t$(document).find('#wrtc_textChatWrapper').addClass('active');\r\n\t\t}, 250);\r\n\r\n\t\tsocket.on('receiveTextMessage:' + headerId, function receiveTextMessage(headingId, msg) {\r\n\t\t\tif (headingId === headerId) {\r\n\t\t\t\tcreateAndAppendMessage(msg);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.emit('getTextMessages', padId, headerId, {}, function getTextMessages(data) {\r\n\t\t\tdata.forEach(function (el) {\r\n\t\t\t\tcreateAndAppendMessage(el);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n\t}\r\n\r\n\tfunction addUserToRoom(data, roomInfo) {\r\n\t\tif (!data || !data.userId) return true;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.textChatCount').text(userCount);\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\t\t// some user may session does exist but the user info does not available in all over the current pad\r\n\t\tif (!user) return true;\r\n\r\n\t\t// TODO: this is not good idea, use global state\r\n\t\t// if incoming user has already in the room don't persuade the request\r\n\t\tvar IsUserInRooms = $headingRoom.find(\".wrtc_content.textChat ul li[data-id='\" + user.userId + \"']\").text();\r\n\t\tif (IsUserInRooms) return false;\r\n\r\n\t\tshare.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.textChat ul'));\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n\r\n\t\t// notify, a user join the video-chat room\r\n\t\t// var msg = {\r\n\t\t// \ttime: new Date(),\r\n\t\t// \tuserId: data.userId || user.userId,\r\n\t\t// \tuserName: user.name || data.name || 'anonymous',\r\n\t\t// \theaderId: data.headerId,\r\n\t\t// \tuserCount: userCount,\r\n\t\t// \theaderTitle: headTitle\r\n\t\t// };\r\n\t\t// share.notifyNewUserJoined('TEXT', msg, 'JOIN');\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId) {\r\n\t\t// \tvar privateMsg = {\r\n\t\t// \t\tuserName: user.name,\r\n\t\t// \t\tauthor: user.userId,\r\n\t\t// \t\theaderTitle: headTitle,\r\n\t\t// \t\ttime: new Date().getTime()\r\n\t\t// \t};\r\n\t\t// \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'JOIN');\r\n\t\t// }\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n\t\t// \t$.gritter.add({\r\n\t\t// \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the text-chat, <b><i> \"' + headTitle + '\"</b></i>',\r\n\t\t// \t\tsticky: false,\r\n\t\t// \t\ttime: 3000,\r\n\t\t// \t\tposition: 'center',\r\n\t\t// \t\tclass_name: 'chat-gritter-msg'\r\n\t\t// \t});\r\n\t\t// }\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\tcurrentRoom = data;\r\n\t\t\t$headingRoom.attr({ 'data-text': true });\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tactivateModal(headerId, headTitle, userCount, roomInfo);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'TEXT', roomInfo, function updateStore() {});\r\n\t}\r\n\r\n\tfunction removeUserFromRoom(data, roomInfo, target, cb) {\r\n\t\tif (!data || !data.userId) return true;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.textChatCount').text(userCount);\r\n\r\n\t\tvar $textChatUserList = $headingRoom.find('.wrtc_content.textChat ul');\r\n\r\n\t\tshare.appendUserList(roomInfo, $textChatUserList);\r\n\t\tshare.appendUserList(roomInfo, '#wrtc_textChatWrapper #textChatUserModal ul');\r\n\r\n\t\tif (userCount === 0) {\r\n\t\t\t$textChatUserList.append('<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_text\" data-action=\"JOIN\" data-id=\"' + headerId + '\" data-join=\"TEXT\"><b>text-chat</b></button></li>');\r\n\t\t}\r\n\r\n\t\t// var user = share.getUserFromId(data.userId);\r\n\r\n\t\t// notify, a user join the text-chat room\r\n\t\t// var msg = {\r\n\t\t// \ttime: new Date(),\r\n\t\t// \tuserId: user.userId || data.userId,\r\n\t\t// \tuserName: user.name || data.name || 'anonymous',\r\n\t\t// \theaderId: data.headerId,\r\n\t\t// \tuserCount: userCount,\r\n\t\t// \theaderTitle: headTitle\r\n\t\t// };\r\n\t\t// share.notifyNewUserJoined('TEXT', msg, 'LEAVE');\r\n\r\n\t\t// if (data.headerId === currentRoom.headerId) {\r\n\t\t// \tvar privateMsg = {\r\n\t\t// \t\tuserName: user.name,\r\n\t\t// \t\tauthor: user.userId,\r\n\t\t// \t\theaderTitle: headTitle,\r\n\t\t// \t\ttime: new Date().getTime()\r\n\t\t// \t};\r\n\t\t// \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'LEAVE');\r\n\t\t// }\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.removeAttr('data-text');\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tcurrentRoom = {};\r\n\t\t\tdeactivateModal(data.headerId, roomInfo);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'TEXT', roomInfo, function () {});\r\n\r\n\t\tif (cb && typeof cb === 'function') cb();\r\n\t}\r\n\r\n\tfunction userJoin(headerId, userData, $joinButton) {\r\n\t\tif (!userData || !userData.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// check if user already in that room\r\n\t\tif (currentRoom && currentRoom.headerId === headerId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$joinBtn = $joinButton;\r\n\r\n\t\tshare.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n\r\n\t\tif (!currentRoom.userId) {\r\n\t\t\tsocket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n\t\t} else {\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'text', function userLeave(data, roomInfo, target) {\r\n\t\t\t\tremoveUserFromRoom(data, roomInfo, 'text', function join2newOne() {\r\n\t\t\t\t\tsocket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction userLeave(headerId, userData, $joinButton) {\r\n\t\t$joinBtn = $joinButton;\r\n\t\tsocket.emit('userLeave', padId, userData, 'text', removeUserFromRoom);\r\n\t}\r\n\r\n\tfunction socketBulkUpdateRooms(rooms, info, target) {\r\n\t\tvar roomsInfo = {};\r\n\t\t// create a roomInfo for each individual room\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\tvar roomInfo = {\r\n\t\t\t\tpresent: rooms[headerId].length,\r\n\t\t\t\tlist: rooms[headerId]\r\n\t\t\t};\r\n\t\t\troomsInfo[headerId] = roomInfo;\r\n\t\t});\r\n\r\n\t\t// bind roomInfo and send user to gateway_userJoin\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\trooms[headerId].forEach(function (user) {\r\n\t\t\t\taddUserToRoom(user, roomsInfo[headerId], 'text');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction bulkUpdateRooms(hTagList) {\r\n\t\tsocket.emit('bulkUpdateRooms', padId, hTagList, 'text', socketBulkUpdateRooms);\r\n\t}\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tsocket = webSocket;\r\n\t\tpadId = docId || window.pad.getPadId();\r\n\t\teventListers();\r\n\t}\r\n\r\n\treturn {\r\n\t\tpostAceInit: postAceInit,\r\n\t\tactivateModal: activateModal,\r\n\t\tdeactivateModal: deactivateModal,\r\n\t\tuserJoin: userJoin,\r\n\t\tuserLeave: userLeave,\r\n\t\tremoveUserFromRoom: removeUserFromRoom,\r\n\t\taddUserToRoom: addUserToRoom,\r\n\t\tbulkUpdateRooms: bulkUpdateRooms\r\n\t};\r\n})();\r\n\r\n// module.exports = textChat;","'use strict';\r\n// var share = require('ep_wrtc_heading/static/js/clientShare');\r\n\r\nvar videoChat = (function videoChat() {\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar currentRoom = {};\r\n\tvar localStream = null;\r\n\tvar VIDEOCHATLIMIT = 0;\r\n\tvar $joinBtn = null;\r\n\r\n\tfunction mediaDevices() {\r\n\t\tnavigator.mediaDevices.enumerateDevices().then(function enumerateDevices(data) {\r\n\t\t\tvar videoSettings = localStorage.getItem('videoSettings') || { microphone: null, speaker: null, camera: null };\r\n\r\n\t\t\tif (typeof videoSettings === 'string') {\r\n\t\t\t\tvideoSettings = JSON.parse(videoSettings);\r\n\t\t\t}\r\n\r\n\t\t\tvar audioInputSelect = document.querySelector('select#audioSource');\r\n\t\t\tvar audioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\tvar videoSelect = document.querySelector('select#videoSource');\r\n\r\n\t\t\tfor (var i = 0; i !== data.length; ++i) {\r\n\t\t\t\tvar deviceInfo = data[i];\r\n\t\t\t\tvar option = document.createElement('option');\r\n\t\t\t\toption.value = deviceInfo.deviceId;\r\n\t\t\t\tif (deviceInfo.kind === 'audioinput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'microphone ' + (audioInputSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.microphone === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\taudioInputSelect.appendChild(option);\r\n\t\t\t\t} else if (deviceInfo.kind === 'audiooutput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'speaker ' + (audioOutputSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.speaker === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\taudioOutputSelect.appendChild(option);\r\n\t\t\t\t} else if (deviceInfo.kind === 'videoinput') {\r\n\t\t\t\t\toption.text = deviceInfo.label || 'camera ' + (videoSelect.length + 1);\r\n\t\t\t\t\tif (videoSettings.camera === deviceInfo.deviceId) option.selected = true;\r\n\t\t\t\t\tvideoSelect.appendChild(option);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction stopStreaming(stream, userId) {\r\n\t\tif (stream) {\r\n\t\t\tstream.getTracks().forEach(function stopStream(track) {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t});\r\n\t\t\tstream = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isUserMediaAvailable() {\r\n\t\treturn window.navigator.mediaDevices.getUserMedia({ audio: true, video: true });\r\n\t}\r\n\r\n\tfunction activateModal() {}\r\n\r\n\tfunction deactivateModal() {}\r\n\r\n\tfunction removeUserFromRoom(data, roomInfo, cb) {\r\n\t\tif (!data || !roomInfo || !data.userId) return false;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\t\tvar $videoChatUserList = $headingRoom.find('.wrtc_content.videoChat ul');\r\n\r\n\t\tshare.appendUserList(roomInfo, $videoChatUserList);\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n\t\tif (userCount === 0) {\r\n\t\t\t$videoChatUserList.append('<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_video\" data-action=\"JOIN\" data-id=\"' + headerId + '\" data-join=\"VIDEO\"><b>video-chat</b></button></li>');\r\n\t\t}\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\r\n\t\tif(user && data.action !== 'JOIN' && data.action !== 'RELOAD' ){\r\n\t\t\t// notify, a user join the video-chat room\r\n\t\t\tvar msg = {\r\n\t\t\t\ttime: new Date(),\r\n\t\t\t\tuserId: data.userId || user.userId,\r\n\t\t\t\tuserName: data.name || user.name || 'anonymous',\r\n\t\t\t\theaderId: data.headerId,\r\n\t\t\t\tuserCount: userCount,\r\n\t\t\t\theaderTitle: headerTitle,\r\n\t\t\t\tVIDEOCHATLIMIT: VIDEOCHATLIMIT\r\n\t\t\t};\r\n\t\t\tshare.notifyNewUserJoined('VIDEO', msg, 'LEAVE');\r\n\t\t}\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.removeAttr('data-video');\r\n\t\t\tshare.roomBoxIconActive();\r\n\t\t\tWRTC.deactivate(data.userId, data.headerId);\r\n\t\t\twindow.headerId = null;\r\n\r\n\t\t\tcurrentRoom = {};\r\n\r\n\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\ttransform: 'translate(-50%, -100%)',\r\n\t\t\t\topacity: 0\r\n\t\t\t}).attr({ 'data-active': false });\r\n\r\n\t\t\tstopStreaming(localStream);\r\n\t\t\tsocket.removeListener('receiveTextMessage:' + data.headerId);\r\n\t\t}\r\n\r\n\t\tif (cb && typeof cb === 'function') cb();\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'VIDEO', roomInfo, function updateStore() {});\r\n\r\n\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\r\n\t\tWRTC.userLeave(data.userId)\r\n\t}\r\n\r\n\tfunction addUserToRoom(data, roomInfo) {\r\n\t\tif (!data || !data.userId) return false;\r\n\t\tvar headerId = data.headerId;\r\n\t\tvar $headingRoom = share.$body_ace_outer().find('#' + headerId);\r\n\t\tvar headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n\t\tvar user = share.getUserFromId(data.userId);\r\n\t\t// some user may session does exist but the user info does not available in all over the current pad\r\n\t\tif (!user) return true;\r\n\r\n\t\t// TODO: this is not good idea, use global state\r\n\t\t// if incoming user has already in the room don't persuade the request\r\n\t\tvar IsUserInRooms = $headingRoom.find(\".wrtc_content.videoChat ul li[data-id='\" + user.userId + \"']\").text();\r\n\t\tif (IsUserInRooms) return false;\r\n\r\n\t\tvar userCount = roomInfo.present;\r\n\t\t$headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n\t\t$(document).find('#wrtc_textChatWrapper .textChatToolbar .userCount').text(userCount);\r\n\r\n\t\tshare.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.videoChat ul'));\r\n\r\n\t\tif(data.action == 'JOIN'){\r\n\t\t\t// notify, a user join the video-chat room\r\n\t\t\tvar msg = {\r\n\t\t\t\ttime: new Date(),\r\n\t\t\t\tuserId: data.userId,\r\n\t\t\t\tuserName: user.name || data.name || 'anonymous',\r\n\t\t\t\theaderId: data.headerId,\r\n\t\t\t\tuserCount: userCount,\r\n\t\t\t\theaderTitle: headerTitle,\r\n\t\t\t\tVIDEOCHATLIMIT: VIDEOCHATLIMIT\r\n\t\t\t};\r\n\r\n\t\t\tshare.notifyNewUserJoined('VIDEO', msg, 'JOIN');\r\n\r\n\t\t\t// if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n\t\t\t// \t$.gritter.add({\r\n\t\t\t// \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the video-chat, <b><i> \"' + headerTitle + '\"</b></i>',\r\n\t\t\t// \t\tsticky: false,\r\n\t\t\t// \t\ttime: 3000,\r\n\t\t\t// \t\tposition: 'center',\r\n\t\t\t// \t\tclass_name: 'chat-gritter-msg'\r\n\t\t\t// \t});\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tif (data.userId === clientVars.userId) {\r\n\t\t\t$headingRoom.attr({ 'data-video': true });\r\n\t\t\tshare.roomBoxIconActive();\r\n\r\n\t\t\t$('#werc_toolbar p').attr({ 'data-id': data.headerId }).text(headerTitle);\r\n\t\t\t$(\"#werc_toolbar .btn_roomHandler\").attr({ 'data-id': data.headerId });\r\n\r\n\t\t\twindow.headerId = data.headerId;\r\n\t\t\tWRTC.activate(data.headerId, user.userId);\r\n\t\t\tcurrentRoom = data;\r\n\r\n\t\t\t$('#rtcbox').prepend('<h4 class=\"chatTitle\">' + headerTitle + '</h4>');\r\n\r\n\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\ttransform: 'translate(-50%, 0)',\r\n\t\t\t\topacity: 1\r\n\t\t\t}).attr({ 'data-active': true });\r\n\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n\r\n\t\t\tsocket.on('receiveTextMessage:' + headerId, function receiveTextMessage(headingId, msg) {\r\n\t\t\t\tvar active = $(document).find('#wrtc_textChatWrapper').hasClass('active');\r\n\t\t\t\tif (headingId === headerId && !active) {\r\n\t\t\t\t\ttextChat.userJoin(headerId, data, 'TEXT');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tshare.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'VIDEO', roomInfo, function updateStore() {});\r\n\t}\r\n\t\r\n\tfunction createSession(headerId, userInfo, $joinButton) {\r\n\t\tshare.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n\t\t$joinBtn = $joinButton;\r\n\t\tisUserMediaAvailable().then(function joining(stream) {\r\n\t\t\tlocalStream = stream;\r\n\r\n\t\t\tif (!currentRoom.userId) {\r\n\t\t\t\treturn socket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n\t\t\t}\r\n\t\t\t// If the user has already joined the video chat, make suer leave that room then join to the new chat room\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'video', function userLeave(_userData, roomInfo) {\r\n\t\t\t\tgateway_userLeave(_userData, roomInfo, function join2newOne() {\r\n\t\t\t\t\tsocket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t})['catch'](function (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\tsocket.emit('userLeave', padId, currentRoom, 'video', function userLeave(_userData, roomInfo) {\r\n\t\t\t\tgateway_userLeave(_userData, roomInfo);\r\n\t\t\t});\r\n\t\t\tWRTC.showUserMediaError(err);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction userJoin(headerId, userInfo, $joinButton) {\r\n\t\tif (!userInfo || !userInfo.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// check if has user already in that room\r\n\t\tif (currentRoom && currentRoom.headerId === headerId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tcreateSession(headerId, userInfo, $joinButton);\r\n\t}\r\n\r\n\tfunction reloadSession(headerId, userInfo, $joinButton){\r\n\t\tif (!userInfo || !userInfo.userId) {\r\n\t\t\tshare.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tcreateSession(headerId, userInfo, $joinButton, 'RELOAD');\r\n\t}\r\n\r\n\tfunction userLeave(headerId, data, $joinButton) {\r\n\t\t$joinBtn = $joinButton;\r\n\t\tsocket.emit('userLeave', padId, data, 'video', gateway_userLeave);\r\n\t}\r\n\r\n\tfunction reachedVideoRoomSize(roomInfo, showAlert, isBulkUpdate) {\r\n\t\tif (roomInfo && roomInfo.present <= VIDEOCHATLIMIT) return true;\r\n\r\n\t\tshowAlert = showAlert || true;\r\n\t\tif (showAlert && !isBulkUpdate) {\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Video chat Limitation',\r\n\t\t\t\ttext: 'The video-chat room has been reached its limitation. \\r\\n <br> The size of this video-chat room is ' + VIDEOCHATLIMIT + '.',\r\n\t\t\t\tsticky: false,\r\n\t\t\t\tclass_name: 'error',\r\n\t\t\t\ttime: '5000'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction socketBulkUpdateRooms(rooms, info, target) {\r\n\t\tvar roomsInfo = {};\r\n\t\t// create a roomInfo for each individual room\r\n\t\tObject.keys(rooms).forEach(function makeRoomInfo(headerId) {\r\n\t\t\tvar roomInfo = {\r\n\t\t\t\tpresent: rooms[headerId].length,\r\n\t\t\t\tlist: rooms[headerId]\r\n\t\t\t};\r\n\t\t\troomsInfo[headerId] = roomInfo;\r\n\t\t});\r\n\r\n\t\t// bind roomInfo and send user to gateway_userJoin\r\n\t\tObject.keys(rooms).forEach(function (headerId) {\r\n\t\t\trooms[headerId].forEach(function (user) {\r\n\t\t\t\tgateway_userJoin(user, roomsInfo[headerId], true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction bulkUpdateRooms(hTagList) {\r\n\t\tsocket.emit('bulkUpdateRooms', padId, hTagList, 'video', socketBulkUpdateRooms);\r\n\t}\r\n\r\n\t/**\r\n  *\r\n  * @param {Object} data @requires\r\n  * @param {String} data.padId @requires\r\n  * @param {String} data.userId @requires\r\n  * @param {String} data.userName @requires\r\n  * @param {String} data.headerId\r\n  *\r\n  * @param {Object} roomInfo\r\n  * @param {Boolean} showAlert\r\n  * @param {Boolean} bulkUpdate\r\n *\r\n *\t@returns\r\n  */\r\n\tfunction gateway_userJoin(data, roomInfo, showAlert, bulkUpdate) {\r\n\t\tif (!data) return reachedVideoRoomSize(null, true, false);\r\n\r\n\t\tif (data && reachedVideoRoomSize(roomInfo, showAlert, bulkUpdate)) {\r\n\t\t\treturn addUserToRoom(data, roomInfo);\r\n\t\t} else if (bulkUpdate) {\r\n\t\t\treturn addUserToRoom(data, roomInfo);\r\n\t\t}\r\n\t\treturn stopStreaming(localStream);\r\n\t}\r\n\r\n\tfunction gateway_userLeave(data, roomInfo, cb) {\r\n\t\tremoveUserFromRoom(data, roomInfo, cb);\r\n\t}\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tsocket = webSocket;\r\n\t\tpadId = docId || window.pad.getPadId();\r\n\t\tVIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n\r\n\t\tmediaDevices();\r\n\t}\r\n\r\n\treturn {\r\n\t\tpostAceInit: postAceInit,\r\n\t\tactivateModal: activateModal,\r\n\t\tdeactivateModal: deactivateModal,\r\n\t\tuserJoin: userJoin,\r\n\t\tuserLeave: userLeave,\r\n\t\tgateway_userJoin: gateway_userJoin,\r\n\t\tgateway_userLeave: gateway_userLeave,\r\n\t\tbulkUpdateRooms: bulkUpdateRooms,\r\n\t\treloadSession: reloadSession\r\n\t};\r\n})();\r\n\r\n// module.exports = videoChat;","/**\r\n * Copyright 2013 j <j@mailb.org>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n'use strict';\r\n\r\nvar WRTC = (function WRTC() {\r\n\tvar padId = null;\r\n\tvar socket = null;\r\n\tvar videoSizes = { large: '260px', small: '160px' };\r\n\tvar pcConfig = {};\r\n\tvar audioInputSelect = null;\r\n\tvar videoSelect = null;\r\n\tvar audioOutputSelect = null;\r\n\tvar pcConstraints = {\r\n\t\toptional: [{\r\n\t\t\tDtlsSrtpKeyAgreement: true\r\n\t\t}]\r\n\t};\r\n\tvar sdpConstraints = {\r\n\t\tmandatory: {\r\n\t\t\tOfferToReceiveAudio: true,\r\n\t\t\tOfferToReceiveVideo: true\r\n\t\t}\r\n\t};\r\n\tvar localStream;\r\n\tvar remoteStream = {};\r\n\tvar pc = {};\r\n\tvar callQueue = [];\r\n\tvar enlargedVideos = new Set();\r\n\tvar localVideoElement = null;\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tpadId = docId;\r\n\t\tsocket = webSocket;\r\n\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/RTCConfiguration/iceServers\r\n\t\t// Don't forget to use TURN server, The Stun server is not enough.\r\n\t\tpcConfig.iceServers = [{\r\n\t\t\t'urls': [\r\n\t\t\t\t'stun:stun.l.google.com:19302',\r\n\t\t\t\t'stun:stun1.l.google.com:19302',\r\n\t\t\t\t'stun:stun2.l.google.com:19302',\r\n\t\t\t\t'stun:stun.l.google.com:19302?transport=udp',\r\n\t\t\t]\r\n\t\t}];\r\n\r\n\t\tif(clientVars.webrtc && clientVars.webrtc.iceServers) pcConfig.iceServers = clientVars.webrtc.iceServers;\r\n\r\n\t\tif (clientVars.webrtc.video.sizes.large) {\r\n\t\t\tvideoSizes.large = clientVars.webrtc.video.sizes.large + 'px';\r\n\t\t}\r\n\t\tif (clientVars.webrtc.video.sizes.small) {\r\n\t\t\tvideoSizes.small = clientVars.webrtc.video.sizes.small + 'px';\r\n\t\t}\r\n\t\twebSocket.on(\"RTC_MESSAGE\", function(context){\r\n\t\t\tif (context.data.payload.data.headerId === window.headerId) self.receiveMessage(context.data.payload);\r\n\t\t})\r\n\r\n\t\t$(document).on('change', 'select#audioSource', self.audioVideoInputChange);\r\n\t\t$(document).on('change', 'select#videoSource', self.audioVideoInputChange);\r\n\t\t$(document).on('change', 'select#audioOutput', self.changeAudioDestination);\r\n\r\n\t\t$(window).on('unload', function () {\r\n\t\t\tself.hangupAll();\r\n\t\t});\r\n\r\n\t}\r\n\r\n\r\n\tvar self = {\r\n\t\t// API HOOKS\r\n\t\t_pad: window.pad,\r\n\t\tpostAceInit: postAceInit,\r\n\t\tappendInterfaceLayout: function appendInterfaceLayout() {\r\n\t\t\t// TODO: legacy code, move it to template\r\n\t\t\tvar werc_toolbar = $('#wertc_modal_toolbar').tmpl({\r\n\t\t\t\tvideoChatLimit: clientVars.webrtc.videoChatLimit,\r\n\t\t\t\theaderId: ''\r\n\t\t\t});\r\n\t\t\tvar $wrtc_modal = $('<div id=\"wrtc_modal\"><div class=\"videoWrapper\" class=\"thin-scrollbar\"></div></div');\r\n\t\t\t$wrtc_modal.append(werc_toolbar);\r\n\t\t\t$('body').prepend($wrtc_modal);\r\n\t\t\t$(document).on('click', '#wrtc_modal .btn_toggle_modal', function () {\r\n\t\t\t\tvar $parent = $(this).parent().parent();\r\n\t\t\t\tvar action = $(this).attr('data-action');\r\n\t\t\t\tvar videoBox = $('#wrtc_modal .videoWrapper').innerHeight();\r\n\r\n\t\t\t\t$(this).find('.fa_arrow-from-top').toggle();\r\n\t\t\t\t$(this).find('.fa_arrow-to-top').toggle();\r\n\r\n\t\t\t\tif (action === 'collapse') {\r\n\t\t\t\t\t$(this).attr({ 'data-action': 'expand' });\r\n\t\t\t\t\t$parent.find('.btn_enlarge').removeAttr('active');\r\n\t\t\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\t\t\ttransform: 'translate(-50%, -' + videoBox + 'px)'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(this).attr({ 'data-action': 'collapse' });\r\n\t\t\t\t\t$parent.find('.btn_enlarge').attr({ active: true });\r\n\t\t\t\t\t$('#wrtc_modal').css({\r\n\t\t\t\t\t\ttransform: 'translate(-50%, 0)'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\taceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n\t\t\tif (context.author) {\r\n\t\t\t\tvar user = self.getUserFromId(context.author);\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\t$('#video_' + user.userId.replace(/\\./g, '_')).css({\r\n\t\t\t\t\t\t'border-color': user.colorId\r\n\t\t\t\t\t}).siblings('.user-name').text(user.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLeave: function userLeave(userId) {\r\n\t\t\tif (userId && pc[userId]) self.hangup(userId, true);\r\n\t\t},\r\n\t\t// handleClientMessage_RTC_MESSAGE: function handleClientMessage_RTC_MESSAGE(hook, context) {\r\n\t\t// \tif (context.payload.data.headerId === window.headerId) self.receiveMessage(context.payload);\r\n\t\t// },\r\n\t\t// END OF API HOOKS\r\n\t\tshow: function show() {\r\n\t\t\t$('#pad_title').addClass('f_wrtcActive');\r\n\t\t},\r\n\t\tshowUserMediaError: function showUserMediaError(err) {\r\n\t\t\t// show an error returned from getUserMedia\r\n\t\t\tvar reason;\r\n\t\t\t// For reference on standard errors returned by getUserMedia:\r\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n\t\t\t// However keep in mind that we add our own errors in getUserMediaPolyfill\r\n\t\t\tswitch (err.name) {\r\n\t\t\t\tcase 'CustomNotSupportedError':\r\n\t\t\t\t\treason = 'Sorry, your browser does not support WebRTC. (or you have it disabled in your settings).<br><br>' + 'To participate in this audio/video chat you have to user a browser with WebRTC support like Chrome, Firefox or Opera.' + '<a href=\"http://www.webrtc.org/\" target=\"_new\">Find out more</a>';\r\n\t\t\t\t\tself.sendErrorStat('NotSupported');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'CustomSecureConnectionError':\r\n\t\t\t\t\treason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n\t\t\t\t\tself.sendErrorStat('SecureConnection');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotAllowedError':\r\n\t\t\t\t\t// For certain (I suspect older) browsers, `NotAllowedError` indicates either an insecure connection or the user rejecting camera permissions.\r\n\t\t\t\t\t// The error for both cases appears to be identical, so our best guess at telling them apart is to guess whether we are in a secure context.\r\n\t\t\t\t\t// (webrtc is considered secure for https connections or on localhost)\r\n\t\t\t\t\tif (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {\r\n\t\t\t\t\t\treason = 'Sorry, you need to give us permission to use your camera and microphone';\r\n\t\t\t\t\t\tself.sendErrorStat('Permission');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n\t\t\t\t\t\tself.sendErrorStat('SecureConnection');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotFoundError':\r\n\t\t\t\t\treason = \"Sorry, we couldn't find a suitable camera on your device. If you have a camera, make sure it set up correctly and refresh this website to retry.\";\r\n\t\t\t\t\tself.sendErrorStat('NotFound');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NotReadableError':\r\n\t\t\t\t\t// `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, a hardware error occurred that prevented access to your camera and/or microphone:<br><br>' + err.message;\r\n\t\t\t\t\tself.sendErrorStat('Hardware');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'AbortError':\r\n\t\t\t\t\t// `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, an error occurred (probably not hardware related) that prevented access to your camera and/or microphone:<br><br>' + err.message;\r\n\t\t\t\t\tself.sendErrorStat('Abort');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// `err` as a string might give useful info to the user (not necessarily useful for other error messages)\r\n\t\t\t\t\treason = 'Sorry, there was an unknown Error:<br><br>' + err;\r\n\t\t\t\t\tself.sendErrorStat('Unknown');\r\n\t\t\t}\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\ttext: reason,\r\n\t\t\t\tsticky: true,\r\n\t\t\t\tclass_name: 'error'\r\n\t\t\t});\r\n\t\t\tself.hide();\r\n\t\t},\r\n\t\thide: function hide(userId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tuserId = userId.split('.')[1];\r\n\t\t\t$('#rtcbox').find('#video_a_' + userId).parent().remove();\r\n\t\t},\r\n\t\tactivate: function activate(headerId) {\r\n\t\t\tself.show();\r\n\t\t\tself.hangupAll();\r\n\t\t\tself.getUserMedia(headerId);\r\n\r\n\r\n\r\n\t\t\t\r\n\r\n\r\n\r\n\t\t},\r\n\t\tdeactivate: function deactivate(userId, headerId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tself.hide(userId);\r\n\t\t\tself.hangupAll(headerId);\r\n\t\t\tif(pc[userId]) pc[userId].close();\r\n\t\t\t// self.hangup(userId, true, headerId);\r\n\t\t\tif (localStream) {\r\n\t\t\t\tlocalStream.getTracks().forEach(function (track){ track.stop() });\r\n\t\t\t\tlocalStream = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoggleMuted: function toggleMuted() {\r\n\t\t\tvar audioTrack = localStream.getAudioTracks()[0];\r\n\t\t\tif (audioTrack) {\r\n\t\t\t\taudioTrack.enabled = !audioTrack.enabled;\r\n\t\t\t\treturn !audioTrack.enabled;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoggleVideo: function toggleVideo() {\r\n\t\t\tvar videoTrack = localStream.getVideoTracks()[0];\r\n\t\t\tif (videoTrack) {\r\n\t\t\t\tvideoTrack.enabled = !videoTrack.enabled;\r\n\t\t\t\treturn !videoTrack.enabled;\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetUserFromId: function getUserFromId(userId) {\r\n\t\t\tif (!self._pad || !self._pad.collabClient) return null;\r\n\t\t\tvar result = self._pad.collabClient.getConnectedUsers().filter(function (user) {\r\n\t\t\t\treturn user.userId === userId;\r\n\t\t\t});\r\n\t\t\tvar user = result.length > 0 ? result[0] : null;\r\n\t\t\treturn user;\r\n\t\t},\r\n\t\tsetStream: function setStream(userId, stream) {\r\n\t\t\tif (!userId) return false;\r\n\r\n\t\t\tvar isLocal = userId === self.getUserId();\r\n\t\t\tvar videoId = 'video_' + userId.replace(/\\./g, '_');\r\n\t\t\tvar video = $('#' + videoId)[0];\r\n\r\n\t\t\tif (!stream) $(video).parent().remove();\r\n\r\n\t\t\tvar user = self.getUserFromId(userId);\r\n\r\n\t\t\tif (!video && stream) {\r\n\t\t\t\tvar videoContainer = $(\"<div class='video-container'>\").css({\r\n\t\t\t\t\twidth: videoSizes.small,\r\n\t\t\t\t\t'max-height': videoSizes.small\r\n\t\t\t\t}).appendTo($('#wrtc_modal .videoWrapper'));\r\n\r\n\t\t\t\tvideoContainer.append($('<div class=\"user-name\">').text(user.name));\r\n\r\n\t\t\t\tvideo = $('<video playsinline>').attr('id', videoId).css({\r\n\t\t\t\t\t'border-color': user.colorId,\r\n\t\t\t\t\twidth: videoSizes.small,\r\n\t\t\t\t\t'max-height': videoSizes.small\r\n\t\t\t\t}).on({\r\n\t\t\t\t\tloadedmetadata: function loadedmetadata() {\r\n\t\t\t\t\t\tself.addInterface(userId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).appendTo(videoContainer)[0];\r\n\r\n\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\tif (isLocal) {\r\n\t\t\t\t\tvideoContainer.addClass('local-user');\r\n\t\t\t\t\tvideo.muted = true;\r\n\t\t\t\t}\r\n\t\t\t\tself.addInterface(userId);\r\n\t\t\t}\r\n\t\t\tif (stream) attachMediaStream(video, stream);\r\n\t\t},\r\n\t\taddInterface: function addInterface(userId) {\r\n\t\t\tif (!userId) return false;\r\n\t\t\tvar isLocal = userId === self.getUserId();\r\n\t\t\tvar videoId = 'video_' + userId.replace(/\\./g, '_');\r\n\t\t\tvar $video = $('#' + videoId);\r\n\r\n\t\t\tvar $mute = $(\"<span class='interface-btn audio-btn buttonicon'>\").attr('title', 'Mute').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tvar muted;\r\n\t\t\t\t\tif (isLocal) {\r\n\t\t\t\t\t\tmuted = self.toggleMuted();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$video[0].muted = !$video[0].muted;\r\n\t\t\t\t\t\tmuted = $video[0].muted;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$mute.attr('title', muted ? 'Unmute' : 'Mute').toggleClass('muted', muted);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar videoEnabled = true;\r\n\t\t\tvar $disableVideo = isLocal ? $(\"<span class='interface-btn video-btn buttonicon'>\").attr('title', 'Disable video').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tself.toggleVideo();\r\n\t\t\t\t\tvideoEnabled = !videoEnabled;\r\n\t\t\t\t\t$disableVideo.attr('title', videoEnabled ? 'Disable video' : 'Enable video').toggleClass('off', !videoEnabled);\r\n\t\t\t\t}\r\n\t\t\t}) : null;\r\n\r\n\t\t\tvar videoEnlarged = false;\r\n\t\t\tvar $largeVideo = $(\"<span class='interface-btn enlarge-btn buttonicon'>\").attr('title', 'Make video larger').on({\r\n\t\t\t\tclick: function click() {\r\n\t\t\t\t\tvideoEnlarged = !videoEnlarged;\r\n\r\n\t\t\t\t\tif (videoEnlarged) {\r\n\t\t\t\t\t\tenlargedVideos.add(userId);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tenlargedVideos['delete'](userId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$largeVideo.attr('title', videoEnlarged ? 'Make video smaller' : 'Make video larger').toggleClass('large', videoEnlarged);\r\n\r\n\t\t\t\t\tvar videoSize = $(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large') ? videoSizes.large : videoSizes.small;\r\n\t\t\t\t\t$video.parent().css({ width: videoSize, 'max-height': videoSize });\r\n\t\t\t\t\t$video.css({ width: videoSize, 'max-height': videoSize });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif($(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large')){\r\n\t\t\t\t$video.parent().css({ width: videoSizes.large, 'max-height': videoSizes.large });\r\n\t\t\t\t$video.css({ width: videoSizes.large, 'max-height': videoSizes.large });\r\n\t\t\t}\r\n\r\n\t\t\tif(isLocal) localVideoElement = $video;\r\n\r\n\t\t\t$('#interface_' + videoId).remove();\r\n\t\t\t$(\"<div class='interface-container'>\").attr('id', 'interface_' + videoId).append($mute).append($disableVideo).append($largeVideo).insertAfter($video);\r\n\t\t\tself.changeAudioDestination();\r\n\r\n\t\t\t\r\n\t\t\tif(pc[userId]){\r\n\t\t\t\tfunction formatBytes(a,b=2){if(0===a)return\"0 Bytes\";const c=0>b?0:b,d=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,d)).toFixed(c))+\" \"+[\"Bytes\",\"KB\",\"MB\",\"GB\",\"TB\",\"PB\",\"EB\",\"ZB\",\"YB\"][d]}\r\n\r\n\t\t\t\tvar repeatInterval = 2000; // 2000 ms == 2 seconds\r\n\t\t\t\tgetStats(pc[userId], function(result) {\r\n\t\t\t\t\t\tresult.connectionType.remote.ipAddress\r\n\t\t\t\t\t\tresult.connectionType.remote.candidateType\r\n\t\t\t\t\t\tresult.connectionType.transport\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tresult.bandwidth.speed // bandwidth download speed (bytes per second)\r\n\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(bitrate) document.querySelector(\".stats-box #bitrate\").innerText  = `bandwidth: ${formatBytes(result.bandwidth.speed)}`;\r\n\t\t\t\t\t\t// if(headerBytes)document.querySelector(\".stats-box #headerrate\").innerText  = `headerrate: ${formatBytes(headerBytes)}`;\r\n\t\t\t\t\t\t// if(packetpersec)document.querySelector(\".stats-box #packets\").innerText  = `packets: ${packetpersec}`;\r\n\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// to access native \"results\" array\r\n\t\t\t\t\t\tresult.results.forEach(function(item) {\r\n\t\t\t\t\t\t\t\tif (item.type === 'ssrc' && item.transportId === 'Channel-audio-1') {\r\n\t\t\t\t\t\t\t\t\t\tvar packetsLost = item.packetsLost;\r\n\t\t\t\t\t\t\t\t\t\tvar packetsSent = item.packetsSent;\r\n\t\t\t\t\t\t\t\t\t\tvar audioInputLevel = item.audioInputLevel;\r\n\t\t\t\t\t\t\t\t\t\tvar trackId = item.googTrackId; // media stream track id\r\n\t\t\t\t\t\t\t\t\t\tvar isAudio = item.mediaType === 'audio'; // audio or video\r\n\t\t\t\t\t\t\t\t\t\tvar isSending = item.id.indexOf('_send') !== -1; // sender or receiver\r\n\t\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('SendRecv type', item.id.split('_send').pop());\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('MediaStream track type', item.mediaType);\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}, repeatInterval);\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// if(pc[userId] || pc[userId].getStats) {\r\n\t\t\t\t\r\n\t\t\t// }\r\n\r\n\r\n\r\n\r\n\t\t\t// let lastResult;\r\n\t\t\t// window.setInterval(function() {\r\n\t\t\t// \tif(!pc[userId] || !pc[userId].getStats)return false;\r\n\t\t\t// \tpc[userId].getStats(null).then(stats => {\r\n\t\t\t// \t\tlet statsOutput = \"\";\r\n\r\n\t\t\r\n\r\n\t\t\t// \t\tstats.forEach(report => {\r\n\r\n\r\n\t\t\t// \t\t\tif (lastResult && lastResult.has(report.id)) {\r\n\t\t\t// \t\t\t\tconst now = report.timestamp;\r\n\t\t\t// \t\t\t\tlet bytes = report.bytesSent;\r\n\t\t\t// \t\t\t\tlet headerBytes = report.headerBytesSent;\r\n\t\t\t// \t\t\t\tlet packets = report.packetsSent;\r\n\t\t\t// \t\t\t\tconst bitrate = 8 * (bytes - lastResult.get(report.id).bytesSent) / (now - lastResult.get(report.id).timestamp);\r\n\t\t\t// \t\t\t\t// const headerrate = 8 * (headerBytes - lastResult.get(report.id).headerBytesSent) / (now - lastResult.get(report.id).timestamp);\r\n\t\t\r\n\t\t\t// \t\t\t\tconst packetpersec = packets - lastResult.get(report.id).packetsSent\r\n\r\n\r\n\t\t\t// \t\t\t\t// console.log(`bitrate: ${bitrate}, headerrate: ${headerrate}, packets: ${packetpersec}`)\r\n\r\n\t\t\t// \t\t\t\tif(bitrate) document.querySelector(\".stats-box #bitrate\").innerText  = `bitrate: ${formatBytes(bitrate)}`;\r\n\t\t\t// \t\t\t\tif(headerBytes)document.querySelector(\".stats-box #headerrate\").innerText  = `headerrate: ${formatBytes(headerBytes)}`;\r\n\t\t\t// \t\t\t\tif(packetpersec)document.querySelector(\".stats-box #packets\").innerText  = `packets: ${packetpersec}`;\r\n\t\t\t// \t\t\t}\r\n\r\n\r\n\r\n\t\t\t// \t\t\tstatsOutput += `<h2>Report: ${report.type}</h3>\\n<strong>ID:</strong> ${report.id}<br>\\n` +\r\n\t\t\t// \t\t\t\t\t\t\t\t\t\t `<strong>Timestamp:</strong> ${report.timestamp}<br>\\n`;\r\n\t\t\t\t\t\t\r\n\t\t\t// \t\t\t// Now the statistics for this report; we intentially drop the ones we\r\n\t\t\t// \t\t\t// sorted to the top above\r\n\t\t\t\r\n\t\t\t// \t\t\tObject.keys(report).forEach(statName => {\r\n\t\t\t// \t\t\t\tif (statName !== \"id\" && statName !== \"timestamp\" && statName !== \"type\") {\r\n\t\t\t// \t\t\t\t\tstatsOutput += `<strong>${statName}:</strong> ${report[statName]}<br>\\n`;\r\n\t\t\t// \t\t\t\t}\r\n\t\t\t// \t\t\t});\r\n\t\t\t// \t\t});\r\n\t\t\t\r\n\t\t\t// \t\tdocument.querySelector(\".stats-box .box\").innerHTML = statsOutput;\r\n\t\t\t// \t\tlastResult = stats;\r\n\t\t\t// \t});\r\n\t\t\t// }, 1000);\r\n\r\n\r\n\t\t},\r\n\t\t// Sends a stat to the back end. `statName` must be in the\r\n\t\t// approved list on the server side.\r\n\t\tsendErrorStat: function sendErrorStat(statName) {\r\n\t\t\tvar msg = { component: 'pad', type: 'STATS', data: { statName: statName, type: 'RTC_MESSAGE' } };\r\n\t\t\tconsole.error(\"[wrtc]: \", msg)\r\n\t\t\t// self._pad.socket.json.send(msg);\r\n\t\t},\r\n\t\tsendMessage: function sendMessage(to, data) {\r\n\t\t\tsocket.emit(\"RTC_MESSAGE\", {\r\n\t\t\t\ttype: 'RTC_MESSAGE',\r\n\t\t\t\tclient: {\r\n\t\t\t\t\tuserId: clientVars.userId, \r\n\t\t\t\t\tname: clientVars.userName,\r\n\t\t\t\t\tpadId:clientVars.padId,\r\n\t\t\t\t\theaderId: window.headerId\r\n\t\t\t\t},\r\n\t\t\t\tpayload: { data: data, to: to }\r\n\t\t\t});\r\n\t\t},\r\n\t\treceiveMessage: function receiveMessage(msg) {\r\n\t\t\tvar peer = msg.from; // userId sender\r\n\t\t\tvar data = msg.data;\r\n\t\t\tvar type = data.type;\r\n\t\t\tif (peer === self.getUserId()) {\r\n\t\t\t\t// console.info('ignore own messages');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t/*\r\n      if (type != 'icecandidate')\r\n        console.info('receivedMessage', 'peer', peer, 'type', type, 'data', data);\r\n      */\r\n\t\t\tif (type === 'hangup') {\r\n\t\t\t\tself.hangup(peer, true);\r\n\t\t\t} else if (type === 'offer') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tself.hangup(peer, true);\r\n\t\t\t\t\tself.createPeerConnection(peer, data.headerId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.createPeerConnection(peer, data.headerId);\r\n\t\t\t\t}\r\n\t\t\t\tif (localStream) {\r\n\t\t\t\t\tif (pc[peer].getLocalStreams) {\r\n\t\t\t\t\t\tif (!pc[peer].getLocalStreams().length) {\r\n\t\t\t\t\t\t\tpc[peer].addStream(localStream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (pc[peer].localStreams) {\r\n\t\t\t\t\t\tif (!pc[peer].localStreams.length) {\r\n\t\t\t\t\t\t\tpc[peer].addStream(localStream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar offer = new RTCSessionDescription(data.offer);\r\n\t\t\t\tpc[peer].setRemoteDescription(offer, function () {\r\n\t\t\t\t\tpc[peer].createAnswer(function (desc) {\r\n\t\t\t\t\t\tdesc.sdp = cleanupSdp(desc.sdp);\r\n\t\t\t\t\t\tpc[peer].setLocalDescription(desc, function () {\r\n\t\t\t\t\t\t\tself.sendMessage(peer, { type: 'answer', answer: desc, headerId: data.headerId });\r\n\t\t\t\t\t\t}, logError);\r\n\t\t\t\t\t}, logError, sdpConstraints);\r\n\t\t\t\t}, logError);\r\n\t\t\t} else if (type === 'answer') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tvar answer = new RTCSessionDescription(data.answer);\r\n\t\t\t\t\tpc[peer].setRemoteDescription(answer, function () {}, logError);\r\n\t\t\t\t}\r\n\t\t\t} else if (type === 'icecandidate') {\r\n\t\t\t\tif (pc[peer]) {\r\n\t\t\t\t\tvar candidate = new RTCIceCandidate(data.candidate);\r\n\t\t\t\t\tvar p = pc[peer].addIceCandidate(candidate);\r\n\t\t\t\t\tif (p) {\r\n\t\t\t\t\t\tp.then(function () {\r\n\t\t\t\t\t\t\t// Do stuff when the candidate is successfully passed to the ICE agent\r\n\t\t\t\t\t\t})['catch'](function () {\r\n\t\t\t\t\t\t\tconsole.error('Error: Failure during addIceCandidate()', data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error('unknown message', data);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\thangupAll: function hangupAll(_headerId) {\r\n\t\t\tObject.keys(pc).forEach(function (userId) {\r\n\t\t\t\tself.hangup(userId, true, _headerId);\r\n\t\t\t});\r\n\t\t},\r\n\t\thangup: function hangup(userId, notify, headerId) {\r\n\t\t\tnotify = arguments.length === 1 ? true : notify;\r\n\t\t\tif (pc[userId] && userId !== self.getUserId()) {\r\n\t\t\t\tself.setStream(userId, null);\r\n\t\t\t\tpc[userId].close();\r\n\t\t\t\tdelete pc[userId];\r\n\t\t\t\tif (notify) self.sendMessage(userId, { type: 'hangup', headerId: headerId });\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tgetUserId: function getUserId() {\r\n\t\t\treturn clientVars.userId || window.pad.getUserId();\r\n\t\t},\r\n\t\tcall: function call(userId, headerId) {\r\n\t\t\tif (!localStream) {\r\n\t\t\t\tcallQueue.push(userId);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar constraints = { optional: [], mandatory: {} };\r\n\t\t\t// temporary measure to remove Moz* constraints in Chrome\r\n\t\t\tif (webrtcDetectedBrowser === 'chrome') {\r\n\t\t\t\tfor (var prop in constraints.mandatory) {\r\n\t\t\t\t\tif (prop.indexOf('Moz') !== -1) {\r\n\t\t\t\t\t\tdelete constraints.mandatory[prop];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconstraints = mergeConstraints(constraints, sdpConstraints);\r\n\r\n\t\t\tif (!pc[userId]) {\r\n\t\t\t\tself.createPeerConnection(userId, headerId);\r\n\t\t\t}\r\n\t\t\tpc[userId].addStream(localStream);\r\n\t\t\tpc[userId].createOffer(function (desc) {\r\n\t\t\t\tdesc.sdp = cleanupSdp(desc.sdp);\r\n\t\t\t\tpc[userId].setLocalDescription(desc, function () {\r\n\t\t\t\t\tself.sendMessage(userId, { type: 'offer', offer: desc, headerId: headerId });\r\n\t\t\t\t}, logError);\r\n\t\t\t}, logError, constraints);\r\n\t\t},\r\n\t\tcreatePeerConnection: function createPeerConnection(userId, headerId) {\r\n\t\t\tif (pc[userId]) {\r\n\t\t\t\tconsole.warn('WARNING creating PC connection even though one exists', userId);\r\n\t\t\t}\r\n\t\t\tpc[userId] = new RTCPeerConnection(pcConfig, pcConstraints);\r\n\t\t\tpc[userId].onicecandidate = function (event) {\r\n\t\t\t\tif (event.candidate) {\r\n\t\t\t\t\tself.sendMessage(userId, {\r\n\t\t\t\t\t\ttype: 'icecandidate',\r\n\t\t\t\t\t\theaderId: headerId,\r\n\t\t\t\t\t\tcandidate: event.candidate\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tpc[userId].onaddstream = function (event) {\r\n\t\t\t\tremoteStream[userId] = event.stream;\r\n\t\t\t\tself.setStream(userId, event.stream);\r\n\t\t\t};\r\n\t\t\tpc[userId].onremovestream = function () {\r\n\t\t\t\tself.setStream(userId, null);\r\n\t\t\t};\r\n\r\n\t\t},\r\n\t\taudioVideoInputChange: function audioVideoInputChange() {\r\n\t\t\tlocalStream.getTracks().forEach(function (track) {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t});\r\n\t\t\tself.getUserMedia(window.headerId);\r\n\t\t},\r\n\t\tattachSinkId: function attachSinkId(element, sinkId) {\r\n\t\t\t// Attach audio output device to video element using device/sink ID.\r\n\t\t\tif (element && element[0] && typeof element[0].sinkId !== 'undefined') {\r\n\t\t\t\telement[0].setSinkId(sinkId).then(() => {\r\n\t\t\t\t\t\t\tconsole.info(`Success, audio output device attached: ${sinkId}`);\r\n\t\t\t\t\t\t})['catch'](error => {\r\n\t\t\t\t\t\t\tvar errorMessage = error;\r\n\t\t\t\t\t\t\tif (error.name === 'SecurityError') {\r\n\t\t\t\t\t\t\t\terrorMessage = `You need to use HTTPS for selecting audio output device: ${error}`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.error(errorMessage);\r\n\t\t\t\t\t\t\t// Jump back to first output device in the list as it's the default.\r\n\t\t\t\t\t\t\taudioOutputSelect.selectedIndex = 0;\r\n\t\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('Browser does not support output device selection.');\r\n\t\t\t}\r\n\t\t},\r\n\t\tchangeAudioDestination: function changeAudioDestination() {\r\n\t\t\tvar audioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\tvar audioDestination = audioOutputSelect.value;\r\n\t\t\tvar videoElement = localVideoElement\r\n\t\t\tself.attachSinkId(videoElement, audioDestination);\r\n\t\t},\r\n\t\tgetUserMedia: function getUserMedia(headerId) {\r\n\t\t\taudioInputSelect = document.querySelector('select#audioSource');\r\n\t\t\tvideoSelect = document.querySelector('select#videoSource');\r\n\t\t\taudioOutputSelect = document.querySelector('select#audioOutput');\r\n\t\t\t\r\n\t\t\tvar audioSource = audioInputSelect.value;\r\n\t\t\tvar videoSource = videoSelect.value;\r\n\t\t\tvar audioOutput = audioOutputSelect.value;\r\n\r\n\t\t\tvar mediaConstraints = {\r\n\t\t\t\taudio: true,\r\n\t\t\t\tvideo: {\r\n\t\t\t\t\toptional: [],\r\n\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\tmaxWidth: 320,\r\n\t\t\t\t\t\tmaxHeight: 240\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (audioSource) {\r\n\t\t\t\tmediaConstraints.audio = { deviceId: { exact: audioSource } };\r\n\t\t\t}\r\n\t\t\tif (videoSource) {\r\n\t\t\t\tmediaConstraints.video = { deviceId: { exact: videoSource } };\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\r\n\t\t\tlocalStorage.setItem('videoSettings', JSON.stringify({ microphone: audioSource, speaker: audioOutput, camera: videoSource }));\r\n\r\n\t\t\twindow.navigator.mediaDevices.getUserMedia(mediaConstraints).then(function (stream) {\r\n\t\t\t\tlocalStream = stream;\r\n\t\t\t\tself.setStream(self.getUserId(), stream);\r\n\t\t\t\tself._pad.collabClient.getConnectedUsers().forEach(function (user) {\r\n\t\t\t\t\tif (user.userId !== self.getUserId()) {\r\n\t\t\t\t\t\tif (pc[user.userId]) {\r\n\t\t\t\t\t\t\tself.hangup(user.userId, false, headerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.call(user.userId, headerId);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})['catch'](function (err) {\r\n\t\t\t\tself.showUserMediaError(err);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t// Normalize RTC implementation between browsers\r\n\t// var getUserMedia = window.navigator.mediaDevices.getUserMedia\r\n\tvar attachMediaStream = function attachMediaStream(element, stream) {\r\n\t\tif (typeof element.srcObject !== 'undefined') {\r\n\t\t\telement.srcObject = stream;\r\n\t\t} else if (typeof element.mozSrcObject !== 'undefined') {\r\n\t\t\telement.mozSrcObject = stream;\r\n\t\t} else if (typeof element.src !== 'undefined') {\r\n\t\t\telement.src = URL.createObjectURL(stream);\r\n\t\t} else {\r\n\t\t\tconsole.error('Error attaching stream to element.', element);\r\n\t\t}\r\n\t};\r\n\tvar webrtcDetectedBrowser = 'chrome';\r\n\r\n\t// Set Opus as the default audio codec if it's present.\r\n\tfunction preferOpus(sdp) {\r\n\t\tvar sdpLines = sdp.split('\\r\\n');\r\n\t\tvar mLineIndex = null;\r\n\r\n\t\t// Search for m line.\r\n\t\tfor (var i = 0; i < sdpLines.length; i++) {\r\n\t\t\tif (sdpLines[i].search('m=audio') !== -1) {\r\n\t\t\t\tmLineIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (mLineIndex === null) return sdp;\r\n\r\n\t\t// If Opus is available, set it as the default in m line.\r\n\t\tfor (var j = 0; j < sdpLines.length; j++) {\r\n\t\t\tif (sdpLines[j].search('opus/48000') !== -1) {\r\n\t\t\t\tvar opusPayload = extractSdp(sdpLines[j], /:(\\d+) opus\\/48000/i);\r\n\t\t\t\tif (opusPayload) sdpLines[mLineIndex] = setDefaultCodec(sdpLines[mLineIndex], opusPayload);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove CN in m line and sdp.\r\n\t\tsdpLines = removeCN(sdpLines, mLineIndex);\r\n\r\n\t\tsdp = sdpLines.join('\\r\\n');\r\n\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction extractSdp(sdpLine, pattern) {\r\n\t\tvar result = sdpLine.match(pattern);\r\n\t\treturn result && result.length === 2 ? result[1] : null;\r\n\t}\r\n\r\n\t// Set the selected codec to the first in m line.\r\n\tfunction setDefaultCodec(mLine, payload) {\r\n\t\tvar elements = mLine.split(' ');\r\n\t\tvar newLine = [];\r\n\t\tvar index = 0;\r\n\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\tif (index === 3) {\r\n\t\t\t\t// Format of media starts from the fourth.\r\n\t\t\t\tnewLine[index++] = payload;\r\n\t\t\t}\r\n\t\t\t// Put target payload to the first.\r\n\t\t\tif (elements[i] !== payload) newLine[index++] = elements[i];\r\n\t\t}\r\n\t\treturn newLine.join(' ');\r\n\t}\r\n\r\n\t// Strip CN from sdp before CN constraints is ready.\r\n\tfunction removeCN(sdpLines, mLineIndex) {\r\n\t\tvar mLineElements = sdpLines[mLineIndex].split(' ');\r\n\t\t// Scan from end for the convenience of removing an item.\r\n\t\tfor (var i = sdpLines.length - 1; i >= 0; i--) {\r\n\t\t\tvar payload = extractSdp(sdpLines[i], /a=rtpmap:(\\d+) CN\\/\\d+/i);\r\n\t\t\tif (payload) {\r\n\t\t\t\tvar cnPos = mLineElements.indexOf(payload);\r\n\t\t\t\tif (cnPos !== -1) {\r\n\t\t\t\t\t// Remove CN payload from m line.\r\n\t\t\t\t\tmLineElements.splice(cnPos, 1);\r\n\t\t\t\t}\r\n\t\t\t\t// Remove CN line in sdp\r\n\t\t\t\tsdpLines.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsdpLines[mLineIndex] = mLineElements.join(' ');\r\n\t\treturn sdpLines;\r\n\t}\r\n\r\n\tfunction sdpRate(sdp, rate) {\r\n\t\trate = rate || 1638400;\r\n\t\treturn sdp.replace(/b=AS:\\d+\\r/g, 'b=AS:' + rate + '\\r');\r\n\t}\r\n\r\n\tfunction cleanupSdp(sdp) {\r\n\t\tsdp = preferOpus(sdp);\r\n\t\tsdp = sdpRate(sdp);\r\n\t\treturn sdp;\r\n\t}\r\n\r\n\tfunction mergeConstraints(cons1, cons2) {\r\n\t\tvar merged = cons1;\r\n\t\tfor (var name in cons2.mandatory) {\r\n\t\t\tmerged.mandatory[name] = cons2.mandatory[name];\r\n\t\t}\r\n\t\tmerged.optional.concat(cons2.optional);\r\n\t\treturn merged;\r\n\t}\r\n\r\n\tfunction logError(error) {\r\n\t\t// attempt to reconnect\r\n\t\tconsole.error('WebRTC ERROR:', error);\r\n\t}\r\n\r\n\tself.pc = pc;\r\n\treturn self;\r\n})();","'use strict';\r\n\r\n// var share = require('ep_wrtc_heading/static/js/clientShare');\r\n// var textChat = require('ep_wrtc_heading/static/js/textChat');\r\n// var videoChat = require('ep_wrtc_heading/static/js/videoChat');\r\n// new comment so wat?\r\n\r\nvar WRTC_Room = (function WRTC_Room() {\r\n\tvar self = null;\r\n\tvar socket = null;\r\n\tvar padId = null;\r\n\tvar VIDEOCHATLIMIT = 0;\r\n\t// var $lastJoinButton = null;\r\n\tvar prefixHeaderId = 'headingTagId_';\r\n\tvar hElements = \"h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6\";\r\n\r\n\r\n\tfunction postAceInit(hook, context, webSocket, docId) {\r\n\t\tsocket = webSocket;\r\n\t\tpadId = docId;\r\n\t\tVIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n\r\n\t\tsocket.on('userJoin', function (data, roomInfo, target) {\r\n\t\t\tif (target === 'video') {\r\n\t\t\t\tvideoChat.gateway_userJoin(data, roomInfo, false);\r\n\t\t\t} else {\r\n\t\t\t\ttextChat.addUserToRoom(data, roomInfo, target);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on('userLeave', function (data, roomInfo, target) {\r\n\t\t\tif (target === 'video') {\r\n\t\t\t\tvideoChat.gateway_userLeave(data, roomInfo, target);\r\n\t\t\t} else {\r\n\t\t\t\ttextChat.removeUserFromRoom(data, roomInfo, target);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tactiveEventListener();\r\n\r\n\t\t// check if there is a join request in URI queryString\r\n\t\t// TODO: befre check this, the tags must be ready\r\n\t\tsetTimeout(function () {\r\n\t\t\tjoinByQueryString();\r\n\t\t}, 500);\r\n\t}\r\n\r\n\r\n\t/** --------- Helper --------- */\r\n\r\n\tfunction link2Clipboard(text) {\r\n\t\tvar $temp = $('<input>');\r\n\t\t$('body').append($temp);\r\n\t\t$temp.val(text).select();\r\n\t\tdocument.execCommand('copy');\r\n\t\t$temp.remove();\r\n\t\t$.gritter.add({\r\n\t\t\ttitle: 'Copied',\r\n\t\t\ttext: 'Join link copied to clip board',\r\n\t\t\tsticky: false,\r\n\t\t\tclass_name: 'copyLinkToClipboard',\r\n\t\t\ttime: '3000'\r\n\t\t});\r\n\t}\r\n\r\n\tfunction scroll2Header(headerId) {\r\n\t\tvar padContainer = share.$body_ace_outer().find('iframe').contents().find('#innerdocbody');\r\n\t\tpadContainer.find('.' + prefixHeaderId + headerId).each(function scrolling() {\r\n\t\t\tthis.scrollIntoView({\r\n\t\t\t\tbehavior: 'smooth'\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeTextChat () {\r\n\t\t$('#wrtc_textChatWrapper .btn_leave').trigger('click');\r\n\t}\r\n\r\n\tfunction joinChatRoom(headerId, userInfo, target) {\r\n\t\t// textChat.userJoin(headerId, userInfo, 'TEXTPLUS');\r\n\t\tvideoChat.userJoin(headerId, userInfo, 'PLUS');\r\n\t\tcloseTextChat();\r\n\t}\r\n\t\r\n\tfunction leaveChatRoom(headerId, userInfo, target) {\r\n\t\t// textChat.userLeave(headerId, userInfo, 'TEXTPLUS');\r\n\t\tvideoChat.userLeave(headerId, userInfo, 'PLUS');\r\n\t\tcloseTextChat();\r\n\t}\r\n\r\n\t/**\r\n  *\r\n  * @param {string} actions @enum (JOIN|LEAVE)\r\n  * @param {string} headerId\r\n  * @param {string} target @enum (chatRoom|video|text)\r\n  */\r\n\tfunction roomBtnHandler(actions, headerId, target) {\r\n\t\tif(typeof actions !== 'string') {\r\n\t\t\tactions.preventDefault();\r\n\t\t\t// actions.stopPropagation();\r\n\t\t}\r\n\t\theaderId = $(this).attr('data-id') || headerId;\r\n\t\tactions = $(this).attr('data-action') || actions;\r\n\t\ttarget = $(this).attr('data-join') || target;\r\n\r\n\t\tif (!headerId || !target ) return true;\r\n\r\n\t\tvar $joinBtn = $(this);\r\n\r\n\t\tvar userInfo = {\r\n\t\t\tpadId: clientVars.padId || window.pad.getPadId(),\r\n\t\t\tuserId: clientVars.userId || window.pad.getUserId(),\r\n\t\t\tuserName: clientVars.userName || 'anonymous',\r\n\t\t\theaderId: headerId,\r\n\t\t\ttarget: target,\r\n\t\t\taction: actions\r\n\t\t};\r\n\r\n\t\tshare.wrtcPubsub.emit('disable room buttons', headerId, actions, target);\r\n\r\n\t\tif (actions === 'JOIN') {\r\n\t\t\tswitch (target) {\r\n\t\t\t\tcase 'PLUS':\r\n\t\t\t\t\tjoinChatRoom(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VIDEO':\r\n\t\t\t\t\tvideoChat.userJoin(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TEXT':\r\n\t\t\t\t\ttextChat.userJoin(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if (actions === 'LEAVE') {\r\n\t\t\tswitch (target) {\r\n\t\t\t\tcase 'PLUS':\r\n\t\t\t\t\tleaveChatRoom(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VIDEO':\r\n\t\t\t\t\tvideoChat.userLeave(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TEXT':\r\n\t\t\t\t\ttextChat.userLeave(headerId, userInfo, target);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if(actions === 'RELOAD') {\r\n\t\t\tvideoChat.reloadSession(headerId, userInfo, target, actions);\r\n\t\t} else if(actions === 'SHARELINK') {\r\n\t\t\tshareRoomsLink(headerId, target);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction joinByQueryString() {\r\n\t\tvar urlParams = new URLSearchParams(window.location.search);\r\n\t\tvar headerId = urlParams.get('id');\r\n\t\tvar target = urlParams.get('target');\r\n\t\tvar join = urlParams.get('join');\r\n\r\n\t\tif(!headerId) return true;\r\n\r\n\t\tvar isHeading = share.$body_ace_outer().find('#' + headerId);\r\n\r\n\t\tif(!isHeading.length){\r\n\t\t\t$.gritter.add({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\ttext: \"The header seems not to exist anymore!\",\r\n\t\t\t\ttime: 3000,\r\n\t\t\t\tsticky: false,\r\n\t\t\t\tclass_name: 'error'\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (headerId) {\r\n\t\t\tscroll2Header(headerId);\r\n\t\t}\r\n\t\tif (join === 'true') {\r\n\t\t\ttarget = target.toUpperCase();\r\n\t\t\tsetTimeout(function makeSureHeadingReady() {\r\n\t\t\t\troomBtnHandler('JOIN', headerId, target);\r\n\t\t\t}, 700);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction shareRoomsLink(headId, target) {\r\n\t\theadId = $(this).attr('data-id') || headId;\r\n\t\ttarget = $(this).attr('data-join') || target;\r\n\t\tvar title = share.$body_ace_outer().find('.wbrtc_roomBox.' + headId + ' .titleRoom').text();\r\n\r\n\t\tvar origin = window.location.origin;\r\n\t\tvar pathName = window.location.pathname;\r\n\t\tvar link = origin + pathName + '?header=' + share.slugify(title) + '&id=' + headId + '&target=' + target + '&join=true';\r\n\r\n\t\tvar $temp = $('<input>');\r\n\t\t$('body').append($temp);\r\n\t\t$temp.val(link).select();\r\n\t\tdocument.execCommand('copy');\r\n\t\t$temp.remove();\r\n\r\n\t\t$.gritter.add({\r\n\t\t\ttitle: 'Copied',\r\n\t\t\ttext: 'Join link copied to clip board',\r\n\t\t\tsticky: false,\r\n\t\t\tclass_name: 'copyLinkToClipboard',\r\n\t\t\ttime: '3000'\r\n\t\t});\r\n\t}\r\n\r\n\tfunction getHeaderRoomY($element) {\r\n\t\tvar height = $element.outerHeight();\r\n\t\tvar paddingTop = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-top');\r\n\t\tvar aceOuterPadding = parseInt(paddingTop, 10);\r\n\t\tvar offsetTop = Math.ceil($element.offset().top + aceOuterPadding);\r\n\t\treturn offsetTop + height / 2 - 26;\r\n\t}\r\n\r\n\tfunction getHeaderRoomX($element) {\r\n\t\tvar width = $element.outerWidth();\r\n\t\tvar paddingLeft = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-left');\r\n\t\tvar aceOuterPadding = parseInt(paddingLeft, 10);\r\n\t\tvar offsetLeft = Math.ceil(share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset().left - aceOuterPadding);\r\n\t\treturn offsetLeft - width - 6;\r\n\t}\r\n\r\n\tfunction activeEventListener() {\r\n\t\tvar $wbrtc_roomBox = share.$body_ace_outer();\r\n\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_text', roomBtnHandler);\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_video', roomBtnHandler);\r\n\t\t$wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_chatRoom', roomBtnHandler);\r\n\r\n\t\t$(document).on('click', '#chattext .wrtc_roomLink', roomBtnHandler);\r\n\r\n\t\t$(document).on('click', '#werc_toolbar .btn_roomHandler, .btn_controllers .btn_roomHandler', roomBtnHandler);\r\n\r\n\t\t// ep_full_hyperlinks link listner\r\n\t\t$wbrtc_roomBox.on('click', 'a.btn_roomHandler', roomBtnHandler)\r\n\t\t$(document).on('click', 'a.btn_roomHandler', roomBtnHandler)\r\n\t\t// share.$body_ace_outer().on('mouseenter', '.wbrtc_roomBox', function mouseenter() {\r\n\t\t// \t$(this).parent().css({ overflow: 'initial' });\r\n\t\t// \t$(this).addClass('active').find('.wrtc_contentBody').css({ display: 'block' });\r\n\t\t// }).on('mouseleave', '.wbrtc_roomBox', function mouseleave() {\r\n\t\t// \t$(this).parent().css({ overflow: 'hidden' });\r\n\t\t// \t$(this).removeClass('active').find('.wrtc_contentBody').css({ display: 'none' });\r\n\t\t// });\r\n\r\n\t\tshare.$body_ace_outer().on('click', '.wbrtc_roomBoxFooter > button.btn_share', function click() {\r\n\t\t\tvar headerURI = $(this).find('input').val();\r\n\t\t\tlink2Clipboard(headerURI);\r\n\t\t});\r\n\r\n\t\t// share.$body_ace_outer().on('mouseenter', '.wrtc_roomInlineAvatar .avatar', function mouseenter() {\r\n\t\t// \tvar id = $(this).parent().parent().attr('id');\r\n\t\t// \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseenter');\r\n\t\t// }).on('mouseleave', '.wrtc_roomInlineAvatar .avatar', function mouseleave() {\r\n\t\t// \tvar id = $(this).parent().parent().attr('id');\r\n\t\t// \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseleave');\r\n\t\t// });\r\n\r\n\t\t$(document).on('click', '#werc_toolbar p, .textChatToolbar b', function click() {\r\n\t\t\tvar headerId = $(this).attr('data-id');\r\n\t\t\tscroll2Header(headerId);\r\n\t\t});\r\n\r\n\t\t$(document).on('click', '#werc_toolbar .btn_enlarge', function click() {\r\n\t\t\tif (!$(this).attr('active')) return true;\r\n\r\n\t\t\t$(this).toggleClass('large');\r\n\r\n\t\t\t$('#wrtc_modal .video-container .enlarge-btn').each(function trigger() {\r\n\t\t\t\t$(this).trigger('click');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// video interface settings\r\n\t\t$(document).on('click', '#werc_toolbar .btn_videoSetting', function click() {\r\n\t\t\tvar offset = $(this).position();\r\n\t\t\tvar $box = $(document).find('#wrtc_settings');\r\n\t\t\tvar width = $box.outerWidth();\r\n\t\t\t$box.css({left: offset.left - width  + 'px',top: offset.top + 4 + 'px'}).toggleClass('active');\r\n\t\t});\r\n\r\n\t\t$(document).on('click', '#wrtc_settings .btn_close', function click() {\r\n\t\t\t$('#wrtc_settings').toggleClass('active');\r\n\t\t});\r\n\t}\r\n\r\n\tself = {\r\n\t\tpostAceInit: postAceInit,\r\n\t\tgetHeaderRoomX: getHeaderRoomX,\r\n\t\taceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n\t\t\tif (context.author) {\r\n\t\t\t\tvar user = share.getUserFromId(context.author);\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\t// sync user info\r\n\t\t\t\t\tshare.$body_ace_outer().find(\".wrtc_content.textChat ul li[data-id='\" + user.userId + \"']\").css({ 'border-color': user.colorId }).text(user.name);\r\n\t\t\t\t\tshare.$body_ace_outer().find(\".wrtc_content.videoChat ul li[data-id='\" + user.userId + \"']\").css({ 'border-color': user.colorId }).text(user.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLeave: function userLeave(context, callback) {\r\n\t\t\t// Deprecated, we use socket disconnect\r\n\r\n\t\t\tcallback();\r\n\t\t},\r\n\t\tbulkUpdateRooms: function bulkUpdateRooms(hTagList) {\r\n\t\t\tvideoChat.bulkUpdateRooms(hTagList);\r\n\t\t\ttextChat.bulkUpdateRooms(hTagList);\r\n\t\t},\r\n\t\tadoptHeaderYRoom: function adoptHeaderYRoom() {\r\n\t\t\t// Set all video_heading to be inline with their target REP\r\n\t\t\tvar $padOuter = share.$body_ace_outer();\r\n\t\t\tif (!$padOuter) return;\r\n\r\n\t\t\t$padOuter.find('.wbrtc_roomBox, .wrtc_roomInlineAvatar ').each(function adjustHeaderIconPosition() {\r\n\t\t\t\tvar $el = $(this);\r\n\t\t\t\tvar $boxId = $el.attr('id');\r\n\t\t\t\tvar hClassId = 'headingTagId_' + $boxId;\r\n\t\t\t\tvar $headingEl = $padOuter.find('iframe').contents().find('#innerdocbody').find('.' + hClassId);\r\n\r\n\t\t\t\t// if the H tags does not find, remove chatBox\r\n\t\t\t\t// TODO: and kick out the user form the chatBox\r\n\t\t\t\tif ($headingEl.length <= 0) {\r\n\t\t\t\t\t$el.remove();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($el.attr('data-box') === 'avatar') $el.css({ left: getHeaderRoomX($el) + 'px' });\r\n\t\t\t\t$el.css({ top: getHeaderRoomY($headingEl) + 'px' });\r\n\t\t\t});\r\n\t\t},\r\n\t\tfindTags: function findTags() {\r\n\t\t\tvar hTagList = [];\r\n\t\t\tvar hTagElements = hElements;\r\n\t\t\tvar hTags = share.$body_ace_outer().find('iframe').contents().find('#innerdocbody').children('div').children(hTagElements);\r\n\t\t\tvar aceInnerOffset = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset();\r\n\t\t\tvar target = share.$body_ace_outer().find('#outerdocbody');\r\n\t\t\tvar newHTagAdded = false;\r\n\r\n\t\t\t$(hTags).each(function createWrtcRoomBox() {\r\n\t\t\t\tvar $el = $(this);\r\n\t\t\t\t// var lineNumber = $el.parent().prevAll().length;\r\n\t\t\t\t// var tag = $(\"#title\")[0].tagName.toLowerCase();\r\n\t\t\t\tvar newY = getHeaderRoomY($el);\r\n\t\t\t\tvar newX = Math.ceil(aceInnerOffset.left);\r\n\t\t\t\tvar headingTagId = $el.find('span').attr('class');\r\n\t\t\t\theadingTagId = /(?:^| )headingTagId_([A-Za-z0-9]*)/.exec(headingTagId);\r\n\r\n\t\t\t\tif (!headingTagId) {\r\n\t\t\t\t\tconsole.warn(\"[wrtc]: couldn't find headingTagId.\")\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar data = {\r\n\t\t\t\t\theadingTagId: headingTagId[1],\r\n\t\t\t\t\t// tag: tag,\r\n\t\t\t\t\tpositionTop: newY,\r\n\t\t\t\t\tpositionLeft: newX,\r\n\t\t\t\t\theadTitle: $el.text(),\r\n\t\t\t\t\t// lineNumber: lineNumber,\r\n\t\t\t\t\tvideoChatLimit: VIDEOCHATLIMIT\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (!share.wrtcStore[data.headingTagId]) share.wrtcStore[data.headingTagId] = { VIDEO: { list: [] }, TEXT: { list: [] }, USERS: {} };\r\n\r\n\t\t\t\t// if the header does not exists then adde to list\r\n\t\t\t\t// otherwise update textHeader\r\n\t\t\t\t// TODO: performance issue\r\n\t\t\t\tif (target.find('#' + data.headingTagId).length <= 0) {\r\n\t\t\t\t\tvar box = $('#wertc_roomBox').tmpl(data);\r\n\t\t\t\t\ttarget.find('#wbrtc_chatBox').append(box);\r\n\t\t\t\t\tvar avatarBox = $('#wertc_inlineAvatar').tmpl(data);\r\n\t\t\t\t\ttarget.find('#wbrtc_avatarCol').append(avatarBox);\r\n\t\t\t\t\tnewHTagAdded = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(document).find('[data-headid=' + data.headingTagId + '].wrtc_text .wrtc_roomLink, #werc_toolbar p[data-id=' + data.headingTagId + ']').text(data.headTitle);\r\n\t\t\t\t\ttarget.find('.wbrtc_roomBox[id=' + data.headingTagId + '] .titleRoom').text(data.headTitle);\r\n\t\t\t\t\t$(document).find('#wrtc_textChatWrapper[data-id=' + data.headingTagId + '] .nd_title b').text(data.headTitle);\r\n\t\t\t\t}\r\n\r\n\t\t\t\thTagList.push(data);\r\n\t\t\t});\r\n\t\t\t// if a new h tag addedd check all heading again!\r\n\t\t\tif (newHTagAdded) {\r\n\t\t\t\tself.bulkUpdateRooms(hTagList);\r\n\t\t\t\tnewHTagAdded = false;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn self;\r\n})();"]}